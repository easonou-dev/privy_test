const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-CSHNl68v.js","assets/index-C4XRDiHp.js","assets/lit-element-CQT_gvNE.js","assets/basic-Uba6gPM7.js","assets/class-map-BUQwRYdT.js","assets/index-Gs568PQj.js","assets/index-D_sE5vDe.js","assets/ref-BAUA0BIo.js","assets/w3m-modal-CzytgwBZ.js"])))=>i.map(i=>d[i]);
import{C as as,D as up,N as dn,O as jn,P as Ya,Q as hp,R as dp,S as pp,V as fp,W as gp,X as vc,Y as ai,Z as Ec,$ as j,a0 as xt,a1 as mp,a2 as wp,a3 as rt,a4 as ia,a5 as Zu,a6 as lr,F as en,G as Xu,J as ht,a7 as yp,a8 as $t,a9 as Xs,aa as ci,ab as Za,ac as jt,ad as bp,ae as Xa,af as Qa,ag as Yn,ah as ec,ai as Ic,aj as vp,ak as Ep,al as Br,am as Qu,an as gs,ao as ns,_ as na,K as eh,ap as Cs,aq as Qt,I as pn,L as Cc}from"./index-C4XRDiHp.js";import{B as mi,c as Nc,r as zt,i as Wr}from"./lit-element-CQT_gvNE.js";var Ac={};const V={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"ID_AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin",cosmos:"Cosmos"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],HTTP_STATUS_CODES:{SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network",SECURE_SITE_SDK_ORIGIN:(typeof as<"u"&&typeof Ac<"u"?Ac.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org"},th={caipNetworkIdToNumber(t){return t?Number(t.split(":")[1]):void 0},parseEvmChainId(t){return typeof t=="string"?this.caipNetworkIdToNumber(t):t},getNetworksByNamespace(t,e){return(t==null?void 0:t.filter(s=>s.chainNamespace===e))||[]},getFirstNetworkByNamespace(t,e){return this.getNetworksByNamespace(t,e)[0]},getNetworkNameByCaipNetworkId(t,e){var i;if(!e)return;const s=t.find(n=>n.caipNetworkId===e);if(s)return s.name;const[r]=e.split(":");return((i=V.CHAIN_NAME_MAP)==null?void 0:i[r])||void 0}},Ip={bigNumber(t){return t?new mi(t):new mi(0)},multiply(t,e){if(t===void 0||e===void 0)return new mi(0);const s=new mi(t),r=new mi(e);return s.times(r)},formatNumberToLocalString(t,e=2){return t===void 0?"0.00":typeof t=="number"?t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e}):parseFloat(t).toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e})},parseLocalStringToNumber(t){return t===void 0?0:parseFloat(t.replace(/,/gu,""))}},Cp=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],Np=[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],Ap=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],Sp={getERC20Abi:t=>V.USDT_CONTRACT_ADDRESSES.includes(t)?Ap:Cp,getSwapAbi:()=>Np},Ns={validateCaipAddress(t){var e;if(((e=t.split(":"))==null?void 0:e.length)!==3)throw new Error("Invalid CAIP Address");return t},parseCaipAddress(t){const e=t.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${t}`);const[s,r,i]=e;if(!s||!r||!i)throw new Error(`Invalid CAIP-10 address: ${t}`);return{chainNamespace:s,chainId:r,address:i}},parseCaipNetworkId(t){const e=t.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${t}`);const[s,r]=e;if(!s||!r)throw new Error(`Invalid CAIP-2 network id: ${t}`);return{chainNamespace:s,chainId:r}}},re={WALLET_ID:"@appkit/wallet_id",WALLET_NAME:"@appkit/wallet_name",SOLANA_WALLET:"@appkit/solana_wallet",SOLANA_CAIP_CHAIN:"@appkit/solana_caip_chain",ACTIVE_CAIP_NETWORK_ID:"@appkit/active_caip_network_id",CONNECTED_SOCIAL:"@appkit/connected_social",CONNECTED_SOCIAL_USERNAME:"@appkit-wallet/SOCIAL_USERNAME",RECENT_WALLETS:"@appkit/recent_wallets",DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",ACTIVE_NAMESPACE:"@appkit/active_namespace",CONNECTED_NAMESPACES:"@appkit/connected_namespaces",CONNECTION_STATUS:"@appkit/connection_status",SIWX_AUTH_TOKEN:"@appkit/siwx-auth-token",SIWX_NONCE_TOKEN:"@appkit/siwx-nonce-token",TELEGRAM_SOCIAL_PROVIDER:"@appkit/social_provider",NATIVE_BALANCE_CACHE:"@appkit/native_balance_cache",PORTFOLIO_CACHE:"@appkit/portfolio_cache",ENS_CACHE:"@appkit/ens_cache",IDENTITY_CACHE:"@appkit/identity_cache",PREFERRED_ACCOUNT_TYPES:"@appkit/preferred_account_types",CONNECTIONS:"@appkit/connections"};function fo(t){if(!t)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return`@appkit/${t}:connected_connector_id`}const se={setItem(t,e){Pi()&&e!==void 0&&localStorage.setItem(t,e)},getItem(t){if(Pi())return localStorage.getItem(t)||void 0},removeItem(t){Pi()&&localStorage.removeItem(t)},clear(){Pi()&&localStorage.clear()}};function Pi(){return typeof window<"u"&&typeof localStorage<"u"}function $s(t,e){return e==="light"?{"--w3m-accent":(t==null?void 0:t["--w3m-accent"])||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":(t==null?void 0:t["--w3m-accent"])||"hsla(230, 100%, 67%, 1)","--w3m-background":"#121313"}}const _p=Symbol(),Sc=Object.getPrototypeOf,oa=new WeakMap,Pp=t=>t&&(oa.has(t)?oa.get(t):Sc(t)===Object.prototype||Sc(t)===Array.prototype),Tp=t=>Pp(t)&&t[_p]||null,_c=(t,e=!0)=>{oa.set(t,e)},qn={},go=t=>typeof t=="object"&&t!==null,ks=new WeakMap,Ti=new WeakSet,Op=(t=Object.is,e=(l,u)=>new Proxy(l,u),s=l=>go(l)&&!Ti.has(l)&&(Array.isArray(l)||!(Symbol.iterator in l))&&!(l instanceof WeakMap)&&!(l instanceof WeakSet)&&!(l instanceof Error)&&!(l instanceof Number)&&!(l instanceof Date)&&!(l instanceof String)&&!(l instanceof RegExp)&&!(l instanceof ArrayBuffer),r=l=>{switch(l.status){case"fulfilled":return l.value;case"rejected":throw l.reason;default:throw l}},i=new WeakMap,n=(l,u,h=r)=>{const d=i.get(l);if((d==null?void 0:d[0])===u)return d[1];const f=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l));return _c(f,!0),i.set(l,[u,f]),Reflect.ownKeys(l).forEach(g=>{if(Object.getOwnPropertyDescriptor(f,g))return;const m=Reflect.get(l,g),{enumerable:p}=Reflect.getOwnPropertyDescriptor(l,g),w={value:m,enumerable:p,configurable:!0};if(Ti.has(m))_c(m,!1);else if(m instanceof Promise)delete w.value,w.get=()=>h(m);else if(ks.has(m)){const[y,I]=ks.get(m);w.value=n(y,I(),h)}Object.defineProperty(f,g,w)}),Object.preventExtensions(f)},o=new WeakMap,a=[1,1],c=l=>{if(!go(l))throw new Error("object required");const u=o.get(l);if(u)return u;let h=a[0];const d=new Set,f=(v,x=++a[0])=>{h!==x&&(h=x,d.forEach(S=>S(v,x)))};let g=a[1];const m=(v=++a[1])=>(g!==v&&!d.size&&(g=v,w.forEach(([x])=>{const S=x[1](v);S>h&&(h=S)})),h),p=v=>(x,S)=>{const R=[...x];R[1]=[v,...R[1]],f(R,S)},w=new Map,y=(v,x)=>{if((qn?"production":void 0)!=="production"&&w.has(v))throw new Error("prop listener already exists");if(d.size){const S=x[3](p(v));w.set(v,[x,S])}else w.set(v,[x])},I=v=>{var x;const S=w.get(v);S&&(w.delete(v),(x=S[1])==null||x.call(S))},T=v=>(d.add(v),d.size===1&&w.forEach(([S,R],L)=>{if((qn?"production":void 0)!=="production"&&R)throw new Error("remove already exists");const E=S[3](p(L));w.set(L,[S,E])}),()=>{d.delete(v),d.size===0&&w.forEach(([S,R],L)=>{R&&(R(),w.set(L,[S]))})}),$=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l)),_=e($,{deleteProperty(v,x){const S=Reflect.get(v,x);I(x);const R=Reflect.deleteProperty(v,x);return R&&f(["delete",[x],S]),R},set(v,x,S,R){const L=Reflect.has(v,x),E=Reflect.get(v,x,R);if(L&&(t(E,S)||o.has(S)&&t(E,o.get(S))))return!0;I(x),go(S)&&(S=Tp(S)||S);let N=S;if(S instanceof Promise)S.then(C=>{S.status="fulfilled",S.value=C,f(["resolve",[x],C])}).catch(C=>{S.status="rejected",S.reason=C,f(["reject",[x],C])});else{!ks.has(S)&&s(S)&&(N=c(S));const C=!Ti.has(N)&&ks.get(N);C&&y(x,C)}return Reflect.set(v,x,N,R),f(["set",[x],S,E]),!0}});o.set(l,_);const O=[$,m,n,T];return ks.set(_,O),Reflect.ownKeys(l).forEach(v=>{const x=Object.getOwnPropertyDescriptor(l,v);"value"in x&&(_[v]=l[v],delete x.value,delete x.writable),Object.defineProperty($,v,x)}),_})=>[c,ks,Ti,t,e,s,r,i,n,o,a],[xp]=Op();function xe(t={}){return xp(t)}function nt(t,e,s){const r=ks.get(t);(qn?"production":void 0)!=="production"&&!r&&console.warn("Please use proxy object");let i;const n=[],o=r[3];let a=!1;const l=o(u=>{n.push(u),i||(i=Promise.resolve().then(()=>{i=void 0,a&&e(n.splice(0))}))});return a=!0,()=>{a=!1,l()}}function Hi(t,e){const s=ks.get(t);(qn?"production":void 0)!=="production"&&!s&&console.warn("Please use proxy object");const[r,i,n]=s;return n(r,i(),e)}function rr(t){return Ti.add(t),t}function ot(t,e,s,r){let i=t[e];return nt(t,()=>{const n=t[e];Object.is(i,n)||s(i=n)})}function kp(t){const e=xe({data:Array.from([]),has(s){return this.data.some(r=>r[0]===s)},set(s,r){const i=this.data.find(n=>n[0]===s);return i?i[1]=r:this.data.push([s,r]),this},get(s){var r;return(r=this.data.find(i=>i[0]===s))==null?void 0:r[1]},delete(s){const r=this.data.findIndex(i=>i[0]===s);return r===-1?!1:(this.data.splice(r,1),!0)},clear(){this.data.splice(0)},get size(){return this.data.length},toJSON(){return new Map(this.data)},forEach(s){this.data.forEach(r=>{s(r[1],r[0],this)})},keys(){return this.data.map(s=>s[0]).values()},values(){return this.data.map(s=>s[1]).values()},entries(){return new Map(this.data).entries()},get[Symbol.toStringTag](){return"Map"},[Symbol.iterator](){return this.entries()}});return Object.defineProperties(e,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(e),e}const sh=[{label:"Coinbase",name:"coinbase",feeRange:"1-2%",url:"",supportedChains:["eip155"]},{label:"Meld.io",name:"meld",feeRange:"1-2%",url:"https://meldcrypto.com",supportedChains:["eip155","solana"]}],$p="WXETMuFUQmqqybHuRkSgxv:25B8LJHSfpG6LVjR2ytU5Cwh7Z4Sch2ocoU",_e={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,ONE_SEC_MS:1e3,BALANCE_SUPPORTED_CHAINS:["eip155","solana"],NAMES_SUPPORTED_CHAIN_NAMESPACES:["eip155"],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x",cosmos:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in the wallet app"},SEND_SUPPORTED_NAMESPACES:["eip155","solana"],DEFAULT_REMOTE_FEATURES:{swaps:["1inch"],onramp:["coinbase","meld"],email:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],activity:!0,reownBranding:!0},DEFAULT_REMOTE_FEATURES_DISABLED:{email:!1,socials:!1,swaps:!1,onramp:!1,activity:!1,reownBranding:!1},DEFAULT_FEATURES:{receive:!0,send:!0,emailShowWallets:!0,connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0,pay:!1},DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal"}},H={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5},isCacheExpired(t,e){return Date.now()-t>e},getActiveNetworkProps(){const t=H.getActiveNamespace(),e=H.getActiveCaipNetworkId(),s=e?e.split(":")[1]:void 0,r=s?isNaN(Number(s))?s:Number(s):void 0;return{namespace:t,caipNetworkId:e,chainId:r}},setWalletConnectDeepLink({name:t,href:e}){try{se.setItem(re.DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const t=se.getItem(re.DEEPLINK_CHOICE);if(t)return JSON.parse(t)}catch{console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{se.removeItem(re.DEEPLINK_CHOICE)}catch{console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(t){try{se.setItem(re.ACTIVE_NAMESPACE,t)}catch{console.info("Unable to set active namespace")}},setActiveCaipNetworkId(t){try{se.setItem(re.ACTIVE_CAIP_NETWORK_ID,t),H.setActiveNamespace(t.split(":")[0])}catch{console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return se.getItem(re.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to get active caip network id");return}},deleteActiveCaipNetworkId(){try{se.removeItem(re.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(t){try{const e=fo(t);se.removeItem(e)}catch{console.info("Unable to delete connected connector id")}},setAppKitRecent(t){try{const e=H.getRecentWallets();e.find(r=>r.id===t.id)||(e.unshift(t),e.length>2&&e.pop(),se.setItem(re.RECENT_WALLETS,JSON.stringify(e)))}catch{console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const t=se.getItem(re.RECENT_WALLETS);return t?JSON.parse(t):[]}catch{console.info("Unable to get AppKit recent")}return[]},setConnectedConnectorId(t,e){try{const s=fo(t);se.setItem(s,e)}catch{console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return se.getItem(re.ACTIVE_NAMESPACE)}catch{console.info("Unable to get active namespace")}},getConnectedConnectorId(t){if(t)try{const e=fo(t);return se.getItem(e)}catch{console.info("Unable to get connected connector id in namespace ",t)}},setConnectedSocialProvider(t){try{se.setItem(re.CONNECTED_SOCIAL,t)}catch{console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return se.getItem(re.CONNECTED_SOCIAL)}catch{console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{se.removeItem(re.CONNECTED_SOCIAL)}catch{console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return se.getItem(re.CONNECTED_SOCIAL_USERNAME)}catch{console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){var s;const t=se.getItem(re.ACTIVE_CAIP_NETWORK_ID);return(s=t==null?void 0:t.split(":"))==null?void 0:s[1]},setConnectionStatus(t){try{se.setItem(re.CONNECTION_STATUS,t)}catch{console.info("Unable to set connection status")}},getConnectionStatus(){try{return se.getItem(re.CONNECTION_STATUS)}catch{return}},getConnectedNamespaces(){try{const t=se.getItem(re.CONNECTED_NAMESPACES);return t!=null&&t.length?t.split(","):[]}catch{return[]}},setConnectedNamespaces(t){try{const e=Array.from(new Set(t));se.setItem(re.CONNECTED_NAMESPACES,e.join(","))}catch{console.info("Unable to set namespaces in storage")}},addConnectedNamespace(t){try{const e=H.getConnectedNamespaces();e.includes(t)||(e.push(t),H.setConnectedNamespaces(e))}catch{console.info("Unable to add connected namespace")}},removeConnectedNamespace(t){try{const e=H.getConnectedNamespaces(),s=e.indexOf(t);s>-1&&(e.splice(s,1),H.setConnectedNamespaces(e))}catch{console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return se.getItem(re.TELEGRAM_SOCIAL_PROVIDER)}catch{return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(t){try{se.setItem(re.TELEGRAM_SOCIAL_PROVIDER,t)}catch{console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{se.removeItem(re.TELEGRAM_SOCIAL_PROVIDER)}catch{console.info("Unable to remove telegram social provider")}},getBalanceCache(){let t={};try{const e=se.getItem(re.PORTFOLIO_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromBalanceCache(t){try{const e=H.getBalanceCache();se.setItem(re.PORTFOLIO_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getBalanceCacheForCaipAddress(t){try{const s=H.getBalanceCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.portfolio))return s.balance;H.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateBalanceCache(t){try{const e=H.getBalanceCache();e[t.caipAddress]=t,se.setItem(re.PORTFOLIO_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getNativeBalanceCache(){let t={};try{const e=se.getItem(re.NATIVE_BALANCE_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromNativeBalanceCache(t){try{const e=H.getBalanceCache();se.setItem(re.NATIVE_BALANCE_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getNativeBalanceCacheForCaipAddress(t){try{const s=H.getNativeBalanceCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.nativeBalance))return s;console.info("Discarding cache for address",t),H.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateNativeBalanceCache(t){try{const e=H.getNativeBalanceCache();e[t.caipAddress]=t,se.setItem(re.NATIVE_BALANCE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getEnsCache(){let t={};try{const e=se.getItem(re.ENS_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get ens name cache")}return t},getEnsFromCacheForAddress(t){try{const s=H.getEnsCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.ens))return s.ens;H.removeEnsFromCache(t)}catch{console.info("Unable to get ens name from cache",t)}},updateEnsCache(t){try{const e=H.getEnsCache();e[t.address]=t,se.setItem(re.ENS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ens name cache",t)}},removeEnsFromCache(t){try{const e=H.getEnsCache();se.setItem(re.ENS_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove ens name from cache",t)}},getIdentityCache(){let t={};try{const e=se.getItem(re.IDENTITY_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get identity cache")}return t},getIdentityFromCacheForAddress(t){try{const s=H.getIdentityCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.identity))return s.identity;H.removeIdentityFromCache(t)}catch{console.info("Unable to get identity from cache",t)}},updateIdentityCache(t){try{const e=H.getIdentityCache();e[t.address]={identity:t.identity,timestamp:t.timestamp},se.setItem(re.IDENTITY_CACHE,JSON.stringify(e))}catch{console.info("Unable to update identity cache",t)}},removeIdentityFromCache(t){try{const e=H.getIdentityCache();se.setItem(re.IDENTITY_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove identity from cache",t)}},clearAddressCache(){try{se.removeItem(re.PORTFOLIO_CACHE),se.removeItem(re.NATIVE_BALANCE_CACHE),se.removeItem(re.ENS_CACHE),se.removeItem(re.IDENTITY_CACHE)}catch{console.info("Unable to clear address cache")}},setPreferredAccountTypes(t){try{se.setItem(re.PREFERRED_ACCOUNT_TYPES,JSON.stringify(t))}catch{console.info("Unable to set preferred account types",t)}},getPreferredAccountTypes(){try{const t=se.getItem(re.PREFERRED_ACCOUNT_TYPES);return t?JSON.parse(t):{}}catch{console.info("Unable to get preferred account types")}return{}},setConnections(t,e){try{const s={...H.getConnections(),[e]:t};se.setItem(re.CONNECTIONS,JSON.stringify(s))}catch(s){console.error("Unable to sync connections to storage",s)}},getConnections(){try{const t=se.getItem(re.CONNECTIONS);return t?JSON.parse(t):{}}catch(t){return console.error("Unable to get connections from storage",t),{}}}},te={isMobile(){var t;return this.isClient()?!!(typeof(window==null?void 0:window.matchMedia)=="function"&&((t=window==null?void 0:window.matchMedia("(pointer:coarse)"))!=null&&t.matches)||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},checkCaipNetwork(t,e=""){return t==null?void 0:t.caipNetworkId.toLocaleLowerCase().includes(e.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return te.isMobile()&&t.includes("android")},isIos(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("iphone")||t.includes("ipad")},isSafari(){return this.isClient()?(window==null?void 0:window.navigator.userAgent.toLowerCase()).includes("safari"):!1},isClient(){return typeof window<"u"},isPairingExpired(t){return t?t-Date.now()<=_e.TEN_SEC_MS:!0},isAllowedRetry(t,e=_e.ONE_SEC_MS){return Date.now()-t>=e},copyToClopboard(t){navigator.clipboard.writeText(t)},isIframe(){try{return(window==null?void 0:window.self)!==(window==null?void 0:window.top)}catch{return!1}},isSafeApp(){var t,e;if(te.isClient()&&window.self!==window.top)try{const s=(e=(t=window==null?void 0:window.location)==null?void 0:t.ancestorOrigins)==null?void 0:e[0],r="https://app.safe.global";if(s){const i=new URL(s),n=new URL(r);return i.hostname===n.hostname}}catch{return!1}return!1},getPairingExpiry(){return Date.now()+_e.FOUR_MINUTES_MS},getNetworkId(t){return t==null?void 0:t.split(":")[1]},getPlainAddress(t){return t==null?void 0:t.split(":")[2]},async wait(t){return new Promise(e=>{setTimeout(e,t)})},debounce(t,e=500){let s;return(...r)=>{function i(){t(...r)}s&&clearTimeout(s),s=setTimeout(i,e)}},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},formatNativeUrl(t,e,s=null){if(te.isHttpUrl(t))return this.formatUniversalUrl(t,e);let r=t,i=s;r.includes("://")||(r=t.replaceAll("/","").replaceAll(":",""),r=`${r}://`),r.endsWith("/")||(r=`${r}/`),i&&!(i!=null&&i.endsWith("/"))&&(i=`${i}/`),this.isTelegram()&&this.isAndroid()&&(e=encodeURIComponent(e));const n=encodeURIComponent(e);return{redirect:`${r}wc?uri=${n}`,redirectUniversalLink:i?`${i}wc?uri=${n}`:void 0,href:r}},formatUniversalUrl(t,e){if(!te.isHttpUrl(t))return this.formatNativeUrl(t,e);let s=t;s.endsWith("/")||(s=`${s}/`);const r=encodeURIComponent(e);return{redirect:`${s}wc?uri=${r}`,href:s}},getOpenTargetForPlatform(t){return t==="popupWindow"?t:this.isTelegram()?H.getTelegramSocialProvider()?"_top":"_blank":t},openHref(t,e,s){window==null||window.open(t,this.getOpenTargetForPlatform(e),s||"noreferrer noopener")},returnOpenHref(t,e,s){return window==null?void 0:window.open(t,this.getOpenTargetForPlatform(e),s||"noreferrer noopener")},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},isPWA(){var s,r,i;if(typeof window>"u")return!1;const t=(r=(s=window.matchMedia)==null?void 0:s.call(window,"(display-mode: standalone)"))==null?void 0:r.matches,e=(i=window==null?void 0:window.navigator)==null?void 0:i.standalone;return!!(t||e)},async preloadImage(t){const e=new Promise((s,r)=>{const i=new Image;i.onload=s,i.onerror=r,i.crossOrigin="anonymous",i.src=t});return Promise.race([e,te.wait(2e3)])},formatBalance(t,e){let s="0.000";if(typeof t=="string"){const r=Number(t);if(r){const i=Math.floor(r*1e3)/1e3;i&&(s=i.toString())}}return`${s}${e?` ${e}`:""}`},formatBalance2(t,e){var r;let s;if(t==="0")s="0";else if(typeof t=="string"){const i=Number(t);i&&(s=(r=i.toString().match(/^-?\d+(?:\.\d{0,3})?/u))==null?void 0:r[0])}return{value:s??"0",rest:s==="0"?"000":"",symbol:e}},getApiUrl(){return V.W3M_API_URL},getBlockchainApiUrl(){return V.BLOCKCHAIN_API_RPC_URL},getAnalyticsUrl(){return V.PULSE_API_URL},getUUID(){return crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})},parseError(t){var e,s;return typeof t=="string"?t:typeof((s=(e=t==null?void 0:t.issues)==null?void 0:e[0])==null?void 0:s.message)=="string"?t.issues[0].message:t instanceof Error?t.message:"Unknown error"},sortRequestedNetworks(t,e=[]){const s={};return e&&t&&(t.forEach((r,i)=>{s[r]=i}),e.sort((r,i)=>{const n=s[r.id],o=s[i.id];return n!==void 0&&o!==void 0?n-o:n!==void 0?-1:o!==void 0?1:0})),e},calculateBalance(t){let e=0;for(const s of t)e+=s.value??0;return e},formatTokenBalance(t){const e=t.toFixed(2),[s,r]=e.split(".");return{dollars:s,pennies:r}},isAddress(t,e="eip155"){switch(e){case"eip155":if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)){if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)||/^(?:0x)?[0-9A-F]{40}$/iu.test(t))return!0}else return!1;return!1;case"solana":return/[1-9A-HJ-NP-Za-km-z]{32,44}$/iu.test(t);default:return!1}},uniqueBy(t,e){const s=new Set;return t.filter(r=>{const i=r[e];return s.has(i)?!1:(s.add(i),!0)})},generateSdkVersion(t,e,s){const i=t.length===0?_e.ADAPTER_TYPES.UNIVERSAL:t.map(n=>n.adapterType).join(",");return`${e}-${i}-${s}`},createAccount(t,e,s,r,i){return{namespace:t,address:e,type:s,publicKey:r,path:i}},isCaipAddress(t){if(typeof t!="string")return!1;const e=t.split(":"),s=e[0];return e.filter(Boolean).length===3&&s in V.CHAIN_NAME_MAP},isMac(){const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("macintosh")&&!t.includes("safari")},formatTelegramSocialLoginUrl(t){const e=`--${encodeURIComponent(window==null?void 0:window.location.href)}`,s="state=";if(new URL(t).host==="auth.magic.link"){const i="provider_authorization_url=",n=t.substring(t.indexOf(i)+i.length),o=this.injectIntoUrl(decodeURIComponent(n),s,e);return t.replace(n,encodeURIComponent(o))}return this.injectIntoUrl(t,s,e)},injectIntoUrl(t,e,s){const r=t.indexOf(e);if(r===-1)throw new Error(`${e} parameter not found in the URL: ${t}`);const i=t.indexOf("&",r),n=e.length,o=i!==-1?i:t.length,a=t.substring(0,r+n),c=t.substring(r+n,o),l=t.substring(i),u=c+s;return a+u+l}};async function wi(...t){const e=await fetch(...t);if(!e.ok)throw new Error(`HTTP status code: ${e.status}`,{cause:e});return e}class tn{constructor({baseUrl:e,clientId:s}){this.baseUrl=e,this.clientId=s}async get({headers:e,signal:s,cache:r,...i}){const n=this.createUrl(i);return(await wi(n,{method:"GET",headers:e,signal:s,cache:r})).json()}async getBlob({headers:e,signal:s,...r}){const i=this.createUrl(r);return(await wi(i,{method:"GET",headers:e,signal:s})).blob()}async post({body:e,headers:s,signal:r,...i}){const n=this.createUrl(i);return(await wi(n,{method:"POST",headers:s,body:e?JSON.stringify(e):void 0,signal:r})).json()}async put({body:e,headers:s,signal:r,...i}){const n=this.createUrl(i);return(await wi(n,{method:"PUT",headers:s,body:e?JSON.stringify(e):void 0,signal:r})).json()}async delete({body:e,headers:s,signal:r,...i}){const n=this.createUrl(i);return(await wi(n,{method:"DELETE",headers:s,body:e?JSON.stringify(e):void 0,signal:r})).json()}createUrl({path:e,params:s}){const r=new URL(e,this.baseUrl);return s&&Object.entries(s).forEach(([i,n])=>{n&&r.searchParams.append(i,n)}),this.clientId&&r.searchParams.append("clientId",this.clientId),r}}const Rp={getFeatureValue(t,e){const s=e==null?void 0:e[t];return s===void 0?_e.DEFAULT_FEATURES[t]:s},filterSocialsByPlatform(t){if(!t||!t.length)return t;if(te.isTelegram()){if(te.isIos())return t.filter(e=>e!=="google");if(te.isMac())return t.filter(e=>e!=="x");if(te.isAndroid())return t.filter(e=>!["facebook","x"].includes(e))}return t}},Y=xe({features:_e.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:_e.DEFAULT_ACCOUNT_TYPES,enableNetworkSwitch:!0,experimental_preferUniversalLinks:!1,remoteFeatures:{}}),B={state:Y,subscribeKey(t,e){return ot(Y,t,e)},setOptions(t){Object.assign(Y,t)},setRemoteFeatures(t){var s;if(!t)return;const e={...Y.remoteFeatures,...t};Y.remoteFeatures=e,(s=Y.remoteFeatures)!=null&&s.socials&&(Y.remoteFeatures.socials=Rp.filterSocialsByPlatform(Y.remoteFeatures.socials))},setFeatures(t){if(!t)return;Y.features||(Y.features=_e.DEFAULT_FEATURES);const e={...Y.features,...t};Y.features=e},setProjectId(t){Y.projectId=t},setCustomRpcUrls(t){Y.customRpcUrls=t},setAllWallets(t){Y.allWallets=t},setIncludeWalletIds(t){Y.includeWalletIds=t},setExcludeWalletIds(t){Y.excludeWalletIds=t},setFeaturedWalletIds(t){Y.featuredWalletIds=t},setTokens(t){Y.tokens=t},setTermsConditionsUrl(t){Y.termsConditionsUrl=t},setPrivacyPolicyUrl(t){Y.privacyPolicyUrl=t},setCustomWallets(t){Y.customWallets=t},setIsSiweEnabled(t){Y.isSiweEnabled=t},setIsUniversalProvider(t){Y.isUniversalProvider=t},setSdkVersion(t){Y.sdkVersion=t},setMetadata(t){Y.metadata=t},setDisableAppend(t){Y.disableAppend=t},setEIP6963Enabled(t){Y.enableEIP6963=t},setDebug(t){Y.debug=t},setEnableWalletConnect(t){Y.enableWalletConnect=t},setEnableWalletGuide(t){Y.enableWalletGuide=t},setEnableAuthLogger(t){Y.enableAuthLogger=t},setEnableWallets(t){Y.enableWallets=t},setPreferUniversalLinks(t){Y.experimental_preferUniversalLinks=t},setHasMultipleAddresses(t){Y.hasMultipleAddresses=t},setSIWX(t){Y.siwx=t},setConnectMethodsOrder(t){Y.features={...Y.features,connectMethodsOrder:t}},setWalletFeaturesOrder(t){Y.features={...Y.features,walletFeaturesOrder:t}},setSocialsOrder(t){Y.remoteFeatures={...Y.remoteFeatures,socials:t}},setCollapseWallets(t){Y.features={...Y.features,collapseWallets:t}},setEnableEmbedded(t){Y.enableEmbedded=t},setAllowUnsupportedChain(t){Y.allowUnsupportedChain=t},setManualWCControl(t){Y.manualWCControl=t},setEnableNetworkSwitch(t){Y.enableNetworkSwitch=t},setDefaultAccountTypes(t={}){Object.entries(t).forEach(([e,s])=>{s&&(Y.defaultAccountTypes[e]=s)})},setUniversalProviderConfigOverride(t){Y.universalProviderConfigOverride=t},getUniversalProviderConfigOverride(){return Y.universalProviderConfigOverride},getSnapshot(){return Hi(Y)}},Up=Object.freeze({enabled:!0,events:[]}),Dp=new tn({baseUrl:te.getAnalyticsUrl(),clientId:null}),Lp=5,Bp=60*1e3,As=xe({...Up}),Mp={state:As,subscribeKey(t,e){return ot(As,t,e)},async sendError(t,e){if(!As.enabled)return;const s=Date.now();if(As.events.filter(n=>{const o=new Date(n.properties.timestamp||"").getTime();return s-o<Bp}).length>=Lp)return;const i={type:"error",event:e,properties:{errorType:t.name,errorMessage:t.message,stackTrace:t.stack,timestamp:new Date().toISOString()}};As.events.push(i);try{if(typeof window>"u")return;const{projectId:n,sdkType:o,sdkVersion:a}=B.state;await Dp.post({path:"/e",params:{projectId:n,st:o,sv:a||"html-wagmi-4.2.2"},body:{eventId:te.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:new Date().toISOString(),props:{type:"error",event:e,errorType:t.name,errorMessage:t.message,stackTrace:t.stack}}})}catch{}},enable(){As.enabled=!0},disable(){As.enabled=!1},clearEvents(){As.events=[]}};class Vr extends Error{constructor(e,s,r){super(e),this.name="AppKitError",this.category=s,this.originalError=r,Object.setPrototypeOf(this,Vr.prototype);let i=!1;if(r instanceof Error&&typeof r.stack=="string"&&r.stack){const n=r.stack,o=n.indexOf(`
`);if(o>-1){const a=n.substring(o+1);this.stack=`${this.name}: ${this.message}
${a}`,i=!0}}i||(Error.captureStackTrace?Error.captureStackTrace(this,Vr):this.stack||(this.stack=`${this.name}: ${this.message}`))}}function Pc(t,e){const s=t instanceof Vr?t:new Vr(t instanceof Error?t.message:String(t),e,t);throw Mp.sendError(s,s.category),s}function Rt(t,e="INTERNAL_SDK_ERROR"){const s={};return Object.keys(t).forEach(r=>{const i=t[r];if(typeof i=="function"){let n=i;i.constructor.name==="AsyncFunction"?n=async(...o)=>{try{return await i(...o)}catch(a){return Pc(a,e)}}:n=(...o)=>{try{return i(...o)}catch(a){return Pc(a,e)}},s[r]=n}else s[r]=i}),s}const os={PHANTOM:{id:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",url:"https://phantom.app"},SOLFLARE:{id:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",url:"https://solflare.com"},COINBASE:{id:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",url:"https://go.cb-w.com"}},jp={handleMobileDeeplinkRedirect(t,e){const s=window.location.href,r=encodeURIComponent(s);if(t===os.PHANTOM.id&&!("phantom"in window)){const i=s.startsWith("https")?"https":"http",n=s.split("/")[2],o=encodeURIComponent(`${i}://${n}`);window.location.href=`${os.PHANTOM.url}/ul/browse/${r}?ref=${o}`}t===os.SOLFLARE.id&&!("solflare"in window)&&(window.location.href=`${os.SOLFLARE.url}/ul/v1/browse/${r}?ref=${r}`),e===V.CHAIN.SOLANA&&t===os.COINBASE.id&&!("coinbaseSolana"in window)&&(window.location.href=`${os.COINBASE.url}/dapp?cb_url=${r}`)}},Ct=xe({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),qp={state:Ct,subscribeNetworkImages(t){return nt(Ct.networkImages,()=>t(Ct.networkImages))},subscribeKey(t,e){return ot(Ct,t,e)},subscribe(t){return nt(Ct,()=>t(Ct))},setWalletImage(t,e){Ct.walletImages[t]=e},setNetworkImage(t,e){Ct.networkImages[t]=e},setChainImage(t,e){Ct.chainImages[t]=e},setConnectorImage(t,e){Ct.connectorImages={...Ct.connectorImages,[t]:e}},setTokenImage(t,e){Ct.tokenImages[t]=e},setCurrencyImage(t,e){Ct.currencyImages[t]=e}},Yt=Rt(qp),Fp={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00",cosmos:""},mo=xe({networkImagePromises:{}}),rh={async fetchWalletImage(t){if(t)return await J._fetchWalletImage(t),this.getWalletImageById(t)},async fetchNetworkImage(t){if(!t)return;const e=this.getNetworkImageById(t);return e||(mo.networkImagePromises[t]||(mo.networkImagePromises[t]=J._fetchNetworkImage(t)),await mo.networkImagePromises[t],this.getNetworkImageById(t))},getWalletImageById(t){if(t)return Yt.state.walletImages[t]},getWalletImage(t){if(t!=null&&t.image_url)return t==null?void 0:t.image_url;if(t!=null&&t.image_id)return Yt.state.walletImages[t.image_id]},getNetworkImage(t){var e,s,r;if((e=t==null?void 0:t.assets)!=null&&e.imageUrl)return(s=t==null?void 0:t.assets)==null?void 0:s.imageUrl;if((r=t==null?void 0:t.assets)!=null&&r.imageId)return Yt.state.networkImages[t.assets.imageId]},getNetworkImageById(t){if(t)return Yt.state.networkImages[t]},getConnectorImage(t){if(t!=null&&t.imageUrl)return t.imageUrl;if(t!=null&&t.imageId)return Yt.state.connectorImages[t.imageId]},getChainImage(t){return Yt.state.networkImages[Fp[t]]}},Ss=xe({message:"",variant:"info",open:!1}),zp={state:Ss,subscribeKey(t,e){return ot(Ss,t,e)},open(t,e){const{debug:s}=B.state,{shortMessage:r,longMessage:i}=t;s&&(Ss.message=r,Ss.variant=e,Ss.open=!0),i&&console.error(typeof i=="function"?i():i)},close(){Ss.open=!1,Ss.message="",Ss.variant="info"}},Vs=Rt(zp),Wp=te.getAnalyticsUrl(),Hp=new tn({baseUrl:Wp,clientId:null}),Kp=["MODAL_CREATED"],us=xe({timestamp:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"}}),Re={state:us,subscribe(t){return nt(us,()=>t(us))},getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:s}=B.state;return{projectId:t,st:e,sv:s||"html-wagmi-4.2.2"}},async _sendAnalyticsEvent(t){try{const e=K.state.address;if(Kp.includes(t.data.event)||typeof window>"u")return;await Hp.post({path:"/e",params:Re.getSdkProperties(),body:{eventId:te.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:t.timestamp,props:{...t.data,address:e}}}),us.reportedErrors.FORBIDDEN=!1}catch(e){e instanceof Error&&e.cause instanceof Response&&e.cause.status===V.HTTP_STATUS_CODES.FORBIDDEN&&!us.reportedErrors.FORBIDDEN&&(Vs.open({shortMessage:"Invalid App Configuration",longMessage:`Origin ${Pi()?window.origin:"uknown"} not found on Allowlist - update configuration on cloud.reown.com`},"error"),us.reportedErrors.FORBIDDEN=!0)}},sendEvent(t){var e;us.timestamp=Date.now(),us.data=t,(e=B.state.features)!=null&&e.analytics&&Re._sendAnalyticsEvent(us)}},Vp=te.getApiUrl(),dt=new tn({baseUrl:Vp,clientId:null}),Gp=40,Tc=4,Jp=20,ie=xe({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],filteredWallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1}),J={state:ie,subscribeKey(t,e){return ot(ie,t,e)},_getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:s}=B.state;return{projectId:t,st:e||"appkit",sv:s||"html-wagmi-4.2.2"}},_filterOutExtensions(t){return B.state.isUniversalProvider?t.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):t},async _fetchWalletImage(t){const e=`${dt.baseUrl}/getWalletImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setWalletImage(t,URL.createObjectURL(s))},async _fetchNetworkImage(t){const e=`${dt.baseUrl}/public/getAssetImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setNetworkImage(t,URL.createObjectURL(s))},async _fetchConnectorImage(t){const e=`${dt.baseUrl}/public/getAssetImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setConnectorImage(t,URL.createObjectURL(s))},async _fetchCurrencyImage(t){const e=`${dt.baseUrl}/public/getCurrencyImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setCurrencyImage(t,URL.createObjectURL(s))},async _fetchTokenImage(t){const e=`${dt.baseUrl}/public/getTokenImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setTokenImage(t,URL.createObjectURL(s))},_filterWalletsByPlatform(t){return te.isMobile()?t==null?void 0:t.filter(s=>s.mobile_link||s.id===os.COINBASE.id?!0:b.state.activeChain==="solana"&&(s.id===os.SOLFLARE.id||s.id===os.PHANTOM.id)):t},async fetchProjectConfig(){return(await dt.get({path:"/appkit/v1/config",params:J._getSdkProperties()})).features},async fetchAllowedOrigins(){try{const{allowedOrigins:t}=await dt.get({path:"/projects/v1/origins",params:J._getSdkProperties()});return t}catch{return[]}},async fetchNetworkImages(){const t=b.getAllRequestedCaipNetworks(),e=t==null?void 0:t.map(({assets:s})=>s==null?void 0:s.imageId).filter(Boolean).filter(s=>!rh.getNetworkImageById(s));e&&await Promise.allSettled(e.map(s=>J._fetchNetworkImage(s)))},async fetchConnectorImages(){const{connectors:t}=W.state,e=t.map(({imageId:s})=>s).filter(Boolean);await Promise.allSettled(e.map(s=>J._fetchConnectorImage(s)))},async fetchCurrencyImages(t=[]){await Promise.allSettled(t.map(e=>J._fetchCurrencyImage(e)))},async fetchTokenImages(t=[]){await Promise.allSettled(t.map(e=>J._fetchTokenImage(e)))},async fetchWallets(t){var n;const e=t.exclude??[];J._getSdkProperties().sv.startsWith("html-core-")&&e.push(...Object.values(os).map(o=>o.id));const r=await dt.get({path:"/getWallets",params:{...J._getSdkProperties(),...t,page:String(t.page),entries:String(t.entries),include:(n=t.include)==null?void 0:n.join(","),exclude:e.join(",")}});return{data:J._filterWalletsByPlatform(r==null?void 0:r.data)||[],count:r==null?void 0:r.count}},async fetchFeaturedWallets(){const{featuredWalletIds:t}=B.state;if(t!=null&&t.length){const e={...J._getSdkProperties(),page:1,entries:(t==null?void 0:t.length)??Tc,include:t},{data:s}=await J.fetchWallets(e),r=[...s].sort((n,o)=>t.indexOf(n.id)-t.indexOf(o.id)),i=r.map(n=>n.image_id).filter(Boolean);await Promise.allSettled(i.map(n=>J._fetchWalletImage(n))),ie.featured=r,ie.allFeatured=r}},async fetchRecommendedWallets(){try{ie.isFetchingRecommendedWallets=!0;const{includeWalletIds:t,excludeWalletIds:e,featuredWalletIds:s}=B.state,r=[...e??[],...s??[]].filter(Boolean),i=b.getRequestedCaipNetworkIds().join(","),n={page:1,entries:Tc,include:t,exclude:r,chains:i},{data:o,count:a}=await J.fetchWallets(n),c=H.getRecentWallets(),l=o.map(h=>h.image_id).filter(Boolean),u=c.map(h=>h.image_id).filter(Boolean);await Promise.allSettled([...l,...u].map(h=>J._fetchWalletImage(h))),ie.recommended=o,ie.allRecommended=o,ie.count=a??0}catch{}finally{ie.isFetchingRecommendedWallets=!1}},async fetchWalletsByPage({page:t}){const{includeWalletIds:e,excludeWalletIds:s,featuredWalletIds:r}=B.state,i=b.getRequestedCaipNetworkIds().join(","),n=[...ie.recommended.map(({id:u})=>u),...s??[],...r??[]].filter(Boolean),o={page:t,entries:Gp,include:e,exclude:n,chains:i},{data:a,count:c}=await J.fetchWallets(o),l=a.slice(0,Jp).map(u=>u.image_id).filter(Boolean);await Promise.allSettled(l.map(u=>J._fetchWalletImage(u))),ie.wallets=te.uniqueBy([...ie.wallets,...J._filterOutExtensions(a)],"id").filter(u=>{var h;return(h=u.chains)==null?void 0:h.some(d=>i.includes(d))}),ie.count=c>ie.count?c:ie.count,ie.page=t},async initializeExcludedWallets({ids:t}){const e={page:1,entries:t.length,include:t},{data:s}=await J.fetchWallets(e);s&&s.forEach(r=>{ie.excludedWallets.push({rdns:r.rdns,name:r.name})})},async searchWallet({search:t,badge:e}){const{includeWalletIds:s,excludeWalletIds:r}=B.state,i=b.getRequestedCaipNetworkIds().join(",");ie.search=[];const n={page:1,entries:100,search:t==null?void 0:t.trim(),badge_type:e,include:s,exclude:r,chains:i},{data:o}=await J.fetchWallets(n);Re.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:e??"",search:t??""}});const a=o.map(c=>c.image_id).filter(Boolean);await Promise.allSettled([...a.map(c=>J._fetchWalletImage(c)),te.wait(300)]),ie.search=J._filterOutExtensions(o)},initPromise(t,e){const s=ie.promises[t];return s||(ie.promises[t]=e())},prefetch({fetchConnectorImages:t=!0,fetchFeaturedWallets:e=!0,fetchRecommendedWallets:s=!0,fetchNetworkImages:r=!0}={}){const i=[t&&J.initPromise("connectorImages",J.fetchConnectorImages),e&&J.initPromise("featuredWallets",J.fetchFeaturedWallets),s&&J.initPromise("recommendedWallets",J.fetchRecommendedWallets),r&&J.initPromise("networkImages",J.fetchNetworkImages)].filter(Boolean);return Promise.allSettled(i)},prefetchAnalyticsConfig(){var t;(t=B.state.features)!=null&&t.analytics&&J.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:t}=await dt.get({path:"/getAnalyticsConfig",params:J._getSdkProperties()});B.setFeatures({analytics:t})}catch{B.setFeatures({analytics:!1})}},filterByNamespaces(t){if(!(t!=null&&t.length)){ie.featured=ie.allFeatured,ie.recommended=ie.allRecommended;return}const e=b.getRequestedCaipNetworkIds().join(",");ie.featured=ie.allFeatured.filter(s=>{var r;return(r=s.chains)==null?void 0:r.some(i=>e.includes(i))}),ie.recommended=ie.allRecommended.filter(s=>{var r;return(r=s.chains)==null?void 0:r.some(i=>e.includes(i))}),ie.filteredWallets=ie.wallets.filter(s=>{var r;return(r=s.chains)==null?void 0:r.some(i=>e.includes(i))})},clearFilterByNamespaces(){ie.filteredWallets=[]},setFilterByNamespace(t){if(!t){ie.featured=ie.allFeatured,ie.recommended=ie.allRecommended;return}const e=b.getRequestedCaipNetworkIds().join(",");ie.featured=ie.allFeatured.filter(s=>{var r;return(r=s.chains)==null?void 0:r.some(i=>e.includes(i))}),ie.recommended=ie.allRecommended.filter(s=>{var r;return(r=s.chains)==null?void 0:r.some(i=>e.includes(i))}),ie.filteredWallets=ie.wallets.filter(s=>{var r;return(r=s.chains)==null?void 0:r.some(i=>e.includes(i))})}},Ee=xe({view:"Connect",history:["Connect"],transactionStack:[]}),Yp={state:Ee,subscribeKey(t,e){return ot(Ee,t,e)},pushTransactionStack(t){Ee.transactionStack.push(t)},popTransactionStack(t){const e=Ee.transactionStack.pop();if(!e)return;const{onSuccess:s,onError:r,onCancel:i}=e;switch(t){case"success":s==null||s();break;case"error":r==null||r(),ne.goBack();break;case"cancel":i==null||i(),ne.goBack();break}},push(t,e){t!==Ee.view&&(Ee.view=t,Ee.history.push(t),Ee.data=e)},reset(t,e){Ee.view=t,Ee.history=[t],Ee.data=e},replace(t,e){Ee.history.at(-1)===t||(Ee.view=t,Ee.history[Ee.history.length-1]=t,Ee.data=e)},goBack(){var r;const t=b.state.activeCaipAddress,e=ne.state.view==="ConnectingFarcaster",s=!t&&e;if(Ee.history.length>1){Ee.history.pop();const[i]=Ee.history.slice(-1);i&&(t&&i==="Connect"?Ee.view="Account":Ee.view=i)}else Ve.close();(r=Ee.data)!=null&&r.wallet&&(Ee.data.wallet=void 0),setTimeout(()=>{var i,n,o;if(s){K.setFarcasterUrl(void 0,b.state.activeChain);const a=W.getAuthConnector();(i=a==null?void 0:a.provider)==null||i.reload();const c=Hi(B.state);(o=(n=a==null?void 0:a.provider)==null?void 0:n.syncDappData)==null||o.call(n,{metadata:c.metadata,sdkVersion:c.sdkVersion,projectId:c.projectId,sdkType:c.sdkType})}},100)},goBackToIndex(t){if(Ee.history.length>1){Ee.history=Ee.history.slice(0,t+1);const[e]=Ee.history.slice(-1);e&&(Ee.view=e)}},goBackOrCloseModal(){ne.state.history.length>1?ne.goBack():Ve.close()}},ne=Rt(Yp),hs=xe({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),aa={state:hs,subscribe(t){return nt(hs,()=>t(hs))},setThemeMode(t){hs.themeMode=t;try{const e=W.getAuthConnector();if(e){const s=aa.getSnapshot().themeVariables;e.provider.syncTheme({themeMode:t,themeVariables:s,w3mThemeVariables:$s(s,t)})}}catch{console.info("Unable to sync theme to auth connector")}},setThemeVariables(t){hs.themeVariables={...hs.themeVariables,...t};try{const e=W.getAuthConnector();if(e){const s=aa.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:s,w3mThemeVariables:$s(hs.themeVariables,hs.themeMode)})}}catch{console.info("Unable to sync theme to auth connector")}},getSnapshot(){return Hi(hs)}},St=Rt(aa),ih={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0},pe=xe({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:{...ih},filterByNamespaceMap:{eip155:!0,solana:!0,polkadot:!0,bip122:!0,cosmos:!0}}),Zp={state:pe,subscribe(t){return nt(pe,()=>{t(pe)})},subscribeKey(t,e){return ot(pe,t,e)},initialize(t){t.forEach(e=>{const s=H.getConnectedConnectorId(e);s&&W.setConnectorId(s,e)})},setActiveConnector(t){t&&(pe.activeConnector=rr(t))},setConnectors(t){t.filter(i=>!pe.allConnectors.some(n=>n.id===i.id&&W.getConnectorName(n.name)===W.getConnectorName(i.name)&&n.chain===i.chain)).forEach(i=>{i.type!=="MULTI_CHAIN"&&pe.allConnectors.push(rr(i))});const s=W.getEnabledNamespaces(),r=W.getEnabledConnectors(s);pe.connectors=W.mergeMultiChainConnectors(r)},filterByNamespaces(t){Object.keys(pe.filterByNamespaceMap).forEach(e=>{pe.filterByNamespaceMap[e]=!1}),t.forEach(e=>{pe.filterByNamespaceMap[e]=!0}),W.updateConnectorsForEnabledNamespaces()},filterByNamespace(t,e){pe.filterByNamespaceMap[t]=e,W.updateConnectorsForEnabledNamespaces()},updateConnectorsForEnabledNamespaces(){const t=W.getEnabledNamespaces(),e=W.getEnabledConnectors(t),s=W.areAllNamespacesEnabled();pe.connectors=W.mergeMultiChainConnectors(e),s?J.clearFilterByNamespaces():J.filterByNamespaces(t)},getEnabledNamespaces(){return Object.entries(pe.filterByNamespaceMap).filter(([t,e])=>e).map(([t])=>t)},getEnabledConnectors(t){return pe.allConnectors.filter(e=>t.includes(e.chain))},areAllNamespacesEnabled(){return Object.values(pe.filterByNamespaceMap).every(t=>t)},mergeMultiChainConnectors(t){const e=W.generateConnectorMapByName(t),s=[];return e.forEach(r=>{const i=r[0],n=(i==null?void 0:i.id)===V.CONNECTOR_ID.AUTH;r.length>1&&i?s.push({name:i.name,imageUrl:i.imageUrl,imageId:i.imageId,connectors:[...r],type:n?"AUTH":"MULTI_CHAIN",chain:"eip155",id:(i==null?void 0:i.id)||""}):i&&s.push(i)}),s},generateConnectorMapByName(t){const e=new Map;return t.forEach(s=>{const{name:r}=s,i=W.getConnectorName(r);if(!i)return;const n=e.get(i)||[];n.find(a=>a.chain===s.chain)||n.push(s),e.set(i,n)}),e},getConnectorName(t){return t&&({"Trust Wallet":"Trust"}[t]||t)},getUniqueConnectorsByName(t){const e=[];return t.forEach(s=>{e.find(r=>r.chain===s.chain)||e.push(s)}),e},addConnector(t){var e,s,r;if(t.id===V.CONNECTOR_ID.AUTH){const i=t,n=Hi(B.state),o=St.getSnapshot().themeMode,a=St.getSnapshot().themeVariables;(s=(e=i==null?void 0:i.provider)==null?void 0:e.syncDappData)==null||s.call(e,{metadata:n.metadata,sdkVersion:n.sdkVersion,projectId:n.projectId,sdkType:n.sdkType}),(r=i==null?void 0:i.provider)==null||r.syncTheme({themeMode:o,themeVariables:a,w3mThemeVariables:$s(a,o)}),W.setConnectors([t])}else W.setConnectors([t])},getAuthConnector(t){var r;const e=t||b.state.activeChain,s=pe.connectors.find(i=>i.id===V.CONNECTOR_ID.AUTH);if(s)return(r=s==null?void 0:s.connectors)!=null&&r.length?s.connectors.find(n=>n.chain===e):s},getAnnouncedConnectorRdns(){return pe.connectors.filter(t=>t.type==="ANNOUNCED").map(t=>{var e;return(e=t.info)==null?void 0:e.rdns})},getConnectorById(t){return pe.allConnectors.find(e=>e.id===t)},getConnector(t,e){return pe.allConnectors.filter(r=>r.chain===b.state.activeChain).find(r=>{var i;return r.explorerId===t||((i=r.info)==null?void 0:i.rdns)===e})},syncIfAuthConnector(t){var n,o;if(t.id!=="ID_AUTH")return;const e=t,s=Hi(B.state),r=St.getSnapshot().themeMode,i=St.getSnapshot().themeVariables;(o=(n=e==null?void 0:e.provider)==null?void 0:n.syncDappData)==null||o.call(n,{metadata:s.metadata,sdkVersion:s.sdkVersion,sdkType:s.sdkType,projectId:s.projectId}),e.provider.syncTheme({themeMode:r,themeVariables:i,w3mThemeVariables:$s(i,r)})},getConnectorsByNamespace(t){const e=pe.allConnectors.filter(s=>s.chain===t);return W.mergeMultiChainConnectors(e)},selectWalletConnector(t){const e=W.getConnector(t.id,t.rdns),s=b.state.activeChain;jp.handleMobileDeeplinkRedirect((e==null?void 0:e.explorerId)||t.id,s),e?ne.push("ConnectingExternal",{connector:e}):ne.push("ConnectingWalletConnect",{wallet:t})},getConnectors(t){return t?W.getConnectorsByNamespace(t):W.mergeMultiChainConnectors(pe.allConnectors)},setFilterByNamespace(t){pe.filterByNamespace=t,pe.connectors=W.getConnectors(t),J.setFilterByNamespace(t)},setConnectorId(t,e){t&&(pe.activeConnectorIds={...pe.activeConnectorIds,[e]:t},H.setConnectedConnectorId(e,t))},removeConnectorId(t){pe.activeConnectorIds={...pe.activeConnectorIds,[t]:void 0},H.deleteConnectedConnectorId(t)},getConnectorId(t){if(t)return pe.activeConnectorIds[t]},isConnected(t){return t?!!pe.activeConnectorIds[t]:Object.values(pe.activeConnectorIds).some(e=>!!e)},resetConnectorIds(){pe.activeConnectorIds={...ih}}},W=Rt(Zp),Ui={ACCOUNT_TYPES:{SMART_ACCOUNT:"smartAccount"}},Ks=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),Be=xe({...Ks}),Xp={state:Be,subscribeKey(t,e){return ot(Be,t,e)},showLoading(t,e={}){this._showMessage({message:t,variant:"loading",...e})},showSuccess(t){this._showMessage({message:t,variant:"success"})},showSvg(t,e){this._showMessage({message:t,svg:e})},showError(t){const e=te.parseError(t);this._showMessage({message:e,variant:"error"})},hide(){Be.message=Ks.message,Be.variant=Ks.variant,Be.svg=Ks.svg,Be.open=Ks.open,Be.autoClose=Ks.autoClose},_showMessage({message:t,svg:e,variant:s="success",autoClose:r=Ks.autoClose}){Be.open?(Be.open=!1,setTimeout(()=>{Be.message=t,Be.variant=s,Be.svg=e,Be.open=!0,Be.autoClose=r},150)):(Be.message=t,Be.variant=s,Be.svg=e,Be.open=!0,Be.autoClose=r)}},Zt=Xp,Pe=xe({transactions:[],coinbaseTransactions:{},transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),Qp={state:Pe,subscribe(t){return nt(Pe,()=>t(Pe))},setLastNetworkInView(t){Pe.lastNetworkInView=t},async fetchTransactions(t,e){var s,r;if(!t)throw new Error("Transactions can't be fetched without an accountAddress");Pe.loading=!0;try{const i=await Q.fetchTransactions({account:t,cursor:Pe.next,onramp:e,cache:e==="coinbase"?"no-cache":void 0,chainId:(s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId}),n=Oi.filterSpamTransactions(i.data),o=Oi.filterByConnectedChain(n),a=[...Pe.transactions,...o];Pe.loading=!1,e==="coinbase"?Pe.coinbaseTransactions=Oi.groupTransactionsByYearAndMonth(Pe.coinbaseTransactions,i.data):(Pe.transactions=a,Pe.transactionsByYear=Oi.groupTransactionsByYearAndMonth(Pe.transactionsByYear,o)),Pe.empty=a.length===0,Pe.next=i.next?i.next:void 0}catch{const n=b.state.activeChain;Re.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:t,projectId:B.state.projectId,cursor:Pe.next,isSmartAccount:((r=K.state.preferredAccountTypes)==null?void 0:r[n])===Ui.ACCOUNT_TYPES.SMART_ACCOUNT}}),Zt.showError("Failed to fetch transactions"),Pe.loading=!1,Pe.empty=!0,Pe.next=void 0}},groupTransactionsByYearAndMonth(t={},e=[]){const s=t;return e.forEach(r=>{const i=new Date(r.metadata.minedAt).getFullYear(),n=new Date(r.metadata.minedAt).getMonth(),o=s[i]??{},c=(o[n]??[]).filter(l=>l.id!==r.id);s[i]={...o,[n]:[...c,r].sort((l,u)=>new Date(u.metadata.minedAt).getTime()-new Date(l.metadata.minedAt).getTime())}}),s},filterSpamTransactions(t){return t.filter(e=>!e.transfers.every(r=>{var i;return((i=r.nft_info)==null?void 0:i.flags.is_spam)===!0}))},filterByConnectedChain(t){var r;const e=(r=b.state.activeCaipNetwork)==null?void 0:r.caipNetworkId;return t.filter(i=>i.metadata.chain===e)},clearCursor(){Pe.next=void 0},resetTransactions(){Pe.transactions=[],Pe.transactionsByYear={},Pe.lastNetworkInView=void 0,Pe.loading=!1,Pe.empty=!1,Pe.next=void 0}},Oi=Rt(Qp,"API_ERROR"),Ce=xe({connections:new Map,wcError:!1,buffering:!1,status:"disconnected"});let zs;const ef={state:Ce,subscribeKey(t,e){return ot(Ce,t,e)},_getClient(){return Ce._client},setClient(t){Ce._client=rr(t)},async connectWalletConnect(){var t,e,s,r;if(te.isTelegram()||te.isSafari()&&te.isIos()){if(zs){await zs,zs=void 0;return}if(!te.isPairingExpired(Ce==null?void 0:Ce.wcPairingExpiry)){const i=Ce.wcUri;Ce.wcUri=i;return}zs=(e=(t=ee._getClient())==null?void 0:t.connectWalletConnect)==null?void 0:e.call(t).catch(()=>{}),ee.state.status="connecting",await zs,zs=void 0,Ce.wcPairingExpiry=void 0,ee.state.status="connected"}else await((r=(s=ee._getClient())==null?void 0:s.connectWalletConnect)==null?void 0:r.call(s))},async connectExternal(t,e,s=!0){var r,i;await((i=(r=ee._getClient())==null?void 0:r.connectExternal)==null?void 0:i.call(r,t)),s&&b.setActiveNamespace(e)},async reconnectExternal(t){var s,r;await((r=(s=ee._getClient())==null?void 0:s.reconnectExternal)==null?void 0:r.call(s,t));const e=t.chain||b.state.activeChain;e&&W.setConnectorId(t.id,e)},async setPreferredAccountType(t,e){var r;Ve.setLoading(!0,b.state.activeChain);const s=W.getAuthConnector();s&&(K.setPreferredAccountType(t,e),await s.provider.setPreferredAccount(t),H.setPreferredAccountTypes(K.state.preferredAccountTypes??{[e]:t}),await ee.reconnectExternal(s),Ve.setLoading(!1,b.state.activeChain),Re.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:t,network:((r=b.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)||""}}))},async signMessage(t){var e;return(e=ee._getClient())==null?void 0:e.signMessage(t)},parseUnits(t,e){var s;return(s=ee._getClient())==null?void 0:s.parseUnits(t,e)},formatUnits(t,e){var s;return(s=ee._getClient())==null?void 0:s.formatUnits(t,e)},async sendTransaction(t){var e;return(e=ee._getClient())==null?void 0:e.sendTransaction(t)},async getCapabilities(t){var e;return(e=ee._getClient())==null?void 0:e.getCapabilities(t)},async grantPermissions(t){var e;return(e=ee._getClient())==null?void 0:e.grantPermissions(t)},async walletGetAssets(t){var e;return((e=ee._getClient())==null?void 0:e.walletGetAssets(t))??{}},async estimateGas(t){var e;return(e=ee._getClient())==null?void 0:e.estimateGas(t)},async writeContract(t){var e;return(e=ee._getClient())==null?void 0:e.writeContract(t)},async getEnsAddress(t){var e;return(e=ee._getClient())==null?void 0:e.getEnsAddress(t)},async getEnsAvatar(t){var e;return(e=ee._getClient())==null?void 0:e.getEnsAvatar(t)},checkInstalled(t){var e,s;return((s=(e=ee._getClient())==null?void 0:e.checkInstalled)==null?void 0:s.call(e,t))||!1},resetWcConnection(){Ce.wcUri=void 0,Ce.wcPairingExpiry=void 0,Ce.wcLinking=void 0,Ce.recentWallet=void 0,Ce.status="disconnected",Oi.resetTransactions(),H.deleteWalletConnectDeepLink()},resetUri(){Ce.wcUri=void 0,Ce.wcPairingExpiry=void 0,zs=void 0},finalizeWcConnection(){var s,r;const{wcLinking:t,recentWallet:e}=ee.state;t&&H.setWalletConnectDeepLink(t),e&&H.setAppKitRecent(e),Re.sendEvent({type:"track",event:"CONNECT_SUCCESS",properties:{method:t?"mobile":"qrcode",name:((r=(s=ne.state.data)==null?void 0:s.wallet)==null?void 0:r.name)||"Unknown"}})},setWcBasic(t){Ce.wcBasic=t},setUri(t){Ce.wcUri=t,Ce.wcPairingExpiry=te.getPairingExpiry()},setWcLinking(t){Ce.wcLinking=t},setWcError(t){Ce.wcError=t,Ce.buffering=!1},setRecentWallet(t){Ce.recentWallet=t},setBuffering(t){Ce.buffering=t},setStatus(t){Ce.status=t},async disconnect(t){var e;try{await((e=ee._getClient())==null?void 0:e.disconnect(t))}catch(s){throw new Vr("Failed to disconnect","INTERNAL_SDK_ERROR",s)}},setConnections(t,e){Ce.connections.set(e,t)},switchAccount({connection:t,address:e,namespace:s}){if(W.state.activeConnectorIds[s]===t.connectorId){const n=b.state.activeCaipNetwork;if(n){const o=`${s}:${n.id}:${e}`;K.setCaipAddress(o,s)}else console.warn(`No current network found for namespace "${s}"`)}else{const n=W.getConnector(t.connectorId);n?ee.connectExternal(n,s):console.warn(`No connector found for namespace "${s}"`)}}},ee=Rt(ef),pr=xe({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1}),Us={state:pr,subscribe(t){return nt(pr,()=>t(pr))},subscribeOpen(t){return ot(pr,"open",t)},set(t){Object.assign(pr,{...pr,...t})}},wo={createBalance(t,e){const s={name:t.metadata.name||"",symbol:t.metadata.symbol||"",decimals:t.metadata.decimals||0,value:t.metadata.value||0,price:t.metadata.price||0,iconUrl:t.metadata.iconUrl||""};return{name:s.name,symbol:s.symbol,chainId:e,address:t.address==="native"?void 0:this.convertAddressToCAIP10Address(t.address,e),value:s.value,price:s.price,quantity:{decimals:s.decimals.toString(),numeric:this.convertHexToBalance({hex:t.balance,decimals:s.decimals})},iconUrl:s.iconUrl}},convertHexToBalance({hex:t,decimals:e}){return up(BigInt(t),e)},convertAddressToCAIP10Address(t,e){return`${e}:${t}`},createCAIP2ChainId(t,e){return`${e}:${parseInt(t,16)}`},getChainIdHexFromCAIP2ChainId(t){const e=t.split(":");if(e.length<2||!e[1])return"0x0";const s=e[1],r=parseInt(s,10);return isNaN(r)?"0x0":`0x${r.toString(16)}`},isWalletGetAssetsResponse(t){return typeof t!="object"||t===null?!1:Object.values(t).every(e=>Array.isArray(e)&&e.every(s=>this.isValidAsset(s)))},isValidAsset(t){return typeof t=="object"&&t!==null&&typeof t.address=="string"&&typeof t.balance=="string"&&(t.type==="ERC20"||t.type==="NATIVE")&&typeof t.metadata=="object"&&t.metadata!==null&&typeof t.metadata.name=="string"&&typeof t.metadata.symbol=="string"&&typeof t.metadata.decimals=="number"&&typeof t.metadata.price=="number"&&typeof t.metadata.iconUrl=="string"}},Oc={async getMyTokensWithBalance(t){const e=K.state.address,s=b.state.activeCaipNetwork;if(!e||!s)return[];if(s.chainNamespace==="eip155"){const i=await this.getEIP155Balances(e,s);if(i)return this.filterLowQualityTokens(i)}const r=await Q.getBalance(e,s.caipNetworkId,t);return this.filterLowQualityTokens(r.balances)},async getEIP155Balances(t,e){var s,r;try{const i=wo.getChainIdHexFromCAIP2ChainId(e.caipNetworkId),n=await ee.getCapabilities(t);if(!((r=(s=n==null?void 0:n[i])==null?void 0:s.assetDiscovery)!=null&&r.supported))return null;const o=await ee.walletGetAssets({account:t,chainFilter:[i]});return wo.isWalletGetAssetsResponse(o)?(o[i]||[]).map(c=>wo.createBalance(c,e.caipNetworkId)):null}catch{return null}},filterLowQualityTokens(t){return t.filter(e=>e.quantity.decimals!=="0")},mapBalancesToSwapTokens(t){return(t==null?void 0:t.map(e=>({...e,address:e!=null&&e.address?e.address:b.getActiveNetworkTokenAddress(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1})))||[]}},ve=xe({tokenBalances:[],loading:!1}),tf={state:ve,subscribe(t){return nt(ve,()=>t(ve))},subscribeKey(t,e){return ot(ve,t,e)},setToken(t){t&&(ve.token=rr(t))},setTokenAmount(t){ve.sendTokenAmount=t},setReceiverAddress(t){ve.receiverAddress=t},setReceiverProfileImageUrl(t){ve.receiverProfileImageUrl=t},setReceiverProfileName(t){ve.receiverProfileName=t},setNetworkBalanceInUsd(t){ve.networkBalanceInUSD=t},setLoading(t){ve.loading=t},async sendToken(){var t;try{switch(ye.setLoading(!0),(t=b.state.activeCaipNetwork)==null?void 0:t.chainNamespace){case"eip155":await ye.sendEvmToken();return;case"solana":await ye.sendSolanaToken();return;default:throw new Error("Unsupported chain")}}finally{ye.setLoading(!1)}},async sendEvmToken(){var s,r,i,n;const t=b.state.activeChain,e=(s=K.state.preferredAccountTypes)==null?void 0:s[t];if(!ye.state.sendTokenAmount||!ye.state.receiverAddress)throw new Error("An amount and receiver address are required");if(!ye.state.token)throw new Error("A token is required");(r=ye.state.token)!=null&&r.address?(Re.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Ui.ACCOUNT_TYPES.SMART_ACCOUNT,token:ye.state.token.address,amount:ye.state.sendTokenAmount,network:((i=b.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)||""}}),await ye.sendERC20Token({receiverAddress:ye.state.receiverAddress,tokenAddress:ye.state.token.address,sendTokenAmount:ye.state.sendTokenAmount,decimals:ye.state.token.quantity.decimals})):(Re.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Ui.ACCOUNT_TYPES.SMART_ACCOUNT,token:ye.state.token.symbol||"",amount:ye.state.sendTokenAmount,network:((n=b.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||""}}),await ye.sendNativeToken({receiverAddress:ye.state.receiverAddress,sendTokenAmount:ye.state.sendTokenAmount,decimals:ye.state.token.quantity.decimals}))},async fetchTokenBalance(t){var n,o;ve.loading=!0;const e=(n=b.state.activeCaipNetwork)==null?void 0:n.caipNetworkId,s=(o=b.state.activeCaipNetwork)==null?void 0:o.chainNamespace,r=b.state.activeCaipAddress,i=r?te.getPlainAddress(r):void 0;if(ve.lastRetry&&!te.isAllowedRetry(ve.lastRetry,30*_e.ONE_SEC_MS))return ve.loading=!1,[];try{if(i&&e&&s){const a=await Oc.getMyTokensWithBalance();return ve.tokenBalances=a,ve.lastRetry=void 0,a}}catch(a){ve.lastRetry=Date.now(),t==null||t(a),Zt.showError("Token Balance Unavailable")}finally{ve.loading=!1}return[]},fetchNetworkBalance(){if(ve.tokenBalances.length===0)return;const t=Oc.mapBalancesToSwapTokens(ve.tokenBalances);if(!t)return;const e=t.find(s=>s.address===b.getActiveNetworkTokenAddress());e&&(ve.networkBalanceInUSD=e?Ip.multiply(e.quantity.numeric,e.price).toString():"0")},async sendNativeToken(t){var n,o,a,c;ne.pushTransactionStack({});const e=t.receiverAddress,s=K.state.address,r=ee.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals));await ee.sendTransaction({chainNamespace:"eip155",to:e,address:s,data:"0x",value:r??BigInt(0)}),Re.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:((n=K.state.preferredAccountTypes)==null?void 0:n.eip155)===Ui.ACCOUNT_TYPES.SMART_ACCOUNT,token:((o=ye.state.token)==null?void 0:o.symbol)||"",amount:t.sendTokenAmount,network:((a=b.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)||""}}),(c=ee._getClient())==null||c.updateBalance("eip155"),ye.resetSend()},async sendERC20Token(t){ne.pushTransactionStack({onSuccess(){ne.replace("Account")}});const e=ee.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals));if(K.state.address&&t.sendTokenAmount&&t.receiverAddress&&t.tokenAddress){const s=te.getPlainAddress(t.tokenAddress);await ee.writeContract({fromAddress:K.state.address,tokenAddress:s,args:[t.receiverAddress,e??BigInt(0)],method:"transfer",abi:Sp.getERC20Abi(s),chainNamespace:"eip155"}),ye.resetSend()}},async sendSolanaToken(){var t;if(!ye.state.sendTokenAmount||!ye.state.receiverAddress)throw new Error("An amount and receiver address are required");ne.pushTransactionStack({onSuccess(){ne.replace("Account")}}),await ee.sendTransaction({chainNamespace:"solana",to:ye.state.receiverAddress,value:ye.state.sendTokenAmount}),(t=ee._getClient())==null||t.updateBalance("solana"),ye.resetSend()},resetSend(){ve.token=void 0,ve.sendTokenAmount=void 0,ve.receiverAddress=void 0,ve.receiverProfileImageUrl=void 0,ve.receiverProfileName=void 0,ve.loading=!1,ve.tokenBalances=[]}},ye=Rt(tf),yo={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[],user:void 0},fn={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},z=xe({chains:kp(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{networkControllerClient:void 0,connectionControllerClient:void 0},isSwitchingNamespace:!1}),sf={state:z,subscribe(t){return nt(z,()=>{t(z)})},subscribeKey(t,e){return ot(z,t,e)},subscribeChainProp(t,e,s){let r;return nt(z.chains,()=>{var n;const i=s||z.activeChain;if(i){const o=(n=z.chains.get(i))==null?void 0:n[t];r!==o&&(r=o,e(o))}})},initialize(t,e,s){const{chainId:r,namespace:i}=H.getActiveNetworkProps(),n=e==null?void 0:e.find(u=>u.id.toString()===(r==null?void 0:r.toString())),a=t.find(u=>(u==null?void 0:u.namespace)===i)||(t==null?void 0:t[0]),c=t.map(u=>u.namespace).filter(u=>u!==void 0),l=B.state.enableEmbedded?new Set([...c]):new Set([...(e==null?void 0:e.map(u=>u.chainNamespace))??[]]);((t==null?void 0:t.length)===0||!a)&&(z.noAdapters=!0),z.noAdapters||(z.activeChain=a==null?void 0:a.namespace,z.activeCaipNetwork=n,b.setChainNetworkData(a==null?void 0:a.namespace,{caipNetwork:n}),z.activeChain&&Us.set({activeChain:a==null?void 0:a.namespace})),l.forEach(u=>{const h=e==null?void 0:e.filter(d=>d.chainNamespace===u);b.state.chains.set(u,{namespace:u,networkState:xe({...fn,caipNetwork:h==null?void 0:h[0]}),accountState:xe(yo),caipNetworks:h??[],...s}),b.setRequestedCaipNetworks(h??[],u)})},removeAdapter(t){var e,s;if(z.activeChain===t){const r=Array.from(z.chains.entries()).find(([i])=>i!==t);if(r){const i=(s=(e=r[1])==null?void 0:e.caipNetworks)==null?void 0:s[0];i&&b.setActiveCaipNetwork(i)}}z.chains.delete(t)},addAdapter(t,{networkControllerClient:e,connectionControllerClient:s},r){z.chains.set(t.namespace,{namespace:t.namespace,networkState:{...fn,caipNetwork:r[0]},accountState:yo,caipNetworks:r,connectionControllerClient:s,networkControllerClient:e}),b.setRequestedCaipNetworks((r==null?void 0:r.filter(i=>i.chainNamespace===t.namespace))??[],t.namespace)},addNetwork(t){var s;const e=z.chains.get(t.chainNamespace);if(e){const r=[...e.caipNetworks||[]];(s=e.caipNetworks)!=null&&s.find(i=>i.id===t.id)||r.push(t),z.chains.set(t.chainNamespace,{...e,caipNetworks:r}),b.setRequestedCaipNetworks(r,t.chainNamespace),W.filterByNamespace(t.chainNamespace,!0)}},removeNetwork(t,e){var r,i,n;const s=z.chains.get(t);if(s){const o=((r=z.activeCaipNetwork)==null?void 0:r.id)===e,a=[...((i=s.caipNetworks)==null?void 0:i.filter(c=>c.id!==e))||[]];o&&((n=s==null?void 0:s.caipNetworks)!=null&&n[0])&&b.setActiveCaipNetwork(s.caipNetworks[0]),z.chains.set(t,{...s,caipNetworks:a}),b.setRequestedCaipNetworks(a||[],t),a.length===0&&W.filterByNamespace(t,!1)}},setAdapterNetworkState(t,e){const s=z.chains.get(t);s&&(s.networkState={...s.networkState||fn,...e},z.chains.set(t,s))},setChainAccountData(t,e,s=!0){if(!t)throw new Error("Chain is required to update chain account data");const r=z.chains.get(t);if(r){const i={...r.accountState||yo,...e};z.chains.set(t,{...r,accountState:i}),(z.chains.size===1||z.activeChain===t)&&(e.caipAddress&&(z.activeCaipAddress=e.caipAddress),K.replaceState(i))}},setChainNetworkData(t,e){if(!t)return;const s=z.chains.get(t);if(s){const r={...s.networkState||fn,...e};z.chains.set(t,{...s,networkState:r})}},setAccountProp(t,e,s,r=!0){b.setChainAccountData(s,{[t]:e},r),t==="status"&&e==="disconnected"&&s&&W.removeConnectorId(s)},setActiveNamespace(t){var r,i;z.activeChain=t;const e=t?z.chains.get(t):void 0,s=(r=e==null?void 0:e.networkState)==null?void 0:r.caipNetwork;s!=null&&s.id&&t&&(z.activeCaipAddress=(i=e==null?void 0:e.accountState)==null?void 0:i.caipAddress,z.activeCaipNetwork=s,b.setChainNetworkData(t,{caipNetwork:s}),H.setActiveCaipNetworkId(s==null?void 0:s.caipNetworkId),Us.set({activeChain:t,selectedNetworkId:s==null?void 0:s.caipNetworkId}))},setActiveCaipNetwork(t){var r,i,n;if(!t)return;z.activeChain!==t.chainNamespace&&b.setIsSwitchingNamespace(!0);const e=z.chains.get(t.chainNamespace);z.activeChain=t.chainNamespace,z.activeCaipNetwork=t,b.setChainNetworkData(t.chainNamespace,{caipNetwork:t}),(r=e==null?void 0:e.accountState)!=null&&r.address?z.activeCaipAddress=`${t.chainNamespace}:${t.id}:${(i=e==null?void 0:e.accountState)==null?void 0:i.address}`:z.activeCaipAddress=void 0,b.setAccountProp("caipAddress",z.activeCaipAddress,t.chainNamespace),e&&K.replaceState(e.accountState),ye.resetSend(),Us.set({activeChain:z.activeChain,selectedNetworkId:(n=z.activeCaipNetwork)==null?void 0:n.caipNetworkId}),H.setActiveCaipNetworkId(t.caipNetworkId),!b.checkIfSupportedNetwork(t.chainNamespace)&&B.state.enableNetworkSwitch&&!B.state.allowUnsupportedChain&&!ee.state.wcBasic&&b.showUnsupportedChainUI()},addCaipNetwork(t){var s;if(!t)return;const e=z.chains.get(t.chainNamespace);e&&((s=e==null?void 0:e.caipNetworks)==null||s.push(t))},async switchActiveNamespace(t){var i;if(!t)return;const e=t!==b.state.activeChain,s=(i=b.getNetworkData(t))==null?void 0:i.caipNetwork,r=b.getCaipNetworkByNamespace(t,s==null?void 0:s.id);e&&r&&await b.switchActiveNetwork(r)},async switchActiveNetwork(t){var i;const e=b.state.chains.get(b.state.activeChain),s=!((i=e==null?void 0:e.caipNetworks)!=null&&i.some(n=>{var o;return n.id===((o=z.activeCaipNetwork)==null?void 0:o.id)})),r=b.getNetworkControllerClient(t.chainNamespace);if(r){try{await r.switchCaipNetwork(t),s&&Ve.close()}catch{ne.goBack()}Re.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:t.caipNetworkId}})}},getNetworkControllerClient(t){const e=t||z.activeChain,s=z.chains.get(e);if(!s)throw new Error("Chain adapter not found");if(!s.networkControllerClient)throw new Error("NetworkController client not set");return s.networkControllerClient},getConnectionControllerClient(t){const e=t||z.activeChain;if(!e)throw new Error("Chain is required to get connection controller client");const s=z.chains.get(e);if(!(s!=null&&s.connectionControllerClient))throw new Error("ConnectionController client not set");return s.connectionControllerClient},getAccountProp(t,e){var i;let s=z.activeChain;if(e&&(s=e),!s)return;const r=(i=z.chains.get(s))==null?void 0:i.accountState;if(r)return r[t]},getNetworkProp(t,e){var r;const s=(r=z.chains.get(e))==null?void 0:r.networkState;if(s)return s[t]},getRequestedCaipNetworks(t){const e=z.chains.get(t),{approvedCaipNetworkIds:s=[],requestedCaipNetworks:r=[]}=(e==null?void 0:e.networkState)||{};return te.sortRequestedNetworks(s,r)},getAllRequestedCaipNetworks(){const t=[];return z.chains.forEach(e=>{const s=b.getRequestedCaipNetworks(e.namespace);t.push(...s)}),t},setRequestedCaipNetworks(t,e){b.setAdapterNetworkState(e,{requestedCaipNetworks:t});const r=b.getAllRequestedCaipNetworks().map(n=>n.chainNamespace),i=Array.from(new Set(r));W.filterByNamespaces(i)},getAllApprovedCaipNetworkIds(){const t=[];return z.chains.forEach(e=>{const s=b.getApprovedCaipNetworkIds(e.namespace);t.push(...s)}),t},getActiveCaipNetwork(){return z.activeCaipNetwork},getActiveCaipAddress(){return z.activeCaipAddress},getApprovedCaipNetworkIds(t){var r;const e=z.chains.get(t);return((r=e==null?void 0:e.networkState)==null?void 0:r.approvedCaipNetworkIds)||[]},async setApprovedCaipNetworksData(t){const e=b.getNetworkControllerClient(),s=await(e==null?void 0:e.getApprovedCaipNetworksData());b.setAdapterNetworkState(t,{approvedCaipNetworkIds:s==null?void 0:s.approvedCaipNetworkIds,supportsAllNetworks:s==null?void 0:s.supportsAllNetworks})},checkIfSupportedNetwork(t,e){const s=e||z.activeCaipNetwork,r=b.getRequestedCaipNetworks(t);return r.length?r==null?void 0:r.some(i=>i.id===(s==null?void 0:s.id)):!0},checkIfSupportedChainId(t){if(!z.activeChain)return!0;const e=b.getRequestedCaipNetworks(z.activeChain);return e==null?void 0:e.some(s=>s.id===t)},setSmartAccountEnabledNetworks(t,e){b.setAdapterNetworkState(e,{smartAccountEnabledNetworks:t})},checkIfSmartAccountEnabled(){var r;const t=th.caipNetworkIdToNumber((r=z.activeCaipNetwork)==null?void 0:r.caipNetworkId),e=z.activeChain;if(!e||!t)return!1;const s=b.getNetworkProp("smartAccountEnabledNetworks",e);return!!(s!=null&&s.includes(Number(t)))},getActiveNetworkTokenAddress(){var r,i;const t=((r=z.activeCaipNetwork)==null?void 0:r.chainNamespace)||"eip155",e=((i=z.activeCaipNetwork)==null?void 0:i.id)||1,s=_e.NATIVE_TOKEN_ADDRESS[t];return`${t}:${e}:${s}`},showUnsupportedChainUI(){Ve.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const t=z.activeCaipNetwork;return!!(t!=null&&t.chainNamespace&&_e.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(t.chainNamespace))},resetNetwork(t){b.setAdapterNetworkState(t,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]})},resetAccount(t){const e=t;if(!e)throw new Error("Chain is required to set account prop");z.activeCaipAddress=void 0,b.setChainAccountData(e,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountTypes:void 0,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,allAccounts:[],user:void 0,status:"disconnected"}),W.removeConnectorId(e)},setIsSwitchingNamespace(t){z.isSwitchingNamespace=t},getFirstCaipNetworkSupportsAuthConnector(){var s,r;const t=[];let e;if(z.chains.forEach(i=>{V.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(n=>n===i.namespace)&&i.namespace&&t.push(i.namespace)}),t.length>0){const i=t[0];return e=i?(r=(s=z.chains.get(i))==null?void 0:s.caipNetworks)==null?void 0:r[0]:void 0,e}},getAccountData(t){var e;return t?(e=b.state.chains.get(t))==null?void 0:e.accountState:K.state},getNetworkData(t){var s;const e=t||z.activeChain;if(e)return(s=b.state.chains.get(e))==null?void 0:s.networkState},getCaipNetworkByNamespace(t,e){var i,n,o;if(!t)return;const s=b.state.chains.get(t),r=(i=s==null?void 0:s.caipNetworks)==null?void 0:i.find(a=>a.id===e);return r||((n=s==null?void 0:s.networkState)==null?void 0:n.caipNetwork)||((o=s==null?void 0:s.caipNetworks)==null?void 0:o[0])},getRequestedCaipNetworkIds(){const t=W.state.filterByNamespace;return(t?[z.chains.get(t)]:Array.from(z.chains.values())).flatMap(s=>(s==null?void 0:s.caipNetworks)||[]).map(s=>s.caipNetworkId)},getCaipNetworks(t){return t?b.getRequestedCaipNetworks(t):b.getAllRequestedCaipNetworks()}},b=Rt(sf),rf={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},nh=te.getBlockchainApiUrl(),pt=xe({clientId:null,api:new tn({baseUrl:nh,clientId:null}),supportedChains:{http:[],ws:[]}}),Q={state:pt,async get(t){const{st:e,sv:s}=Q.getSdkProperties(),r=B.state.projectId,i={...t.params||{},st:e,sv:s,projectId:r};return pt.api.get({...t,params:i})},getSdkProperties(){const{sdkType:t,sdkVersion:e}=B.state;return{st:t||"unknown",sv:e||"unknown"}},async isNetworkSupported(t){if(!t)return!1;try{pt.supportedChains.http.length||await Q.getSupportedNetworks()}catch{return!1}return pt.supportedChains.http.includes(t)},async getSupportedNetworks(){try{const t=await Q.get({path:"v1/supported-chains"});return pt.supportedChains=t,t}catch{return pt.supportedChains}},async fetchIdentity({address:t,caipNetworkId:e}){if(!await Q.isNetworkSupported(e))return{avatar:"",name:""};const r=H.getIdentityFromCacheForAddress(t);if(r)return r;const i=await Q.get({path:`/v1/identity/${t}`,params:{sender:b.state.activeCaipAddress?te.getPlainAddress(b.state.activeCaipAddress):void 0}});return H.updateIdentityCache({address:t,identity:i,timestamp:Date.now()}),i},async fetchTransactions({account:t,cursor:e,onramp:s,signal:r,cache:i,chainId:n}){var a;return await Q.isNetworkSupported((a=b.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)?Q.get({path:`/v1/account/${t}/history`,params:{cursor:e,onramp:s,chainId:n},signal:r,cache:i}):{data:[],next:void 0}},async fetchSwapQuote({amount:t,userAddress:e,from:s,to:r,gasPrice:i}){var o;return await Q.isNetworkSupported((o=b.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)?Q.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:t,userAddress:e,from:s,to:r,gasPrice:i}}):{quotes:[]}},async fetchSwapTokens({chainId:t}){var s;return await Q.isNetworkSupported((s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?Q.get({path:"/v1/convert/tokens",params:{chainId:t}}):{tokens:[]}},async fetchTokenPrice({addresses:t}){var s;return await Q.isNetworkSupported((s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?pt.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:t,projectId:B.state.projectId},headers:{"Content-Type":"application/json"}}):{fungibles:[]}},async fetchSwapAllowance({tokenAddress:t,userAddress:e}){var r;return await Q.isNetworkSupported((r=b.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?Q.get({path:"/v1/convert/allowance",params:{tokenAddress:t,userAddress:e},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice({chainId:t}){var i;const{st:e,sv:s}=Q.getSdkProperties();if(!await Q.isNetworkSupported((i=b.state.activeCaipNetwork)==null?void 0:i.caipNetworkId))throw new Error("Network not supported for Gas Price");return Q.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:t,st:e,sv:s}})},async generateSwapCalldata({amount:t,from:e,to:s,userAddress:r,disableEstimate:i}){var o;if(!await Q.isNetworkSupported((o=b.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return pt.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:t,eip155:{slippage:_e.CONVERT_SLIPPAGE_TOLERANCE},projectId:B.state.projectId,from:e,to:s,userAddress:r,disableEstimate:i}})},async generateApproveCalldata({from:t,to:e,userAddress:s}){var o;const{st:r,sv:i}=Q.getSdkProperties();if(!await Q.isNetworkSupported((o=b.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return Q.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:s,from:t,to:e,st:r,sv:i}})},async getBalance(t,e,s){var l;const{st:r,sv:i}=Q.getSdkProperties();if(!await Q.isNetworkSupported((l=b.state.activeCaipNetwork)==null?void 0:l.caipNetworkId))return Zt.showError("Token Balance Unavailable"),{balances:[]};const o=`${e}:${t}`,a=H.getBalanceCacheForCaipAddress(o);if(a)return a;const c=await Q.get({path:`/v1/account/${t}/balance`,params:{currency:"usd",chainId:e,forceUpdate:s,st:r,sv:i}});return H.updateBalanceCache({caipAddress:o,balance:c,timestamp:Date.now()}),c},async lookupEnsName(t){var s;return await Q.isNetworkSupported((s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?Q.get({path:`/v1/profile/account/${t}`,params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName({address:t}){var s;return await Q.isNetworkSupported((s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?Q.get({path:`/v1/profile/reverse/${t}`,params:{sender:K.state.address,apiVersion:"2"}}):[]},async getEnsNameSuggestions(t){var s;return await Q.isNetworkSupported((s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?Q.get({path:`/v1/profile/suggestions/${t}`,params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName({coinType:t,address:e,message:s,signature:r}){var n;return await Q.isNetworkSupported((n=b.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?pt.api.post({path:"/v1/profile/account",body:{coin_type:t,address:e,message:s,signature:r},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL({destinationWallets:t,partnerUserId:e,defaultNetwork:s,purchaseAmount:r,paymentAmount:i}){var a;return await Q.isNetworkSupported((a=b.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)?(await pt.api.post({path:"/v1/generators/onrampurl",params:{projectId:B.state.projectId},body:{destinationWallets:t,defaultNetwork:s,partnerUserId:e,defaultExperience:"buy",presetCryptoAmount:r,presetFiatAmount:i}})).url:""},async getOnrampOptions(){var e;if(!await Q.isNetworkSupported((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await Q.get({path:"/v1/onramp/options"})}catch{return rf}},async getOnrampQuote({purchaseCurrency:t,paymentCurrency:e,amount:s,network:r}){var i;try{return await Q.isNetworkSupported((i=b.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?await pt.api.post({path:"/v1/onramp/quote",params:{projectId:B.state.projectId},body:{purchaseCurrency:t,paymentCurrency:e,amount:s,network:r}}):null}catch{return{coinbaseFee:{amount:s,currency:e.id},networkFee:{amount:s,currency:e.id},paymentSubtotal:{amount:s,currency:e.id},paymentTotal:{amount:s,currency:e.id},purchaseAmount:{amount:s,currency:e.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(t){var s;return await Q.isNetworkSupported((s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?Q.get({path:`/v1/sessions/${t}`}):[]},async revokeSmartSession(t,e,s){var i;return await Q.isNetworkSupported((i=b.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?pt.api.post({path:`/v1/sessions/${t}/revoke`,params:{projectId:B.state.projectId},body:{pci:e,signature:s}}):{success:!1}},setClientId(t){pt.clientId=t,pt.api=new tn({baseUrl:nh,clientId:t})}},Ut=xe({currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[]}),nf={state:Ut,replaceState(t){t&&Object.assign(Ut,rr(t))},subscribe(t){return b.subscribeChainProp("accountState",e=>{if(e)return t(e)})},subscribeKey(t,e,s){let r;return b.subscribeChainProp("accountState",i=>{if(i){const n=i[t];r!==n&&(r=n,e(n))}},s)},setStatus(t,e){b.setAccountProp("status",t,e)},getCaipAddress(t){return b.getAccountProp("caipAddress",t)},setCaipAddress(t,e){const s=t?te.getPlainAddress(t):void 0;e===b.state.activeChain&&(b.state.activeCaipAddress=t),b.setAccountProp("caipAddress",t,e),b.setAccountProp("address",s,e)},setBalance(t,e,s){b.setAccountProp("balance",t,s),b.setAccountProp("balanceSymbol",e,s)},setProfileName(t,e){b.setAccountProp("profileName",t,e)},setProfileImage(t,e){b.setAccountProp("profileImage",t,e)},setUser(t,e){b.setAccountProp("user",t,e)},setAddressExplorerUrl(t,e){b.setAccountProp("addressExplorerUrl",t,e)},setSmartAccountDeployed(t,e){b.setAccountProp("smartAccountDeployed",t,e)},setCurrentTab(t){b.setAccountProp("currentTab",t,b.state.activeChain)},setTokenBalance(t,e){t&&b.setAccountProp("tokenBalance",t,e)},setShouldUpdateToAddress(t,e){b.setAccountProp("shouldUpdateToAddress",t,e)},setAllAccounts(t,e){b.setAccountProp("allAccounts",t,e)},addAddressLabel(t,e,s){const r=b.getAccountProp("addressLabels",s)||new Map;r.set(t,e),b.setAccountProp("addressLabels",r,s)},removeAddressLabel(t,e){const s=b.getAccountProp("addressLabels",e)||new Map;s.delete(t),b.setAccountProp("addressLabels",s,e)},setConnectedWalletInfo(t,e){b.setAccountProp("connectedWalletInfo",t,e,!1)},setPreferredAccountType(t,e){b.setAccountProp("preferredAccountTypes",{...Ut.preferredAccountTypes,[e]:t},e)},setPreferredAccountTypes(t){Ut.preferredAccountTypes=t},setSocialProvider(t,e){t&&b.setAccountProp("socialProvider",t,e)},setSocialWindow(t,e){b.setAccountProp("socialWindow",t?rr(t):void 0,e)},setFarcasterUrl(t,e){b.setAccountProp("farcasterUrl",t,e)},async fetchTokenBalance(t){var n,o;Ut.balanceLoading=!0;const e=(n=b.state.activeCaipNetwork)==null?void 0:n.caipNetworkId,s=(o=b.state.activeCaipNetwork)==null?void 0:o.chainNamespace,r=b.state.activeCaipAddress,i=r?te.getPlainAddress(r):void 0;if(Ut.lastRetry&&!te.isAllowedRetry(Ut.lastRetry,30*_e.ONE_SEC_MS))return Ut.balanceLoading=!1,[];try{if(i&&e&&s){const c=(await Q.getBalance(i,e)).balances.filter(l=>l.quantity.decimals!=="0");return K.setTokenBalance(c,s),Ut.lastRetry=void 0,Ut.balanceLoading=!1,c}}catch(a){Ut.lastRetry=Date.now(),t==null||t(a),Zt.showError("Token Balance Unavailable")}finally{Ut.balanceLoading=!1}return[]},resetAccount(t){b.resetAccount(t)}},K=Rt(nf),of={onSwitchNetwork({network:t,ignoreSwitchConfirmation:e=!1}){const s=b.state.activeCaipNetwork,r=ne.state.data;if(t.id===(s==null?void 0:s.id))return;const n=K.getCaipAddress(b.state.activeChain),o=t.chainNamespace!==b.state.activeChain,a=K.getCaipAddress(t.chainNamespace),l=W.getConnectorId(b.state.activeChain)===V.CONNECTOR_ID.AUTH,u=V.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(h=>h===t.chainNamespace);e||l&&u?ne.push("SwitchNetwork",{...r,network:t}):n&&o&&!a?ne.push("SwitchActiveChain",{switchToChain:t.chainNamespace,navigateTo:"Connect",navigateWithReplace:!0,network:t}):ne.push("SwitchNetwork",{...r,network:t})}},ft=xe({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),af={state:ft,subscribe(t){return nt(ft,()=>t(ft))},subscribeKey(t,e){return ot(ft,t,e)},async open(t){var o,a;const e=K.state.status==="connected",s=t==null?void 0:t.namespace,r=b.state.activeChain,i=s&&s!==r,n=(o=b.getAccountData(t==null?void 0:t.namespace))==null?void 0:o.caipAddress;if(ee.state.wcBasic?J.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1}):await J.prefetch({fetchConnectorImages:!e,fetchFeaturedWallets:!e,fetchRecommendedWallets:!e}),W.setFilterByNamespace(t==null?void 0:t.namespace),Ve.setLoading(!0,s),s&&i){const c=((a=b.getNetworkData(s))==null?void 0:a.caipNetwork)||b.getRequestedCaipNetworks(s)[0];c&&of.onSwitchNetwork({network:c,ignoreSwitchConfirmation:!0})}else{const c=b.state.noAdapters;B.state.manualWCControl||c&&!n?te.isMobile()?ne.reset("AllWallets"):ne.reset("ConnectingWalletConnectBasic"):t!=null&&t.view?ne.reset(t.view,t.data):n?ne.reset("Account"):ne.reset("Connect")}ft.open=!0,Us.set({open:!0}),Re.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!n}})},close(){const t=B.state.enableEmbedded,e=!!b.state.activeCaipAddress;ft.open&&Re.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:e}}),ft.open=!1,ne.reset("Connect"),Ve.clearLoading(),t?e?ne.replace("Account"):ne.push("Connect"):Us.set({open:!1}),ee.resetUri()},setLoading(t,e){e&&ft.loadingNamespaceMap.set(e,t),ft.loading=t,Us.set({loading:t})},clearLoading(){ft.loadingNamespaceMap.clear(),ft.loading=!1},shake(){ft.shake||(ft.shake=!0,setTimeout(()=>{ft.shake=!1},500))}},Ve=Rt(af),Di={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},ca={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},cf={providers:sh,selectedProvider:null,error:null,purchaseCurrency:Di,paymentCurrency:ca,purchaseCurrencies:[Di],paymentCurrencies:[],quotesLoading:!1},de=xe(cf),lf={state:de,subscribe(t){return nt(de,()=>t(de))},subscribeKey(t,e){return ot(de,t,e)},setSelectedProvider(t){if(t&&t.name==="meld"){const e=b.state.activeChain===V.CHAIN.SOLANA?"SOL":"USDC",s=K.state.address??"",r=new URL(t.url);r.searchParams.append("publicKey",$p),r.searchParams.append("destinationCurrencyCode",e),r.searchParams.append("walletAddress",s),r.searchParams.append("externalCustomerId",B.state.projectId),de.selectedProvider={...t,url:r.toString()}}else de.selectedProvider=t},setOnrampProviders(t){if(Array.isArray(t)&&t.every(e=>typeof e=="string")){const e=t,s=sh.filter(r=>e.includes(r.name));de.providers=s}else de.providers=[]},setPurchaseCurrency(t){de.purchaseCurrency=t},setPaymentCurrency(t){de.paymentCurrency=t},setPurchaseAmount(t){la.state.purchaseAmount=t},setPaymentAmount(t){la.state.paymentAmount=t},async getAvailableCurrencies(){const t=await Q.getOnrampOptions();de.purchaseCurrencies=t.purchaseCurrencies,de.paymentCurrencies=t.paymentCurrencies,de.paymentCurrency=t.paymentCurrencies[0]||ca,de.purchaseCurrency=t.purchaseCurrencies[0]||Di,await J.fetchCurrencyImages(t.paymentCurrencies.map(e=>e.id)),await J.fetchTokenImages(t.purchaseCurrencies.map(e=>e.symbol))},async getQuote(){var t,e;de.quotesLoading=!0;try{const s=await Q.getOnrampQuote({purchaseCurrency:de.purchaseCurrency,paymentCurrency:de.paymentCurrency,amount:((t=de.paymentAmount)==null?void 0:t.toString())||"0",network:(e=de.purchaseCurrency)==null?void 0:e.symbol});return de.quotesLoading=!1,de.purchaseAmount=Number(s==null?void 0:s.purchaseAmount.amount),s}catch(s){return de.error=s.message,de.quotesLoading=!1,null}finally{de.quotesLoading=!1}},resetState(){de.selectedProvider=null,de.error=null,de.purchaseCurrency=Di,de.paymentCurrency=ca,de.purchaseCurrencies=[Di],de.paymentCurrencies=[],de.paymentAmount=void 0,de.purchaseAmount=void 0,de.quotesLoading=!1}},la=Rt(lf),xc=2147483648,uf={convertEVMChainIdToCoinType(t){if(t>=xc)throw new Error("Invalid chainId");return(xc|t)>>>0}},Dt=xe({suggestions:[],loading:!1}),hf={state:Dt,subscribe(t){return nt(Dt,()=>t(Dt))},subscribeKey(t,e){return ot(Dt,t,e)},async resolveName(t){var e,s;try{return await Q.lookupEnsName(t)}catch(r){const i=r;throw new Error(((s=(e=i==null?void 0:i.reasons)==null?void 0:e[0])==null?void 0:s.description)||"Error resolving name")}},async isNameRegistered(t){try{return await Q.lookupEnsName(t),!0}catch{return!1}},async getSuggestions(t){try{Dt.loading=!0,Dt.suggestions=[];const e=await Q.getEnsNameSuggestions(t);return Dt.suggestions=e.suggestions.map(s=>({...s,name:s.name}))||[],Dt.suggestions}catch(e){const s=Li.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(s)}finally{Dt.loading=!1}},async getNamesForAddress(t){try{if(!b.state.activeCaipNetwork)return[];const s=H.getEnsFromCacheForAddress(t);if(s)return s;const r=await Q.reverseLookupEnsName({address:t});return H.updateEnsCache({address:t,ens:r,timestamp:Date.now()}),r}catch(e){const s=Li.parseEnsApiError(e,"Error fetching names for address");throw new Error(s)}},async registerName(t){const e=b.state.activeCaipNetwork;if(!e)throw new Error("Network not found");const s=K.state.address,r=W.getAuthConnector();if(!s||!r)throw new Error("Address or auth connector not found");Dt.loading=!0;try{const i=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});ne.pushTransactionStack({onCancel(){ne.replace("RegisterAccountName")}});const n=await ee.signMessage(i);Dt.loading=!1;const o=e.id;if(!o)throw new Error("Network not found");const a=uf.convertEVMChainIdToCoinType(Number(o));await Q.registerEnsName({coinType:a,address:s,signature:n,message:i}),K.setProfileName(t,e.chainNamespace),ne.replace("RegisterAccountNameSuccess")}catch(i){const n=Li.parseEnsApiError(i,`Error registering name ${t}`);throw ne.replace("RegisterAccountName"),new Error(n)}finally{Dt.loading=!1}},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){var r,i;const s=t;return((i=(r=s==null?void 0:s.reasons)==null?void 0:r[0])==null?void 0:i.description)||e}},Li=Rt(hf);function df(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Fe(t,...e){try{return df(t(...e))}catch(s){return Promise.reject(s)}}function pf(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function ff(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function kn(t){if(pf(t))return String(t);if(ff(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return kn(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const ua="base64:";function gf(t){return typeof t=="string"?t:ua+yf(t)}function mf(t){return typeof t!="string"||!t.startsWith(ua)?t:wf(t.slice(ua.length))}function wf(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function yf(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function yt(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function bf(...t){return yt(t.join(":"))}function gn(t){return t=yt(t),t?t+":":""}function vf(t,e){if(e===void 0)return!0;let s=0,r=t.indexOf(":");for(;r>-1;)s++,r=t.indexOf(":",r+1);return s<=e}function Ef(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const If="memory",Cf=()=>{const t=new Map;return{name:If,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,s){t.set(e,s)},setItemRaw(e,s){t.set(e,s)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Nf(t={}){const e={mounts:{"":t.driver||Cf()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},s=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},r=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(l,u)=>{if(e.watching){u=yt(u);for(const h of e.watchListeners)h(l,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await kc(e.mounts[l],i,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const d=new Map,f=g=>{let m=d.get(g.base);return m||(m={driver:g.driver,base:g.base,items:[]},d.set(g.base,m)),m};for(const g of l){const m=typeof g=="string",p=yt(m?g:g.key),w=m?void 0:g.value,y=m||!g.options?u:{...u,...g.options},I=s(p);f(I).items.push({key:p,value:w,relativeKey:I.relativeKey,options:y})}return Promise.all([...d.values()].map(g=>h(g))).then(g=>g.flat())},c={hasItem(l,u={}){l=yt(l);const{relativeKey:h,driver:d}=s(l);return Fe(d.hasItem,h,u)},getItem(l,u={}){l=yt(l);const{relativeKey:h,driver:d}=s(l);return Fe(d.getItem,h,u).then(f=>dn(f))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?Fe(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),u).then(d=>d.map(f=>({key:bf(h.base,f.key),value:dn(f.value)}))):Promise.all(h.items.map(d=>Fe(h.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:dn(f)})))))},getItemRaw(l,u={}){l=yt(l);const{relativeKey:h,driver:d}=s(l);return d.getItemRaw?Fe(d.getItemRaw,h,u):Fe(d.getItem,h,u).then(f=>mf(f))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=yt(l);const{relativeKey:d,driver:f}=s(l);f.setItem&&(await Fe(f.setItem,d,kn(u),h),f.watch||i("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return Fe(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:kn(d.value),options:d.options})),u);h.driver.setItem&&await Promise.all(h.items.map(d=>Fe(h.driver.setItem,d.relativeKey,kn(d.value),d.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=yt(l);const{relativeKey:d,driver:f}=s(l);if(f.setItemRaw)await Fe(f.setItemRaw,d,u,h);else if(f.setItem)await Fe(f.setItem,d,gf(u),h);else return;f.watch||i("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=yt(l);const{relativeKey:h,driver:d}=s(l);d.removeItem&&(await Fe(d.removeItem,h,u),(u.removeMeta||u.removeMata)&&await Fe(d.removeItem,h+"$",u),d.watch||i("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=yt(l);const{relativeKey:h,driver:d}=s(l),f=Object.create(null);if(d.getMeta&&Object.assign(f,await Fe(d.getMeta,h,u)),!u.nativeOnly){const g=await Fe(d.getItem,h+"$",u).then(m=>dn(m));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(f,g))}return f},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){var p;l=gn(l);const h=r(l,!0);let d=[];const f=[];let g=!0;for(const w of h){(p=w.driver.flags)!=null&&p.maxDepth||(g=!1);const y=await Fe(w.driver.getKeys,w.relativeBase,u);for(const I of y){const T=w.mountpoint+yt(I);d.some($=>T.startsWith($))||f.push(T)}d=[w.mountpoint,...d.filter(I=>!I.startsWith(w.mountpoint))]}const m=u.maxDepth!==void 0&&!g;return f.filter(w=>(!m||vf(w,u.maxDepth))&&Ef(w,l))},async clear(l,u={}){l=gn(l),await Promise.all(r(l,!1).map(async h=>{if(h.driver.clear)return Fe(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(d.map(f=>h.driver.removeItem(f,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>$c(l)))},async watch(l){return await n(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=gn(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(kc(u,i,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){var h,d;l=gn(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((d=(h=e.unwatch)[l])==null||d.call(h),delete e.unwatch[l]),u&&await $c(e.mounts[l]),e.mountpoints=e.mountpoints.filter(f=>f!==l),delete e.mounts[l])},getMount(l=""){l=yt(l)+":";const u=s(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=yt(l),r(l,u.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function kc(t,e,s){return t.watch?t.watch((r,i)=>e(r,s+i)):()=>{}}async function $c(t){typeof t.dispose=="function"&&await Fe(t.dispose)}const Af="idb-keyval";var Sf=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",s=i=>e+i;let r;return t.dbName&&t.storeName&&(r=hp(t.dbName,t.storeName)),{name:Af,options:t,async hasItem(i){return!(typeof await vc(s(i),r)>"u")},async getItem(i){return await vc(s(i),r)??null},setItem(i,n){return gp(s(i),n,r)},removeItem(i){return fp(s(i),r)},getKeys(){return pp(r)},clear(){return dp(r)}}};const _f="WALLET_CONNECT_V2_INDEXED_DB",Pf="keyvaluestorage";class Tf{constructor(){this.indexedDb=Nf({driver:Sf({dbName:_f,storeName:Pf})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const s=await this.indexedDb.getItem(e);if(s!==null)return s}async setItem(e,s){await this.indexedDb.setItem(e,Ya(s))}async removeItem(e){await this.indexedDb.removeItem(e)}}var bo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},$n={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(s){return this.hasOwnProperty(s)?String(this[s]):null},t.prototype.setItem=function(s,r){this[s]=String(r)},t.prototype.removeItem=function(s){delete this[s]},t.prototype.clear=function(){const s=this;Object.keys(s).forEach(function(r){s[r]=void 0,delete s[r]})},t.prototype.key=function(s){return s=s||0,Object.keys(this)[s]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof bo<"u"&&bo.localStorage?$n.exports=bo.localStorage:typeof window<"u"&&window.localStorage?$n.exports=window.localStorage:$n.exports=new e})();function Of(t){var e;return[t[0],jn((e=t[1])!=null?e:"")]}let xf=class{constructor(){this.localStorage=$n.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Of)}async getItem(e){const s=this.localStorage.getItem(e);if(s!==null)return jn(s)}async setItem(e,s){this.localStorage.setItem(e,Ya(s))}async removeItem(e){this.localStorage.removeItem(e)}};const kf="wc_storage_version",Rc=1,$f=async(t,e,s)=>{const r=kf,i=await e.getItem(r);if(i&&i>=Rc){s(e);return}const n=await t.getKeys();if(!n.length){s(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(r,Rc),s(e),Rf(t,o)},Rf=async(t,e)=>{e.length&&e.forEach(async s=>{await t.removeItem(s)})};let Uf=class{constructor(){this.initialized=!1,this.setInitialized=s=>{this.storage=s,this.initialized=!0};const e=new xf;this.storage=e;try{const s=new Tf;$f(e,s,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,s){return await this.initialize(),this.storage.setItem(e,s)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const s=setInterval(()=>{this.initialized&&(clearInterval(s),e())},20)})}};var Df=Object.defineProperty,Lf=(t,e,s)=>e in t?Df(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Uc=(t,e,s)=>Lf(t,typeof e!="symbol"?e+"":e,s);let Bf=class extends ai{constructor(e){super(),this.opts=e,Uc(this,"protocol","wc"),Uc(this,"version",2)}};var Mf=Object.defineProperty,jf=(t,e,s)=>e in t?Mf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,qf=(t,e,s)=>jf(t,e+"",s);let Ff=class extends ai{constructor(e,s){super(),this.core=e,this.logger=s,qf(this,"records",new Map)}},zf=class{constructor(e,s){this.logger=e,this.core=s}};class Wf extends ai{constructor(e,s){super(),this.relayer=e,this.logger=s}}let Hf=class extends ai{constructor(e){super()}},Kf=class{constructor(e,s,r,i){this.core=e,this.logger=s,this.name=r}},Vf=class extends ai{constructor(e,s){super(),this.relayer=e,this.logger=s}},Gf=class extends ai{constructor(e,s){super(),this.core=e,this.logger=s}},Jf=class{constructor(e,s,r){this.core=e,this.logger=s,this.store=r}},Yf=class{constructor(e,s){this.projectId=e,this.logger=s}},Zf=class{constructor(e,s,r){this.core=e,this.logger=s,this.telemetryEnabled=r}};function Fn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Xf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Zn(t,...e){if(!Xf(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function BA(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Fn(t.outputLen),Fn(t.blockLen)}function Dc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Qf(t,e){Zn(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}const mn=BigInt(2**32-1),Lc=BigInt(32);function eg(t,e=!1){return e?{h:Number(t&mn),l:Number(t>>Lc&mn)}:{h:Number(t>>Lc&mn)|0,l:Number(t&mn)|0}}function tg(t,e=!1){let s=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:n,l:o}=eg(t[i],e);[s[i],r[i]]=[n,o]}return[s,r]}const sg=(t,e,s)=>t<<s|e>>>32-s,rg=(t,e,s)=>e<<s|t>>>32-s,ig=(t,e,s)=>e<<s-32|t>>>64-s,ng=(t,e,s)=>t<<s-32|e>>>64-s,fr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function og(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function MA(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function jA(t,e){return t<<32-e|t>>>e}const Bc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ag(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Mc(t){for(let e=0;e<t.length;e++)t[e]=ag(t[e])}function cg(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function oh(t){return typeof t=="string"&&(t=cg(t)),Zn(t),t}function qA(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Zn(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}class lg{clone(){return this._cloneInto()}}function ug(t){const e=r=>t().update(oh(r)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function FA(t=32){if(fr&&typeof fr.getRandomValues=="function")return fr.getRandomValues(new Uint8Array(t));if(fr&&typeof fr.randomBytes=="function")return fr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const ah=[],ch=[],lh=[],hg=BigInt(0),yi=BigInt(1),dg=BigInt(2),pg=BigInt(7),fg=BigInt(256),gg=BigInt(113);for(let t=0,e=yi,s=1,r=0;t<24;t++){[s,r]=[r,(2*s+3*r)%5],ah.push(2*(5*r+s)),ch.push((t+1)*(t+2)/2%64);let i=hg;for(let n=0;n<7;n++)e=(e<<yi^(e>>pg)*gg)%fg,e&dg&&(i^=yi<<(yi<<BigInt(n))-yi);lh.push(i)}const[mg,wg]=tg(lh,!0),jc=(t,e,s)=>s>32?ig(t,e,s):sg(t,e,s),qc=(t,e,s)=>s>32?ng(t,e,s):rg(t,e,s);function yg(t,e=24){const s=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=s[c],u=s[c+1],h=jc(l,u,1)^s[a],d=qc(l,u,1)^s[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],n=t[3];for(let o=0;o<24;o++){const a=ch[o],c=jc(i,n,a),l=qc(i,n,a),u=ah[o];i=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=mg[r],t[1]^=wg[r]}s.fill(0)}class tc extends lg{constructor(e,s,r,i=!1,n=24){if(super(),this.blockLen=e,this.suffix=s,this.outputLen=r,this.enableXOF=i,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Fn(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=og(this.state)}keccak(){Bc||Mc(this.state32),yg(this.state32,this.rounds),Bc||Mc(this.state32),this.posOut=0,this.pos=0}update(e){Dc(this);const{blockLen:s,state:r}=this;e=oh(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(s-this.pos,i-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:r,blockLen:i}=this;e[r]^=s,(s&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Dc(this,!1),Zn(e),this.finish();const s=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-i);e.set(s.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Fn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Qf(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:s,suffix:r,outputLen:i,rounds:n,enableXOF:o}=this;return e||(e=new tc(s,r,i,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const bg=(t,e,s)=>ug(()=>new tc(e,t,s)),vg=bg(1,136,256/8);function uh(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Bi(t,e){e||(e=t.reduce((i,n)=>i+n.length,0));const s=uh(e);let r=0;for(const i of t)s.set(i,r),r+=i.length;return s}function hh(t,e,s,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:r}}}const Fc=hh("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),vo=hh("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);const e=uh(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),dh={utf8:Fc,"utf-8":Fc,hex:Ec.base16,latin1:vo,ascii:vo,binary:vo,...Ec};function It(t,e="utf8"){const s=dh[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):s.decoder.decode(`${s.prefix}${t}`)}function it(t,e="utf8"){const s=dh[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):s.encoder.encode(t).substring(1)}var Eg={};const Ig="ReactNative",Xt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Cg="js";function zn(){return typeof as<"u"&&typeof as.versions<"u"&&typeof as.versions.node<"u"}function ur(){return!xt.getDocument()&&!!xt.getNavigator()&&navigator.product===Ig}function Ng(){return ur()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="android"}function Ag(){return ur()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="ios"}function sn(){return!zn()&&!!xt.getNavigator()&&!!xt.getDocument()}function Xn(){return ur()?Xt.reactNative:zn()?Xt.node:sn()?Xt.browser:Xt.unknown}function zc(){var t;try{return ur()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Application)<"u"?(t=globalThis.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Sg(t,e){const s=new URLSearchParams(t);for(const r of Object.keys(e).sort())if(e.hasOwnProperty(r)){const i=e[r];i!==void 0&&s.set(r,i)}return s.toString()}function _g(){return Zu.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Pg(){if(Xn()===Xt.reactNative&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"){const{OS:s,Version:r}=globalThis.Platform;return[s,r].join("-")}const t=wp();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Tg(){var t;const e=Xn();return e===Xt.browser?[e,((t=xt.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function ph(t,e,s){const r=Pg(),i=Tg();return[[t,e].join("-"),[Cg,s].join("-"),r,i].join("/")}function Og({protocol:t,version:e,relayUrl:s,sdkVersion:r,auth:i,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=s.split("?"),u=ph(t,e,r),h={auth:i,ua:u,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=Sg(l[1]||"",h);return l[0]+"?"+d}function ha(t){return Object.fromEntries(t.entries())}function da(t){return new Map(Object.entries(t))}function xg(t=j.FIVE_MINUTES,e){const s=j.toMiliseconds(t||j.FIVE_MINUTES);let r,i,n,o;return{resolve:a=>{n&&r&&(clearTimeout(n),r(a),o=Promise.resolve(a))},reject:a=>{n&&i&&(clearTimeout(n),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},s),r=a,i=c})}}function Rs(t,e,s){return new Promise(async(r,i)=>{const n=setTimeout(()=>i(new Error(s)),e);try{const o=await t;r(o)}catch(o){i(o)}clearTimeout(n)})}function fh(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function kg(t){return fh("topic",t)}function $g(t){return fh("id",t)}function Rg(t){const[e,s]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof s=="string")r.topic=s;else if(e==="id"&&Number.isInteger(Number(s)))r.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${s}`);return r}function Mi(t,e){return j.fromMiliseconds(Date.now()+j.toMiliseconds(t))}function Wc(t){return Date.now()>=j.toMiliseconds(t)}function Eo(t,e){return`${t}${e?`:${e}`:""}`}function Hc(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function gh(){return typeof as<"u"&&Eg.IS_VITEST==="true"}function mh(t){return rt.Buffer.from(t,"base64").toString("utf-8")}function Ug(t){return new Promise(e=>setTimeout(e,t))}function Ki(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Dg(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function rn(t,...e){if(!Dg(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function sc(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ki(t.outputLen),Ki(t.blockLen)}function Gr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function wh(t,e){rn(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}const wn=BigInt(2**32-1),Kc=BigInt(32);function Lg(t,e=!1){return e?{h:Number(t&wn),l:Number(t>>Kc&wn)}:{h:Number(t>>Kc&wn)|0,l:Number(t&wn)|0}}function Bg(t,e=!1){let s=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:n,l:o}=Lg(t[i],e);[s[i],r[i]]=[n,o]}return[s,r]}const Mg=(t,e,s)=>t<<s|e>>>32-s,jg=(t,e,s)=>e<<s|t>>>32-s,qg=(t,e,s)=>e<<s-32|t>>>64-s,Fg=(t,e,s)=>t<<s-32|e>>>64-s,gr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function zg(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Io(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function es(t,e){return t<<32-e|t>>>e}const Vc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Wg(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Gc(t){for(let e=0;e<t.length;e++)t[e]=Wg(t[e])}function Hg(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Jr(t){return typeof t=="string"&&(t=Hg(t)),rn(t),t}function Kg(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];rn(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}let rc=class{clone(){return this._cloneInto()}};function yh(t){const e=r=>t().update(Jr(r)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function li(t=32){if(gr&&typeof gr.getRandomValues=="function")return gr.getRandomValues(new Uint8Array(t));if(gr&&typeof gr.randomBytes=="function")return gr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const bh=[],vh=[],Eh=[],Vg=BigInt(0),bi=BigInt(1),Gg=BigInt(2),Jg=BigInt(7),Yg=BigInt(256),Zg=BigInt(113);for(let t=0,e=bi,s=1,r=0;t<24;t++){[s,r]=[r,(2*s+3*r)%5],bh.push(2*(5*r+s)),vh.push((t+1)*(t+2)/2%64);let i=Vg;for(let n=0;n<7;n++)e=(e<<bi^(e>>Jg)*Zg)%Yg,e&Gg&&(i^=bi<<(bi<<BigInt(n))-bi);Eh.push(i)}const[Xg,Qg]=Bg(Eh,!0),Jc=(t,e,s)=>s>32?qg(t,e,s):Mg(t,e,s),Yc=(t,e,s)=>s>32?Fg(t,e,s):jg(t,e,s);function em(t,e=24){const s=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=s[c],u=s[c+1],h=Jc(l,u,1)^s[a],d=Yc(l,u,1)^s[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],n=t[3];for(let o=0;o<24;o++){const a=vh[o],c=Jc(i,n,a),l=Yc(i,n,a),u=bh[o];i=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=Xg[r],t[1]^=Qg[r]}s.fill(0)}let tm=class Ih extends rc{constructor(e,s,r,i=!1,n=24){if(super(),this.blockLen=e,this.suffix=s,this.outputLen=r,this.enableXOF=i,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ki(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=zg(this.state)}keccak(){Vc||Gc(this.state32),em(this.state32,this.rounds),Vc||Gc(this.state32),this.posOut=0,this.pos=0}update(e){Gr(this);const{blockLen:s,state:r}=this;e=Jr(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(s-this.pos,i-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:r,blockLen:i}=this;e[r]^=s,(s&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Gr(this,!1),rn(e),this.finish();const s=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-i);e.set(s.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ki(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(wh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:s,suffix:r,outputLen:i,rounds:n,enableXOF:o}=this;return e||(e=new Ih(s,r,i,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const sm=(t,e,s)=>yh(()=>new tm(e,t,s));sm(1,136,256/8);function Co(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ch(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Tt(t,...e){if(!Ch(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Zc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function rm(t,e){Tt(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function Xc(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const Ds=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),im=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),nm=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!nm)throw new Error("Non little-endian hardware is not supported");function om(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function pa(t){if(typeof t=="string")t=om(t);else if(Ch(t))t=fa(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function am(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function cm(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t[r]^e[r];return s===0}const lm=(t,e)=>{function s(r,...i){if(Tt(r),t.nonceLength!==void 0){const l=i[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Tt(l):Tt(l,t.nonceLength)}const n=t.tagLength;n&&i[1]!==void 0&&Tt(i[1]);const o=e(r,...i),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Tt(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Tt(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Tt(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(s,t),s};function Qc(t,e,s=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(s&&!um(e))throw new Error("invalid output, must be aligned");return e}function el(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(s>>i&n),a=Number(s&n);t.setUint32(e+4,o,r),t.setUint32(e+0,a,r)}function um(t){return t.byteOffset%4===0}function fa(t){return Uint8Array.from(t)}function Yr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const Nh=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),hm=Nh("expand 16-byte k"),dm=Nh("expand 32-byte k"),pm=Ds(hm),fm=Ds(dm);function fe(t,e){return t<<e|t>>>32-e}function ga(t){return t.byteOffset%4===0}const yn=64,gm=16,Ah=2**32-1,tl=new Uint32Array;function mm(t,e,s,r,i,n,o,a){const c=i.length,l=new Uint8Array(yn),u=Ds(l),h=ga(i)&&ga(n),d=h?Ds(i):tl,f=h?Ds(n):tl;for(let g=0;g<c;o++){if(t(e,s,r,u,o,a),o>=Ah)throw new Error("arx: counter overflow");const m=Math.min(yn,c-g);if(h&&m===yn){const p=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let w=0,y;w<gm;w++)y=p+w,f[y]=d[y]^u[w];g+=yn;continue}for(let p=0,w;p<m;p++)w=g+p,n[w]=i[w]^l[p];g+=m}}function wm(t,e){const{allowShortKeys:s,extendNonceFn:r,counterLength:i,counterRight:n,rounds:o}=am({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Co(i),Co(o),Xc(n),Xc(s),(a,c,l,u,h=0)=>{Tt(a),Tt(c),Tt(l);const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),Tt(u),Co(h),h<0||h>=Ah)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const f=[];let g=a.length,m,p;if(g===32)f.push(m=fa(a)),p=fm;else if(g===16&&s)m=new Uint8Array(32),m.set(a),m.set(a,16),p=pm,f.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);ga(c)||f.push(c=fa(c));const w=Ds(m);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(p,w,Ds(c.subarray(0,16)),w),c=c.subarray(16)}const y=16-i;if(y!==c.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const T=new Uint8Array(12);T.set(c,n?0:12-c.length),c=T,f.push(c)}const I=Ds(c);return mm(t,p,w,I,l,u,h,o),Yr(...f),u}}const Ze=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let ym=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=pa(e),Tt(e,32);const s=Ze(e,0),r=Ze(e,2),i=Ze(e,4),n=Ze(e,6),o=Ze(e,8),a=Ze(e,10),c=Ze(e,12),l=Ze(e,14);this.r[0]=s&8191,this.r[1]=(s>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Ze(e,16+2*u)}process(e,s,r=!1){const i=r?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],f=o[6],g=o[7],m=o[8],p=o[9],w=Ze(e,s+0),y=Ze(e,s+2),I=Ze(e,s+4),T=Ze(e,s+6),$=Ze(e,s+8),P=Ze(e,s+10),_=Ze(e,s+12),O=Ze(e,s+14);let v=n[0]+(w&8191),x=n[1]+((w>>>13|y<<3)&8191),S=n[2]+((y>>>10|I<<6)&8191),R=n[3]+((I>>>7|T<<9)&8191),L=n[4]+((T>>>4|$<<12)&8191),E=n[5]+($>>>1&8191),N=n[6]+(($>>>14|P<<2)&8191),C=n[7]+((P>>>11|_<<5)&8191),k=n[8]+((_>>>8|O<<8)&8191),U=n[9]+(O>>>5|i),A=0,M=A+v*a+x*(5*p)+S*(5*m)+R*(5*g)+L*(5*f);A=M>>>13,M&=8191,M+=E*(5*d)+N*(5*h)+C*(5*u)+k*(5*l)+U*(5*c),A+=M>>>13,M&=8191;let q=A+v*c+x*a+S*(5*p)+R*(5*m)+L*(5*g);A=q>>>13,q&=8191,q+=E*(5*f)+N*(5*d)+C*(5*h)+k*(5*u)+U*(5*l),A+=q>>>13,q&=8191;let F=A+v*l+x*c+S*a+R*(5*p)+L*(5*m);A=F>>>13,F&=8191,F+=E*(5*g)+N*(5*f)+C*(5*d)+k*(5*h)+U*(5*u),A+=F>>>13,F&=8191;let X=A+v*u+x*l+S*c+R*a+L*(5*p);A=X>>>13,X&=8191,X+=E*(5*m)+N*(5*g)+C*(5*f)+k*(5*d)+U*(5*h),A+=X>>>13,X&=8191;let G=A+v*h+x*u+S*l+R*c+L*a;A=G>>>13,G&=8191,G+=E*(5*p)+N*(5*m)+C*(5*g)+k*(5*f)+U*(5*d),A+=G>>>13,G&=8191;let oe=A+v*d+x*h+S*u+R*l+L*c;A=oe>>>13,oe&=8191,oe+=E*a+N*(5*p)+C*(5*m)+k*(5*g)+U*(5*f),A+=oe>>>13,oe&=8191;let le=A+v*f+x*d+S*h+R*u+L*l;A=le>>>13,le&=8191,le+=E*c+N*a+C*(5*p)+k*(5*m)+U*(5*g),A+=le>>>13,le&=8191;let Ie=A+v*g+x*f+S*d+R*h+L*u;A=Ie>>>13,Ie&=8191,Ie+=E*l+N*c+C*a+k*(5*p)+U*(5*m),A+=Ie>>>13,Ie&=8191;let ue=A+v*m+x*g+S*f+R*d+L*h;A=ue>>>13,ue&=8191,ue+=E*u+N*l+C*c+k*a+U*(5*p),A+=ue>>>13,ue&=8191;let he=A+v*p+x*m+S*g+R*f+L*d;A=he>>>13,he&=8191,he+=E*h+N*u+C*l+k*c+U*a,A+=he>>>13,he&=8191,A=(A<<2)+A|0,A=A+M|0,M=A&8191,A=A>>>13,q+=A,n[0]=M,n[1]=q,n[2]=F,n[3]=X,n[4]=G,n[5]=oe,n[6]=le,n[7]=Ie,n[8]=ue,n[9]=he}finalize(){const{h:e,pad:s}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let n=(i^1)-1;for(let a=0;a<10;a++)r[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+s[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+s[a]|0)+(o>>>16)|0,e[a]=o&65535;Yr(r)}update(e){Zc(this);const{buffer:s,blockLen:r}=this;e=pa(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(r-this.pos,i-n);if(o===r){for(;r<=i-n;n+=r)this.process(e,n);continue}s.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(s,0,!1),this.pos=0)}return this}destroy(){Yr(this.h,this.r,this.buffer,this.pad)}digestInto(e){Zc(this),rm(e,this),this.finished=!0;const{buffer:s,h:r}=this;let{pos:i}=this;if(i){for(s[i++]=1;i<16;i++)s[i]=0;this.process(s,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=r[o]>>>0,e[n++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const r=e.slice(0,s);return this.destroy(),r}};function bm(t){const e=(r,i)=>t(i).update(pa(r)).digest(),s=t(new Uint8Array(32));return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=r=>t(r),e}const vm=bm(t=>new ym(t));function Em(t,e,s,r,i,n=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],f=e[3],g=e[4],m=e[5],p=e[6],w=e[7],y=i,I=s[0],T=s[1],$=s[2],P=o,_=a,O=c,v=l,x=u,S=h,R=d,L=f,E=g,N=m,C=p,k=w,U=y,A=I,M=T,q=$;for(let X=0;X<n;X+=2)P=P+x|0,U=fe(U^P,16),E=E+U|0,x=fe(x^E,12),P=P+x|0,U=fe(U^P,8),E=E+U|0,x=fe(x^E,7),_=_+S|0,A=fe(A^_,16),N=N+A|0,S=fe(S^N,12),_=_+S|0,A=fe(A^_,8),N=N+A|0,S=fe(S^N,7),O=O+R|0,M=fe(M^O,16),C=C+M|0,R=fe(R^C,12),O=O+R|0,M=fe(M^O,8),C=C+M|0,R=fe(R^C,7),v=v+L|0,q=fe(q^v,16),k=k+q|0,L=fe(L^k,12),v=v+L|0,q=fe(q^v,8),k=k+q|0,L=fe(L^k,7),P=P+S|0,q=fe(q^P,16),C=C+q|0,S=fe(S^C,12),P=P+S|0,q=fe(q^P,8),C=C+q|0,S=fe(S^C,7),_=_+R|0,U=fe(U^_,16),k=k+U|0,R=fe(R^k,12),_=_+R|0,U=fe(U^_,8),k=k+U|0,R=fe(R^k,7),O=O+L|0,A=fe(A^O,16),E=E+A|0,L=fe(L^E,12),O=O+L|0,A=fe(A^O,8),E=E+A|0,L=fe(L^E,7),v=v+x|0,M=fe(M^v,16),N=N+M|0,x=fe(x^N,12),v=v+x|0,M=fe(M^v,8),N=N+M|0,x=fe(x^N,7);let F=0;r[F++]=o+P|0,r[F++]=a+_|0,r[F++]=c+O|0,r[F++]=l+v|0,r[F++]=u+x|0,r[F++]=h+S|0,r[F++]=d+R|0,r[F++]=f+L|0,r[F++]=g+E|0,r[F++]=m+N|0,r[F++]=p+C|0,r[F++]=w+k|0,r[F++]=y+U|0,r[F++]=I+A|0,r[F++]=T+M|0,r[F++]=$+q|0}const Im=wm(Em,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Cm=new Uint8Array(16),sl=(t,e)=>{t.update(e);const s=e.length%16;s&&t.update(Cm.subarray(s))},Nm=new Uint8Array(32);function rl(t,e,s,r,i){const n=t(e,s,Nm),o=vm.create(n);i&&sl(o,i),sl(o,r);const a=new Uint8Array(16),c=im(a);el(c,0,BigInt(i?i.length:0),!0),el(c,8,BigInt(r.length),!0),o.update(a);const l=o.digest();return Yr(n,a),l}const Am=t=>(e,s,r)=>({encrypt(i,n){const o=i.length;n=Qc(o+16,n,!1),n.set(i);const a=n.subarray(0,-16);t(e,s,a,a,1);const c=rl(t,e,s,a,r);return n.set(c,o),Yr(c),n},decrypt(i,n){n=Qc(i.length-16,n,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=rl(t,e,s,o,r);if(!cm(a,c))throw new Error("invalid tag");return n.set(i.subarray(0,-16)),t(e,s,n,n,1),Yr(c),n}}),Sh=lm({blockSize:64,nonceLength:12,tagLength:16},Am(Im));let _h=class extends rc{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,sc(e);const r=Jr(s);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return Gr(this),this.iHash.update(e),this}digestInto(e){Gr(this),rn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:s,iHash:r,finished:i,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=s._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Qn=(t,e,s)=>new _h(t,e).update(s).digest();Qn.create=(t,e)=>new _h(t,e);function Sm(t,e,s){return sc(t),s===void 0&&(s=new Uint8Array(t.outputLen)),Qn(t,Jr(s),Jr(e))}const No=new Uint8Array([0]),il=new Uint8Array;function _m(t,e,s,r=32){if(sc(t),Ki(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);s===void 0&&(s=il);const n=new Uint8Array(i*t.outputLen),o=Qn.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<i;l++)No[0]=l+1,a.update(l===0?il:c).update(s).update(No).digestInto(c),n.set(c,t.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),No.fill(0),n.slice(0,r)}const Pm=(t,e,s,r,i)=>_m(t,Sm(t,e,s),r,i);function Tm(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(s>>i&n),a=Number(s&n),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function Om(t,e,s){return t&e^~t&s}function xm(t,e,s){return t&e^t&s^e&s}let km=class extends rc{constructor(e,s,r,i){super(),this.blockLen=e,this.outputLen=s,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Io(this.buffer)}update(e){Gr(this);const{view:s,buffer:r,blockLen:i}=this;e=Jr(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(i-this.pos,n-o);if(a===i){const c=Io(e);for(;i<=n-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(s,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Gr(this),wh(e,this),this.finished=!0;const{buffer:s,view:r,blockLen:i,isLE:n}=this;let{pos:o}=this;s[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)s[h]=0;Tm(r,i-8,BigInt(this.length*8),n),this.process(r,0);const a=Io(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const r=e.slice(0,s);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:s,buffer:r,length:i,finished:n,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=n,e.destroyed=o,i%s&&e.buffer.set(r),e}};const $m=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),_s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ps=new Uint32Array(64);let Rm=class extends km{constructor(){super(64,32,8,!1),this.A=_s[0]|0,this.B=_s[1]|0,this.C=_s[2]|0,this.D=_s[3]|0,this.E=_s[4]|0,this.F=_s[5]|0,this.G=_s[6]|0,this.H=_s[7]|0}get(){const{A:e,B:s,C:r,D:i,E:n,F:o,G:a,H:c}=this;return[e,s,r,i,n,o,a,c]}set(e,s,r,i,n,o,a,c){this.A=e|0,this.B=s|0,this.C=r|0,this.D=i|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,s){for(let h=0;h<16;h++,s+=4)Ps[h]=e.getUint32(s,!1);for(let h=16;h<64;h++){const d=Ps[h-15],f=Ps[h-2],g=es(d,7)^es(d,18)^d>>>3,m=es(f,17)^es(f,19)^f>>>10;Ps[h]=m+Ps[h-7]+g+Ps[h-16]|0}let{A:r,B:i,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=es(a,6)^es(a,11)^es(a,25),f=u+d+Om(a,c,l)+$m[h]+Ps[h]|0,g=(es(r,2)^es(r,13)^es(r,22))+xm(r,i,n)|0;u=l,l=c,c=a,a=o+f|0,o=n,n=i,i=r,r=f+g|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,n,o,a,c,l,u)}roundClean(){Ps.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const nn=yh(()=>new Rm);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const eo=BigInt(0),to=BigInt(1),Um=BigInt(2);function ir(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function on(t){if(!ir(t))throw new Error("Uint8Array expected")}function Zr(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Dm=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Xr(t){on(t);let e="";for(let s=0;s<t.length;s++)e+=Dm[t[s]];return e}function Mr(t){const e=t.toString(16);return e.length&1?"0"+e:e}function ic(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?eo:BigInt("0x"+t)}const ds={_0:48,_9:57,A:65,F:70,a:97,f:102};function nl(t){if(t>=ds._0&&t<=ds._9)return t-ds._0;if(t>=ds.A&&t<=ds.F)return t-(ds.A-10);if(t>=ds.a&&t<=ds.f)return t-(ds.a-10)}function Qr(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(s);for(let i=0,n=0;i<s;i++,n+=2){const o=nl(t.charCodeAt(n)),a=nl(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}r[i]=o*16+a}return r}function er(t){return ic(Xr(t))}function Vi(t){return on(t),ic(Xr(Uint8Array.from(t).reverse()))}function ei(t,e){return Qr(t.toString(16).padStart(e*2,"0"))}function so(t,e){return ei(t,e).reverse()}function Lm(t){return Qr(Mr(t))}function _t(t,e,s){let r;if(typeof e=="string")try{r=Qr(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(ir(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof s=="number"&&i!==s)throw new Error(t+" of length "+s+" expected, got "+i);return r}function Gi(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];on(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}function Bm(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t[r]^e[r];return s===0}function Mm(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const Ao=t=>typeof t=="bigint"&&eo<=t;function ro(t,e,s){return Ao(t)&&Ao(e)&&Ao(s)&&e<=t&&t<s}function Es(t,e,s,r){if(!ro(e,s,r))throw new Error("expected valid "+t+": "+s+" <= n < "+r+", got "+e)}function Ph(t){let e;for(e=0;t>eo;t>>=to,e+=1);return e}function jm(t,e){return t>>BigInt(e)&to}function qm(t,e,s){return t|(s?to:eo)<<BigInt(e)}const nc=t=>(Um<<BigInt(t-1))-to,So=t=>new Uint8Array(t),ol=t=>Uint8Array.from(t);function Th(t,e,s){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof s!="function")throw new Error("hmacFn must be a function");let r=So(t),i=So(t),n=0;const o=()=>{r.fill(1),i.fill(0),n=0},a=(...u)=>s(i,r,...u),c=(u=So())=>{i=a(ol([0]),u),r=a(),u.length!==0&&(i=a(ol([1]),u),r=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const h=[];for(;u<e;){r=a();const d=r.slice();h.push(d),u+=r.length}return Gi(...h)};return(u,h)=>{o(),c(u);let d;for(;!(d=h(l()));)c();return o(),d}}const Fm={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ir(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ui(t,e,s={}){const r=(i,n,o)=>{const a=Fm[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+n+", got "+c)};for(const[i,n]of Object.entries(e))r(i,n,!1);for(const[i,n]of Object.entries(s))r(i,n,!0);return t}const zm=()=>{throw new Error("not implemented")};function ma(t){const e=new WeakMap;return(s,...r)=>{const i=e.get(s);if(i!==void 0)return i;const n=t(s,...r);return e.set(s,n),n}}var Wm=Object.freeze({__proto__:null,isBytes:ir,abytes:on,abool:Zr,bytesToHex:Xr,numberToHexUnpadded:Mr,hexToNumber:ic,hexToBytes:Qr,bytesToNumberBE:er,bytesToNumberLE:Vi,numberToBytesBE:ei,numberToBytesLE:so,numberToVarBytesBE:Lm,ensureBytes:_t,concatBytes:Gi,equalBytes:Bm,utf8ToBytes:Mm,inRange:ro,aInRange:Es,bitLen:Ph,bitGet:jm,bitSet:qm,bitMask:nc,createHmacDrbg:Th,validateObject:ui,notImplemented:zm,memoized:ma});const Ge=BigInt(0),Ue=BigInt(1),Gs=BigInt(2),Hm=BigInt(3),wa=BigInt(4),al=BigInt(5),cl=BigInt(8);function bt(t,e){const s=t%e;return s>=Ge?s:e+s}function Oh(t,e,s){if(e<Ge)throw new Error("invalid exponent, negatives unsupported");if(s<=Ge)throw new Error("invalid modulus");if(s===Ue)return Ge;let r=Ue;for(;e>Ge;)e&Ue&&(r=r*t%s),t=t*t%s,e>>=Ue;return r}function Gt(t,e,s){let r=t;for(;e-- >Ge;)r*=r,r%=s;return r}function ya(t,e){if(t===Ge)throw new Error("invert: expected non-zero number");if(e<=Ge)throw new Error("invert: expected positive modulus, got "+e);let s=bt(t,e),r=e,i=Ge,n=Ue;for(;s!==Ge;){const o=r/s,a=r%s,c=i-n*o;r=s,s=a,i=n,n=c}if(r!==Ue)throw new Error("invert: does not exist");return bt(i,e)}function Km(t){const e=(t-Ue)/Gs;let s,r,i;for(s=t-Ue,r=0;s%Gs===Ge;s/=Gs,r++);for(i=Gs;i<t&&Oh(i,e,t)!==t-Ue;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+Ue)/wa;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(s+Ue)/Gs;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,l=o.pow(o.mul(o.ONE,i),s),u=o.pow(a,n),h=o.pow(a,s);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let g=o.sqr(h);d<c&&!o.eql(g,o.ONE);d++)g=o.sqr(g);const f=o.pow(l,Ue<<BigInt(c-d-1));l=o.sqr(f),u=o.mul(u,f),h=o.mul(h,l),c=d}return u}}function Vm(t){if(t%wa===Hm){const e=(t+Ue)/wa;return function(s,r){const i=s.pow(r,e);if(!s.eql(s.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%cl===al){const e=(t-al)/cl;return function(s,r){const i=s.mul(r,Gs),n=s.pow(i,e),o=s.mul(r,n),a=s.mul(s.mul(o,Gs),n),c=s.mul(o,s.sub(a,s.ONE));if(!s.eql(s.sqr(c),r))throw new Error("Cannot find square root");return c}}return Km(t)}const Gm=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Jm(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},s=Gm.reduce((r,i)=>(r[i]="function",r),e);return ui(t,s)}function Ym(t,e,s){if(s<Ge)throw new Error("invalid exponent, negatives unsupported");if(s===Ge)return t.ONE;if(s===Ue)return e;let r=t.ONE,i=e;for(;s>Ge;)s&Ue&&(r=t.mul(r,i)),i=t.sqr(i),s>>=Ue;return r}function Zm(t,e){const s=new Array(e.length),r=e.reduce((n,o,a)=>t.is0(o)?n:(s[a]=n,t.mul(n,o)),t.ONE),i=t.inv(r);return e.reduceRight((n,o,a)=>t.is0(o)?n:(s[a]=t.mul(n,s[a]),t.mul(n,o)),i),s}function xh(t,e){const s=e!==void 0?e:t.toString(2).length,r=Math.ceil(s/8);return{nBitLength:s,nByteLength:r}}function kh(t,e,s=!1,r={}){if(t<=Ge)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:n}=xh(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:s,BITS:i,BYTES:n,MASK:nc(i),ZERO:Ge,ONE:Ue,create:c=>bt(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ge<=c&&c<t},is0:c=>c===Ge,isOdd:c=>(c&Ue)===Ue,neg:c=>bt(-c,t),eql:(c,l)=>c===l,sqr:c=>bt(c*c,t),add:(c,l)=>bt(c+l,t),sub:(c,l)=>bt(c-l,t),mul:(c,l)=>bt(c*l,t),pow:(c,l)=>Ym(a,c,l),div:(c,l)=>bt(c*ya(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>ya(c,t),sqrt:r.sqrt||(c=>(o||(o=Vm(t)),o(a,c))),invertBatch:c=>Zm(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>s?so(c,n):ei(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return s?Vi(c):er(c)}});return Object.freeze(a)}function $h(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Rh(t){const e=$h(t);return e+Math.ceil(e/2)}function Xm(t,e,s=!1){const r=t.length,i=$h(e),n=Rh(e);if(r<16||r<n||r>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+r);const o=s?Vi(t):er(t),a=bt(o,e-Ue)+Ue;return s?so(a,i):ei(a,i)}const ll=BigInt(0),bn=BigInt(1);function _o(t,e){const s=e.negate();return t?s:e}function Uh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Po(t,e){Uh(t,e);const s=Math.ceil(e/t)+1,r=2**(t-1);return{windows:s,windowSize:r}}function Qm(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((s,r)=>{if(!(s instanceof e))throw new Error("invalid point at index "+r)})}function ew(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((s,r)=>{if(!e.isValid(s))throw new Error("invalid scalar at index "+r)})}const To=new WeakMap,Dh=new WeakMap;function Oo(t){return Dh.get(t)||1}function tw(t,e){return{constTimeNegate:_o,hasPrecomputes(s){return Oo(s)!==1},unsafeLadder(s,r,i=t.ZERO){let n=s;for(;r>ll;)r&bn&&(i=i.add(n)),n=n.double(),r>>=bn;return i},precomputeWindow(s,r){const{windows:i,windowSize:n}=Po(r,e),o=[];let a=s,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(s,r,i){const{windows:n,windowSize:o}=Po(s,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**s-1),u=2**s,h=BigInt(s);for(let d=0;d<n;d++){const f=d*o;let g=Number(i&l);i>>=h,g>o&&(g-=u,i+=bn);const m=f,p=f+Math.abs(g)-1,w=d%2!==0,y=g<0;g===0?c=c.add(_o(w,r[m])):a=a.add(_o(y,r[p]))}return{p:a,f:c}},wNAFUnsafe(s,r,i,n=t.ZERO){const{windows:o,windowSize:a}=Po(s,e),c=BigInt(2**s-1),l=2**s,u=BigInt(s);for(let h=0;h<o;h++){const d=h*a;if(i===ll)break;let f=Number(i&c);if(i>>=u,f>a&&(f-=l,i+=bn),f===0)continue;let g=r[d+Math.abs(f)-1];f<0&&(g=g.negate()),n=n.add(g)}return n},getPrecomputes(s,r,i){let n=To.get(r);return n||(n=this.precomputeWindow(r,s),s!==1&&To.set(r,i(n))),n},wNAFCached(s,r,i){const n=Oo(s);return this.wNAF(n,this.getPrecomputes(n,s,i),r)},wNAFCachedUnsafe(s,r,i,n){const o=Oo(s);return o===1?this.unsafeLadder(s,r,n):this.wNAFUnsafe(o,this.getPrecomputes(o,s,i),r,n)},setWindowSize(s,r){Uh(r,e),Dh.set(s,r),To.delete(s)}}}function sw(t,e,s,r){if(Qm(s,t),ew(r,e),s.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,n=Ph(BigInt(s.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let u=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let f=0;f<r.length;f++){const g=r[f],m=Number(g>>BigInt(h)&BigInt(a));c[m]=c[m].add(s[f])}let d=i;for(let f=c.length-1,g=i;f>0;f--)g=g.add(c[f]),d=d.add(g);if(u=u.add(d),h!==0)for(let f=0;f<o;f++)u=u.double()}return u}function Lh(t){return Jm(t.Fp),ui(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...xh(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const mr=BigInt(0),xo=BigInt(1);function rw(t){return ui(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function iw(t){const e=rw(t),{P:s}=e,r=y=>bt(y,s),i=e.montgomeryBits,n=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(y=>y),c=e.powPminus2||(y=>Oh(y,s-BigInt(2),s));function l(y,I,T){const $=r(y*(I-T));return I=r(I-$),T=r(T+$),[I,T]}const u=(e.a-BigInt(2))/BigInt(4);function h(y,I){Es("u",y,mr,s),Es("scalar",I,mr,s);const T=I,$=y;let P=xo,_=mr,O=y,v=xo,x=mr,S;for(let L=BigInt(i-1);L>=mr;L--){const E=T>>L&xo;x^=E,S=l(x,P,O),P=S[0],O=S[1],S=l(x,_,v),_=S[0],v=S[1],x=E;const N=P+_,C=r(N*N),k=P-_,U=r(k*k),A=C-U,M=O+v,q=O-v,F=r(q*N),X=r(M*k),G=F+X,oe=F-X;O=r(G*G),v=r($*r(oe*oe)),P=r(C*U),_=r(A*(C+r(u*A)))}S=l(x,P,O),P=S[0],O=S[1],S=l(x,_,v),_=S[0],v=S[1];const R=c(_);return r(P*R)}function d(y){return so(r(y),n)}function f(y){const I=_t("u coordinate",y,n);return o===32&&(I[31]&=127),Vi(I)}function g(y){const I=_t("scalar",y),T=I.length;if(T!==n&&T!==o){let $=""+n+" or "+o;throw new Error("invalid scalar, expected "+$+" bytes, got "+T)}return Vi(a(I))}function m(y,I){const T=f(I),$=g(y),P=h(T,$);if(P===mr)throw new Error("invalid private or public key received");return d(P)}const p=d(e.Gu);function w(y){return m(y,p)}return{scalarMult:m,scalarMultBase:w,getSharedSecret:(y,I)=>m(y,I),getPublicKey:y=>w(y),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:p}}const ba=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const nw=BigInt(1),ul=BigInt(2),ow=BigInt(3),aw=BigInt(5);BigInt(8);function cw(t){const e=BigInt(10),s=BigInt(20),r=BigInt(40),i=BigInt(80),n=ba,o=t*t%n*t%n,a=Gt(o,ul,n)*o%n,c=Gt(a,nw,n)*t%n,l=Gt(c,aw,n)*c%n,u=Gt(l,e,n)*l%n,h=Gt(u,s,n)*u%n,d=Gt(h,r,n)*h%n,f=Gt(d,i,n)*d%n,g=Gt(f,i,n)*d%n,m=Gt(g,e,n)*l%n;return{pow_p_5_8:Gt(m,ul,n)*t%n,b2:o}}function lw(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const va=iw({P:ba,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=ba,{pow_p_5_8:s,b2:r}=cw(t);return bt(Gt(s,ow,e)*r,e)},adjustScalarBytes:lw,randomBytes:li});function hl(t){t.lowS!==void 0&&Zr("lowS",t.lowS),t.prehash!==void 0&&Zr("prehash",t.prehash)}function uw(t){const e=Lh(t);ui(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:s,Fp:r,a:i}=e;if(s){if(!r.eql(i,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof s!="object"||typeof s.beta!="bigint"||typeof s.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:hw,hexToBytes:dw}=Wm;let pw=class extends Error{constructor(e=""){super(e)}};const ws={Err:pw,_tlv:{encode:(t,e)=>{const{Err:s}=ws;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length&1)throw new s("tlv.encode: unpadded data");const r=e.length/2,i=Mr(r);if(i.length/2&128)throw new s("tlv.encode: long form length too big");const n=r>127?Mr(i.length/2|128):"";return Mr(t)+n+i+e},decode(t,e){const{Err:s}=ws;let r=0;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new s("tlv.decode: wrong tlv");const i=e[r++],n=!!(i&128);let o=0;if(!n)o=i;else{const c=i&127;if(!c)throw new s("tlv.decode(long): indefinite length not supported");if(c>4)throw new s("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new s("tlv.decode: length bytes not complete");if(l[0]===0)throw new s("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(r+=c,o<128)throw new s("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=ws;if(t<bs)throw new e("integer: negative integers are not allowed");let s=Mr(t);if(Number.parseInt(s[0],16)&8&&(s="00"+s),s.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return s},decode(t){const{Err:e}=ws;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return hw(t)}},toSig(t){const{Err:e,_int:s,_tlv:r}=ws,i=typeof t=="string"?dw(t):t;on(i);const{v:n,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,n),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:s.decode(a),s:s.decode(l)}},hexFromSig(t){const{_tlv:e,_int:s}=ws,r=e.encode(2,s.encode(t.r)),i=e.encode(2,s.encode(t.s)),n=r+i;return e.encode(48,n)}},bs=BigInt(0),ze=BigInt(1);BigInt(2);const dl=BigInt(3);BigInt(4);function fw(t){const e=uw(t),{Fp:s}=e,r=kh(e.n,e.nBitLength),i=e.toBytes||((m,p,w)=>{const y=p.toAffine();return Gi(Uint8Array.from([4]),s.toBytes(y.x),s.toBytes(y.y))}),n=e.fromBytes||(m=>{const p=m.subarray(1),w=s.fromBytes(p.subarray(0,s.BYTES)),y=s.fromBytes(p.subarray(s.BYTES,2*s.BYTES));return{x:w,y}});function o(m){const{a:p,b:w}=e,y=s.sqr(m),I=s.mul(y,m);return s.add(s.add(I,s.mul(m,p)),w)}if(!s.eql(s.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(m){return ro(m,ze,e.n)}function c(m){const{allowedPrivateKeyLengths:p,nByteLength:w,wrapPrivateKey:y,n:I}=e;if(p&&typeof m!="bigint"){if(ir(m)&&(m=Xr(m)),typeof m!="string"||!p.includes(m.length))throw new Error("invalid private key");m=m.padStart(w*2,"0")}let T;try{T=typeof m=="bigint"?m:er(_t("private key",m,w))}catch{throw new Error("invalid private key, expected hex or "+w+" bytes, got "+typeof m)}return y&&(T=bt(T,I)),Es("private key",T,ze,I),T}function l(m){if(!(m instanceof d))throw new Error("ProjectivePoint expected")}const u=ma((m,p)=>{const{px:w,py:y,pz:I}=m;if(s.eql(I,s.ONE))return{x:w,y};const T=m.is0();p==null&&(p=T?s.ONE:s.inv(I));const $=s.mul(w,p),P=s.mul(y,p),_=s.mul(I,p);if(T)return{x:s.ZERO,y:s.ZERO};if(!s.eql(_,s.ONE))throw new Error("invZ was invalid");return{x:$,y:P}}),h=ma(m=>{if(m.is0()){if(e.allowInfinityPoint&&!s.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:p,y:w}=m.toAffine();if(!s.isValid(p)||!s.isValid(w))throw new Error("bad point: x or y not FE");const y=s.sqr(w),I=o(p);if(!s.eql(y,I))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(p,w,y){if(this.px=p,this.py=w,this.pz=y,p==null||!s.isValid(p))throw new Error("x required");if(w==null||!s.isValid(w))throw new Error("y required");if(y==null||!s.isValid(y))throw new Error("z required");Object.freeze(this)}static fromAffine(p){const{x:w,y}=p||{};if(!p||!s.isValid(w)||!s.isValid(y))throw new Error("invalid affine point");if(p instanceof d)throw new Error("projective point not allowed");const I=T=>s.eql(T,s.ZERO);return I(w)&&I(y)?d.ZERO:new d(w,y,s.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(p){const w=s.invertBatch(p.map(y=>y.pz));return p.map((y,I)=>y.toAffine(w[I])).map(d.fromAffine)}static fromHex(p){const w=d.fromAffine(n(_t("pointHex",p)));return w.assertValidity(),w}static fromPrivateKey(p){return d.BASE.multiply(c(p))}static msm(p,w){return sw(d,r,p,w)}_setWindowSize(p){g.setWindowSize(this,p)}assertValidity(){h(this)}hasEvenY(){const{y:p}=this.toAffine();if(s.isOdd)return!s.isOdd(p);throw new Error("Field doesn't support isOdd")}equals(p){l(p);const{px:w,py:y,pz:I}=this,{px:T,py:$,pz:P}=p,_=s.eql(s.mul(w,P),s.mul(T,I)),O=s.eql(s.mul(y,P),s.mul($,I));return _&&O}negate(){return new d(this.px,s.neg(this.py),this.pz)}double(){const{a:p,b:w}=e,y=s.mul(w,dl),{px:I,py:T,pz:$}=this;let P=s.ZERO,_=s.ZERO,O=s.ZERO,v=s.mul(I,I),x=s.mul(T,T),S=s.mul($,$),R=s.mul(I,T);return R=s.add(R,R),O=s.mul(I,$),O=s.add(O,O),P=s.mul(p,O),_=s.mul(y,S),_=s.add(P,_),P=s.sub(x,_),_=s.add(x,_),_=s.mul(P,_),P=s.mul(R,P),O=s.mul(y,O),S=s.mul(p,S),R=s.sub(v,S),R=s.mul(p,R),R=s.add(R,O),O=s.add(v,v),v=s.add(O,v),v=s.add(v,S),v=s.mul(v,R),_=s.add(_,v),S=s.mul(T,$),S=s.add(S,S),v=s.mul(S,R),P=s.sub(P,v),O=s.mul(S,x),O=s.add(O,O),O=s.add(O,O),new d(P,_,O)}add(p){l(p);const{px:w,py:y,pz:I}=this,{px:T,py:$,pz:P}=p;let _=s.ZERO,O=s.ZERO,v=s.ZERO;const x=e.a,S=s.mul(e.b,dl);let R=s.mul(w,T),L=s.mul(y,$),E=s.mul(I,P),N=s.add(w,y),C=s.add(T,$);N=s.mul(N,C),C=s.add(R,L),N=s.sub(N,C),C=s.add(w,I);let k=s.add(T,P);return C=s.mul(C,k),k=s.add(R,E),C=s.sub(C,k),k=s.add(y,I),_=s.add($,P),k=s.mul(k,_),_=s.add(L,E),k=s.sub(k,_),v=s.mul(x,C),_=s.mul(S,E),v=s.add(_,v),_=s.sub(L,v),v=s.add(L,v),O=s.mul(_,v),L=s.add(R,R),L=s.add(L,R),E=s.mul(x,E),C=s.mul(S,C),L=s.add(L,E),E=s.sub(R,E),E=s.mul(x,E),C=s.add(C,E),R=s.mul(L,C),O=s.add(O,R),R=s.mul(k,C),_=s.mul(N,_),_=s.sub(_,R),R=s.mul(N,L),v=s.mul(k,v),v=s.add(v,R),new d(_,O,v)}subtract(p){return this.add(p.negate())}is0(){return this.equals(d.ZERO)}wNAF(p){return g.wNAFCached(this,p,d.normalizeZ)}multiplyUnsafe(p){const{endo:w,n:y}=e;Es("scalar",p,bs,y);const I=d.ZERO;if(p===bs)return I;if(this.is0()||p===ze)return this;if(!w||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,p,d.normalizeZ);let{k1neg:T,k1:$,k2neg:P,k2:_}=w.splitScalar(p),O=I,v=I,x=this;for(;$>bs||_>bs;)$&ze&&(O=O.add(x)),_&ze&&(v=v.add(x)),x=x.double(),$>>=ze,_>>=ze;return T&&(O=O.negate()),P&&(v=v.negate()),v=new d(s.mul(v.px,w.beta),v.py,v.pz),O.add(v)}multiply(p){const{endo:w,n:y}=e;Es("scalar",p,ze,y);let I,T;if(w){const{k1neg:$,k1:P,k2neg:_,k2:O}=w.splitScalar(p);let{p:v,f:x}=this.wNAF(P),{p:S,f:R}=this.wNAF(O);v=g.constTimeNegate($,v),S=g.constTimeNegate(_,S),S=new d(s.mul(S.px,w.beta),S.py,S.pz),I=v.add(S),T=x.add(R)}else{const{p:$,f:P}=this.wNAF(p);I=$,T=P}return d.normalizeZ([I,T])[0]}multiplyAndAddUnsafe(p,w,y){const I=d.BASE,T=(P,_)=>_===bs||_===ze||!P.equals(I)?P.multiplyUnsafe(_):P.multiply(_),$=T(this,w).add(T(p,y));return $.is0()?void 0:$}toAffine(p){return u(this,p)}isTorsionFree(){const{h:p,isTorsionFree:w}=e;if(p===ze)return!0;if(w)return w(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:p,clearCofactor:w}=e;return p===ze?this:w?w(d,this):this.multiplyUnsafe(e.h)}toRawBytes(p=!0){return Zr("isCompressed",p),this.assertValidity(),i(d,this,p)}toHex(p=!0){return Zr("isCompressed",p),Xr(this.toRawBytes(p))}}d.BASE=new d(e.Gx,e.Gy,s.ONE),d.ZERO=new d(s.ZERO,s.ONE,s.ZERO);const f=e.nBitLength,g=tw(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function gw(t){const e=Lh(t);return ui(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function mw(t){const e=gw(t),{Fp:s,n:r}=e,i=s.BYTES+1,n=2*s.BYTES+1;function o(E){return bt(E,r)}function a(E){return ya(E,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=fw({...e,toBytes(E,N,C){const k=N.toAffine(),U=s.toBytes(k.x),A=Gi;return Zr("isCompressed",C),C?A(Uint8Array.from([N.hasEvenY()?2:3]),U):A(Uint8Array.from([4]),U,s.toBytes(k.y))},fromBytes(E){const N=E.length,C=E[0],k=E.subarray(1);if(N===i&&(C===2||C===3)){const U=er(k);if(!ro(U,ze,s.ORDER))throw new Error("Point is not on curve");const A=u(U);let M;try{M=s.sqrt(A)}catch(F){const X=F instanceof Error?": "+F.message:"";throw new Error("Point is not on curve"+X)}const q=(M&ze)===ze;return(C&1)===1!==q&&(M=s.neg(M)),{x:U,y:M}}else if(N===n&&C===4){const U=s.fromBytes(k.subarray(0,s.BYTES)),A=s.fromBytes(k.subarray(s.BYTES,2*s.BYTES));return{x:U,y:A}}else{const U=i,A=n;throw new Error("invalid Point, expected length of "+U+", or uncompressed "+A+", got "+N)}}}),d=E=>Xr(ei(E,e.nByteLength));function f(E){const N=r>>ze;return E>N}function g(E){return f(E)?o(-E):E}const m=(E,N,C)=>er(E.slice(N,C));class p{constructor(N,C,k){this.r=N,this.s=C,this.recovery=k,this.assertValidity()}static fromCompact(N){const C=e.nByteLength;return N=_t("compactSignature",N,C*2),new p(m(N,0,C),m(N,C,2*C))}static fromDER(N){const{r:C,s:k}=ws.toSig(_t("DER",N));return new p(C,k)}assertValidity(){Es("r",this.r,ze,r),Es("s",this.s,ze,r)}addRecoveryBit(N){return new p(this.r,this.s,N)}recoverPublicKey(N){const{r:C,s:k,recovery:U}=this,A=P(_t("msgHash",N));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const M=U===2||U===3?C+e.n:C;if(M>=s.ORDER)throw new Error("recovery id 2 or 3 invalid");const q=(U&1)===0?"02":"03",F=c.fromHex(q+d(M)),X=a(M),G=o(-A*X),oe=o(k*X),le=c.BASE.multiplyAndAddUnsafe(F,G,oe);if(!le)throw new Error("point at infinify");return le.assertValidity(),le}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Qr(this.toDERHex())}toDERHex(){return ws.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Qr(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const w={isValidPrivateKey(E){try{return l(E),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const E=Rh(e.n);return Xm(e.randomBytes(E),e.n)},precompute(E=8,N=c.BASE){return N._setWindowSize(E),N.multiply(BigInt(3)),N}};function y(E,N=!0){return c.fromPrivateKey(E).toRawBytes(N)}function I(E){const N=ir(E),C=typeof E=="string",k=(N||C)&&E.length;return N?k===i||k===n:C?k===2*i||k===2*n:E instanceof c}function T(E,N,C=!0){if(I(E))throw new Error("first arg must be private key");if(!I(N))throw new Error("second arg must be public key");return c.fromHex(N).multiply(l(E)).toRawBytes(C)}const $=e.bits2int||function(E){if(E.length>8192)throw new Error("input is too large");const N=er(E),C=E.length*8-e.nBitLength;return C>0?N>>BigInt(C):N},P=e.bits2int_modN||function(E){return o($(E))},_=nc(e.nBitLength);function O(E){return Es("num < 2^"+e.nBitLength,E,bs,_),ei(E,e.nByteLength)}function v(E,N,C=x){if(["recovered","canonical"].some(ue=>ue in C))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:U}=e;let{lowS:A,prehash:M,extraEntropy:q}=C;A==null&&(A=!0),E=_t("msgHash",E),hl(C),M&&(E=_t("prehashed msgHash",k(E)));const F=P(E),X=l(N),G=[O(X),O(F)];if(q!=null&&q!==!1){const ue=q===!0?U(s.BYTES):q;G.push(_t("extraEntropy",ue))}const oe=Gi(...G),le=F;function Ie(ue){const he=$(ue);if(!h(he))return;const Ft=a(he),at=c.BASE.multiply(he).toAffine(),Me=o(at.x);if(Me===bs)return;const Ye=o(Ft*o(le+Me*X));if(Ye===bs)return;let ct=(at.x===Me?0:2)|Number(at.y&ze),Fs=Ye;return A&&f(Ye)&&(Fs=g(Ye),ct^=1),new p(Me,Fs,ct)}return{seed:oe,k2sig:Ie}}const x={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};function R(E,N,C=x){const{seed:k,k2sig:U}=v(E,N,C),A=e;return Th(A.hash.outputLen,A.nByteLength,A.hmac)(k,U)}c.BASE._setWindowSize(8);function L(E,N,C,k=S){var Ye;const U=E;N=_t("msgHash",N),C=_t("publicKey",C);const{lowS:A,prehash:M,format:q}=k;if(hl(k),"strict"in k)throw new Error("options.strict was renamed to lowS");if(q!==void 0&&q!=="compact"&&q!=="der")throw new Error("format must be compact or der");const F=typeof U=="string"||ir(U),X=!F&&!q&&typeof U=="object"&&U!==null&&typeof U.r=="bigint"&&typeof U.s=="bigint";if(!F&&!X)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let G,oe;try{if(X&&(G=new p(U.r,U.s)),F){try{q!=="compact"&&(G=p.fromDER(U))}catch(ct){if(!(ct instanceof ws.Err))throw ct}!G&&q!=="der"&&(G=p.fromCompact(U))}oe=c.fromHex(C)}catch{return!1}if(!G||A&&G.hasHighS())return!1;M&&(N=e.hash(N));const{r:le,s:Ie}=G,ue=P(N),he=a(Ie),Ft=o(ue*he),at=o(le*he),Me=(Ye=c.BASE.multiplyAndAddUnsafe(oe,Ft,at))==null?void 0:Ye.toAffine();return Me?o(Me.x)===le:!1}return{CURVE:e,getPublicKey:y,getSharedSecret:T,sign:R,verify:L,ProjectivePoint:c,Signature:p,utils:w}}function ww(t){return{hash:t,hmac:(e,...s)=>Qn(t,e,Kg(...s)),randomBytes:li}}function yw(t,e){const s=r=>mw({...t,...ww(r)});return{...s(e),create:s}}const Bh=kh(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),bw=Bh.create(BigInt("-3")),vw=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Ew=yw({a:bw,b:vw,Fp:Bh,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},nn),Mh="base10",ut="base16",tr="base64pad",oc="base64url",an="utf8",jh=0,hi=1,io=2,Iw=0,pl=1,ji=12,ac=32;function Cw(){const t=va.utils.randomPrivateKey(),e=va.getPublicKey(t);return{privateKey:it(t,ut),publicKey:it(e,ut)}}function Ea(){const t=li(ac);return it(t,ut)}function Nw(t,e){const s=va.getSharedSecret(It(t,ut),It(e,ut)),r=Pm(nn,s,void 0,void 0,ac);return it(r,ut)}function Aw(t){const e=nn(It(t,ut));return it(e,ut)}function Rn(t){const e=nn(It(t,an));return it(e,ut)}function qh(t){return It(`${t}`,Mh)}function nr(t){return Number(it(t,Mh))}function Fh(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function zh(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),s=(4-e.length%4)%4;return e+"=".repeat(s)}function Sw(t){const e=qh(typeof t.type<"u"?t.type:jh);if(nr(e)===hi&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const s=typeof t.senderPublicKey<"u"?It(t.senderPublicKey,ut):void 0,r=typeof t.iv<"u"?It(t.iv,ut):li(ji),i=It(t.symKey,ut),n=Sh(i,r).encrypt(It(t.message,an)),o=Wh({type:e,sealed:n,iv:r,senderPublicKey:s});return t.encoding===oc?Fh(o):o}function _w(t){const e=It(t.symKey,ut),{sealed:s,iv:r}=Ji({encoded:t.encoded,encoding:t.encoding}),i=Sh(e,r).decrypt(s);if(i===null)throw new Error("Failed to decrypt");return it(i,an)}function Pw(t,e){const s=qh(io),r=li(ji),i=It(t,an),n=Wh({type:s,sealed:i,iv:r});return e===oc?Fh(n):n}function Tw(t,e){const{sealed:s}=Ji({encoded:t,encoding:e});return it(s,an)}function Wh(t){if(nr(t.type)===io)return it(Bi([t.type,t.sealed]),tr);if(nr(t.type)===hi){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return it(Bi([t.type,t.senderPublicKey,t.iv,t.sealed]),tr)}return it(Bi([t.type,t.iv,t.sealed]),tr)}function Ji(t){const e=(t.encoding||tr)===oc?zh(t.encoded):t.encoded,s=It(e,tr),r=s.slice(Iw,pl),i=pl;if(nr(r)===hi){const c=i+ac,l=c+ji,u=s.slice(i,c),h=s.slice(c,l),d=s.slice(l);return{type:r,sealed:d,iv:h,senderPublicKey:u}}if(nr(r)===io){const c=s.slice(i),l=li(ji);return{type:r,sealed:c,iv:l}}const n=i+ji,o=s.slice(i,n),a=s.slice(n);return{type:r,sealed:a,iv:o}}function Ow(t,e){const s=Ji({encoded:t,encoding:e==null?void 0:e.encoding});return Hh({type:nr(s.type),senderPublicKey:typeof s.senderPublicKey<"u"?it(s.senderPublicKey,ut):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Hh(t){const e=(t==null?void 0:t.type)||jh;if(e===hi){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function fl(t){return t.type===hi&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function gl(t){return t.type===io}function xw(t){const e=rt.Buffer.from(t.x,"base64"),s=rt.Buffer.from(t.y,"base64");return Bi([new Uint8Array([4]),e,s])}function kw(t,e){const[s,r,i]=t.split("."),n=rt.Buffer.from(zh(i),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${s}.${r}`,l=nn(c),u=xw(e);if(!Ew.verify(Bi([o,a]),l,u))throw new Error("Invalid signature");return ia(t).payload}const $w="irn";function Wn(t){return(t==null?void 0:t.relay)||{protocol:$w}}function xi(t){const e=mp[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function Rw(t,e="-"){const s={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){const n=i.replace(r,""),o=t[i];s[n]=o}}),s}function ml(t){if(!t.includes("wc:")){const l=mh(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),s=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,s).split("@"),n=typeof s<"u"?t.substring(s):"",o=new URLSearchParams(n),a={};o.forEach((l,u)=>{a[u]=l});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:Uw(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:Rw(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function Uw(t){return t.startsWith("//")?t.substring(2):t}function Dw(t,e="-"){const s="relay",r={};return Object.keys(t).forEach(i=>{const n=i,o=s+e+n;t[n]&&(r[o]=t[n])}),r}function wl(t){const e=new URLSearchParams,s=Dw(t.relay);Object.keys(s).sort().forEach(i=>{e.set(i,s[i])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const r=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${r}`}const Lw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Bw={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function be(t,e){const{message:s,code:r}=Bw[t];return{message:e?`${s} ${e}`:s,code:r}}function ki(t,e){const{message:s,code:r}=Lw[t];return{message:e?`${s} ${e}`:s,code:r}}function Ia(t){return typeof t>"u"}function Kh(t,e){return typeof t=="string"&&!!t.trim().length}function Mw(t){function e(s){try{return typeof new URL(s)<"u"}catch{return!1}}try{if(Kh(t,!1)){if(e(t))return!0;const s=mh(t);return e(s)}}catch{}return!1}function jw(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function qw(t){return t==null?void 0:t.topic}function ko(t){return typeof t<"u"&&typeof t!==null}function yl(){const t=Xn();return new Promise(e=>{switch(t){case Xt.browser:e(Fw());break;case Xt.reactNative:e(zw());break;case Xt.node:e(Ww());break;default:e(!0)}})}function Fw(){return sn()&&(navigator==null?void 0:navigator.onLine)}async function zw(){if(ur()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo){const t=await(globalThis==null?void 0:globalThis.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function Ww(){return!0}function Hw(t){switch(Xn()){case Xt.browser:Kw(t);break;case Xt.reactNative:Vw(t);break}}function Kw(t){!ur()&&sn()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function Vw(t){ur()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo&&(globalThis==null||globalThis.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function Gw(){var t;return sn()&&xt.getDocument()?((t=xt.getDocument())==null?void 0:t.visibilityState)==="visible":!0}var Jw={};const Vh="wc",Gh=2,Ca="core",ls=`${Vh}@2:${Ca}:`,Yw={logger:"error"},Zw={database:":memory:"},Xw="crypto",bl="client_ed25519_seed",Qw=j.ONE_DAY,ey="keychain",ty="0.3",sy="messages",ry="0.3",vl=j.SIX_HOURS,iy="publisher",Jh="irn",ny="error",Yh="wss://relay.walletconnect.org",oy="relayer",Ke={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ay="_subscription",Lt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},cy=.1,Na="2.21.0",Oe={link_mode:"link_mode",relay:"relay"},Un={inbound:"inbound",outbound:"outbound"},ly="0.3",uy="WALLETCONNECT_CLIENT_ID",El="WALLETCONNECT_LINK_MODE_APPS",At={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},hy="subscription",dy="0.3",py="pairing",fy="0.3",vi={wc_pairingDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:j.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:j.ONE_DAY,prompt:!1,tag:0},res:{ttl:j.ONE_DAY,prompt:!1,tag:0}}},Js={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Wt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},gy="history",my="0.3",wy="expirer",Mt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},yy="0.3",by="verify-api",vy="https://verify.walletconnect.com",Zh="https://verify.walletconnect.org",qi=Zh,Ey=`${qi}/v3`,Iy=[vy,Zh],Cy="echo",Ny="https://echo.walletconnect.com",is={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},ms={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Ht={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ws={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Hs={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Ei={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},Ay=.1,Sy="event-client",_y=86400,Py="https://pulse.walletconnect.org/batch";function Ty(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),r=0;r<s.length;r++)s[r]=255;for(var i=0;i<t.length;i++){var n=t.charAt(i),o=n.charCodeAt(0);if(s[o]!==255)throw new TypeError(n+" is ambiguous");s[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var m=0,p=0,w=0,y=g.length;w!==y&&g[w]===0;)w++,m++;for(var I=(y-w)*u+1>>>0,T=new Uint8Array(I);w!==y;){for(var $=g[w],P=0,_=I-1;($!==0||P<p)&&_!==-1;_--,P++)$+=256*T[_]>>>0,T[_]=$%a>>>0,$=$/a>>>0;if($!==0)throw new Error("Non-zero carry");p=P,w++}for(var O=I-p;O!==I&&T[O]===0;)O++;for(var v=c.repeat(m);O<I;++O)v+=t.charAt(T[O]);return v}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var m=0;if(g[m]!==" "){for(var p=0,w=0;g[m]===c;)p++,m++;for(var y=(g.length-m)*l+1>>>0,I=new Uint8Array(y);g[m];){var T=s[g.charCodeAt(m)];if(T===255)return;for(var $=0,P=y-1;(T!==0||$<w)&&P!==-1;P--,$++)T+=a*I[P]>>>0,I[P]=T%256>>>0,T=T/256>>>0;if(T!==0)throw new Error("Non-zero carry");w=$,m++}if(g[m]!==" "){for(var _=y-w;_!==y&&I[_]===0;)_++;for(var O=new Uint8Array(p+(y-_)),v=p;_!==y;)O[v++]=I[_++];return O}}}function f(g){var m=d(g);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var Oy=Ty,xy=Oy;const Xh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},ky=t=>new TextEncoder().encode(t),$y=t=>new TextDecoder().decode(t);let Ry=class{constructor(e,s,r){this.name=e,this.prefix=s,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Uy=class{constructor(e,s,r){if(this.name=e,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Qh(this,e)}},Dy=class{constructor(e){this.decoders=e}or(e){return Qh(this,e)}decode(e){const s=e[0],r=this.decoders[s];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Qh=(t,e)=>new Dy({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Ly=class{constructor(e,s,r,i){this.name=e,this.prefix=s,this.baseEncode=r,this.baseDecode=i,this.encoder=new Ry(e,s,r),this.decoder=new Uy(e,s,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const no=({name:t,prefix:e,encode:s,decode:r})=>new Ly(t,e,s,r),cn=({prefix:t,name:e,alphabet:s})=>{const{encode:r,decode:i}=xy(s,e);return no({prefix:t,name:e,encode:r,decode:n=>Xh(i(n))})},By=(t,e,s,r)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*s/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=i[t[u]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<s|h,a+=s,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=s||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},My=(t,e,s)=>{const r=e[e.length-1]==="=",i=(1<<s)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>s;)o-=s,n+=e[i&a>>o];if(o&&(n+=e[i&a<<s-o]),r)for(;n.length*s&7;)n+="=";return n},tt=({name:t,prefix:e,bitsPerChar:s,alphabet:r})=>no({prefix:e,name:t,encode(i){return My(i,r,s)},decode(i){return By(i,r,s,t)}}),jy=no({prefix:"\0",name:"identity",encode:t=>$y(t),decode:t=>ky(t)});var qy=Object.freeze({__proto__:null,identity:jy});const Fy=tt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var zy=Object.freeze({__proto__:null,base2:Fy});const Wy=tt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Hy=Object.freeze({__proto__:null,base8:Wy});const Ky=cn({prefix:"9",name:"base10",alphabet:"0123456789"});var Vy=Object.freeze({__proto__:null,base10:Ky});const Gy=tt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Jy=tt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Yy=Object.freeze({__proto__:null,base16:Gy,base16upper:Jy});const Zy=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Xy=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qy=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),eb=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),tb=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sb=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),rb=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ib=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),nb=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ob=Object.freeze({__proto__:null,base32:Zy,base32upper:Xy,base32pad:Qy,base32padupper:eb,base32hex:tb,base32hexupper:sb,base32hexpad:rb,base32hexpadupper:ib,base32z:nb});const ab=cn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),cb=cn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var lb=Object.freeze({__proto__:null,base36:ab,base36upper:cb});const ub=cn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),hb=cn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var db=Object.freeze({__proto__:null,base58btc:ub,base58flickr:hb});const pb=tt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),fb=tt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),gb=tt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),mb=tt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var wb=Object.freeze({__proto__:null,base64:pb,base64pad:fb,base64url:gb,base64urlpad:mb});const ed=Array.from(""),yb=ed.reduce((t,e,s)=>(t[s]=e,t),[]),bb=ed.reduce((t,e,s)=>(t[e.codePointAt(0)]=s,t),[]);function vb(t){return t.reduce((e,s)=>(e+=yb[s],e),"")}function Eb(t){const e=[];for(const s of t){const r=bb[s.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${s}`);e.push(r)}return new Uint8Array(e)}const Ib=no({prefix:"",name:"base256emoji",encode:vb,decode:Eb});var Cb=Object.freeze({__proto__:null,base256emoji:Ib}),Nb=td,Il=128,Ab=-128,Sb=Math.pow(2,31);function td(t,e,s){e=e||[],s=s||0;for(var r=s;t>=Sb;)e[s++]=t&255|Il,t/=128;for(;t&Ab;)e[s++]=t&255|Il,t>>>=7;return e[s]=t|0,td.bytes=s-r+1,e}var _b=Aa,Pb=128,Cl=127;function Aa(t,r){var s=0,r=r||0,i=0,n=r,o,a=t.length;do{if(n>=a)throw Aa.bytes=0,new RangeError("Could not decode varint");o=t[n++],s+=i<28?(o&Cl)<<i:(o&Cl)*Math.pow(2,i),i+=7}while(o>=Pb);return Aa.bytes=n-r,s}var Tb=Math.pow(2,7),Ob=Math.pow(2,14),xb=Math.pow(2,21),kb=Math.pow(2,28),$b=Math.pow(2,35),Rb=Math.pow(2,42),Ub=Math.pow(2,49),Db=Math.pow(2,56),Lb=Math.pow(2,63),Bb=function(t){return t<Tb?1:t<Ob?2:t<xb?3:t<kb?4:t<$b?5:t<Rb?6:t<Ub?7:t<Db?8:t<Lb?9:10},Mb={encode:Nb,decode:_b,encodingLength:Bb},sd=Mb;const Nl=(t,e,s=0)=>(sd.encode(t,e,s),e),Al=t=>sd.encodingLength(t),Sa=(t,e)=>{const s=e.byteLength,r=Al(t),i=r+Al(s),n=new Uint8Array(i+s);return Nl(t,n,0),Nl(s,n,r),n.set(e,i),new jb(t,s,e,n)};let jb=class{constructor(e,s,r,i){this.code=e,this.size=s,this.digest=r,this.bytes=i}};const rd=({name:t,code:e,encode:s})=>new qb(t,e,s);class qb{constructor(e,s,r){this.name=e,this.code=s,this.encode=r}digest(e){if(e instanceof Uint8Array){const s=this.encode(e);return s instanceof Uint8Array?Sa(this.code,s):s.then(r=>Sa(this.code,r))}else throw Error("Unknown type, must be binary type")}}const id=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Fb=rd({name:"sha2-256",code:18,encode:id("SHA-256")}),zb=rd({name:"sha2-512",code:19,encode:id("SHA-512")});var Wb=Object.freeze({__proto__:null,sha256:Fb,sha512:zb});const nd=0,Hb="identity",od=Xh,Kb=t=>Sa(nd,od(t)),Vb={code:nd,name:Hb,encode:od,digest:Kb};var Gb=Object.freeze({__proto__:null,identity:Vb});new TextEncoder,new TextDecoder;const Sl={...qy,...zy,...Hy,...Vy,...Yy,...ob,...lb,...db,...wb,...Cb};({...Wb,...Gb});function Jb(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function ad(t,e,s,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:r}}}const _l=ad("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),$o=ad("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);const e=Jb(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),Yb={utf8:_l,"utf-8":_l,hex:Sl.base16,latin1:$o,ascii:$o,binary:$o,...Sl};function Zb(t,e="utf8"){const s=Yb[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):s.decoder.decode(`${s.prefix}${t}`)}var Xb=Object.defineProperty,Qb=(t,e,s)=>e in t?Xb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ts=(t,e,s)=>Qb(t,typeof e!="symbol"?e+"":e,s);let e0=class{constructor(e,s){this.core=e,this.logger=s,ts(this,"keychain",new Map),ts(this,"name",ey),ts(this,"version",ty),ts(this,"initialized",!1),ts(this,"storagePrefix",ls),ts(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),ts(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),ts(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),ts(this,"get",r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:n}=be("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}),ts(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=ht(s,this.name)}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ha(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?da(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var t0=Object.defineProperty,s0=(t,e,s)=>e in t?t0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Xe=(t,e,s)=>s0(t,typeof e!="symbol"?e+"":e,s);let r0=class{constructor(e,s,r){this.core=e,this.logger=s,Xe(this,"name",Xw),Xe(this,"keychain"),Xe(this,"randomSessionIdentifier",Ea()),Xe(this,"initialized",!1),Xe(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Xe(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),Xe(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),n=Ic(i);return vp(n.publicKey)}),Xe(this,"generateKeyPair",()=>{this.isInitialized();const i=Cw();return this.setPrivateKey(i.publicKey,i.privateKey)}),Xe(this,"signJWT",async i=>{this.isInitialized();const n=await this.getClientSeed(),o=Ic(n),a=this.randomSessionIdentifier;return await Ep(a,i,Qw,o)}),Xe(this,"generateSharedKey",(i,n,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=Nw(a,n);return this.setSymKey(c,o)}),Xe(this,"setSymKey",async(i,n)=>{this.isInitialized();const o=n||Aw(i);return await this.keychain.set(o,i),o}),Xe(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),Xe(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),Xe(this,"encode",async(i,n,o)=>{this.isInitialized();const a=Hh(o),c=Ya(n);if(gl(a))return Pw(c,o==null?void 0:o.encoding);if(fl(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;i=await this.generateSharedKey(d,f)}const l=this.getSymKey(i),{type:u,senderPublicKey:h}=a;return Sw({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),Xe(this,"decode",async(i,n,o)=>{this.isInitialized();const a=Ow(n,o);if(gl(a)){const c=Tw(n,o==null?void 0:o.encoding);return jn(c)}if(fl(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;i=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(i),l=_w({symKey:c,encoded:n,encoding:o==null?void 0:o.encoding});return jn(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Xe(this,"getPayloadType",(i,n=tr)=>{const o=Ji({encoded:i,encoding:n});return nr(o.type)}),Xe(this,"getPayloadSenderPublicKey",(i,n=tr)=>{const o=Ji({encoded:i,encoding:n});return o.senderPublicKey?it(o.senderPublicKey,ut):void 0}),this.core=e,this.logger=ht(s,this.name),this.keychain=r||new e0(this.core,this.logger)}get context(){return $t(this.logger)}async setPrivateKey(e,s){return await this.keychain.set(e,s),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(bl)}catch{e=Ea(),await this.keychain.set(bl,e)}return Zb(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var i0=Object.defineProperty,n0=Object.defineProperties,o0=Object.getOwnPropertyDescriptors,Pl=Object.getOwnPropertySymbols,a0=Object.prototype.hasOwnProperty,c0=Object.prototype.propertyIsEnumerable,_a=(t,e,s)=>e in t?i0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,l0=(t,e)=>{for(var s in e||(e={}))a0.call(e,s)&&_a(t,s,e[s]);if(Pl)for(var s of Pl(e))c0.call(e,s)&&_a(t,s,e[s]);return t},u0=(t,e)=>n0(t,o0(e)),Nt=(t,e,s)=>_a(t,typeof e!="symbol"?e+"":e,s);let h0=class extends zf{constructor(e,s){super(e,s),this.logger=e,this.core=s,Nt(this,"messages",new Map),Nt(this,"messagesWithoutClientAck",new Map),Nt(this,"name",sy),Nt(this,"version",ry),Nt(this,"initialized",!1),Nt(this,"storagePrefix",ls),Nt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),Nt(this,"set",async(r,i,n)=>{this.isInitialized();const o=Rn(i);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),n===Un.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,u0(l0({},c),{[o]:i}))}return await this.persist(),o}),Nt(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),Nt(this,"getWithoutAck",r=>{this.isInitialized();const i={};for(const n of r){const o=this.messagesWithoutClientAck.get(n)||{};i[n]=Object.values(o)}return i}),Nt(this,"has",(r,i)=>{this.isInitialized();const n=this.get(r),o=Rn(i);return typeof n[o]<"u"}),Nt(this,"ack",async(r,i)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(r);if(typeof n>"u")return;const o=Rn(i);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,n),await this.persist()}),Nt(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=ht(e,this.name),this.core=s}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ha(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ha(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?da(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?da(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var d0=Object.defineProperty,p0=Object.defineProperties,f0=Object.getOwnPropertyDescriptors,Tl=Object.getOwnPropertySymbols,g0=Object.prototype.hasOwnProperty,m0=Object.prototype.propertyIsEnumerable,Pa=(t,e,s)=>e in t?d0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,vn=(t,e)=>{for(var s in e||(e={}))g0.call(e,s)&&Pa(t,s,e[s]);if(Tl)for(var s of Tl(e))m0.call(e,s)&&Pa(t,s,e[s]);return t},Ro=(t,e)=>p0(t,f0(e)),Kt=(t,e,s)=>Pa(t,typeof e!="symbol"?e+"":e,s);class w0 extends Wf{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,Kt(this,"events",new lr.EventEmitter),Kt(this,"name",iy),Kt(this,"queue",new Map),Kt(this,"publishTimeout",j.toMiliseconds(j.ONE_MINUTE)),Kt(this,"initialPublishTimeout",j.toMiliseconds(j.ONE_SECOND*15)),Kt(this,"needsTransportRestart",!1),Kt(this,"publish",async(r,i,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:n}});const a=(n==null?void 0:n.ttl)||vl,c=Wn(n),l=(n==null?void 0:n.prompt)||!1,u=(n==null?void 0:n.tag)||0,h=(n==null?void 0:n.id)||Br().toString(),d={topic:r,message:i,opts:{ttl:a,relay:c,prompt:l,tag:u,id:h,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}},f=`Failed to publish payload, please try again. id:${h} tag:${u}`;try{const g=new Promise(async m=>{const p=({id:y})=>{d.opts.id===y&&(this.removeRequestFromQueue(y),this.relayer.events.removeListener(Ke.publish,p),m(d))};this.relayer.events.on(Ke.publish,p);const w=Rs(new Promise((y,I)=>{this.rpcPublish({topic:r,message:i,ttl:a,prompt:l,tag:u,id:h,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}).then(y).catch(T=>{this.logger.warn(T,T==null?void 0:T.message),I(T)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${u}`);try{await w,this.events.removeListener(Ke.publish,p)}catch(y){this.queue.set(h,Ro(vn({},d),{attempt:1})),this.logger.warn(y,y==null?void 0:y.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:r,message:i,opts:n}}),await Rs(g,this.publishTimeout,f)}catch(g){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(g),(o=n==null?void 0:n.internal)!=null&&o.throwOnFailedPublish)throw g}finally{this.queue.delete(h)}}),Kt(this,"on",(r,i)=>{this.events.on(r,i)}),Kt(this,"once",(r,i)=>{this.events.once(r,i)}),Kt(this,"off",(r,i)=>{this.events.off(r,i)}),Kt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=e,this.logger=ht(s,this.name),this.registerEventListeners()}get context(){return $t(this.logger)}async rpcPublish(e){var s,r,i,n;const{topic:o,message:a,ttl:c=vl,prompt:l,tag:u,id:h,attestation:d,tvf:f}=e,g={method:xi(Wn().protocol).publish,params:vn({topic:o,message:a,ttl:c,prompt:l,tag:u,attestation:d},f),id:h};Ia((s=g.params)==null?void 0:s.prompt)&&((r=g.params)==null||delete r.prompt),Ia((i=g.params)==null?void 0:i.tag)&&((n=g.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:g});const m=await this.relayer.request(g);return this.relayer.events.emit(Ke.publish,e),this.logger.debug("Successfully Published Payload"),m}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,s)=>{const r=e.attempt+1;this.queue.set(s,Ro(vn({},e),{attempt:r}));const{topic:i,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${r}`),await this.rpcPublish(Ro(vn({},e),{topic:i,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(ci.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ke.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ke.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var y0=Object.defineProperty,b0=(t,e,s)=>e in t?y0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,wr=(t,e,s)=>b0(t,typeof e!="symbol"?e+"":e,s);class v0{constructor(){wr(this,"map",new Map),wr(this,"set",(e,s)=>{const r=this.get(e);this.exists(e,s)||this.map.set(e,[...r,s])}),wr(this,"get",e=>this.map.get(e)||[]),wr(this,"exists",(e,s)=>this.get(e).includes(s)),wr(this,"delete",(e,s)=>{if(typeof s>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,s))return;const i=r.filter(n=>n!==s);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),wr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var E0=Object.defineProperty,I0=Object.defineProperties,C0=Object.getOwnPropertyDescriptors,Ol=Object.getOwnPropertySymbols,N0=Object.prototype.hasOwnProperty,A0=Object.prototype.propertyIsEnumerable,Ta=(t,e,s)=>e in t?E0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ii=(t,e)=>{for(var s in e||(e={}))N0.call(e,s)&&Ta(t,s,e[s]);if(Ol)for(var s of Ol(e))A0.call(e,s)&&Ta(t,s,e[s]);return t},Uo=(t,e)=>I0(t,C0(e)),Ne=(t,e,s)=>Ta(t,typeof e!="symbol"?e+"":e,s);let S0=class extends Vf{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,Ne(this,"subscriptions",new Map),Ne(this,"topicMap",new v0),Ne(this,"events",new lr.EventEmitter),Ne(this,"name",hy),Ne(this,"version",dy),Ne(this,"pending",new Map),Ne(this,"cached",[]),Ne(this,"initialized",!1),Ne(this,"storagePrefix",ls),Ne(this,"subscribeTimeout",j.toMiliseconds(j.ONE_MINUTE)),Ne(this,"initialSubscribeTimeout",j.toMiliseconds(j.ONE_SECOND*15)),Ne(this,"clientId"),Ne(this,"batchSubscribeTopicsLimit",500),Ne(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Ne(this,"subscribe",async(r,i)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const n=Wn(i),o={topic:r,relay:n,transportType:i==null?void 0:i.transportType};this.pending.set(r,o);const a=await this.rpcSubscribe(r,n,i);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),Ne(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),Ne(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),Ne(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(n=>n.topic===r))})),Ne(this,"on",(r,i)=>{this.events.on(r,i)}),Ne(this,"once",(r,i)=>{this.events.once(r,i)}),Ne(this,"off",(r,i)=>{this.events.off(r,i)}),Ne(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),Ne(this,"start",async()=>{await this.onConnect()}),Ne(this,"stop",async()=>{await this.onDisconnect()}),Ne(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Ne(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),Ne(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(ci.pulse,async()=>{await this.checkPending()}),this.events.on(At.created,async r=>{const i=At.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(At.deleted,async r=>{const i=At.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=e,this.logger=ht(s,this.name),this.clientId=""}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,s){let r=!1;try{r=this.getSubscription(e).topic===s}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,s){const r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,s)))}async unsubscribeById(e,s,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:r}});try{const i=Wn(r);await this.restartToComplete({topic:e,id:s,relay:i}),await this.rpcUnsubscribe(e,s,i);const n=ki("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,s,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,s,r){var i;(!r||(r==null?void 0:r.transportType)===Oe.relay)&&await this.restartToComplete({topic:e,id:e,relay:s});const n={method:xi(s.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=(i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((r==null?void 0:r.transportType)===Oe.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(u=>this.logger.warn(u))},j.toMiliseconds(j.ONE_SECOND)),a;const c=new Promise(async u=>{const h=d=>{d.topic===e&&(this.events.removeListener(At.created,h),u(d.id))};this.events.on(At.created,h);try{const d=await Rs(new Promise((f,g)=>{this.relayer.request(n).catch(m=>{this.logger.warn(m,m==null?void 0:m.message),g(m)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(At.created,h),u(d)}catch{}}),l=await Rs(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return l?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ke.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const s=e[0].relay,r={method:xi(s.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Rs(new Promise(i=>{this.relayer.request(r).catch(n=>this.logger.warn(n)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Ke.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const s=e[0].relay,r={method:xi(s.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await Rs(new Promise((n,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Ke.connection_stalled)}return i}rpcUnsubscribe(e,s,r){const i={method:xi(r.protocol).unsubscribe,params:{topic:e,id:s}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,s){this.setSubscription(e,Uo(Ii({},s),{id:e})),this.pending.delete(s.topic)}onBatchSubscribe(e){e.length&&e.forEach(s=>{this.setSubscription(s.id,Ii({},s)),this.pending.delete(s.topic)})}async onUnsubscribe(e,s,r){this.events.removeAllListeners(s),this.hasSubscription(s,e)&&this.deleteSubscription(s,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,s){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:s}),this.addSubscription(e,s)}addSubscription(e,s){this.subscriptions.set(e,Ii({},s)),this.topicMap.set(s.topic,e),this.events.emit(At.created,s)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const s=this.subscriptions.get(e);if(!s){const{message:r}=be("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return s}deleteSubscription(e,s){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:s});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(At.deleted,Uo(Ii({},r),{reason:s}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(At.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<s;r++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(At.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:s}=be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async s=>Uo(Ii({},s),{id:await this.getSubscriptionId(s.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const s=await this.rpcBatchFetchMessages(e);s&&s.messages&&(await Ug(j.toMiliseconds(j.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(s.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Rn(e+await this.getClientId())}};var _0=Object.defineProperty,xl=Object.getOwnPropertySymbols,P0=Object.prototype.hasOwnProperty,T0=Object.prototype.propertyIsEnumerable,Oa=(t,e,s)=>e in t?_0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,kl=(t,e)=>{for(var s in e||(e={}))P0.call(e,s)&&Oa(t,s,e[s]);if(xl)for(var s of xl(e))T0.call(e,s)&&Oa(t,s,e[s]);return t},ge=(t,e,s)=>Oa(t,typeof e!="symbol"?e+"":e,s);let O0=class extends Hf{constructor(e){super(e),ge(this,"protocol","wc"),ge(this,"version",2),ge(this,"core"),ge(this,"logger"),ge(this,"events",new lr.EventEmitter),ge(this,"provider"),ge(this,"messages"),ge(this,"subscriber"),ge(this,"publisher"),ge(this,"name",oy),ge(this,"transportExplicitlyClosed",!1),ge(this,"initialized",!1),ge(this,"connectionAttemptInProgress",!1),ge(this,"relayUrl"),ge(this,"projectId"),ge(this,"packageName"),ge(this,"bundleId"),ge(this,"hasExperiencedNetworkDisruption",!1),ge(this,"pingTimeout"),ge(this,"heartBeatTimeout",j.toMiliseconds(j.THIRTY_SECONDS+j.FIVE_SECONDS)),ge(this,"reconnectTimeout"),ge(this,"connectPromise"),ge(this,"reconnectInProgress",!1),ge(this,"requestsInFlight",[]),ge(this,"connectTimeout",j.toMiliseconds(j.ONE_SECOND*15)),ge(this,"request",async s=>{var r,i;this.logger.debug("Publishing Request Payload");const n=s.id||Br().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:s.method,topic:(r=s.params)==null?void 0:r.topic},"relayer.request - publishing...");const o=`${n}:${((i=s.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(s);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),ge(this,"resetPingTimeout",()=>{zn()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var s,r,i,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(i=(r=(s=this.provider)==null?void 0:s.connection)==null?void 0:r.socket)==null?void 0:i.terminate)==null||n.call(i)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),ge(this,"onPayloadHandler",s=>{this.onProviderPayload(s),this.resetPingTimeout()}),ge(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(Ke.connect)}),ge(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),ge(this,"onProviderErrorHandler",s=>{this.logger.fatal(`Fatal socket error: ${s.message}`),this.events.emit(Ke.error,s),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ge(this,"registerProviderListeners",()=>{this.provider.on(Lt.payload,this.onPayloadHandler),this.provider.on(Lt.connect,this.onConnectHandler),this.provider.on(Lt.disconnect,this.onDisconnectHandler),this.provider.on(Lt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?ht(e.logger,this.name):Za(en({level:e.logger||ny})),this.messages=new h0(this.logger,e.core),this.subscriber=new S0(this,this.logger),this.publisher=new w0(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Yh,this.projectId=e.projectId,Ng()?this.packageName=zc():Ag()&&(this.bundleId=zc()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return $t(this.logger)}get connected(){var e,s,r;return((r=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,s,r;return((r=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,s,r){this.isInitialized(),await this.publisher.publish(e,s,r),await this.recordMessageEvent({topic:e,message:s,publishedAt:Date.now(),transportType:Oe.relay},Un.outbound)}async subscribe(e,s){var r,i,n;this.isInitialized(),(!(s!=null&&s.transportType)||(s==null?void 0:s.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((r=s==null?void 0:s.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=s==null?void 0:s.internal)==null?void 0:i.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(At.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(At.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,kl({internal:{throwOnFailedPublish:o}},s)).catch(d=>{o&&h(d)})||a,u()})]),a}async unsubscribe(e,s){this.isInitialized(),await this.subscriber.unsubscribe(e,s)}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Rs(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(s,r)=>{await this.connect(e).then(s).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await yl())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const s=e.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${s.length} message events sorted`);for(const r of s)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(i==null?void 0:i.message))}this.logger.trace(`Batch of ${s.length} message events processed`)}async onLinkMessageEvent(e,s){const{topic:r}=e;if(!s.sessionExists){const i=Mi(j.FIVE_MINUTES),n={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,n)}this.events.emit(Ke.message,e),await this.recordMessageEvent(e,Un.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let s=1;for(;s<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${s}...`),await this.createProvider(),await new Promise(async(r,i)=>{const n=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Lt.disconnect,n),await Rs(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(Lt.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Lt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Lt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${s}`);break}await new Promise(r=>setTimeout(r,j.toMiliseconds(s*1))),s++}}startPingTimeout(){var e,s,r,i,n;if(zn())try{(s=(e=this.provider)==null?void 0:e.connection)!=null&&s.socket&&((n=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new jt(new bp(Og({sdkVersion:Na,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,s){const{topic:r,message:i}=e;await this.messages.set(r,i,s)}async shouldIgnoreMessageEvent(e){const{topic:s,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(s))return this.logger.warn(`Ignoring message for unknown topic ${s}`),!0;const i=this.messages.has(s,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Xa(e)){if(!e.method.endsWith(ay))return;const s=e.params,{topic:r,message:i,publishedAt:n,attestation:o}=s.data,a={topic:r,message:i,publishedAt:n,transportType:Oe.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(kl({type:"event",event:s.id},a)),this.events.emit(s.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Qa(e)&&this.events.emit(Ke.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Un.inbound),this.events.emit(Ke.message,e))}async acknowledgePayload(e){const s=Yn(e.id,!0);await this.provider.connection.send(s)}unregisterProviderListeners(){this.provider.off(Lt.payload,this.onPayloadHandler),this.provider.off(Lt.connect,this.onConnectHandler),this.provider.off(Lt.disconnect,this.onDisconnectHandler),this.provider.off(Lt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await yl();Hw(async s=>{e!==s&&(e=s,s?await this.transportOpen().catch(r=>this.logger.error(r,r==null?void 0:r.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(ci.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&Gw())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(s){this.logger.warn(s,s==null?void 0:s.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Ke.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},j.toMiliseconds(cy)))))}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function x0(){}function $l(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function Rl(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Ul(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const k0="[object RegExp]",$0="[object String]",R0="[object Number]",U0="[object Boolean]",Dl="[object Arguments]",D0="[object Symbol]",L0="[object Date]",B0="[object Map]",M0="[object Set]",j0="[object Array]",q0="[object Function]",F0="[object ArrayBuffer]",Do="[object Object]",z0="[object Error]",W0="[object DataView]",H0="[object Uint8Array]",K0="[object Uint8ClampedArray]",V0="[object Uint16Array]",G0="[object Uint32Array]",J0="[object BigUint64Array]",Y0="[object Int8Array]",Z0="[object Int16Array]",X0="[object Int32Array]",Q0="[object BigInt64Array]",ev="[object Float32Array]",tv="[object Float64Array]";function sv(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function rv(t,e,s){return $i(t,e,void 0,void 0,void 0,void 0,s)}function $i(t,e,s,r,i,n,o){const a=o(t,e,s,r,i,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Fi(t,e,n,o)}return Fi(t,e,n,o)}function Fi(t,e,s,r){if(Object.is(t,e))return!0;let i=Ul(t),n=Ul(e);if(i===Dl&&(i=Do),n===Dl&&(n=Do),i!==n)return!1;switch(i){case $0:return t.toString()===e.toString();case R0:{const c=t.valueOf(),l=e.valueOf();return sv(c,l)}case U0:case L0:case D0:return Object.is(t.valueOf(),e.valueOf());case k0:return t.source===e.source&&t.flags===e.flags;case q0:return t===e}s=s??new Map;const o=s.get(t),a=s.get(e);if(o!=null&&a!=null)return o===e;s.set(t,e),s.set(e,t);try{switch(i){case B0:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!$i(l,e.get(c),c,t,e,s,r))return!1;return!0}case M0:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],d=l.findIndex(f=>$i(h,f,void 0,t,e,s,r));if(d===-1)return!1;l.splice(d,1)}return!0}case j0:case H0:case K0:case V0:case G0:case J0:case Y0:case Z0:case X0:case Q0:case ev:case tv:{if(typeof rt.Buffer<"u"&&rt.Buffer.isBuffer(t)!==rt.Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!$i(t[c],e[c],c,t,e,s,r))return!1;return!0}case F0:return t.byteLength!==e.byteLength?!1:Fi(new Uint8Array(t),new Uint8Array(e),s,r);case W0:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Fi(new Uint8Array(t),new Uint8Array(e),s,r);case z0:return t.name===e.name&&t.message===e.message;case Do:{if(!(Fi(t.constructor,e.constructor,s,r)||$l(t)&&$l(e)))return!1;const c=[...Object.keys(t),...Rl(t)],l=[...Object.keys(e),...Rl(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],d=t[h];if(!Object.hasOwn(e,h))return!1;const f=e[h];if(!$i(d,f,h,t,e,s,r))return!1}return!0}default:return!1}}finally{s.delete(t),s.delete(e)}}function iv(t,e){return rv(t,e,x0)}var nv=Object.defineProperty,Ll=Object.getOwnPropertySymbols,ov=Object.prototype.hasOwnProperty,av=Object.prototype.propertyIsEnumerable,xa=(t,e,s)=>e in t?nv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Bl=(t,e)=>{for(var s in e||(e={}))ov.call(e,s)&&xa(t,s,e[s]);if(Ll)for(var s of Ll(e))av.call(e,s)&&xa(t,s,e[s]);return t},gt=(t,e,s)=>xa(t,typeof e!="symbol"?e+"":e,s);let hr=class extends Kf{constructor(e,s,r,i=ls,n=void 0){super(e,s,r,i),this.core=e,this.logger=s,this.name=r,gt(this,"map",new Map),gt(this,"version",ly),gt(this,"cached",[]),gt(this,"initialized",!1),gt(this,"getKey"),gt(this,"storagePrefix",ls),gt(this,"recentlyDeleted",[]),gt(this,"recentlyDeletedLimit",200),gt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ia(o)?this.map.set(this.getKey(o),o):jw(o)?this.map.set(o.id,o):qw(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),gt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),gt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),gt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>iv(a[c],o[c]))):this.values)),gt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Bl(Bl({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),gt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=ht(s,this.name),this.storagePrefix=i,this.getKey=n}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const s=this.map.get(e);if(!s){if(this.recentlyDeleted.includes(e)){const{message:i}=be("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:r}=be("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return s}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:s}=be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var cv=Object.defineProperty,lv=(t,e,s)=>e in t?cv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ae=(t,e,s)=>lv(t,typeof e!="symbol"?e+"":e,s);let uv=class{constructor(e,s){this.core=e,this.logger=s,ae(this,"name",py),ae(this,"version",fy),ae(this,"events",new ec),ae(this,"pairings"),ae(this,"initialized",!1),ae(this,"storagePrefix",ls),ae(this,"ignoredPayloadTypes",[hi]),ae(this,"registeredMethods",[]),ae(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ae(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),ae(this,"create",async r=>{this.isInitialized();const i=Ea(),n=await this.core.crypto.setSymKey(i),o=Mi(j.FIVE_MINUTES),a={protocol:Jh},c={topic:n,expiry:o,relay:a,active:!1,methods:r==null?void 0:r.methods},l=wl({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:a,expiryTimestamp:o,methods:r==null?void 0:r.methods});return this.events.emit(Js.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:r==null?void 0:r.transportType}),{topic:n,uri:l}}),ae(this,"pair",async r=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:r==null?void 0:r.uri,trace:[is.pairing_started]}});this.isValidPair(r,i);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=ml(r.uri);i.props.properties.topic=n,i.addTrace(is.pairing_uri_validation_success),i.addTrace(is.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(n)){if(u=this.pairings.get(n),i.addTrace(is.existing_pairing),u.active)throw i.setError(ms.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);i.addTrace(is.pairing_not_expired)}const h=c||Mi(j.FIVE_MINUTES),d={topic:n,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(n,h),await this.pairings.set(n,d),i.addTrace(is.store_new_pairing),r.activatePairing&&await this.activate({topic:n}),this.events.emit(Js.create,d),i.addTrace(is.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),i.addTrace(is.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(ms.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(f){throw i.setError(ms.subscribe_pairing_topic_failure),f}return i.addTrace(is.subscribe_pairing_topic_success),d}),ae(this,"activate",async({topic:r})=>{this.isInitialized();const i=Mi(j.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),ae(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=r;if(this.pairings.keys.includes(i)){const n=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=xg();this.events.once(Eo("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),ae(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),ae(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),ae(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ae(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",ki("USER_DISCONNECTED")),await this.deletePairing(i))}),ae(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:i,relay:n,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return wl({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),ae(this,"sendRequest",async(r,i,n)=>{const o=Xs(i,n),a=await this.core.crypto.encode(r,o),c=vi[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),ae(this,"sendResult",async(r,i,n)=>{const o=Yn(r,n),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=vi[c].res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),ae(this,"sendError",async(r,i,n)=>{const o=Qu(r,n),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=vi[c]?vi[c].res:vi.unregistered_method.res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),ae(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,ki("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),ae(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(i=>Wc(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),ae(this,"onRelayEventRequest",async r=>{const{topic:i,payload:n}=r;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,n);default:return await this.onUnknownRpcMethodRequest(i,n)}}),ae(this,"onRelayEventResponse",async r=>{const{topic:i,payload:n}=r,o=(await this.core.history.get(i,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,n);default:return this.onUnknownRpcMethodResponse(o)}}),ae(this,"onPairingPingRequest",async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.events.emit(Js.ping,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),ae(this,"onPairingPingResponse",(r,i)=>{const{id:n}=i;setTimeout(()=>{gs(i)?this.events.emit(Eo("pairing_ping",n),{}):ns(i)&&this.events.emit(Eo("pairing_ping",n),{error:i.error})},500)}),ae(this,"onPairingDeleteRequest",async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(Js.delete,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),ae(this,"onUnknownRpcMethodRequest",async(r,i)=>{const{id:n,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=ki("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,r,a),this.logger.error(a)}catch(a){await this.sendError(n,r,a),this.logger.error(a)}}),ae(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(ki("WC_METHOD_UNSUPPORTED",r))}),ae(this,"isValidPair",(r,i)=>{var n;if(!ko(r)){const{message:a}=be("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(ms.malformed_pairing_uri),new Error(a)}if(!Mw(r.uri)){const{message:a}=be("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(ms.malformed_pairing_uri),new Error(a)}const o=ml(r==null?void 0:r.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=be("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(ms.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=be("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(ms.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&j.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){i.setError(ms.pairing_expired);const{message:a}=be("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ae(this,"isValidPing",async r=>{if(!ko(r)){const{message:n}=be("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidPairingTopic(i)}),ae(this,"isValidDisconnect",async r=>{if(!ko(r)){const{message:n}=be("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidPairingTopic(i)}),ae(this,"isValidPairingTopic",async r=>{if(!Kh(r)){const{message:i}=be("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=be("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Wc(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=be("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=e,this.logger=ht(s,this.name),this.pairings=new hr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return $t(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ke.message,async e=>{const{topic:s,message:r,transportType:i}=e;if(this.pairings.keys.includes(s)&&i!==Oe.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const n=await this.core.crypto.decode(s,r);Xa(n)?(this.core.history.set(s,n),await this.onRelayEventRequest({topic:s,payload:n})):Qa(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:s,payload:n}),this.core.history.delete(s,n.id)),await this.core.relayer.messages.ack(s,r)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(Mt.expired,async e=>{const{topic:s}=Rg(e.target);s&&this.pairings.keys.includes(s)&&(await this.deletePairing(s,!0),this.events.emit(Js.expire,{topic:s}))})}};var hv=Object.defineProperty,dv=(t,e,s)=>e in t?hv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Qe=(t,e,s)=>dv(t,typeof e!="symbol"?e+"":e,s);let pv=class extends Ff{constructor(e,s){super(e,s),this.core=e,this.logger=s,Qe(this,"records",new Map),Qe(this,"events",new lr.EventEmitter),Qe(this,"name",gy),Qe(this,"version",my),Qe(this,"cached",[]),Qe(this,"initialized",!1),Qe(this,"storagePrefix",ls),Qe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Qe(this,"set",(r,i,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:n}),this.records.has(i.id))return;const o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:n,expiry:Mi(j.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Wt.created,o)}),Qe(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=ns(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(Wt.updated,i))}),Qe(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),Qe(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(n=>{if(n.topic===r){if(typeof i<"u"&&n.id!==i)return;this.records.delete(n.id),this.events.emit(Wt.deleted,n)}}),this.persist()}),Qe(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),Qe(this,"on",(r,i)=>{this.events.on(r,i)}),Qe(this,"once",(r,i)=>{this.events.once(r,i)}),Qe(this,"off",(r,i)=>{this.events.off(r,i)}),Qe(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=ht(s,this.name)}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(s=>{if(typeof s.response<"u")return;const r={topic:s.topic,request:Xs(s.request.method,s.request.params,s.id),chainId:s.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const s=this.records.get(e);if(!s){const{message:r}=be("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return s}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Wt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:s}=be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Wt.created,e=>{const s=Wt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(Wt.updated,e=>{const s=Wt.updated;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(Wt.deleted,e=>{const s=Wt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.core.heartbeat.on(ci.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(s=>{j.toMiliseconds(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.records.delete(s.id),this.events.emit(Wt.deleted,s,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var fv=Object.defineProperty,gv=(t,e,s)=>e in t?fv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,st=(t,e,s)=>gv(t,typeof e!="symbol"?e+"":e,s);let mv=class extends Gf{constructor(e,s){super(e,s),this.core=e,this.logger=s,st(this,"expirations",new Map),st(this,"events",new lr.EventEmitter),st(this,"name",wy),st(this,"version",yy),st(this,"cached",[]),st(this,"initialized",!1),st(this,"storagePrefix",ls),st(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),st(this,"has",r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),st(this,"set",(r,i)=>{this.isInitialized();const n=this.formatTarget(r),o={target:n,expiry:i};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(Mt.created,{target:n,expiration:o})}),st(this,"get",r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)}),st(this,"del",r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),n=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Mt.deleted,{target:i,expiration:n})}}),st(this,"on",(r,i)=>{this.events.on(r,i)}),st(this,"once",(r,i)=>{this.events.once(r,i)}),st(this,"off",(r,i)=>{this.events.off(r,i)}),st(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=ht(s,this.name)}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return kg(e);if(typeof e=="number")return $g(e);const{message:s}=be("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(s)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Mt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:s}=be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const s=this.expirations.get(e);if(!s){const{message:r}=be("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return s}checkExpiry(e,s){const{expiry:r}=s;j.toMiliseconds(r)-Date.now()<=0&&this.expire(e,s)}expire(e,s){this.expirations.delete(e),this.events.emit(Mt.expired,{target:e,expiration:s})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,s)=>this.checkExpiry(s,e))}registerEventListeners(){this.core.heartbeat.on(ci.pulse,()=>this.checkExpirations()),this.events.on(Mt.created,e=>{const s=Mt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(Mt.expired,e=>{const s=Mt.expired;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(Mt.deleted,e=>{const s=Mt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var wv=Object.defineProperty,yv=(t,e,s)=>e in t?wv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Le=(t,e,s)=>yv(t,typeof e!="symbol"?e+"":e,s);let bv=class extends Jf{constructor(e,s,r){super(e,s,r),this.core=e,this.logger=s,this.store=r,Le(this,"name",by),Le(this,"abortController"),Le(this,"isDevEnv"),Le(this,"verifyUrlV3",Ey),Le(this,"storagePrefix",ls),Le(this,"version",Gh),Le(this,"publicKey"),Le(this,"fetchPromise"),Le(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&j.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Le(this,"register",async i=>{if(!sn()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=xt.getDocument(),u=this.startAbortTimer(j.ONE_SECOND*5),h=await new Promise((d,f)=>{const g=()=>{window.removeEventListener("message",p),l.body.removeChild(m),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const m=l.createElement("iframe");m.src=c,m.style.display="none",m.addEventListener("error",g,{signal:this.abortController.signal});const p=w=>{if(w.data&&typeof w.data=="string")try{const y=JSON.parse(w.data);if(y.type==="verify_attestation"){if(ia(y.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(m),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",p),d(y.attestation===null?"":y.attestation)}}catch(y){this.logger.warn(y)}};l.body.appendChild(m),window.addEventListener("message",p,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),Le(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=i;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(ia(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(i==null?void 0:i.verifyUrl);return this.fetchAttestation(o,c)}),Le(this,"fetchAttestation",async(i,n)=>{this.logger.debug(`resolving attestation: ${i} from url: ${n}`);const o=this.startAbortTimer(j.ONE_SECOND*5),a=await fetch(`${n}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Le(this,"getVerifyUrl",i=>{let n=i||qi;return Iy.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${qi}`),n=qi),n}),Le(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(j.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await n.json()}catch(i){this.logger.warn(i)}}),Le(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),Le(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Le(this,"isValidJwtAttestation",async i=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(i,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Le(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Le(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),Le(this,"validateAttestation",(i,n)=>{const o=kw(i,n.publicKey),a={hasExpired:j.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=ht(s,this.name),this.abortController=new AbortController,this.isDevEnv=gh(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return $t(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),j.toMiliseconds(e))}};var vv=Object.defineProperty,Ev=(t,e,s)=>e in t?vv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ml=(t,e,s)=>Ev(t,typeof e!="symbol"?e+"":e,s);let Iv=class extends Yf{constructor(e,s){super(e,s),this.projectId=e,this.logger=s,Ml(this,"context",Cy),Ml(this,"registerDeviceToken",async r=>{const{clientId:i,token:n,notificationType:o,enableEncrypted:a=!1}=r,c=`${Ny}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:n,always_raw:a})})}),this.logger=ht(s,this.context)}};var Cv=Object.defineProperty,jl=Object.getOwnPropertySymbols,Nv=Object.prototype.hasOwnProperty,Av=Object.prototype.propertyIsEnumerable,ka=(t,e,s)=>e in t?Cv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ci=(t,e)=>{for(var s in e||(e={}))Nv.call(e,s)&&ka(t,s,e[s]);if(jl)for(var s of jl(e))Av.call(e,s)&&ka(t,s,e[s]);return t},je=(t,e,s)=>ka(t,typeof e!="symbol"?e+"":e,s);class Sv extends Zf{constructor(e,s,r=!0){super(e,s,r),this.core=e,this.logger=s,je(this,"context",Sy),je(this,"storagePrefix",ls),je(this,"storageVersion",Ay),je(this,"events",new Map),je(this,"shouldPersist",!1),je(this,"init",async()=>{if(!gh())try{const i={eventId:Hc(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:ph(this.core.relayer.protocol,this.core.relayer.version,Na)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),je(this,"createEvent",i=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=i,l=Hc(),u=this.core.projectId||"",h=Date.now(),d=Ci({eventId:l,timestamp:h,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),je(this,"getEvent",i=>{const{eventId:n,topic:o}=i;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ci(Ci({},a),this.setMethods(a.eventId))}),je(this,"deleteEvent",i=>{const{eventId:n}=i;this.events.delete(n),this.shouldPersist=!0}),je(this,"setEventListeners",()=>{this.core.heartbeat.on(ci.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{j.fromMiliseconds(Date.now())-j.fromMiliseconds(i.timestamp)>_y&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),je(this,"setMethods",i=>({addTrace:n=>this.addTrace(i,n),setError:n=>this.setError(i,n)})),je(this,"addTrace",(i,n)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(n),this.events.set(i,o),this.shouldPersist=!0)}),je(this,"setError",(i,n)=>{const o=this.events.get(i);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),je(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),je(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(n=>{this.events.set(n.eventId,Ci(Ci({},n),this.setMethods(n.eventId)))})}catch(i){this.logger.warn(i)}}),je(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[n,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const n of i)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),je(this,"sendEvent",async i=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Py}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Na}${n}`,{method:"POST",body:JSON.stringify(i)})}),je(this,"getAppDomain",()=>_g().url),this.logger=ht(s,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var _v=Object.defineProperty,ql=Object.getOwnPropertySymbols,Pv=Object.prototype.hasOwnProperty,Tv=Object.prototype.propertyIsEnumerable,$a=(t,e,s)=>e in t?_v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Fl=(t,e)=>{for(var s in e||(e={}))Pv.call(e,s)&&$a(t,s,e[s]);if(ql)for(var s of ql(e))Tv.call(e,s)&&$a(t,s,e[s]);return t},Te=(t,e,s)=>$a(t,typeof e!="symbol"?e+"":e,s);let Ov=class cd extends Bf{constructor(e){var s;super(e),Te(this,"protocol",Vh),Te(this,"version",Gh),Te(this,"name",Ca),Te(this,"relayUrl"),Te(this,"projectId"),Te(this,"customStoragePrefix"),Te(this,"events",new lr.EventEmitter),Te(this,"logger"),Te(this,"heartbeat"),Te(this,"relayer"),Te(this,"crypto"),Te(this,"storage"),Te(this,"history"),Te(this,"expirer"),Te(this,"pairing"),Te(this,"verify"),Te(this,"echoClient"),Te(this,"linkModeSupportedApps"),Te(this,"eventClient"),Te(this,"initialized",!1),Te(this,"logChunkController"),Te(this,"on",(a,c)=>this.events.on(a,c)),Te(this,"once",(a,c)=>this.events.once(a,c)),Te(this,"off",(a,c)=>this.events.off(a,c)),Te(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Te(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:Oe.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const r=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Yh,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=en({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:Yw.logger,name:Ca}),{logger:n,chunkLoggerController:o}=Xu({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(s=this.logChunkController)!=null&&s.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=ht(n,this.name),this.heartbeat=new yp,this.crypto=new r0(this,this.logger,e==null?void 0:e.keychain),this.history=new pv(this,this.logger),this.expirer=new mv(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Uf(Fl(Fl({},Zw),e==null?void 0:e.storageOptions)),this.relayer=new O0({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new uv(this,this.logger),this.verify=new bv(this,this.logger,this.storage),this.echoClient=new Iv(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Sv(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const s=new cd(e);await s.initialize();const r=await s.crypto.getClientId();return await s.storage.setItem(uy,r),s}get context(){return $t(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(El,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(El)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const s=`_walletConnectCore_${e}`,r=`${s}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[s]}catch(s){console.warn("Failed to get global WalletConnect core",s);return}}setGlobalCore(e){var s;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((s=e.opts)==null?void 0:s.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof as<"u"&&Jw.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const xv=Ov,zi={getSIWX(){return B.state.siwx},async initializeIfEnabled(){var n;const t=B.state.siwx,e=b.getActiveCaipAddress();if(!(t&&e))return;const[s,r,i]=e.split(":");if(b.checkIfSupportedNetwork(s))try{if((await t.getSessions(`${s}:${r}`,i)).length)return;await Ve.open({view:"SIWXSignMessage"})}catch(o){console.error("SIWXUtil:initializeIfEnabled",o),Re.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties()}),await((n=ee._getClient())==null?void 0:n.disconnect().catch(console.error)),ne.reset("Connect"),Zt.showError("A problem occurred while trying initialize authentication")}},async requestSignMessage(){const t=B.state.siwx,e=te.getPlainAddress(b.getActiveCaipAddress()),s=b.getActiveCaipNetwork(),r=ee._getClient();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!s)throw new Error("No ActiveCaipNetwork or client found");if(!r)throw new Error("No ConnectionController client found");try{const i=await t.createMessage({chainId:s.caipNetworkId,accountAddress:e}),n=i.toString();W.getConnectorId(s.chainNamespace)===V.CONNECTOR_ID.AUTH&&ne.pushTransactionStack({});const a=await r.signMessage(n);await t.addSession({data:i,message:n,signature:a}),Ve.close(),Re.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(i){const n=this.getSIWXEventProperties();(!Ve.state.open||ne.state.view==="ApproveTransaction")&&await Ve.open({view:"SIWXSignMessage"}),n.isSmartAccount?Zt.showError("This application might not support Smart Accounts"):Zt.showError("Signature declined"),Re.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:n}),console.error("SWIXUtil:requestSignMessage",i)}},async cancelSignMessage(){var t;try{const e=this.getSIWX();((t=e==null?void 0:e.getRequired)==null?void 0:t.call(e))?await ee.disconnect():Ve.close(),ne.reset("Connect"),Re.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(e){console.error("SIWXUtil:cancelSignMessage",e)}},async getSessions(){const t=B.state.siwx,e=te.getPlainAddress(b.getActiveCaipAddress()),s=b.getActiveCaipNetwork();return t&&e&&s?t.getSessions(s.caipNetworkId,e):[]},async isSIWXCloseDisabled(){var e;const t=this.getSIWX();if(t){const s=ne.state.view==="ApproveTransaction",r=ne.state.view==="SIWXSignMessage";if(s||r)return((e=t.getRequired)==null?void 0:e.call(t))&&(await this.getSessions()).length===0}return!1},async universalProviderAuthenticate({universalProvider:t,chains:e,methods:s}){var a,c,l;const r=zi.getSIWX(),i=new Set(e.map(u=>u.split(":")[0]));if(!r||i.size!==1||!i.has("eip155"))return!1;const n=await r.createMessage({chainId:((a=b.getActiveCaipNetwork())==null?void 0:a.caipNetworkId)||"",accountAddress:""}),o=await t.authenticate({nonce:n.nonce,domain:n.domain,uri:n.uri,exp:n.expirationTime,iat:n.issuedAt,nbf:n.notBefore,requestId:n.requestId,version:n.version,resources:n.resources,statement:n.statement,chainId:n.chainId,methods:s,chains:[n.chainId,...e.filter(u=>u!==n.chainId)]});if(Zt.showLoading("Authenticating...",{autoClose:!1}),K.setConnectedWalletInfo({...o.session.peer.metadata,name:o.session.peer.metadata.name,icon:(c=o.session.peer.metadata.icons)==null?void 0:c[0],type:"WALLET_CONNECT"},Array.from(i)[0]),(l=o==null?void 0:o.auths)!=null&&l.length){const u=o.auths.map(h=>{const d=t.client.formatAuthMessage({request:h.p,iss:h.p.iss});return{data:{...h.p,accountAddress:h.p.iss.split(":").slice(-1).join(""),chainId:h.p.iss.split(":").slice(2,4).join(":"),uri:h.p.aud,version:h.p.version||n.version,expirationTime:h.p.exp,issuedAt:h.p.iat,notBefore:h.p.nbf},message:d,signature:h.s.s,cacao:h}});try{await r.setSessions(u),Re.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:zi.getSIWXEventProperties()})}catch(h){throw console.error("SIWX:universalProviderAuth - failed to set sessions",h),Re.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:zi.getSIWXEventProperties()}),await t.disconnect().catch(console.error),h}finally{Zt.hide()}}return!0},getSIWXEventProperties(){var e,s;const t=b.state.activeChain;return{network:((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)||"",isSmartAccount:((s=K.state.preferredAccountTypes)==null?void 0:s[t])===Ui.ACCOUNT_TYPES.SMART_ACCOUNT}},async clearSessions(){const t=this.getSIWX();t&&await t.setSessions([])}};var kv=Object.defineProperty,$v=(t,e,s)=>e in t?kv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,zl=(t,e,s)=>$v(t,typeof e!="symbol"?e+"":e,s);let Rv=class{constructor(e){this.opts=e,zl(this,"protocol","wc"),zl(this,"version",2)}},Uv=class{constructor(e){this.client=e}};function Yi(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function Wl(t){return Yi(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const ld="2.23.2";let Ni={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:s})=>e?`${t??"https://viem.sh"}${e}${s?`#${s}`:""}`:void 0,version:`viem@${ld}`};class or extends Error{constructor(e,s={}){var a;const r=(()=>{var c;return s.cause instanceof or?s.cause.details:(c=s.cause)!=null&&c.message?s.cause.message:s.details})(),i=s.cause instanceof or&&s.cause.docsPath||s.docsPath,n=(a=Ni.getDocsUrl)==null?void 0:a.call(Ni,{...s,docsPath:i}),o=[e||"An error occurred.","",...s.metaMessages?[...s.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...r?[`Details: ${r}`]:[],...Ni.version?[`Version: ${Ni.version}`]:[]].join(`
`);super(o,s.cause?{cause:s.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=i,this.metaMessages=s.metaMessages,this.name=s.name??this.name,this.shortMessage=e,this.version=ld}walk(e){return ud(this,e)}}function ud(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?ud(t.cause,e):e?null:t}class hd extends or{constructor({size:e,targetSize:s,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${s}).`,{name:"SizeExceedsPaddingSizeError"})}}function di(t,{dir:e,size:s=32}={}){return typeof t=="string"?Dv(t,{dir:e,size:s}):Lv(t,{dir:e,size:s})}function Dv(t,{dir:e,size:s=32}={}){if(s===null)return t;const r=t.replace("0x","");if(r.length>s*2)throw new hd({size:Math.ceil(r.length/2),targetSize:s,type:"hex"});return`0x${r[e==="right"?"padEnd":"padStart"](s*2,"0")}`}function Lv(t,{dir:e,size:s=32}={}){if(s===null)return t;if(t.length>s)throw new hd({size:t.length,targetSize:s,type:"bytes"});const r=new Uint8Array(s);for(let i=0;i<s;i++){const n=e==="right";r[n?i:s-i-1]=t[n?i:t.length-i-1]}return r}class Bv extends or{constructor({max:e,min:s,signed:r,size:i,value:n}){super(`Number "${n}" is not in safe ${i?`${i*8}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${s} to ${e})`:`(above ${s})`}`,{name:"IntegerOutOfRangeError"})}}class Mv extends or{constructor({givenSize:e,maxSize:s}){super(`Size cannot exceed ${s} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function pi(t,{size:e}){if(Wl(t)>e)throw new Mv({givenSize:Wl(t),maxSize:e})}function Ra(t,e={}){const{signed:s}=e;e.size&&pi(t,{size:e.size});const r=BigInt(t);if(!s)return r;const i=(t.length-2)/2,n=(1n<<BigInt(i)*8n-1n)-1n;return r<=n?r:r-BigInt(`0x${"f".padStart(i*2,"f")}`)-1n}function jv(t,e={}){return Number(Ra(t,e))}const qv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ua(t,e={}){return typeof t=="number"||typeof t=="bigint"?pd(t,e):typeof t=="string"?Wv(t,e):typeof t=="boolean"?Fv(t,e):dd(t,e)}function Fv(t,e={}){const s=`0x${Number(t)}`;return typeof e.size=="number"?(pi(s,{size:e.size}),di(s,{size:e.size})):s}function dd(t,e={}){let s="";for(let i=0;i<t.length;i++)s+=qv[t[i]];const r=`0x${s}`;return typeof e.size=="number"?(pi(r,{size:e.size}),di(r,{dir:"right",size:e.size})):r}function pd(t,e={}){const{signed:s,size:r}=e,i=BigInt(t);let n;r?s?n=(1n<<BigInt(r)*8n-1n)-1n:n=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&s?-n-1n:0;if(n&&i>n||i<o){const c=typeof t=="bigint"?"n":"";throw new Bv({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:s,size:r,value:`${t}${c}`})}const a=`0x${(s&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?di(a,{size:r}):a}const zv=new TextEncoder;function Wv(t,e={}){const s=zv.encode(t);return dd(s,e)}const Hv=new TextEncoder;function Kv(t,e={}){return typeof t=="number"||typeof t=="bigint"?Gv(t,e):typeof t=="boolean"?Vv(t,e):Yi(t)?fd(t,e):gd(t,e)}function Vv(t,e={}){const s=new Uint8Array(1);return s[0]=Number(t),typeof e.size=="number"?(pi(s,{size:e.size}),di(s,{size:e.size})):s}const ps={zero:48,nine:57,A:65,F:70,a:97,f:102};function Hl(t){if(t>=ps.zero&&t<=ps.nine)return t-ps.zero;if(t>=ps.A&&t<=ps.F)return t-(ps.A-10);if(t>=ps.a&&t<=ps.f)return t-(ps.a-10)}function fd(t,e={}){let s=t;e.size&&(pi(s,{size:e.size}),s=di(s,{dir:"right",size:e.size}));let r=s.slice(2);r.length%2&&(r=`0${r}`);const i=r.length/2,n=new Uint8Array(i);for(let o=0,a=0;o<i;o++){const c=Hl(r.charCodeAt(a++)),l=Hl(r.charCodeAt(a++));if(c===void 0||l===void 0)throw new or(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);n[o]=c*16+l}return n}function Gv(t,e){const s=pd(t,e);return fd(s)}function gd(t,e={}){const s=Hv.encode(t);return typeof e.size=="number"?(pi(s,{size:e.size}),di(s,{dir:"right",size:e.size})):s}function md(t,e){const s=e||"hex",r=vg(Yi(t,{strict:!1})?Kv(t):t);return s==="bytes"?r:Ua(r)}class Jv extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const s=super.get(e);return super.has(e)&&s!==void 0&&(this.delete(e),super.set(e,s)),s}set(e,s){if(super.set(e,s),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const Lo=new Jv(8192);function Yv(t,e){if(Lo.has(`${t}.${e}`))return Lo.get(`${t}.${e}`);const s=t.substring(2).toLowerCase(),r=md(gd(s),"bytes"),i=s.split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&i[o]&&(i[o]=i[o].toUpperCase()),(r[o>>1]&15)>=8&&i[o+1]&&(i[o+1]=i[o+1].toUpperCase());const n=`0x${i.join("")}`;return Lo.set(`${t}.${e}`,n),n}function Zv(t){const e=md(`0x${t.substring(4)}`).substring(26);return Yv(`0x${e}`)}async function Xv({hash:t,signature:e}){const s=Yi(t)?t:Ua(t),{secp256k1:r}=await na(async()=>{const{secp256k1:o}=await import("./secp256k1-CSHNl68v.js");return{secp256k1:o}},__vite__mapDeps([0,1,2]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:u,v:h,yParity:d}=e,f=Number(d??h),g=Kl(f);return new r.Signature(Ra(l),Ra(u)).addRecoveryBit(g)}const o=Yi(e)?e:Ua(e),a=jv(`0x${o.slice(130)}`),c=Kl(a);return r.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(s.substring(2)).toHex(!1)}`}function Kl(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function Qv({hash:t,signature:e}){return Zv(await Xv({hash:t,signature:e}))}var eE={};const tE=":";function Hr(t){const[e,s]=t.split(tE);return{namespace:e,reference:s}}function wd(t,e){return t.includes(":")?[t]:e.chains||[]}var sE=Object.defineProperty,rE=Object.defineProperties,iE=Object.getOwnPropertyDescriptors,Vl=Object.getOwnPropertySymbols,nE=Object.prototype.hasOwnProperty,oE=Object.prototype.propertyIsEnumerable,Gl=(t,e,s)=>e in t?sE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Jl=(t,e)=>{for(var s in e||(e={}))nE.call(e,s)&&Gl(t,s,e[s]);if(Vl)for(var s of Vl(e))oE.call(e,s)&&Gl(t,s,e[s]);return t},aE=(t,e)=>rE(t,iE(e));const cE="ReactNative",jr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function yd(){return typeof as<"u"&&typeof as.versions<"u"&&typeof as.versions.node<"u"}function bd(){return!xt.getDocument()&&!!xt.getNavigator()&&navigator.product===cE}function vd(){return!yd()&&!!xt.getNavigator()&&!!xt.getDocument()}function lE(){return bd()?jr.reactNative:yd()?jr.node:vd()?jr.browser:jr.unknown}function uE(t){var e,s;const r=hE();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),aE(Jl(Jl({},r),t),{url:(t==null?void 0:t.url)||r.url,name:(t==null?void 0:t.name)||r.name,description:(t==null?void 0:t.description)||r.description,icons:(s=t==null?void 0:t.icons)!=null&&s.length&&t.icons.length>0?t.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),t||r}}function hE(){return Zu.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Qs(t,e){return t.filter(s=>e.includes(s)).length===t.length}function yr(t=j.FIVE_MINUTES,e){const s=j.toMiliseconds(t||j.FIVE_MINUTES);let r,i,n,o;return{resolve:a=>{n&&r&&(clearTimeout(n),r(a),o=Promise.resolve(a))},reject:a=>{n&&i&&(clearTimeout(n),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},s),r=a,i=c})}}function dE(t){const[e,s]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof s=="string")r.topic=s;else if(e==="id"&&Number.isInteger(Number(s)))r.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${s}`);return r}function mt(t,e){return j.fromMiliseconds(Date.now()+j.toMiliseconds(t))}function br(t){return Date.now()>=j.toMiliseconds(t)}function Ae(t,e){return`${t}${e?`:${e}`:""}`}function cs(t=[],e=[]){return[...new Set([...t,...e])]}async function pE({id:t,topic:e,wcDeepLink:s}){var r;try{if(!s)return;const i=typeof s=="string"?JSON.parse(s):s,n=i==null?void 0:i.href;if(typeof n!="string")return;const o=fE(n,t,e),a=lE();if(a===jr.browser){if(!((r=xt.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}gE(o)}else a===jr.reactNative&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"&&await globalThis.Linking.openURL(o)}catch(i){console.error(i)}}function fE(t,e,s){const r=`requestId=${e}&sessionTopic=${s}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${n}${vE(r,!0)}`}else i=`${i}/wc?${r}`;return i}function gE(t){let e="_self";bE()?e="_top":(yE()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function mE(t,e){let s="";try{if(vd()&&(s=localStorage.getItem(e),s))return s;s=await t.getItem(e)}catch(r){console.error(r)}return s}function Yl(t,e){if(!t.includes(e))return null;const s=t.split(/([&,?,=])/),r=s.indexOf(e);return s[r+2]}function wE(){return typeof as<"u"&&eE.IS_VITEST==="true"}function yE(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function bE(){try{return window.self!==window.top}catch{return!1}}function vE(t,e=!1){const s=rt.Buffer.from(t).toString("base64");return e?s.replace(/[=]/g,""):s}function Hn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function EE(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ln(t,...e){if(!EE(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function IE(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Hn(t.outputLen),Hn(t.blockLen)}function ti(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ed(t,e){ln(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}const En=BigInt(2**32-1),Zl=BigInt(32);function CE(t,e=!1){return e?{h:Number(t&En),l:Number(t>>Zl&En)}:{h:Number(t>>Zl&En)|0,l:Number(t&En)|0}}function NE(t,e=!1){let s=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:n,l:o}=CE(t[i],e);[s[i],r[i]]=[n,o]}return[s,r]}const AE=(t,e,s)=>t<<s|e>>>32-s,SE=(t,e,s)=>e<<s|t>>>32-s,_E=(t,e,s)=>e<<s-32|t>>>64-s,PE=(t,e,s)=>t<<s-32|e>>>64-s,vr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function TE(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Bo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ss(t,e){return t<<32-e|t>>>e}const Xl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function OE(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Ql(t){for(let e=0;e<t.length;e++)t[e]=OE(t[e])}function xE(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function oo(t){return typeof t=="string"&&(t=xE(t)),ln(t),t}function kE(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];ln(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}let cc=class{clone(){return this._cloneInto()}};function Id(t){const e=r=>t().update(oo(r)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function Cd(t=32){if(vr&&typeof vr.getRandomValues=="function")return vr.getRandomValues(new Uint8Array(t));if(vr&&typeof vr.randomBytes=="function")return vr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Nd=[],Ad=[],Sd=[],$E=BigInt(0),Ai=BigInt(1),RE=BigInt(2),UE=BigInt(7),DE=BigInt(256),LE=BigInt(113);for(let t=0,e=Ai,s=1,r=0;t<24;t++){[s,r]=[r,(2*s+3*r)%5],Nd.push(2*(5*r+s)),Ad.push((t+1)*(t+2)/2%64);let i=$E;for(let n=0;n<7;n++)e=(e<<Ai^(e>>UE)*LE)%DE,e&RE&&(i^=Ai<<(Ai<<BigInt(n))-Ai);Sd.push(i)}const[BE,ME]=NE(Sd,!0),eu=(t,e,s)=>s>32?_E(t,e,s):AE(t,e,s),tu=(t,e,s)=>s>32?PE(t,e,s):SE(t,e,s);function jE(t,e=24){const s=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=s[c],u=s[c+1],h=eu(l,u,1)^s[a],d=tu(l,u,1)^s[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],n=t[3];for(let o=0;o<24;o++){const a=Ad[o],c=eu(i,n,a),l=tu(i,n,a),u=Nd[o];i=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=BE[r],t[1]^=ME[r]}s.fill(0)}class lc extends cc{constructor(e,s,r,i=!1,n=24){if(super(),this.blockLen=e,this.suffix=s,this.outputLen=r,this.enableXOF=i,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Hn(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=TE(this.state)}keccak(){Xl||Ql(this.state32),jE(this.state32,this.rounds),Xl||Ql(this.state32),this.posOut=0,this.pos=0}update(e){ti(this);const{blockLen:s,state:r}=this;e=oo(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(s-this.pos,i-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:r,blockLen:i}=this;e[r]^=s,(s&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){ti(this,!1),ln(e),this.finish();const s=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-i);e.set(s.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Hn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ed(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:s,suffix:r,outputLen:i,rounds:n,enableXOF:o}=this;return e||(e=new lc(s,r,i,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const qE=(t,e,s)=>Id(()=>new lc(e,t,s)),FE=qE(1,136,256/8),zE="https://rpc.walletconnect.org/v1";function _d(t){const e=`Ethereum Signed Message:
${t.length}`,s=new TextEncoder().encode(e+t);return"0x"+rt.Buffer.from(FE(s)).toString("hex")}async function WE(t,e,s,r,i,n){switch(s.t){case"eip191":return await HE(t,e,s.s);case"eip1271":return await KE(t,e,s.s,r,i,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${s.t}`)}}async function HE(t,e,s){return(await Qv({hash:_d(e),signature:s})).toLowerCase()===t.toLowerCase()}async function KE(t,e,s,r,i,n){const o=Hr(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l="0000000000000000000000000000000000000000000000000000000000000041",u=s.substring(2),h=_d(e).substring(2),d=a+h+c+l+u,f=await fetch(`${n||zE}/?chainId=${r}&projectId=${i}`,{method:"POST",body:JSON.stringify({id:VE(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:g}=await f.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function VE(){return Date.now()+Math.floor(Math.random()*1e3)}function GE(t){const e=atob(t),s=new Uint8Array(e.length);for(let o=0;o<e.length;o++)s[o]=e.charCodeAt(o);const r=s[0];if(r===0)throw new Error("No signatures found");const i=1+r*64;if(s.length<i)throw new Error("Transaction data too short for claimed signature count");if(s.length<100)throw new Error("Transaction too short");const n=rt.Buffer.from(t,"base64").slice(1,65);return eh.encode(n)}var JE=Object.defineProperty,YE=Object.defineProperties,ZE=Object.getOwnPropertyDescriptors,su=Object.getOwnPropertySymbols,XE=Object.prototype.hasOwnProperty,QE=Object.prototype.propertyIsEnumerable,ru=(t,e,s)=>e in t?JE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,e1=(t,e)=>{for(var s in e||(e={}))XE.call(e,s)&&ru(t,s,e[s]);if(su)for(var s of su(e))QE.call(e,s)&&ru(t,s,e[s]);return t},t1=(t,e)=>YE(t,ZE(e));const s1="did:pkh:",uc=t=>t==null?void 0:t.split(":"),r1=t=>{const e=t&&uc(t);if(e)return t.includes(s1)?e[3]:e[1]},Da=t=>{const e=t&&uc(t);if(e)return e[2]+":"+e[3]},Kn=t=>{const e=t&&uc(t);if(e)return e.pop()};async function iu(t){const{cacao:e,projectId:s}=t,{s:r,p:i}=e,n=Pd(i,i.iss),o=Kn(i.iss);return await WE(o,n,r,Da(i.iss),s)}const Pd=(t,e)=>{const s=`${t.domain} wants you to sign in with your Ethereum account:`,r=Kn(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${r1(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,f=t.resources?`Resources:${t.resources.map(m=>`
- ${m}`).join("")}`:void 0,g=Dn(t.resources);if(g){const m=Zi(g);i=d1(i,m)}return[s,r,"",i,"",n,o,a,c,l,u,h,d,f].filter(m=>m!=null).join(`
`)};function i1(t){return rt.Buffer.from(JSON.stringify(t)).toString("base64")}function n1(t){return JSON.parse(rt.Buffer.from(t,"base64").toString("utf-8"))}function ar(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(s=>{const r=t.att[s];if(Array.isArray(r))throw new Error(`Resource must be an object: ${s}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${s}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${s}`);Object.keys(r).forEach(i=>{const n=r[i];if(!Array.isArray(n))throw new Error(`Ability limits ${i} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function o1(t,e,s,r={}){return s==null||s.sort((i,n)=>i.localeCompare(n)),{att:{[t]:a1(e,s,r)}}}function a1(t,e,s={}){e=e==null?void 0:e.sort((i,n)=>i.localeCompare(n));const r=e.map(i=>({[`${t}/${i}`]:[s]}));return Object.assign({},...r)}function Td(t){return ar(t),`urn:recap:${i1(t).replace(/=/g,"")}`}function Zi(t){const e=n1(t.replace("urn:recap:",""));return ar(e),e}function c1(t,e,s){const r=o1(t,e,s);return Td(r)}function l1(t){return t&&t.includes("urn:recap:")}function u1(t,e){const s=Zi(t),r=Zi(e),i=h1(s,r);return Td(i)}function h1(t,e){ar(t),ar(e);const s=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,n)=>i.localeCompare(n)),r={att:{}};return s.forEach(i=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;r.att[i]=t1(e1({},r.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((l=e.att[i])==null?void 0:l[a])})})}),r}function d1(t="",e){ar(e);const s="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(s))return t;const r=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(i++,`(${i}) '${h}': '${l[h].join("', '")}' for '${a}'.`));r.push(u.join(", ").replace(".,","."))});const n=r.join(" "),o=`${s}${n}`;return`${t?t+" ":""}${o}`}function nu(t){var e;const s=Zi(t);ar(s);const r=(e=s.att)==null?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function ou(t){const e=Zi(t);ar(e);const s=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var n;(n=i==null?void 0:i[0])!=null&&n.chains&&s.push(i[0].chains)})}),[...new Set(s.flat())]}function Dn(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return l1(e)?e:void 0}function Mo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Od(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ot(t,...e){if(!Od(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function au(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function p1(t,e){Ot(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function cu(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const Ls=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),f1=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),g1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!g1)throw new Error("Non little-endian hardware is not supported");function m1(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function La(t){if(typeof t=="string")t=m1(t);else if(Od(t))t=Ba(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function w1(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function y1(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t[r]^e[r];return s===0}const b1=(t,e)=>{function s(r,...i){if(Ot(r),t.nonceLength!==void 0){const l=i[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Ot(l):Ot(l,t.nonceLength)}const n=t.tagLength;n&&i[1]!==void 0&&Ot(i[1]);const o=e(r,...i),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Ot(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ot(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Ot(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(s,t),s};function lu(t,e,s=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(s&&!v1(e))throw new Error("invalid output, must be aligned");return e}function uu(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(s>>i&n),a=Number(s&n);t.setUint32(e+4,o,r),t.setUint32(e+0,a,r)}function v1(t){return t.byteOffset%4===0}function Ba(t){return Uint8Array.from(t)}function si(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const xd=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),E1=xd("expand 16-byte k"),I1=xd("expand 32-byte k"),C1=Ls(E1),N1=Ls(I1);function me(t,e){return t<<e|t>>>32-e}function Ma(t){return t.byteOffset%4===0}const In=64,A1=16,kd=2**32-1,hu=new Uint32Array;function S1(t,e,s,r,i,n,o,a){const c=i.length,l=new Uint8Array(In),u=Ls(l),h=Ma(i)&&Ma(n),d=h?Ls(i):hu,f=h?Ls(n):hu;for(let g=0;g<c;o++){if(t(e,s,r,u,o,a),o>=kd)throw new Error("arx: counter overflow");const m=Math.min(In,c-g);if(h&&m===In){const p=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let w=0,y;w<A1;w++)y=p+w,f[y]=d[y]^u[w];g+=In;continue}for(let p=0,w;p<m;p++)w=g+p,n[w]=i[w]^l[p];g+=m}}function _1(t,e){const{allowShortKeys:s,extendNonceFn:r,counterLength:i,counterRight:n,rounds:o}=w1({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Mo(i),Mo(o),cu(n),cu(s),(a,c,l,u,h=0)=>{Ot(a),Ot(c),Ot(l);const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),Ot(u),Mo(h),h<0||h>=kd)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const f=[];let g=a.length,m,p;if(g===32)f.push(m=Ba(a)),p=N1;else if(g===16&&s)m=new Uint8Array(32),m.set(a),m.set(a,16),p=C1,f.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Ma(c)||f.push(c=Ba(c));const w=Ls(m);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(p,w,Ls(c.subarray(0,16)),w),c=c.subarray(16)}const y=16-i;if(y!==c.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const T=new Uint8Array(12);T.set(c,n?0:12-c.length),c=T,f.push(c)}const I=Ls(c);return S1(t,p,w,I,l,u,h,o),si(...f),u}}const et=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class P1{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=La(e),Ot(e,32);const s=et(e,0),r=et(e,2),i=et(e,4),n=et(e,6),o=et(e,8),a=et(e,10),c=et(e,12),l=et(e,14);this.r[0]=s&8191,this.r[1]=(s>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=et(e,16+2*u)}process(e,s,r=!1){const i=r?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],f=o[6],g=o[7],m=o[8],p=o[9],w=et(e,s+0),y=et(e,s+2),I=et(e,s+4),T=et(e,s+6),$=et(e,s+8),P=et(e,s+10),_=et(e,s+12),O=et(e,s+14);let v=n[0]+(w&8191),x=n[1]+((w>>>13|y<<3)&8191),S=n[2]+((y>>>10|I<<6)&8191),R=n[3]+((I>>>7|T<<9)&8191),L=n[4]+((T>>>4|$<<12)&8191),E=n[5]+($>>>1&8191),N=n[6]+(($>>>14|P<<2)&8191),C=n[7]+((P>>>11|_<<5)&8191),k=n[8]+((_>>>8|O<<8)&8191),U=n[9]+(O>>>5|i),A=0,M=A+v*a+x*(5*p)+S*(5*m)+R*(5*g)+L*(5*f);A=M>>>13,M&=8191,M+=E*(5*d)+N*(5*h)+C*(5*u)+k*(5*l)+U*(5*c),A+=M>>>13,M&=8191;let q=A+v*c+x*a+S*(5*p)+R*(5*m)+L*(5*g);A=q>>>13,q&=8191,q+=E*(5*f)+N*(5*d)+C*(5*h)+k*(5*u)+U*(5*l),A+=q>>>13,q&=8191;let F=A+v*l+x*c+S*a+R*(5*p)+L*(5*m);A=F>>>13,F&=8191,F+=E*(5*g)+N*(5*f)+C*(5*d)+k*(5*h)+U*(5*u),A+=F>>>13,F&=8191;let X=A+v*u+x*l+S*c+R*a+L*(5*p);A=X>>>13,X&=8191,X+=E*(5*m)+N*(5*g)+C*(5*f)+k*(5*d)+U*(5*h),A+=X>>>13,X&=8191;let G=A+v*h+x*u+S*l+R*c+L*a;A=G>>>13,G&=8191,G+=E*(5*p)+N*(5*m)+C*(5*g)+k*(5*f)+U*(5*d),A+=G>>>13,G&=8191;let oe=A+v*d+x*h+S*u+R*l+L*c;A=oe>>>13,oe&=8191,oe+=E*a+N*(5*p)+C*(5*m)+k*(5*g)+U*(5*f),A+=oe>>>13,oe&=8191;let le=A+v*f+x*d+S*h+R*u+L*l;A=le>>>13,le&=8191,le+=E*c+N*a+C*(5*p)+k*(5*m)+U*(5*g),A+=le>>>13,le&=8191;let Ie=A+v*g+x*f+S*d+R*h+L*u;A=Ie>>>13,Ie&=8191,Ie+=E*l+N*c+C*a+k*(5*p)+U*(5*m),A+=Ie>>>13,Ie&=8191;let ue=A+v*m+x*g+S*f+R*d+L*h;A=ue>>>13,ue&=8191,ue+=E*u+N*l+C*c+k*a+U*(5*p),A+=ue>>>13,ue&=8191;let he=A+v*p+x*m+S*g+R*f+L*d;A=he>>>13,he&=8191,he+=E*h+N*u+C*l+k*c+U*a,A+=he>>>13,he&=8191,A=(A<<2)+A|0,A=A+M|0,M=A&8191,A=A>>>13,q+=A,n[0]=M,n[1]=q,n[2]=F,n[3]=X,n[4]=G,n[5]=oe,n[6]=le,n[7]=Ie,n[8]=ue,n[9]=he}finalize(){const{h:e,pad:s}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let n=(i^1)-1;for(let a=0;a<10;a++)r[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+s[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+s[a]|0)+(o>>>16)|0,e[a]=o&65535;si(r)}update(e){au(this);const{buffer:s,blockLen:r}=this;e=La(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(r-this.pos,i-n);if(o===r){for(;r<=i-n;n+=r)this.process(e,n);continue}s.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(s,0,!1),this.pos=0)}return this}destroy(){si(this.h,this.r,this.buffer,this.pad)}digestInto(e){au(this),p1(e,this),this.finished=!0;const{buffer:s,h:r}=this;let{pos:i}=this;if(i){for(s[i++]=1;i<16;i++)s[i]=0;this.process(s,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=r[o]>>>0,e[n++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const r=e.slice(0,s);return this.destroy(),r}}function T1(t){const e=(r,i)=>t(i).update(La(r)).digest(),s=t(new Uint8Array(32));return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=r=>t(r),e}const O1=T1(t=>new P1(t));function x1(t,e,s,r,i,n=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],f=e[3],g=e[4],m=e[5],p=e[6],w=e[7],y=i,I=s[0],T=s[1],$=s[2],P=o,_=a,O=c,v=l,x=u,S=h,R=d,L=f,E=g,N=m,C=p,k=w,U=y,A=I,M=T,q=$;for(let X=0;X<n;X+=2)P=P+x|0,U=me(U^P,16),E=E+U|0,x=me(x^E,12),P=P+x|0,U=me(U^P,8),E=E+U|0,x=me(x^E,7),_=_+S|0,A=me(A^_,16),N=N+A|0,S=me(S^N,12),_=_+S|0,A=me(A^_,8),N=N+A|0,S=me(S^N,7),O=O+R|0,M=me(M^O,16),C=C+M|0,R=me(R^C,12),O=O+R|0,M=me(M^O,8),C=C+M|0,R=me(R^C,7),v=v+L|0,q=me(q^v,16),k=k+q|0,L=me(L^k,12),v=v+L|0,q=me(q^v,8),k=k+q|0,L=me(L^k,7),P=P+S|0,q=me(q^P,16),C=C+q|0,S=me(S^C,12),P=P+S|0,q=me(q^P,8),C=C+q|0,S=me(S^C,7),_=_+R|0,U=me(U^_,16),k=k+U|0,R=me(R^k,12),_=_+R|0,U=me(U^_,8),k=k+U|0,R=me(R^k,7),O=O+L|0,A=me(A^O,16),E=E+A|0,L=me(L^E,12),O=O+L|0,A=me(A^O,8),E=E+A|0,L=me(L^E,7),v=v+x|0,M=me(M^v,16),N=N+M|0,x=me(x^N,12),v=v+x|0,M=me(M^v,8),N=N+M|0,x=me(x^N,7);let F=0;r[F++]=o+P|0,r[F++]=a+_|0,r[F++]=c+O|0,r[F++]=l+v|0,r[F++]=u+x|0,r[F++]=h+S|0,r[F++]=d+R|0,r[F++]=f+L|0,r[F++]=g+E|0,r[F++]=m+N|0,r[F++]=p+C|0,r[F++]=w+k|0,r[F++]=y+U|0,r[F++]=I+A|0,r[F++]=T+M|0,r[F++]=$+q|0}const k1=_1(x1,{counterRight:!1,counterLength:4,allowShortKeys:!1}),$1=new Uint8Array(16),du=(t,e)=>{t.update(e);const s=e.length%16;s&&t.update($1.subarray(s))},R1=new Uint8Array(32);function pu(t,e,s,r,i){const n=t(e,s,R1),o=O1.create(n);i&&du(o,i),du(o,r);const a=new Uint8Array(16),c=f1(a);uu(c,0,BigInt(i?i.length:0),!0),uu(c,8,BigInt(r.length),!0),o.update(a);const l=o.digest();return si(n,a),l}const U1=t=>(e,s,r)=>({encrypt(i,n){const o=i.length;n=lu(o+16,n,!1),n.set(i);const a=n.subarray(0,-16);t(e,s,a,a,1);const c=pu(t,e,s,a,r);return n.set(c,o),si(c),n},decrypt(i,n){n=lu(i.length-16,n,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=pu(t,e,s,o,r);if(!y1(a,c))throw new Error("invalid tag");return n.set(i.subarray(0,-16)),t(e,s,n,n,1),si(c),n}});b1({blockSize:64,nonceLength:12,tagLength:16},U1(k1));class $d extends cc{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,IE(e);const r=oo(s);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return ti(this),this.iHash.update(e),this}digestInto(e){ti(this),ln(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:s,iHash:r,finished:i,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=s._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Rd=(t,e,s)=>new $d(t,e).update(s).digest();Rd.create=(t,e)=>new $d(t,e);function D1(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(s>>i&n),a=Number(s&n),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function L1(t,e,s){return t&e^~t&s}function B1(t,e,s){return t&e^t&s^e&s}let M1=class extends cc{constructor(e,s,r,i){super(),this.blockLen=e,this.outputLen=s,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Bo(this.buffer)}update(e){ti(this);const{view:s,buffer:r,blockLen:i}=this;e=oo(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(i-this.pos,n-o);if(a===i){const c=Bo(e);for(;i<=n-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(s,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ti(this),Ed(e,this),this.finished=!0;const{buffer:s,view:r,blockLen:i,isLE:n}=this;let{pos:o}=this;s[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)s[h]=0;D1(r,i-8,BigInt(this.length*8),n),this.process(r,0);const a=Bo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const r=e.slice(0,s);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:s,buffer:r,length:i,finished:n,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=n,e.destroyed=o,i%s&&e.buffer.set(r),e}};const j1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ts=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Os=new Uint32Array(64);class q1 extends M1{constructor(){super(64,32,8,!1),this.A=Ts[0]|0,this.B=Ts[1]|0,this.C=Ts[2]|0,this.D=Ts[3]|0,this.E=Ts[4]|0,this.F=Ts[5]|0,this.G=Ts[6]|0,this.H=Ts[7]|0}get(){const{A:e,B:s,C:r,D:i,E:n,F:o,G:a,H:c}=this;return[e,s,r,i,n,o,a,c]}set(e,s,r,i,n,o,a,c){this.A=e|0,this.B=s|0,this.C=r|0,this.D=i|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,s){for(let h=0;h<16;h++,s+=4)Os[h]=e.getUint32(s,!1);for(let h=16;h<64;h++){const d=Os[h-15],f=Os[h-2],g=ss(d,7)^ss(d,18)^d>>>3,m=ss(f,17)^ss(f,19)^f>>>10;Os[h]=m+Os[h-7]+g+Os[h-16]|0}let{A:r,B:i,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=ss(a,6)^ss(a,11)^ss(a,25),f=u+d+L1(a,c,l)+j1[h]+Os[h]|0,g=(ss(r,2)^ss(r,13)^ss(r,22))+B1(r,i,n)|0;u=l,l=c,c=a,a=o+f|0,o=n,n=i,i=r,r=f+g|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,n,o,a,c,l,u)}roundClean(){Os.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const hc=Id(()=>new q1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ao=BigInt(0),co=BigInt(1),F1=BigInt(2);function cr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function un(t){if(!cr(t))throw new Error("Uint8Array expected")}function ri(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const z1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ii(t){un(t);let e="";for(let s=0;s<t.length;s++)e+=z1[t[s]];return e}function qr(t){const e=t.toString(16);return e.length&1?"0"+e:e}function dc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ao:BigInt("0x"+t)}const fs={_0:48,_9:57,A:65,F:70,a:97,f:102};function fu(t){if(t>=fs._0&&t<=fs._9)return t-fs._0;if(t>=fs.A&&t<=fs.F)return t-(fs.A-10);if(t>=fs.a&&t<=fs.f)return t-(fs.a-10)}function ni(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(s);for(let i=0,n=0;i<s;i++,n+=2){const o=fu(t.charCodeAt(n)),a=fu(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}r[i]=o*16+a}return r}function sr(t){return dc(ii(t))}function Xi(t){return un(t),dc(ii(Uint8Array.from(t).reverse()))}function oi(t,e){return ni(t.toString(16).padStart(e*2,"0"))}function lo(t,e){return oi(t,e).reverse()}function W1(t){return ni(qr(t))}function Pt(t,e,s){let r;if(typeof e=="string")try{r=ni(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(cr(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof s=="number"&&i!==s)throw new Error(t+" of length "+s+" expected, got "+i);return r}function Qi(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];un(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}function H1(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t[r]^e[r];return s===0}function K1(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const jo=t=>typeof t=="bigint"&&ao<=t;function uo(t,e,s){return jo(t)&&jo(e)&&jo(s)&&e<=t&&t<s}function Is(t,e,s,r){if(!uo(e,s,r))throw new Error("expected valid "+t+": "+s+" <= n < "+r+", got "+e)}function Ud(t){let e;for(e=0;t>ao;t>>=co,e+=1);return e}function V1(t,e){return t>>BigInt(e)&co}function G1(t,e,s){return t|(s?co:ao)<<BigInt(e)}const pc=t=>(F1<<BigInt(t-1))-co,qo=t=>new Uint8Array(t),gu=t=>Uint8Array.from(t);function Dd(t,e,s){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof s!="function")throw new Error("hmacFn must be a function");let r=qo(t),i=qo(t),n=0;const o=()=>{r.fill(1),i.fill(0),n=0},a=(...u)=>s(i,r,...u),c=(u=qo())=>{i=a(gu([0]),u),r=a(),u.length!==0&&(i=a(gu([1]),u),r=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const h=[];for(;u<e;){r=a();const d=r.slice();h.push(d),u+=r.length}return Qi(...h)};return(u,h)=>{o(),c(u);let d;for(;!(d=h(l()));)c();return o(),d}}const J1={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||cr(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function fi(t,e,s={}){const r=(i,n,o)=>{const a=J1[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+n+", got "+c)};for(const[i,n]of Object.entries(e))r(i,n,!1);for(const[i,n]of Object.entries(s))r(i,n,!0);return t}const Y1=()=>{throw new Error("not implemented")};function ja(t){const e=new WeakMap;return(s,...r)=>{const i=e.get(s);if(i!==void 0)return i;const n=t(s,...r);return e.set(s,n),n}}var Z1=Object.freeze({__proto__:null,isBytes:cr,abytes:un,abool:ri,bytesToHex:ii,numberToHexUnpadded:qr,hexToNumber:dc,hexToBytes:ni,bytesToNumberBE:sr,bytesToNumberLE:Xi,numberToBytesBE:oi,numberToBytesLE:lo,numberToVarBytesBE:W1,ensureBytes:Pt,concatBytes:Qi,equalBytes:H1,utf8ToBytes:K1,inRange:uo,aInRange:Is,bitLen:Ud,bitGet:V1,bitSet:G1,bitMask:pc,createHmacDrbg:Dd,validateObject:fi,notImplemented:Y1,memoized:ja});const Je=BigInt(0),De=BigInt(1),Ys=BigInt(2),X1=BigInt(3),qa=BigInt(4),mu=BigInt(5),wu=BigInt(8);function vt(t,e){const s=t%e;return s>=Je?s:e+s}function Ld(t,e,s){if(e<Je)throw new Error("invalid exponent, negatives unsupported");if(s<=Je)throw new Error("invalid modulus");if(s===De)return Je;let r=De;for(;e>Je;)e&De&&(r=r*t%s),t=t*t%s,e>>=De;return r}function Jt(t,e,s){let r=t;for(;e-- >Je;)r*=r,r%=s;return r}function Fa(t,e){if(t===Je)throw new Error("invert: expected non-zero number");if(e<=Je)throw new Error("invert: expected positive modulus, got "+e);let s=vt(t,e),r=e,i=Je,n=De;for(;s!==Je;){const o=r/s,a=r%s,c=i-n*o;r=s,s=a,i=n,n=c}if(r!==De)throw new Error("invert: does not exist");return vt(i,e)}function Q1(t){const e=(t-De)/Ys;let s,r,i;for(s=t-De,r=0;s%Ys===Je;s/=Ys,r++);for(i=Ys;i<t&&Ld(i,e,t)!==t-De;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+De)/qa;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(s+De)/Ys;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,l=o.pow(o.mul(o.ONE,i),s),u=o.pow(a,n),h=o.pow(a,s);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let g=o.sqr(h);d<c&&!o.eql(g,o.ONE);d++)g=o.sqr(g);const f=o.pow(l,De<<BigInt(c-d-1));l=o.sqr(f),u=o.mul(u,f),h=o.mul(h,l),c=d}return u}}function eI(t){if(t%qa===X1){const e=(t+De)/qa;return function(s,r){const i=s.pow(r,e);if(!s.eql(s.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%wu===mu){const e=(t-mu)/wu;return function(s,r){const i=s.mul(r,Ys),n=s.pow(i,e),o=s.mul(r,n),a=s.mul(s.mul(o,Ys),n),c=s.mul(o,s.sub(a,s.ONE));if(!s.eql(s.sqr(c),r))throw new Error("Cannot find square root");return c}}return Q1(t)}const tI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sI(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},s=tI.reduce((r,i)=>(r[i]="function",r),e);return fi(t,s)}function rI(t,e,s){if(s<Je)throw new Error("invalid exponent, negatives unsupported");if(s===Je)return t.ONE;if(s===De)return e;let r=t.ONE,i=e;for(;s>Je;)s&De&&(r=t.mul(r,i)),i=t.sqr(i),s>>=De;return r}function iI(t,e){const s=new Array(e.length),r=e.reduce((n,o,a)=>t.is0(o)?n:(s[a]=n,t.mul(n,o)),t.ONE),i=t.inv(r);return e.reduceRight((n,o,a)=>t.is0(o)?n:(s[a]=t.mul(n,s[a]),t.mul(n,o)),i),s}function Bd(t,e){const s=e!==void 0?e:t.toString(2).length,r=Math.ceil(s/8);return{nBitLength:s,nByteLength:r}}function Md(t,e,s=!1,r={}){if(t<=Je)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:n}=Bd(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:s,BITS:i,BYTES:n,MASK:pc(i),ZERO:Je,ONE:De,create:c=>vt(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Je<=c&&c<t},is0:c=>c===Je,isOdd:c=>(c&De)===De,neg:c=>vt(-c,t),eql:(c,l)=>c===l,sqr:c=>vt(c*c,t),add:(c,l)=>vt(c+l,t),sub:(c,l)=>vt(c-l,t),mul:(c,l)=>vt(c*l,t),pow:(c,l)=>rI(a,c,l),div:(c,l)=>vt(c*Fa(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Fa(c,t),sqrt:r.sqrt||(c=>(o||(o=eI(t)),o(a,c))),invertBatch:c=>iI(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>s?lo(c,n):oi(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return s?Xi(c):sr(c)}});return Object.freeze(a)}function jd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function qd(t){const e=jd(t);return e+Math.ceil(e/2)}function nI(t,e,s=!1){const r=t.length,i=jd(e),n=qd(e);if(r<16||r<n||r>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+r);const o=s?Xi(t):sr(t),a=vt(o,e-De)+De;return s?lo(a,i):oi(a,i)}const yu=BigInt(0),Cn=BigInt(1);function Fo(t,e){const s=e.negate();return t?s:e}function Fd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function zo(t,e){Fd(t,e);const s=Math.ceil(e/t)+1,r=2**(t-1);return{windows:s,windowSize:r}}function oI(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((s,r)=>{if(!(s instanceof e))throw new Error("invalid point at index "+r)})}function aI(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((s,r)=>{if(!e.isValid(s))throw new Error("invalid scalar at index "+r)})}const Wo=new WeakMap,zd=new WeakMap;function Ho(t){return zd.get(t)||1}function cI(t,e){return{constTimeNegate:Fo,hasPrecomputes(s){return Ho(s)!==1},unsafeLadder(s,r,i=t.ZERO){let n=s;for(;r>yu;)r&Cn&&(i=i.add(n)),n=n.double(),r>>=Cn;return i},precomputeWindow(s,r){const{windows:i,windowSize:n}=zo(r,e),o=[];let a=s,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(s,r,i){const{windows:n,windowSize:o}=zo(s,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**s-1),u=2**s,h=BigInt(s);for(let d=0;d<n;d++){const f=d*o;let g=Number(i&l);i>>=h,g>o&&(g-=u,i+=Cn);const m=f,p=f+Math.abs(g)-1,w=d%2!==0,y=g<0;g===0?c=c.add(Fo(w,r[m])):a=a.add(Fo(y,r[p]))}return{p:a,f:c}},wNAFUnsafe(s,r,i,n=t.ZERO){const{windows:o,windowSize:a}=zo(s,e),c=BigInt(2**s-1),l=2**s,u=BigInt(s);for(let h=0;h<o;h++){const d=h*a;if(i===yu)break;let f=Number(i&c);if(i>>=u,f>a&&(f-=l,i+=Cn),f===0)continue;let g=r[d+Math.abs(f)-1];f<0&&(g=g.negate()),n=n.add(g)}return n},getPrecomputes(s,r,i){let n=Wo.get(r);return n||(n=this.precomputeWindow(r,s),s!==1&&Wo.set(r,i(n))),n},wNAFCached(s,r,i){const n=Ho(s);return this.wNAF(n,this.getPrecomputes(n,s,i),r)},wNAFCachedUnsafe(s,r,i,n){const o=Ho(s);return o===1?this.unsafeLadder(s,r,n):this.wNAFUnsafe(o,this.getPrecomputes(o,s,i),r,n)},setWindowSize(s,r){Fd(r,e),zd.set(s,r),Wo.delete(s)}}}function lI(t,e,s,r){if(oI(s,t),aI(r,e),s.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,n=Ud(BigInt(s.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let u=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let f=0;f<r.length;f++){const g=r[f],m=Number(g>>BigInt(h)&BigInt(a));c[m]=c[m].add(s[f])}let d=i;for(let f=c.length-1,g=i;f>0;f--)g=g.add(c[f]),d=d.add(g);if(u=u.add(d),h!==0)for(let f=0;f<o;f++)u=u.double()}return u}function Wd(t){return sI(t.Fp),fi(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Bd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Er=BigInt(0),Ko=BigInt(1);function uI(t){return fi(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function hI(t){const e=uI(t),{P:s}=e,r=y=>vt(y,s),i=e.montgomeryBits,n=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(y=>y),c=e.powPminus2||(y=>Ld(y,s-BigInt(2),s));function l(y,I,T){const $=r(y*(I-T));return I=r(I-$),T=r(T+$),[I,T]}const u=(e.a-BigInt(2))/BigInt(4);function h(y,I){Is("u",y,Er,s),Is("scalar",I,Er,s);const T=I,$=y;let P=Ko,_=Er,O=y,v=Ko,x=Er,S;for(let L=BigInt(i-1);L>=Er;L--){const E=T>>L&Ko;x^=E,S=l(x,P,O),P=S[0],O=S[1],S=l(x,_,v),_=S[0],v=S[1],x=E;const N=P+_,C=r(N*N),k=P-_,U=r(k*k),A=C-U,M=O+v,q=O-v,F=r(q*N),X=r(M*k),G=F+X,oe=F-X;O=r(G*G),v=r($*r(oe*oe)),P=r(C*U),_=r(A*(C+r(u*A)))}S=l(x,P,O),P=S[0],O=S[1],S=l(x,_,v),_=S[0],v=S[1];const R=c(_);return r(P*R)}function d(y){return lo(r(y),n)}function f(y){const I=Pt("u coordinate",y,n);return o===32&&(I[31]&=127),Xi(I)}function g(y){const I=Pt("scalar",y),T=I.length;if(T!==n&&T!==o){let $=""+n+" or "+o;throw new Error("invalid scalar, expected "+$+" bytes, got "+T)}return Xi(a(I))}function m(y,I){const T=f(I),$=g(y),P=h(T,$);if(P===Er)throw new Error("invalid private or public key received");return d(P)}const p=d(e.Gu);function w(y){return m(y,p)}return{scalarMult:m,scalarMultBase:w,getSharedSecret:(y,I)=>m(y,I),getPublicKey:y=>w(y),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:p}}const za=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const dI=BigInt(1),bu=BigInt(2),pI=BigInt(3),fI=BigInt(5);BigInt(8);function gI(t){const e=BigInt(10),s=BigInt(20),r=BigInt(40),i=BigInt(80),n=za,o=t*t%n*t%n,a=Jt(o,bu,n)*o%n,c=Jt(a,dI,n)*t%n,l=Jt(c,fI,n)*c%n,u=Jt(l,e,n)*l%n,h=Jt(u,s,n)*u%n,d=Jt(h,r,n)*h%n,f=Jt(d,i,n)*d%n,g=Jt(f,i,n)*d%n,m=Jt(g,e,n)*l%n;return{pow_p_5_8:Jt(m,bu,n)*t%n,b2:o}}function mI(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}hI({P:za,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=za,{pow_p_5_8:s,b2:r}=gI(t);return vt(Jt(s,pI,e)*r,e)},adjustScalarBytes:mI,randomBytes:Cd});function vu(t){t.lowS!==void 0&&ri("lowS",t.lowS),t.prehash!==void 0&&ri("prehash",t.prehash)}function wI(t){const e=Wd(t);fi(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:s,Fp:r,a:i}=e;if(s){if(!r.eql(i,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof s!="object"||typeof s.beta!="bigint"||typeof s.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:yI,hexToBytes:bI}=Z1;class vI extends Error{constructor(e=""){super(e)}}const ys={Err:vI,_tlv:{encode:(t,e)=>{const{Err:s}=ys;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length&1)throw new s("tlv.encode: unpadded data");const r=e.length/2,i=qr(r);if(i.length/2&128)throw new s("tlv.encode: long form length too big");const n=r>127?qr(i.length/2|128):"";return qr(t)+n+i+e},decode(t,e){const{Err:s}=ys;let r=0;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new s("tlv.decode: wrong tlv");const i=e[r++],n=!!(i&128);let o=0;if(!n)o=i;else{const c=i&127;if(!c)throw new s("tlv.decode(long): indefinite length not supported");if(c>4)throw new s("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new s("tlv.decode: length bytes not complete");if(l[0]===0)throw new s("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(r+=c,o<128)throw new s("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=ys;if(t<vs)throw new e("integer: negative integers are not allowed");let s=qr(t);if(Number.parseInt(s[0],16)&8&&(s="00"+s),s.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return s},decode(t){const{Err:e}=ys;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return yI(t)}},toSig(t){const{Err:e,_int:s,_tlv:r}=ys,i=typeof t=="string"?bI(t):t;un(i);const{v:n,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,n),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:s.decode(a),s:s.decode(l)}},hexFromSig(t){const{_tlv:e,_int:s}=ys,r=e.encode(2,s.encode(t.r)),i=e.encode(2,s.encode(t.s)),n=r+i;return e.encode(48,n)}},vs=BigInt(0),We=BigInt(1);BigInt(2);const Eu=BigInt(3);BigInt(4);function EI(t){const e=wI(t),{Fp:s}=e,r=Md(e.n,e.nBitLength),i=e.toBytes||((m,p,w)=>{const y=p.toAffine();return Qi(Uint8Array.from([4]),s.toBytes(y.x),s.toBytes(y.y))}),n=e.fromBytes||(m=>{const p=m.subarray(1),w=s.fromBytes(p.subarray(0,s.BYTES)),y=s.fromBytes(p.subarray(s.BYTES,2*s.BYTES));return{x:w,y}});function o(m){const{a:p,b:w}=e,y=s.sqr(m),I=s.mul(y,m);return s.add(s.add(I,s.mul(m,p)),w)}if(!s.eql(s.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(m){return uo(m,We,e.n)}function c(m){const{allowedPrivateKeyLengths:p,nByteLength:w,wrapPrivateKey:y,n:I}=e;if(p&&typeof m!="bigint"){if(cr(m)&&(m=ii(m)),typeof m!="string"||!p.includes(m.length))throw new Error("invalid private key");m=m.padStart(w*2,"0")}let T;try{T=typeof m=="bigint"?m:sr(Pt("private key",m,w))}catch{throw new Error("invalid private key, expected hex or "+w+" bytes, got "+typeof m)}return y&&(T=vt(T,I)),Is("private key",T,We,I),T}function l(m){if(!(m instanceof d))throw new Error("ProjectivePoint expected")}const u=ja((m,p)=>{const{px:w,py:y,pz:I}=m;if(s.eql(I,s.ONE))return{x:w,y};const T=m.is0();p==null&&(p=T?s.ONE:s.inv(I));const $=s.mul(w,p),P=s.mul(y,p),_=s.mul(I,p);if(T)return{x:s.ZERO,y:s.ZERO};if(!s.eql(_,s.ONE))throw new Error("invZ was invalid");return{x:$,y:P}}),h=ja(m=>{if(m.is0()){if(e.allowInfinityPoint&&!s.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:p,y:w}=m.toAffine();if(!s.isValid(p)||!s.isValid(w))throw new Error("bad point: x or y not FE");const y=s.sqr(w),I=o(p);if(!s.eql(y,I))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(p,w,y){if(this.px=p,this.py=w,this.pz=y,p==null||!s.isValid(p))throw new Error("x required");if(w==null||!s.isValid(w))throw new Error("y required");if(y==null||!s.isValid(y))throw new Error("z required");Object.freeze(this)}static fromAffine(p){const{x:w,y}=p||{};if(!p||!s.isValid(w)||!s.isValid(y))throw new Error("invalid affine point");if(p instanceof d)throw new Error("projective point not allowed");const I=T=>s.eql(T,s.ZERO);return I(w)&&I(y)?d.ZERO:new d(w,y,s.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(p){const w=s.invertBatch(p.map(y=>y.pz));return p.map((y,I)=>y.toAffine(w[I])).map(d.fromAffine)}static fromHex(p){const w=d.fromAffine(n(Pt("pointHex",p)));return w.assertValidity(),w}static fromPrivateKey(p){return d.BASE.multiply(c(p))}static msm(p,w){return lI(d,r,p,w)}_setWindowSize(p){g.setWindowSize(this,p)}assertValidity(){h(this)}hasEvenY(){const{y:p}=this.toAffine();if(s.isOdd)return!s.isOdd(p);throw new Error("Field doesn't support isOdd")}equals(p){l(p);const{px:w,py:y,pz:I}=this,{px:T,py:$,pz:P}=p,_=s.eql(s.mul(w,P),s.mul(T,I)),O=s.eql(s.mul(y,P),s.mul($,I));return _&&O}negate(){return new d(this.px,s.neg(this.py),this.pz)}double(){const{a:p,b:w}=e,y=s.mul(w,Eu),{px:I,py:T,pz:$}=this;let P=s.ZERO,_=s.ZERO,O=s.ZERO,v=s.mul(I,I),x=s.mul(T,T),S=s.mul($,$),R=s.mul(I,T);return R=s.add(R,R),O=s.mul(I,$),O=s.add(O,O),P=s.mul(p,O),_=s.mul(y,S),_=s.add(P,_),P=s.sub(x,_),_=s.add(x,_),_=s.mul(P,_),P=s.mul(R,P),O=s.mul(y,O),S=s.mul(p,S),R=s.sub(v,S),R=s.mul(p,R),R=s.add(R,O),O=s.add(v,v),v=s.add(O,v),v=s.add(v,S),v=s.mul(v,R),_=s.add(_,v),S=s.mul(T,$),S=s.add(S,S),v=s.mul(S,R),P=s.sub(P,v),O=s.mul(S,x),O=s.add(O,O),O=s.add(O,O),new d(P,_,O)}add(p){l(p);const{px:w,py:y,pz:I}=this,{px:T,py:$,pz:P}=p;let _=s.ZERO,O=s.ZERO,v=s.ZERO;const x=e.a,S=s.mul(e.b,Eu);let R=s.mul(w,T),L=s.mul(y,$),E=s.mul(I,P),N=s.add(w,y),C=s.add(T,$);N=s.mul(N,C),C=s.add(R,L),N=s.sub(N,C),C=s.add(w,I);let k=s.add(T,P);return C=s.mul(C,k),k=s.add(R,E),C=s.sub(C,k),k=s.add(y,I),_=s.add($,P),k=s.mul(k,_),_=s.add(L,E),k=s.sub(k,_),v=s.mul(x,C),_=s.mul(S,E),v=s.add(_,v),_=s.sub(L,v),v=s.add(L,v),O=s.mul(_,v),L=s.add(R,R),L=s.add(L,R),E=s.mul(x,E),C=s.mul(S,C),L=s.add(L,E),E=s.sub(R,E),E=s.mul(x,E),C=s.add(C,E),R=s.mul(L,C),O=s.add(O,R),R=s.mul(k,C),_=s.mul(N,_),_=s.sub(_,R),R=s.mul(N,L),v=s.mul(k,v),v=s.add(v,R),new d(_,O,v)}subtract(p){return this.add(p.negate())}is0(){return this.equals(d.ZERO)}wNAF(p){return g.wNAFCached(this,p,d.normalizeZ)}multiplyUnsafe(p){const{endo:w,n:y}=e;Is("scalar",p,vs,y);const I=d.ZERO;if(p===vs)return I;if(this.is0()||p===We)return this;if(!w||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,p,d.normalizeZ);let{k1neg:T,k1:$,k2neg:P,k2:_}=w.splitScalar(p),O=I,v=I,x=this;for(;$>vs||_>vs;)$&We&&(O=O.add(x)),_&We&&(v=v.add(x)),x=x.double(),$>>=We,_>>=We;return T&&(O=O.negate()),P&&(v=v.negate()),v=new d(s.mul(v.px,w.beta),v.py,v.pz),O.add(v)}multiply(p){const{endo:w,n:y}=e;Is("scalar",p,We,y);let I,T;if(w){const{k1neg:$,k1:P,k2neg:_,k2:O}=w.splitScalar(p);let{p:v,f:x}=this.wNAF(P),{p:S,f:R}=this.wNAF(O);v=g.constTimeNegate($,v),S=g.constTimeNegate(_,S),S=new d(s.mul(S.px,w.beta),S.py,S.pz),I=v.add(S),T=x.add(R)}else{const{p:$,f:P}=this.wNAF(p);I=$,T=P}return d.normalizeZ([I,T])[0]}multiplyAndAddUnsafe(p,w,y){const I=d.BASE,T=(P,_)=>_===vs||_===We||!P.equals(I)?P.multiplyUnsafe(_):P.multiply(_),$=T(this,w).add(T(p,y));return $.is0()?void 0:$}toAffine(p){return u(this,p)}isTorsionFree(){const{h:p,isTorsionFree:w}=e;if(p===We)return!0;if(w)return w(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:p,clearCofactor:w}=e;return p===We?this:w?w(d,this):this.multiplyUnsafe(e.h)}toRawBytes(p=!0){return ri("isCompressed",p),this.assertValidity(),i(d,this,p)}toHex(p=!0){return ri("isCompressed",p),ii(this.toRawBytes(p))}}d.BASE=new d(e.Gx,e.Gy,s.ONE),d.ZERO=new d(s.ZERO,s.ONE,s.ZERO);const f=e.nBitLength,g=cI(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function II(t){const e=Wd(t);return fi(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function CI(t){const e=II(t),{Fp:s,n:r}=e,i=s.BYTES+1,n=2*s.BYTES+1;function o(E){return vt(E,r)}function a(E){return Fa(E,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=EI({...e,toBytes(E,N,C){const k=N.toAffine(),U=s.toBytes(k.x),A=Qi;return ri("isCompressed",C),C?A(Uint8Array.from([N.hasEvenY()?2:3]),U):A(Uint8Array.from([4]),U,s.toBytes(k.y))},fromBytes(E){const N=E.length,C=E[0],k=E.subarray(1);if(N===i&&(C===2||C===3)){const U=sr(k);if(!uo(U,We,s.ORDER))throw new Error("Point is not on curve");const A=u(U);let M;try{M=s.sqrt(A)}catch(F){const X=F instanceof Error?": "+F.message:"";throw new Error("Point is not on curve"+X)}const q=(M&We)===We;return(C&1)===1!==q&&(M=s.neg(M)),{x:U,y:M}}else if(N===n&&C===4){const U=s.fromBytes(k.subarray(0,s.BYTES)),A=s.fromBytes(k.subarray(s.BYTES,2*s.BYTES));return{x:U,y:A}}else{const U=i,A=n;throw new Error("invalid Point, expected length of "+U+", or uncompressed "+A+", got "+N)}}}),d=E=>ii(oi(E,e.nByteLength));function f(E){const N=r>>We;return E>N}function g(E){return f(E)?o(-E):E}const m=(E,N,C)=>sr(E.slice(N,C));class p{constructor(N,C,k){this.r=N,this.s=C,this.recovery=k,this.assertValidity()}static fromCompact(N){const C=e.nByteLength;return N=Pt("compactSignature",N,C*2),new p(m(N,0,C),m(N,C,2*C))}static fromDER(N){const{r:C,s:k}=ys.toSig(Pt("DER",N));return new p(C,k)}assertValidity(){Is("r",this.r,We,r),Is("s",this.s,We,r)}addRecoveryBit(N){return new p(this.r,this.s,N)}recoverPublicKey(N){const{r:C,s:k,recovery:U}=this,A=P(Pt("msgHash",N));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const M=U===2||U===3?C+e.n:C;if(M>=s.ORDER)throw new Error("recovery id 2 or 3 invalid");const q=(U&1)===0?"02":"03",F=c.fromHex(q+d(M)),X=a(M),G=o(-A*X),oe=o(k*X),le=c.BASE.multiplyAndAddUnsafe(F,G,oe);if(!le)throw new Error("point at infinify");return le.assertValidity(),le}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return ni(this.toDERHex())}toDERHex(){return ys.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ni(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const w={isValidPrivateKey(E){try{return l(E),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const E=qd(e.n);return nI(e.randomBytes(E),e.n)},precompute(E=8,N=c.BASE){return N._setWindowSize(E),N.multiply(BigInt(3)),N}};function y(E,N=!0){return c.fromPrivateKey(E).toRawBytes(N)}function I(E){const N=cr(E),C=typeof E=="string",k=(N||C)&&E.length;return N?k===i||k===n:C?k===2*i||k===2*n:E instanceof c}function T(E,N,C=!0){if(I(E))throw new Error("first arg must be private key");if(!I(N))throw new Error("second arg must be public key");return c.fromHex(N).multiply(l(E)).toRawBytes(C)}const $=e.bits2int||function(E){if(E.length>8192)throw new Error("input is too large");const N=sr(E),C=E.length*8-e.nBitLength;return C>0?N>>BigInt(C):N},P=e.bits2int_modN||function(E){return o($(E))},_=pc(e.nBitLength);function O(E){return Is("num < 2^"+e.nBitLength,E,vs,_),oi(E,e.nByteLength)}function v(E,N,C=x){if(["recovered","canonical"].some(ue=>ue in C))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:U}=e;let{lowS:A,prehash:M,extraEntropy:q}=C;A==null&&(A=!0),E=Pt("msgHash",E),vu(C),M&&(E=Pt("prehashed msgHash",k(E)));const F=P(E),X=l(N),G=[O(X),O(F)];if(q!=null&&q!==!1){const ue=q===!0?U(s.BYTES):q;G.push(Pt("extraEntropy",ue))}const oe=Qi(...G),le=F;function Ie(ue){const he=$(ue);if(!h(he))return;const Ft=a(he),at=c.BASE.multiply(he).toAffine(),Me=o(at.x);if(Me===vs)return;const Ye=o(Ft*o(le+Me*X));if(Ye===vs)return;let ct=(at.x===Me?0:2)|Number(at.y&We),Fs=Ye;return A&&f(Ye)&&(Fs=g(Ye),ct^=1),new p(Me,Fs,ct)}return{seed:oe,k2sig:Ie}}const x={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};function R(E,N,C=x){const{seed:k,k2sig:U}=v(E,N,C),A=e;return Dd(A.hash.outputLen,A.nByteLength,A.hmac)(k,U)}c.BASE._setWindowSize(8);function L(E,N,C,k=S){var Ye;const U=E;N=Pt("msgHash",N),C=Pt("publicKey",C);const{lowS:A,prehash:M,format:q}=k;if(vu(k),"strict"in k)throw new Error("options.strict was renamed to lowS");if(q!==void 0&&q!=="compact"&&q!=="der")throw new Error("format must be compact or der");const F=typeof U=="string"||cr(U),X=!F&&!q&&typeof U=="object"&&U!==null&&typeof U.r=="bigint"&&typeof U.s=="bigint";if(!F&&!X)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let G,oe;try{if(X&&(G=new p(U.r,U.s)),F){try{q!=="compact"&&(G=p.fromDER(U))}catch(ct){if(!(ct instanceof ys.Err))throw ct}!G&&q!=="der"&&(G=p.fromCompact(U))}oe=c.fromHex(C)}catch{return!1}if(!G||A&&G.hasHighS())return!1;M&&(N=e.hash(N));const{r:le,s:Ie}=G,ue=P(N),he=a(Ie),Ft=o(ue*he),at=o(le*he),Me=(Ye=c.BASE.multiplyAndAddUnsafe(oe,Ft,at))==null?void 0:Ye.toAffine();return Me?o(Me.x)===le:!1}return{CURVE:e,getPublicKey:y,getSharedSecret:T,sign:R,verify:L,ProjectivePoint:c,Signature:p,utils:w}}function NI(t){return{hash:t,hmac:(e,...s)=>Rd(t,e,kE(...s)),randomBytes:Cd}}function AI(t,e){const s=r=>CI({...t,...NI(r)});return{...s(e),create:s}}const Hd=Md(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),SI=Hd.create(BigInt("-3")),_I=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");AI({a:SI,b:_I,Fp:Hd,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},hc);const Wa="base16",Nn="base64pad",Si="base64url",PI="utf8",Vo=1,TI=2;function Go(t){const e=hc(It(t,Wa));return it(e,Wa)}function Ir(t){const e=hc(It(t,PI));return it(e,Wa)}function An(t,e,s){return`${t}?wc_ev=${s}&topic=${e}`}var OI=Object.defineProperty,xI=Object.defineProperties,kI=Object.getOwnPropertyDescriptors,Iu=Object.getOwnPropertySymbols,$I=Object.prototype.hasOwnProperty,RI=Object.prototype.propertyIsEnumerable,Cu=(t,e,s)=>e in t?OI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,UI=(t,e)=>{for(var s in e||(e={}))$I.call(e,s)&&Cu(t,s,e[s]);if(Iu)for(var s of Iu(e))RI.call(e,s)&&Cu(t,s,e[s]);return t},DI=(t,e)=>xI(t,kI(e));function gi(t){const e=[];return t.forEach(s=>{const[r,i]=s.split(":");e.push(`${r}:${i}`)}),e}function LI(t){const e=[];return Object.values(t).forEach(s=>{e.push(...gi(s.accounts))}),e}function BI(t,e){const s=[];return Object.values(t).forEach(r=>{gi(r.accounts).includes(e)&&s.push(...r.methods)}),s}function MI(t,e){const s=[];return Object.values(t).forEach(r=>{gi(r.accounts).includes(e)&&s.push(...r.events)}),s}function ho(t){return t.includes(":")}function Fr(t){return ho(t)?t.split(":")[0]:t}function Nu(t){var e,s,r;const i={};if(!Ms(t))return i;for(const[n,o]of Object.entries(t)){const a=ho(n)?[n]:o.chains,c=o.methods||[],l=o.events||[],u=Fr(n);i[u]=DI(UI({},i[u]),{chains:cs(a,(e=i[u])==null?void 0:e.chains),methods:cs(c,(s=i[u])==null?void 0:s.methods),events:cs(l,(r=i[u])==null?void 0:r.events)})}return i}function jI(t){const e={};return t==null||t.forEach(s=>{var r;const[i,n]=s.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(s),(r=e[i].chains)==null||r.push(`${i}:${n}`)}),e}function Au(t,e){e=e.map(r=>r.replace("did:pkh:",""));const s=jI(e);for(const[r,i]of Object.entries(s))i.methods?i.methods=cs(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return s}function qI(t,e){var s,r,i,n,o,a;const c=Nu(t),l=Nu(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const d of h)u[d]={chains:cs((s=c[d])==null?void 0:s.chains,(r=l[d])==null?void 0:r.chains),methods:cs((i=c[d])==null?void 0:i.methods,(n=l[d])==null?void 0:n.methods),events:cs((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return u}const FI={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},zI={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Z(t,e){const{message:s,code:r}=zI[t];return{message:e?`${s} ${e}`:s,code:r}}function $e(t,e){const{message:s,code:r}=FI[t];return{message:e?`${s} ${e}`:s,code:r}}function Bs(t,e){return!!Array.isArray(t)}function Ms(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Et(t){return typeof t>"u"}function He(t,e){return e&&Et(t)?!0:typeof t=="string"&&!!t.trim().length}function fc(t,e){return e&&Et(t)?!0:typeof t=="number"&&!isNaN(t)}function WI(t,e){const{requiredNamespaces:s}=e,r=Object.keys(t.namespaces),i=Object.keys(s);let n=!0;return Qs(i,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=gi(a),h=s[o];(!Qs(wd(o,h),u)||!Qs(h.methods,c)||!Qs(h.events,l))&&(n=!1)}),n):!1}function Vn(t){return He(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function HI(t){if(He(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const s=e[0]+":"+e[1];return!!e[2]&&Vn(s)}}return!1}function KI(t,e){let s=null;return He(t==null?void 0:t.publicKey,!1)||(s=Z("MISSING_OR_INVALID",`${e} controller public key should be a string`)),s}function Su(t){let e=!0;return Bs(t)?t.length&&(e=t.every(s=>He(s,!1))):e=!1,e}function VI(t,e,s){let r=null;return Bs(e)&&e.length?e.forEach(i=>{r||Vn(i)||(r=$e("UNSUPPORTED_CHAINS",`${s}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):Vn(t)||(r=$e("UNSUPPORTED_CHAINS",`${s}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function GI(t,e,s){let r=null;return Object.entries(t).forEach(([i,n])=>{if(r)return;const o=VI(i,wd(i,n),`${e} ${s}`);o&&(r=o)}),r}function JI(t,e){let s=null;return Bs(t)?t.forEach(r=>{s||HI(r)||(s=$e("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):s=$e("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s}function YI(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;const i=JI(r==null?void 0:r.accounts,`${e} namespace`);i&&(s=i)}),s}function ZI(t,e){let s=null;return Su(t==null?void 0:t.methods)?Su(t==null?void 0:t.events)||(s=$e("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):s=$e("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),s}function Kd(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;const i=ZI(r,`${e}, namespace`);i&&(s=i)}),s}function XI(t,e,s){let r=null;if(t&&Ms(t)){const i=Kd(t,e);i&&(r=i);const n=GI(t,e,s);n&&(r=n)}else r=Z("MISSING_OR_INVALID",`${e}, ${s} should be an object with data`);return r}function Jo(t,e){let s=null;if(t&&Ms(t)){const r=Kd(t,e);r&&(s=r);const i=YI(t,e);i&&(s=i)}else s=Z("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return s}function Vd(t){return He(t.protocol,!0)}function QI(t,e){let s=!1;return t?t&&Bs(t)&&t.length&&t.forEach(r=>{s=Vd(r)}):s=!0,s}function eC(t){return typeof t=="number"}function Vt(t){return typeof t<"u"&&typeof t!==null}function tC(t){return!(!t||typeof t!="object"||!t.code||!fc(t.code,!1)||!t.message||!He(t.message,!1))}function sC(t){return!(Et(t)||!He(t.method,!1))}function rC(t){return!(Et(t)||Et(t.result)&&Et(t.error)||!fc(t.id,!1)||!He(t.jsonrpc,!1))}function iC(t){return!(Et(t)||!He(t.name,!1))}function _u(t,e){return!(!Vn(e)||!LI(t).includes(e))}function nC(t,e,s){return He(s,!1)?BI(t,e).includes(s):!1}function oC(t,e,s){return He(s,!1)?MI(t,e).includes(s):!1}function Pu(t,e,s){let r=null;const i=aC(t),n=cC(e),o=Object.keys(i),a=Object.keys(n),c=Tu(Object.keys(t)),l=Tu(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Qs(o,a)||(r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||r)return;const d=gi(e[h].accounts);d.includes(h)||(r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{r||(Qs(i[h].methods,n[h].methods)?Qs(i[h].events,n[h].events)||(r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces events don't satisfy namespace events for ${h}`)):r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces methods don't satisfy namespace methods for ${h}`))}),r}function aC(t){const e={};return Object.keys(t).forEach(s=>{var r;s.includes(":")?e[s]=t[s]:(r=t[s].chains)==null||r.forEach(i=>{e[i]={methods:t[s].methods,events:t[s].events}})}),e}function Tu(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function cC(t){const e={};return Object.keys(t).forEach(s=>{if(s.includes(":"))e[s]=t[s];else{const r=gi(t[s].accounts);r==null||r.forEach(i=>{e[i]={accounts:t[s].accounts.filter(n=>n.includes(`${i}:`)),methods:t[s].methods,events:t[s].events}})}}),e}function lC(t,e){return fc(t,!1)&&t<=e.max&&t>=e.min}const Yo={};class _i{static get(e){return Yo[e]}static set(e,s){Yo[e]=s}static delete(e){delete Yo[e]}}const Gd="wc",Jd=2,Yd="client",gc=`${Gd}@${Jd}:${Yd}:`,Zo={name:Yd,logger:"error"},Ou="WALLETCONNECT_DEEPLINK_CHOICE",uC="proposal",xu="Proposal expired",hC="session",Cr=j.SEVEN_DAYS,dC="engine",qe={wc_sessionPropose:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1104},res:{ttl:j.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1106},res:{ttl:j.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1112},res:{ttl:j.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1114},res:{ttl:j.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:j.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:j.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1119}}},Xo={min:j.FIVE_MINUTES,max:j.SEVEN_DAYS},rs={idle:"IDLE",active:"ACTIVE"},ku={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},pC="request",fC=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],gC="wc",mC="auth",wC="authKeys",yC="pairingTopics",bC="requests",po=`${gC}@${1.5}:${mC}:`,Ln=`${po}:PUB_KEY`;var vC=Object.defineProperty,EC=Object.defineProperties,IC=Object.getOwnPropertyDescriptors,$u=Object.getOwnPropertySymbols,CC=Object.prototype.hasOwnProperty,NC=Object.prototype.propertyIsEnumerable,Ha=(t,e,s)=>e in t?vC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Se=(t,e)=>{for(var s in e||(e={}))CC.call(e,s)&&Ha(t,s,e[s]);if($u)for(var s of $u(e))NC.call(e,s)&&Ha(t,s,e[s]);return t},lt=(t,e)=>EC(t,IC(e)),D=(t,e,s)=>Ha(t,typeof e!="symbol"?e+"":e,s);class AC extends Uv{constructor(e){super(e),D(this,"name",dC),D(this,"events",new ec),D(this,"initialized",!1),D(this,"requestQueue",{state:rs.idle,queue:[]}),D(this,"sessionRequestQueue",{state:rs.idle,queue:[]}),D(this,"requestQueueDelay",j.ONE_SECOND),D(this,"expectedPairingMethodMap",new Map),D(this,"recentlyDeletedMap",new Map),D(this,"recentlyDeletedLimit",200),D(this,"relayMessageCache",[]),D(this,"pendingSessions",new Map),D(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(qe)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay)))}),D(this,"connect",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const r=lt(Se({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});await this.isValidConnect(r),r.optionalNamespaces=qI(r.requiredNamespaces,r.optionalNamespaces),r.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=r;let u=i,h,d=!1;try{if(u){const P=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=P.active}}catch(P){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),P}if(!u||!d){const{topic:P,uri:_}=await this.client.core.pairing.create();u=P,h=_}if(!u){const{message:P}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(P)}const f=await this.client.core.crypto.generateKeyPair(),g=qe.wc_sessionPropose.req.ttl||j.FIVE_MINUTES,m=mt(g),p=lt(Se(Se({requiredNamespaces:n,optionalNamespaces:o,relays:l??[{protocol:Jh}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:m,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Cs()}),w=Ae("session_connect",p.id),{reject:y,resolve:I,done:T}=yr(g,xu),$=({id:P})=>{P===p.id&&(this.client.events.off("proposal_expire",$),this.pendingSessions.delete(p.id),this.events.emit(w,{error:{message:xu,code:0}}))};return this.client.events.on("proposal_expire",$),this.events.once(w,({error:P,session:_})=>{this.client.events.off("proposal_expire",$),P?y(P):_&&I(_)}),await this.sendRequest({topic:u,method:"wc_sessionPropose",params:p,throwOnFailedPublish:!0,clientRpcId:p.id}),await this.setProposal(p.id,p),{uri:h,approval:T}}),D(this,"pair",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(s)}catch(r){throw this.client.logger.error("pair() failed"),r}}),D(this,"approve",async s=>{var r,i,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=s==null?void 0:s.id)==null?void 0:r.toString(),trace:[Ht.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(v){throw o.setError(Ws.no_internet_connection),v}try{await this.isValidProposalId(s==null?void 0:s.id)}catch(v){throw this.client.logger.error(`approve() -> proposal.get(${s==null?void 0:s.id}) failed`),o.setError(Ws.proposal_not_found),v}try{await this.isValidApprove(s)}catch(v){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ws.session_approve_namespace_validation_failure),v}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=s,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:m,requiredNamespaces:p,optionalNamespaces:w}=f;let y=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:g});y||(y=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:Ht.session_approve_started,properties:{topic:g,trace:[Ht.session_approve_started,Ht.session_namespaces_validation_success]}}));const I=await this.client.core.crypto.generateKeyPair(),T=m.publicKey,$=await this.client.core.crypto.generateSharedKey(I,T),P=Se(Se(Se({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:I,metadata:this.client.metadata},expiry:mt(Cr)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),_=Oe.relay;y.addTrace(Ht.subscribing_session_topic);try{await this.client.core.relayer.subscribe($,{transportType:_})}catch(v){throw y.setError(Ws.subscribe_session_topic_failure),v}y.addTrace(Ht.subscribe_session_topic_success);const O=lt(Se({},P),{topic:$,requiredNamespaces:p,optionalNamespaces:w,pairingTopic:g,acknowledged:!1,self:P.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:I,transportType:Oe.relay});await this.client.session.set($,O),y.addTrace(Ht.store_session);try{y.addTrace(Ht.publishing_session_settle),await this.sendRequest({topic:$,method:"wc_sessionSettle",params:P,throwOnFailedPublish:!0}).catch(v=>{throw y==null||y.setError(Ws.session_settle_publish_failure),v}),y.addTrace(Ht.session_settle_publish_success),y.addTrace(Ht.publishing_session_approve),await this.sendResult({id:a,topic:g,result:{relay:{protocol:c??"irn"},responderPublicKey:I},throwOnFailedPublish:!0}).catch(v=>{throw y==null||y.setError(Ws.session_approve_publish_failure),v}),y.addTrace(Ht.session_approve_publish_success)}catch(v){throw this.client.logger.error(v),this.client.session.delete($,$e("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe($),v}return this.client.core.eventClient.deleteEvent({eventId:y.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:m.metadata}),await this.client.proposal.delete(a,$e("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:g}),await this.setExpiry($,mt(Cr)),{topic:$,acknowledged:()=>Promise.resolve(this.client.session.get($))}}),D(this,"reject",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(s)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:i}=s;let n;try{n=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}n&&(await this.sendError({id:r,topic:n,error:i,rpcOpts:qe.wc_sessionPropose.reject}),await this.client.proposal.delete(r,$e("USER_DISCONNECTED")))}),D(this,"update",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(s)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:r,namespaces:i}=s,{done:n,resolve:o,reject:a}=yr(),c=Cs(),l=Br().toString(),u=this.client.session.get(r).namespaces;return this.events.once(Ae("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(r,{namespaces:i}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(r,{namespaces:u}),a(h)}),{acknowledged:n}}),D(this,"extend",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(s)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=s,i=Cs(),{done:n,resolve:o,reject:a}=yr();return this.events.once(Ae("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,mt(Cr)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),D(this,"request",async s=>{this.isInitialized();try{await this.isValidRequest(s)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}const{chainId:r,request:i,topic:n,expiry:o=qe.wc_sessionRequest.req.ttl}=s,a=this.client.session.get(n);(a==null?void 0:a.transportType)===Oe.relay&&await this.confirmOnlineStateOrThrow();const c=Cs(),l=Br().toString(),{done:u,resolve:h,reject:d}=yr(o,"Request expired. Please try again.");this.events.once(Ae("session_request",c),({error:w,result:y})=>{w?d(w):h(y)});const f="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:{request:lt(Se({},i),{expiryTimestamp:mt(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:n,request:i,chainId:r,id:c}),await u();const m={request:lt(Se({},i),{expiryTimestamp:mt(o)}),chainId:r},p=this.shouldSetTVF(f,m);return await Promise.all([new Promise(async w=>{await this.sendRequest(Se({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:m,expiry:o,throwOnFailedPublish:!0},p&&{tvf:this.getTVFParams(c,m)})).catch(y=>d(y)),this.client.events.emit("session_request_sent",{topic:n,request:i,chainId:r,id:c}),w()}),new Promise(async w=>{var y;if(!((y=a.sessionConfig)!=null&&y.disableDeepLink)){const I=await mE(this.client.core.storage,Ou);await pE({id:c,topic:n,wcDeepLink:I})}w()}),u()]).then(w=>w[2])}),D(this,"respond",async s=>{this.isInitialized(),await this.isValidRespond(s);const{topic:r,response:i}=s,{id:n}=i,o=this.client.session.get(r);o.transportType===Oe.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);gs(i)?await this.sendResult({id:n,topic:r,result:i.result,throwOnFailedPublish:!0,appLink:a}):ns(i)&&await this.sendError({id:n,topic:r,error:i.error,appLink:a}),this.cleanupAfterResponse(s)}),D(this,"ping",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(s)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:r}=s;if(this.client.session.keys.includes(r)){const i=Cs(),n=Br().toString(),{done:o,resolve:a,reject:c}=yr();this.events.once(Ae("session_ping",i),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),D(this,"emit",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(s);const{topic:r,event:i,chainId:n}=s,o=Br().toString(),a=Cs();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:i,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),D(this,"disconnect",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(s);const{topic:r}=s;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:$e("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:i}=Z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(i)}}),D(this,"find",s=>(this.isInitialized(),this.client.session.getAll().filter(r=>WI(r,s)))),D(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),D(this,"authenticate",async(s,r)=>{var i;this.isInitialized(),this.isValidAuthenticate(s);const n=r&&this.client.core.linkModeSupportedApps.includes(r)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=n?Oe.link_mode:Oe.relay;o===Oe.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:d,exp:f,nbf:g,methods:m=[],expiry:p}=s,w=[...s.resources||[]],{topic:y,uri:I}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:y,uri:I}});const T=await this.client.core.crypto.generateKeyPair(),$=Go(T);if(await Promise.all([this.client.auth.authKeys.set(Ln,{responseTopic:$,publicKey:T}),this.client.auth.pairingTopics.set($,{topic:$,pairingTopic:y})]),await this.client.core.relayer.subscribe($,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${y}`),m.length>0){const{namespace:A}=Hr(a[0]);let M=c1(A,"request",m);Dn(w)&&(M=u1(M,w.pop())),w.push(M)}const P=p&&p>qe.wc_sessionAuthenticate.req.ttl?p:qe.wc_sessionAuthenticate.req.ttl,_={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:f,nbf:g,resources:w},requester:{publicKey:T,metadata:this.client.metadata},expiryTimestamp:mt(P)},O={eip155:{chains:a,methods:[...new Set(["personal_sign",...m])],events:["chainChanged","accountsChanged"]}},v={requiredNamespaces:{},optionalNamespaces:O,relays:[{protocol:"irn"}],pairingTopic:y,proposer:{publicKey:T,metadata:this.client.metadata},expiryTimestamp:mt(qe.wc_sessionPropose.req.ttl),id:Cs()},{done:x,resolve:S,reject:R}=yr(P,"Request expired"),L=Cs(),E=Ae("session_connect",v.id),N=Ae("session_request",L),C=async({error:A,session:M})=>{this.events.off(N,k),A?R(A):M&&S({session:M})},k=async A=>{var M,q,F;if(await this.deletePendingAuthRequest(L,{message:"fulfilled",code:0}),A.error){const he=$e("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return A.error.code===he.code?void 0:(this.events.off(E,C),R(A.error.message))}await this.deleteProposal(v.id),this.events.off(E,C);const{cacaos:X,responder:G}=A.result,oe=[],le=[];for(const he of X){await iu({cacao:he,projectId:this.client.core.projectId})||(this.client.logger.error(he,"Signature verification failed"),R($e("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Ft}=he,at=Dn(Ft.resources),Me=[Da(Ft.iss)],Ye=Kn(Ft.iss);if(at){const ct=nu(at),Fs=ou(at);oe.push(...ct),Me.push(...Fs)}for(const ct of Me)le.push(`${ct}:${Ye}`)}const Ie=await this.client.core.crypto.generateSharedKey(T,G.publicKey);let ue;oe.length>0&&(ue={topic:Ie,acknowledged:!0,self:{publicKey:T,metadata:this.client.metadata},peer:G,controller:G.publicKey,expiry:mt(Cr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:y,namespaces:Au([...new Set(oe)],[...new Set(le)]),transportType:o},await this.client.core.relayer.subscribe(Ie,{transportType:o}),await this.client.session.set(Ie,ue),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:G.metadata}),ue=this.client.session.get(Ie)),(M=this.client.metadata.redirect)!=null&&M.linkMode&&(q=G.metadata.redirect)!=null&&q.linkMode&&(F=G.metadata.redirect)!=null&&F.universal&&r&&(this.client.core.addLinkModeSupportedApp(G.metadata.redirect.universal),this.client.session.update(Ie,{transportType:Oe.link_mode})),S({auths:X,session:ue})};this.events.once(E,C),this.events.once(N,k);let U;try{if(n){const A=Xs("wc_sessionAuthenticate",_,L);this.client.core.history.set(y,A);const M=await this.client.core.crypto.encode("",A,{type:TI,encoding:Si});U=An(r,y,M)}else await Promise.all([this.sendRequest({topic:y,method:"wc_sessionAuthenticate",params:_,expiry:s.expiry,throwOnFailedPublish:!0,clientRpcId:L}),this.sendRequest({topic:y,method:"wc_sessionPropose",params:v,expiry:qe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:v.id})])}catch(A){throw this.events.off(E,C),this.events.off(N,k),A}return await this.setProposal(v.id,v),await this.setAuthRequest(L,{request:lt(Se({},_),{verifyContext:{}}),pairingTopic:y,transportType:o}),{uri:U??I,response:x}}),D(this,"approveSessionAuthenticate",async s=>{const{id:r,auths:i}=s,n=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[Hs.authenticated_session_approve_started]}});try{this.isInitialized()}catch(p){throw n.setError(Ei.no_internet_connection),p}const o=this.getPendingAuthRequest(r);if(!o)throw n.setError(Ei.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||Oe.relay;a===Oe.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=Go(c),h={type:Vo,receiverPublicKey:c,senderPublicKey:l},d=[],f=[];for(const p of i){if(!await iu({cacao:p,projectId:this.client.core.projectId})){n.setError(Ei.invalid_cacao);const $=$e("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:u,error:$,encodeOpts:h}),new Error($.message)}n.addTrace(Hs.cacaos_verified);const{p:w}=p,y=Dn(w.resources),I=[Da(w.iss)],T=Kn(w.iss);if(y){const $=nu(y),P=ou(y);d.push(...$),I.push(...P)}for(const $ of I)f.push(`${$}:${T}`)}const g=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(Hs.create_authenticated_session_topic);let m;if((d==null?void 0:d.length)>0){m={topic:g,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:mt(Cr),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Au([...new Set(d)],[...new Set(f)]),transportType:a},n.addTrace(Hs.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(p){throw n.setError(Ei.subscribe_authenticated_session_topic_failure),p}n.addTrace(Hs.subscribe_authenticated_session_topic_success),await this.client.session.set(g,m),n.addTrace(Hs.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Hs.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:r,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(p){throw n.setError(Ei.authenticated_session_approve_publish_failure),p}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:m}}),D(this,"rejectSessionAuthenticate",async s=>{this.isInitialized();const{id:r,reason:i}=s,n=this.getPendingAuthRequest(r);if(!n)throw new Error(`Could not find pending auth request with id ${r}`);n.transportType===Oe.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Go(o),l={type:Vo,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:i,encodeOpts:l,rpcOpts:qe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.client.proposal.delete(r,$e("USER_DISCONNECTED"))}),D(this,"formatAuthMessage",s=>{this.isInitialized();const{request:r,iss:i}=s;return Pd(r,i)}),D(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const s=this.relayMessageCache.shift();s&&await this.onRelayMessage(s)}catch(s){this.client.logger.error(s)}},50)}),D(this,"cleanupDuplicatePairings",async s=>{if(s.pairingTopic)try{const r=this.client.core.pairing.pairings.get(s.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===s.peer.metadata.url&&n.topic&&n.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),D(this,"deleteSession",async s=>{var r;const{topic:i,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=s,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,$e("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Ou).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===i&&this.deletePendingSessionRequest(l.id,$e("USER_DISCONNECTED"))}),i===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=rs.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),D(this,"deleteProposal",async(s,r)=>{if(r)try{const i=this.client.proposal.get(s),n=this.client.core.eventClient.getEvent({topic:i.pairingTopic});n==null||n.setError(Ws.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(s,$e("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"proposal")}),D(this,"deletePendingSessionRequest",async(s,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(s,r),i?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==s),i&&(this.sessionRequestQueue.state=rs.idle,this.client.events.emit("session_request_expire",{id:s}))}),D(this,"deletePendingAuthRequest",async(s,r,i=!1)=>{await Promise.all([this.client.auth.requests.delete(s,r),i?Promise.resolve():this.client.core.expirer.del(s)])}),D(this,"setExpiry",async(s,r)=>{this.client.session.keys.includes(s)&&(this.client.core.expirer.set(s,r),await this.client.session.update(s,{expiry:r}))}),D(this,"setProposal",async(s,r)=>{this.client.core.expirer.set(s,mt(qe.wc_sessionPropose.req.ttl)),await this.client.proposal.set(s,r)}),D(this,"setAuthRequest",async(s,r)=>{const{request:i,pairingTopic:n,transportType:o=Oe.relay}=r;this.client.core.expirer.set(s,i.expiryTimestamp),await this.client.auth.requests.set(s,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:s,pairingTopic:n,verifyContext:i.verifyContext,transportType:o})}),D(this,"setPendingSessionRequest",async s=>{const{id:r,topic:i,params:n,verifyContext:o}=s,a=n.request.expiryTimestamp||mt(qe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:i,params:n,verifyContext:o})}),D(this,"sendRequest",async s=>{const{topic:r,method:i,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h}=s,d=Xs(i,n,c);let f;const g=!!u;try{const w=g?Si:Nn;f=await this.client.core.crypto.encode(r,d,{encoding:w})}catch(w){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),w}let m;if(fC.includes(i)){const w=Ir(JSON.stringify(d)),y=Ir(f);m=await this.client.core.verify.register({id:y,decryptedId:w})}const p=qe[i].req;if(p.attestation=m,o&&(p.ttl=o),a&&(p.id=a),this.client.core.history.set(r,d),g){const w=An(u,r,f);await globalThis.Linking.openURL(w,this.client.name)}else{const w=qe[i].req;o&&(w.ttl=o),a&&(w.id=a),w.tvf=lt(Se({},h),{correlationId:d.id}),l?(w.internal=lt(Se({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,f,w)):this.client.core.relayer.publish(r,f,w).catch(y=>this.client.logger.error(y))}return d.id}),D(this,"sendResult",async s=>{const{id:r,topic:i,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=s,l=Yn(r,n);let u;const h=c&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const g=h?Si:Nn;u=await this.client.core.crypto.encode(i,l,lt(Se({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),g}let d,f;try{d=await this.client.core.history.get(i,r);const g=d.request;try{this.shouldSetTVF(g.method,g.params)&&(f=this.getTVFParams(r,g.params,n))}catch(m){this.client.logger.warn("sendResult() -> getTVFParams() failed",m)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${r}) failed`),g}if(h){const g=An(c,i,u);await globalThis.Linking.openURL(g,this.client.name)}else{const g=d.request.method,m=qe[g].res;m.tvf=lt(Se({},f),{correlationId:r}),o?(m.internal=lt(Se({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,u,m)):this.client.core.relayer.publish(i,u,m).catch(p=>this.client.logger.error(p))}await this.client.core.history.resolve(l)}),D(this,"sendError",async s=>{const{id:r,topic:i,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=s,l=Qu(r,n);let u;const h=c&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const f=h?Si:Nn;u=await this.client.core.crypto.encode(i,l,lt(Se({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),f}let d;try{d=await this.client.core.history.get(i,r)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),f}if(h){const f=An(c,i,u);await globalThis.Linking.openURL(f,this.client.name)}else{const f=d.request.method,g=a||qe[f].res;this.client.core.relayer.publish(i,u,g)}await this.client.core.history.resolve(l)}),D(this,"cleanup",async()=>{const s=[],r=[];this.client.session.getAll().forEach(i=>{let n=!1;br(i.expiry)&&(n=!0),this.client.core.crypto.keychain.has(i.topic)||(n=!0),n&&s.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{br(i.expiryTimestamp)&&r.push(i.id)}),await Promise.all([...s.map(i=>this.deleteSession({topic:i})),...r.map(i=>this.deleteProposal(i))])}),D(this,"onProviderMessageEvent",async s=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(s):await this.onRelayMessage(s)}),D(this,"onRelayEventRequest",async s=>{this.requestQueue.queue.push(s),await this.processRequestsQueue()}),D(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===rs.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=rs.active;const s=this.requestQueue.queue.shift();if(s)try{await this.processRequest(s)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=rs.idle}),D(this,"processRequest",async s=>{const{topic:r,payload:i,attestation:n,transportType:o,encryptedId:a}=s,c=i.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:i,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,i);case"wc_sessionPing":return await this.onSessionPingRequest(r,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:i,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:i,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),D(this,"onRelayEventResponse",async s=>{const{topic:r,payload:i,transportType:n}=s,o=(await this.client.core.history.get(r,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),D(this,"onRelayEventUnknownPayload",s=>{const{topic:r}=s,{message:i}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),D(this,"shouldIgnorePairingRequest",s=>{const{topic:r,requestMethod:i}=s,n=this.expectedPairingMethodMap.get(r);return!n||n.includes(i)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),D(this,"onSessionProposeRequest",async s=>{const{topic:r,payload:i,attestation:n,encryptedId:o}=s,{params:a,id:c}=i;try{const l=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(ms.proposal_listener_not_found)),this.isValidConnect(Se({},i.params));const u=a.expiryTimestamp||mt(qe.wc_sessionPropose.req.ttl),h=Se({id:c,pairingTopic:r,expiryTimestamp:u},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:n,hash:Ir(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(is.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(l){await this.sendError({id:c,topic:r,error:l,rpcOpts:qe.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),D(this,"onSessionProposeResponse",async(s,r,i)=>{const{id:n}=r;if(gs(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:u,pairingTopic:s,proposalId:n,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:s})}else if(ns(r)){await this.client.proposal.delete(n,$e("USER_DISCONNECTED"));const o=Ae("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),D(this,"onSessionSettleRequest",async(s,r)=>{const{id:i,params:n}=r;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=r.params,f=[...this.pendingSessions.values()].find(p=>p.sessionTopic===s);if(!f)return this.client.logger.error(`Pending session not found for topic ${s}`);const g=this.client.proposal.get(f.proposalId),m=lt(Se(Se(Se({topic:s,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:Oe.relay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:m.peer.metadata}),this.client.events.emit("session_connect",{session:m}),this.events.emit(Ae("session_connect",f.proposalId),{session:m}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:r.id,topic:s,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:i,topic:s,error:o}),this.client.logger.error(o)}}),D(this,"onSessionSettleResponse",async(s,r)=>{const{id:i}=r;gs(r)?(await this.client.session.update(s,{acknowledged:!0}),this.events.emit(Ae("session_approve",i),{})):ns(r)&&(await this.client.session.delete(s,$e("USER_DISCONNECTED")),this.events.emit(Ae("session_approve",i),{error:r.error}))}),D(this,"onSessionUpdateRequest",async(s,r)=>{const{params:i,id:n}=r;try{const o=`${s}_session_update`,a=_i.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:s,error:$e("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Se({topic:s},i));try{_i.set(o,n),await this.client.session.update(s,{namespaces:i.namespaces}),await this.sendResult({id:n,topic:s,result:!0,throwOnFailedPublish:!0})}catch(c){throw _i.delete(o),c}this.client.events.emit("session_update",{id:n,topic:s,params:i})}catch(o){await this.sendError({id:n,topic:s,error:o}),this.client.logger.error(o)}}),D(this,"isRequestOutOfSync",(s,r)=>r.toString().slice(0,-3)<s.toString().slice(0,-3)),D(this,"onSessionUpdateResponse",(s,r)=>{const{id:i}=r,n=Ae("session_update",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);gs(r)?this.events.emit(Ae("session_update",i),{}):ns(r)&&this.events.emit(Ae("session_update",i),{error:r.error})}),D(this,"onSessionExtendRequest",async(s,r)=>{const{id:i}=r;try{this.isValidExtend({topic:s}),await this.setExpiry(s,mt(Cr)),await this.sendResult({id:i,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:i,topic:s})}catch(n){await this.sendError({id:i,topic:s,error:n}),this.client.logger.error(n)}}),D(this,"onSessionExtendResponse",(s,r)=>{const{id:i}=r,n=Ae("session_extend",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);gs(r)?this.events.emit(Ae("session_extend",i),{}):ns(r)&&this.events.emit(Ae("session_extend",i),{error:r.error})}),D(this,"onSessionPingRequest",async(s,r)=>{const{id:i}=r;try{this.isValidPing({topic:s}),await this.sendResult({id:i,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:s})}catch(n){await this.sendError({id:i,topic:s,error:n}),this.client.logger.error(n)}}),D(this,"onSessionPingResponse",(s,r)=>{const{id:i}=r,n=Ae("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);gs(r)?this.events.emit(Ae("session_ping",i),{}):ns(r)&&this.events.emit(Ae("session_ping",i),{error:r.error})},500)}),D(this,"onSessionDeleteRequest",async(s,r)=>{const{id:i}=r;try{this.isValidDisconnect({topic:s,reason:r.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(Ke.publish,async()=>{n(await this.deleteSession({topic:s,id:i}))})}),this.sendResult({id:i,topic:s,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:s,error:$e("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),D(this,"onSessionRequest",async s=>{var r,i,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=s,{id:h,params:d}=a;try{await this.isValidRequest(Se({topic:o},d));const f=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:Ir(JSON.stringify(Xs("wc_sessionRequest",d,h))),encryptedId:l,metadata:f.peer.metadata,transportType:u}),m={id:h,topic:o,params:d,verifyContext:g};await this.setPendingSessionRequest(m),u===Oe.link_mode&&(r=f.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((i=f.peer.metadata.redirect)==null?void 0:i.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(f){await this.sendError({id:h,topic:o,error:f}),this.client.logger.error(f)}}),D(this,"onSessionRequestResponse",(s,r)=>{const{id:i}=r,n=Ae("session_request",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);gs(r)?this.events.emit(Ae("session_request",i),{result:r.result}):ns(r)&&this.events.emit(Ae("session_request",i),{error:r.error})}),D(this,"onSessionEventRequest",async(s,r)=>{const{id:i,params:n}=r;try{const o=`${s}_session_event_${n.event.name}`,a=_i.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(Se({topic:s},n)),this.client.events.emit("session_event",{id:i,topic:s,params:n}),_i.set(o,i)}catch(o){await this.sendError({id:i,topic:s,error:o}),this.client.logger.error(o)}}),D(this,"onSessionAuthenticateResponse",(s,r)=>{const{id:i}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:s,payload:r}),gs(r)?this.events.emit(Ae("session_request",i),{result:r.result}):ns(r)&&this.events.emit(Ae("session_request",i),{error:r.error})}),D(this,"onSessionAuthenticateRequest",async s=>{var r;const{topic:i,payload:n,attestation:o,encryptedId:a,transportType:c}=s;try{const{requester:l,authPayload:u,expiryTimestamp:h}=n.params,d=await this.getVerifyContext({attestationId:o,hash:Ir(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),f={requester:l,pairingTopic:i,id:n.id,authPayload:u,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(n.id,{request:f,pairingTopic:i,transportType:c}),c===Oe.link_mode&&(r=l.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:n.params,id:n.id,verifyContext:d})}catch(l){this.client.logger.error(l);const u=n.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(n.params.requester.metadata,c),f={type:Vo,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:n.id,topic:i,error:l,encodeOpts:f,rpcOpts:qe.wc_sessionAuthenticate.autoReject,appLink:d})}}),D(this,"addSessionRequestToSessionRequestQueue",s=>{this.sessionRequestQueue.queue.push(s)}),D(this,"cleanupAfterResponse",s=>{this.deletePendingSessionRequest(s.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=rs.idle,this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay))}),D(this,"cleanupPendingSentRequestsForTopic",({topic:s,error:r})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(n=>n.topic===s&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=Ae("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(Ae("session_request",n.request.id),{error:r})})}),D(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===rs.active){this.client.logger.info("session request queue is already active.");return}const s=this.sessionRequestQueue.queue[0];if(!s){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=rs.active,this.emitSessionRequest(s)}catch(r){this.client.logger.error(r)}}),D(this,"emitSessionRequest",s=>{this.client.events.emit("session_request",s)}),D(this,"onPairingCreated",s=>{if(s.methods&&this.expectedPairingMethodMap.set(s.topic,s.methods),s.active)return;const r=this.client.proposal.getAll().find(i=>i.pairingTopic===s.topic);r&&this.onSessionProposeRequest({topic:s.topic,payload:Xs("wc_sessionPropose",lt(Se({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id)})}),D(this,"isValidConnect",async s=>{if(!Vt(s)){const{message:l}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(l)}const{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=s;if(Et(r)||await this.isValidPairingTopic(r),!QI(c)){const{message:l}=Z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!Et(i)&&Ms(i)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(i,"requiredNamespaces")}if(!Et(n)&&Ms(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),Et(o)||this.validateSessionProps(o,"sessionProperties"),!Et(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(i||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(u=>l.includes(u)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),D(this,"validateNamespaces",(s,r)=>{const i=XI(s,"connect()",r);if(i)throw new Error(i.message)}),D(this,"isValidApprove",async s=>{if(!Vt(s))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:r,namespaces:i,relayProtocol:n,sessionProperties:o,scopedProperties:a}=s;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),l=Jo(i,"approve()");if(l)throw new Error(l.message);const u=Pu(c.requiredNamespaces,i,"approve()");if(u)throw new Error(u.message);if(!He(n,!0)){const{message:h}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(h)}if(Et(o)||this.validateSessionProps(o,"sessionProperties"),!Et(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(d=>h.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),D(this,"isValidReject",async s=>{if(!Vt(s)){const{message:n}=Z("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(n)}const{id:r,reason:i}=s;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!tC(i)){const{message:n}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(n)}}),D(this,"isValidSessionSettleRequest",s=>{if(!Vt(s)){const{message:l}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${s}`);throw new Error(l)}const{relay:r,controller:i,namespaces:n,expiry:o}=s;if(!Vd(r)){const{message:l}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=KI(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Jo(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(br(o)){const{message:l}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),D(this,"isValidUpdate",async s=>{if(!Vt(s)){const{message:c}=Z("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(c)}const{topic:r,namespaces:i}=s;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const n=this.client.session.get(r),o=Jo(i,"update()");if(o)throw new Error(o.message);const a=Pu(n.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),D(this,"isValidExtend",async s=>{if(!Vt(s)){const{message:i}=Z("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(i)}const{topic:r}=s;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),D(this,"isValidRequest",async s=>{if(!Vt(s)){const{message:c}=Z("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(c)}const{topic:r,request:i,chainId:n,expiry:o}=s;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!_u(a,n)){const{message:c}=Z("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!sC(i)){const{message:c}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!nC(a,n,i.method)){const{message:c}=Z("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!lC(o,Xo)){const{message:c}=Z("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Xo.min} and ${Xo.max}`);throw new Error(c)}}),D(this,"isValidRespond",async s=>{var r;if(!Vt(s)){const{message:o}=Z("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(o)}const{topic:i,response:n}=s;try{await this.isValidSessionTopic(i)}catch(o){throw(r=s==null?void 0:s.response)!=null&&r.id&&this.cleanupAfterResponse(s),o}if(!rC(n)){const{message:o}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),D(this,"isValidPing",async s=>{if(!Vt(s)){const{message:i}=Z("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(i)}const{topic:r}=s;await this.isValidSessionOrPairingTopic(r)}),D(this,"isValidEmit",async s=>{if(!Vt(s)){const{message:a}=Z("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(a)}const{topic:r,event:i,chainId:n}=s;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!_u(o,n)){const{message:a}=Z("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!iC(i)){const{message:a}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!oC(o,n,i.name)){const{message:a}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),D(this,"isValidDisconnect",async s=>{if(!Vt(s)){const{message:i}=Z("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(i)}const{topic:r}=s;await this.isValidSessionOrPairingTopic(r)}),D(this,"isValidAuthenticate",s=>{const{chains:r,uri:i,domain:n,nonce:o}=s;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!He(i,!1))throw new Error("uri is required parameter");if(!He(n,!1))throw new Error("domain is required parameter");if(!He(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>Hr(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Hr(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),D(this,"getVerifyContext",async s=>{const{attestationId:r,hash:i,encryptedId:n,metadata:o,transportType:a}=s,c={verified:{verifyUrl:o.verifyUrl||qi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===Oe.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:r,hash:i,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),D(this,"validateSessionProps",(s,r)=>{Object.values(s).forEach((i,n)=>{if(i==null){const{message:o}=Z("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${i} for key ${Object.keys(s)[n]}`);throw new Error(o)}})}),D(this,"getPendingAuthRequest",s=>{const r=this.client.auth.requests.get(s);return typeof r=="object"?r:void 0}),D(this,"addToRecentlyDeleted",(s,r)=>{if(this.recentlyDeletedMap.set(s,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=n)break;this.recentlyDeletedMap.delete(o)}}}),D(this,"checkRecentlyDeleted",s=>{const r=this.recentlyDeletedMap.get(s);if(r){const{message:i}=Z("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${s}`);throw new Error(i)}}),D(this,"isLinkModeEnabled",(s,r)=>{var i,n,o,a,c,l,u,h,d;return!s||r!==Oe.link_mode?!1:((n=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=s==null?void 0:s.redirect)==null?void 0:u.universal)!==void 0&&((h=s==null?void 0:s.redirect)==null?void 0:h.universal)!==""&&((d=s==null?void 0:s.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(s.redirect.universal)&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"}),D(this,"getAppLinkIfEnabled",(s,r)=>{var i;return this.isLinkModeEnabled(s,r)?(i=s==null?void 0:s.redirect)==null?void 0:i.universal:void 0}),D(this,"handleLinkModeMessage",({url:s})=>{if(!s||!s.includes("wc_ev")||!s.includes("topic"))return;const r=Yl(s,"topic")||"",i=decodeURIComponent(Yl(s,"wc_ev")||""),n=this.client.session.keys.includes(r);n&&this.client.session.update(r,{transportType:Oe.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:i,sessionExists:n})}),D(this,"registerLinkModeListeners",async()=>{var s;if(wE()||bd()&&(s=this.client.metadata.redirect)!=null&&s.linkMode){const r=globalThis==null?void 0:globalThis.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await r.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),D(this,"shouldSetTVF",(s,r)=>{if(!r||s!=="wc_sessionRequest")return!1;const{request:i}=r;return Object.keys(ku).includes(i.method)}),D(this,"getTVFParams",(s,r,i)=>{var n,o;try{const a=r.request.method,c=this.extractTxHashesFromResult(a,i);return lt(Se({correlationId:s,rpcMethods:[a],chainId:r.chainId},this.isValidContractData(r.request.params)&&{contractAddresses:[(o=(n=r.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),D(this,"isValidContractData",s=>{var r;if(!s)return!1;try{const i=(s==null?void 0:s.data)||((r=s==null?void 0:s[0])==null?void 0:r.data);if(!i.startsWith("0x"))return!1;const n=i.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),D(this,"extractTxHashesFromResult",(s,r)=>{try{const i=ku[s];if(typeof r=="string")return[r];const n=r[i.key];if(Bs(n))return s==="solana_signAllTransactions"?n.map(o=>GE(o)):n;if(typeof n=="string")return[n]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,s=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,i]of Object.entries(s))for(const n of i)try{await this.onProviderMessageEvent({topic:r,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=Z("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ke.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:s,message:r,attestation:i,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ln)?this.client.auth.authKeys.get(Ln):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(s,r,{receiverPublicKey:o,encoding:n===Oe.link_mode?Si:Nn});Xa(a)?(this.client.core.history.set(s,a),await this.onRelayEventRequest({topic:s,payload:a,attestation:i,transportType:n,encryptedId:Ir(r)})):Qa(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:s,payload:a,transportType:n}),this.client.core.history.delete(s,a.id)):await this.onRelayEventUnknownPayload({topic:s,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(s,r)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Mt.expired,async e=>{const{topic:s,id:r}=dE(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,Z("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,Z("EXPIRED"),!0);s?this.client.session.keys.includes(s)&&(await this.deleteSession({topic:s,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:s})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(Js.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Js.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!He(e,!1)){const{message:s}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(s)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:s}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(s)}if(br(this.client.core.pairing.pairings.get(e).expiry)){const{message:s}=Z("EXPIRED",`pairing topic: ${e}`);throw new Error(s)}}async isValidSessionTopic(e){if(!He(e,!1)){const{message:s}=Z("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(s)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:s}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(s)}if(br(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:s}=Z("EXPIRED",`session topic: ${e}`);throw new Error(s)}if(!this.client.core.crypto.keychain.has(e)){const{message:s}=Z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(s)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(He(e,!1)){const{message:s}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(s)}else{const{message:s}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(s)}}async isValidProposalId(e){if(!eC(e)){const{message:s}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(s)}if(!this.client.proposal.keys.includes(e)){const{message:s}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(s)}if(br(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:s}=Z("EXPIRED",`proposal id: ${e}`);throw new Error(s)}}}class SC extends hr{constructor(e,s){super(e,s,uC,gc),this.core=e,this.logger=s}}let _C=class extends hr{constructor(e,s){super(e,s,hC,gc),this.core=e,this.logger=s}};class PC extends hr{constructor(e,s){super(e,s,pC,gc,r=>r.id),this.core=e,this.logger=s}}class TC extends hr{constructor(e,s){super(e,s,wC,po,()=>Ln),this.core=e,this.logger=s}}class OC extends hr{constructor(e,s){super(e,s,yC,po),this.core=e,this.logger=s}}class xC extends hr{constructor(e,s){super(e,s,bC,po,r=>r.id),this.core=e,this.logger=s}}var kC=Object.defineProperty,$C=(t,e,s)=>e in t?kC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Qo=(t,e,s)=>$C(t,typeof e!="symbol"?e+"":e,s);class RC{constructor(e,s){this.core=e,this.logger=s,Qo(this,"authKeys"),Qo(this,"pairingTopics"),Qo(this,"requests"),this.authKeys=new TC(this.core,this.logger),this.pairingTopics=new OC(this.core,this.logger),this.requests=new xC(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var UC=Object.defineProperty,DC=(t,e,s)=>e in t?UC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ce=(t,e,s)=>DC(t,typeof e!="symbol"?e+"":e,s);let LC=class Zd extends Rv{constructor(e){super(e),ce(this,"protocol",Gd),ce(this,"version",Jd),ce(this,"name",Zo.name),ce(this,"metadata"),ce(this,"core"),ce(this,"logger"),ce(this,"events",new lr.EventEmitter),ce(this,"engine"),ce(this,"session"),ce(this,"proposal"),ce(this,"pendingRequest"),ce(this,"auth"),ce(this,"signConfig"),ce(this,"on",(r,i)=>this.events.on(r,i)),ce(this,"once",(r,i)=>this.events.once(r,i)),ce(this,"off",(r,i)=>this.events.off(r,i)),ce(this,"removeListener",(r,i)=>this.events.removeListener(r,i)),ce(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),ce(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"update",async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"request",async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"find",r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),ce(this,"authenticate",async(r,i)=>{try{return await this.engine.authenticate(r,i)}catch(n){throw this.logger.error(n.message),n}}),ce(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),this.name=(e==null?void 0:e.name)||Zo.name,this.metadata=uE(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const s=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Za(en({level:(e==null?void 0:e.logger)||Zo.logger}));this.core=(e==null?void 0:e.core)||new xv(e),this.logger=ht(s,this.name),this.session=new _C(this.core,this.logger),this.proposal=new SC(this.core,this.logger),this.pendingRequest=new PC(this.core,this.logger),this.engine=new AC(this),this.auth=new RC(this.core,this.logger)}static async init(e){const s=new Zd(e);return await s.initialize(),s}get context(){return $t(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},j.toMiliseconds(j.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Ru="error",BC="wss://relay.walletconnect.org",MC="wc",jC="universal_provider",Sn=`${MC}@2:${jC}:`,Xd="https://rpc.walletconnect.org/v1/",Dr="generic",qC=`${Xd}bundler`,qt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function FC(){}function mc(t){return t==null||typeof t!="object"&&typeof t!="function"}function wc(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function zC(t){if(mc(t))return t;if(Array.isArray(t)||wc(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),s=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new s(t);if(t instanceof RegExp){const r=new s(t);return r.lastIndex=t.lastIndex,r}if(t instanceof DataView)return new s(t.buffer.slice(0));if(t instanceof Error){const r=new s(t.message);return r.stack=t.stack,r.name=t.name,r.cause=t.cause,r}if(typeof File<"u"&&t instanceof File)return new s([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const r=Object.create(e);return Object.assign(r,t)}return t}function Uu(t){return typeof t=="object"&&t!==null}function Qd(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function ep(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const WC="[object RegExp]",tp="[object String]",sp="[object Number]",rp="[object Boolean]",ip="[object Arguments]",HC="[object Symbol]",KC="[object Date]",VC="[object Map]",GC="[object Set]",JC="[object Array]",YC="[object ArrayBuffer]",ZC="[object Object]",XC="[object DataView]",QC="[object Uint8Array]",eN="[object Uint8ClampedArray]",tN="[object Uint16Array]",sN="[object Uint32Array]",rN="[object Int8Array]",iN="[object Int16Array]",nN="[object Int32Array]",oN="[object Float32Array]",aN="[object Float64Array]";function cN(t,e){return zr(t,void 0,t,new Map,e)}function zr(t,e,s,r=new Map,i=void 0){const n=i==null?void 0:i(t,e,s,r);if(n!=null)return n;if(mc(t))return t;if(r.has(t))return r.get(t);if(Array.isArray(t)){const o=new Array(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=zr(t[a],a,s,r,i);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;r.set(t,o);for(const[a,c]of t)o.set(a,zr(c,a,s,r,i));return o}if(t instanceof Set){const o=new Set;r.set(t,o);for(const a of t)o.add(zr(a,void 0,s,r,i));return o}if(typeof rt.Buffer<"u"&&rt.Buffer.isBuffer(t))return t.subarray();if(wc(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=zr(t[a],a,s,r,i);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return r.set(t,o),Zs(o,t,s,r,i),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return r.set(t,o),Zs(o,t,s,r,i),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return r.set(t,o),Zs(o,t,s,r,i),o}if(t instanceof Error){const o=new t.constructor;return r.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Zs(o,t,s,r,i),o}if(typeof t=="object"&&lN(t)){const o=Object.create(Object.getPrototypeOf(t));return r.set(t,o),Zs(o,t,s,r,i),o}return t}function Zs(t,e,s=t,r,i){const n=[...Object.keys(e),...Qd(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=zr(e[a],a,s,r,i))}}function lN(t){switch(ep(t)){case ip:case JC:case YC:case XC:case rp:case KC:case oN:case aN:case rN:case iN:case nN:case VC:case sp:case ZC:case WC:case GC:case tp:case HC:case QC:case eN:case tN:case sN:return!0;default:return!1}}function uN(t,e){return cN(t,(s,r,i,n)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case sp:case tp:case rp:{const o=new t.constructor(t==null?void 0:t.valueOf());return Zs(o,t),o}case ip:{const o={};return Zs(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function Du(t){return uN(t)}function Lu(t){return t!==null&&typeof t=="object"&&ep(t)==="[object Arguments]"}function hN(t){return wc(t)}function dN(t){var s;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!((s=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&s.writable)?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function pN(t,...e){const s=e.slice(0,-1),r=e[e.length-1];let i=t;for(let n=0;n<s.length;n++){const o=s[n];i=Ka(i,o,r,new Map)}return i}function Ka(t,e,s,r){if(mc(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(r.has(e))return zC(r.get(e));if(r.set(e,t),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const i=[...Object.keys(e),...Qd(e)];for(let n=0;n<i.length;n++){const o=i[n];let a=e[o],c=t[o];if(Lu(a)&&(a={...a}),Lu(c)&&(c={...c}),typeof rt.Buffer<"u"&&rt.Buffer.isBuffer(a)&&(a=Du(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],h=Reflect.ownKeys(c);for(let d=0;d<h.length;d++){const f=h[d];u[f]=c[f]}c=u}else c=[];const l=s(c,a,o,t,e,r);l!=null?t[o]=l:Array.isArray(a)||Uu(c)&&Uu(a)?t[o]=Ka(c,a,s,r):c==null&&dN(a)?t[o]=Ka({},a,s,r):c==null&&hN(a)?t[o]=Du(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function fN(t,...e){return pN(t,...e,FC)}var gN=Object.defineProperty,mN=Object.defineProperties,wN=Object.getOwnPropertyDescriptors,Bu=Object.getOwnPropertySymbols,yN=Object.prototype.hasOwnProperty,bN=Object.prototype.propertyIsEnumerable,Mu=(t,e,s)=>e in t?gN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_n=(t,e)=>{for(var s in e||(e={}))yN.call(e,s)&&Mu(t,s,e[s]);if(Bu)for(var s of Bu(e))bN.call(e,s)&&Mu(t,s,e[s]);return t},vN=(t,e)=>mN(t,wN(e));function kt(t,e,s){var r;const i=Hr(t);return((r=e.rpcMap)==null?void 0:r[i.reference])||`${Xd}?chainId=${i.namespace}:${i.reference}&projectId=${s}`}function dr(t){return t.includes(":")?t.split(":")[1]:t}function np(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function EN(t,e){const s=Object.keys(e.namespaces).filter(i=>i.includes(t));if(!s.length)return[];const r=[];return s.forEach(i=>{const n=e.namespaces[i].accounts;r.push(...n)}),r}function Pn(t={},e={}){const s=ju(t),r=ju(e);return fN(s,r)}function ju(t){var e,s,r,i,n;const o={};if(!Ms(t))return o;for(const[a,c]of Object.entries(t)){const l=ho(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],d=c.rpcMap||{},f=Fr(a);o[f]=vN(_n(_n({},o[f]),c),{chains:cs(l,(e=o[f])==null?void 0:e.chains),methods:cs(u,(s=o[f])==null?void 0:s.methods),events:cs(h,(r=o[f])==null?void 0:r.events)}),(Ms(d)||Ms(((i=o[f])==null?void 0:i.rpcMap)||{}))&&(o[f].rpcMap=_n(_n({},d),(n=o[f])==null?void 0:n.rpcMap))}return o}function qu(t){return t.includes(":")?t.split(":")[2]:t}function Fu(t){const e={};for(const[s,r]of Object.entries(t)){const i=r.methods||[],n=r.events||[],o=r.accounts||[],a=ho(s)?[s]:r.chains?r.chains:np(r.accounts);e[s]={chains:a,methods:i,events:n,accounts:o}}return e}function ea(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}const op={},we=t=>op[t],ta=(t,e)=>{op[t]=e};var IN=Object.defineProperty,CN=(t,e,s)=>e in t?IN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Nr=(t,e,s)=>CN(t,typeof e!="symbol"?e+"":e,s);class NN{constructor(e){Nr(this,"name","polkadot"),Nr(this,"client"),Nr(this,"httpProviders"),Nr(this,"events"),Nr(this,"namespace"),Nr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=dr(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new jt(new Qt(r,we("disableProviderPing")))}}var AN=Object.defineProperty,SN=Object.defineProperties,_N=Object.getOwnPropertyDescriptors,zu=Object.getOwnPropertySymbols,PN=Object.prototype.hasOwnProperty,TN=Object.prototype.propertyIsEnumerable,Va=(t,e,s)=>e in t?AN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Wu=(t,e)=>{for(var s in e||(e={}))PN.call(e,s)&&Va(t,s,e[s]);if(zu)for(var s of zu(e))TN.call(e,s)&&Va(t,s,e[s]);return t},Hu=(t,e)=>SN(t,_N(e)),Ar=(t,e,s)=>Va(t,typeof e!="symbol"?e+"":e,s);class ON{constructor(e){Ar(this,"name","eip155"),Ar(this,"client"),Ar(this,"chainId"),Ar(this,"namespace"),Ar(this,"httpProviders"),Ar(this,"events"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(parseInt(e),s),this.chainId=parseInt(e),this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,s){const r=s||kt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new jt(new Qt(r,we("disableProviderPing")))}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=parseInt(dr(s));e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}async handleSwitchChain(e){var s,r;let i=e.request.params?(s=e.request.params[0])==null?void 0:s.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;const n=parseInt(i,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(r=this.namespace.chains)==null?void 0:r[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var s,r,i,n,o;const a=(r=(s=e.request)==null?void 0:s.params)==null?void 0:r[0],c=((n=(i=e.request)==null?void 0:i.params)==null?void 0:n[1])||[],l=`${a}${c.join(",")}`;if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const u=this.client.session.get(e.topic),h=((o=u==null?void 0:u.sessionProperties)==null?void 0:o.capabilities)||{};if(h!=null&&h[l])return h==null?void 0:h[l];const d=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Hu(Wu({},u.sessionProperties||{}),{capabilities:Hu(Wu({},h||{}),{[l]:d})})})}catch(f){console.warn("Failed to update session with capabilities",f)}return d}async getCallStatus(e){var s,r;const i=this.client.session.get(e.topic),n=(s=i.sessionProperties)==null?void 0:s.bundler_name;if(n){const a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(r=i.sessionProperties)==null?void 0:r.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,s){var r;const i=new URL(e),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Xs("eth_getUserOperationReceipt",[(r=s.request.params)==null?void 0:r[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,s){return`${qC}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${s}`}}var xN=Object.defineProperty,kN=(t,e,s)=>e in t?xN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Sr=(t,e,s)=>kN(t,typeof e!="symbol"?e+"":e,s);class $N{constructor(e){Sr(this,"name","solana"),Sr(this,"client"),Sr(this,"httpProviders"),Sr(this,"events"),Sr(this,"namespace"),Sr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=dr(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new jt(new Qt(r,we("disableProviderPing")))}}var RN=Object.defineProperty,UN=(t,e,s)=>e in t?RN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_r=(t,e,s)=>UN(t,typeof e!="symbol"?e+"":e,s);class DN{constructor(e){_r(this,"name","cosmos"),_r(this,"client"),_r(this,"httpProviders"),_r(this,"events"),_r(this,"namespace"),_r(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=dr(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new jt(new Qt(r,we("disableProviderPing")))}}var LN=Object.defineProperty,BN=(t,e,s)=>e in t?LN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Pr=(t,e,s)=>BN(t,typeof e!="symbol"?e+"":e,s);class MN{constructor(e){Pr(this,"name","algorand"),Pr(this,"client"),Pr(this,"httpProviders"),Pr(this,"events"),Pr(this,"namespace"),Pr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){if(!this.httpProviders[e]){const r=s||kt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new jt(new Qt(r,we("disableProviderPing")))}}var jN=Object.defineProperty,qN=(t,e,s)=>e in t?jN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Tr=(t,e,s)=>qN(t,typeof e!="symbol"?e+"":e,s);class FN{constructor(e){Tr(this,"name","cip34"),Tr(this,"client"),Tr(this,"httpProviders"),Tr(this,"events"),Tr(this,"namespace"),Tr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{const r=this.getCardanoRPCUrl(s),i=dr(s);e[i]=this.createHttpProvider(i,r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}getCardanoRPCUrl(e){const s=this.namespace.rpcMap;if(s)return s[e]}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||this.getCardanoRPCUrl(e);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new jt(new Qt(r,we("disableProviderPing")))}}var zN=Object.defineProperty,WN=(t,e,s)=>e in t?zN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Or=(t,e,s)=>WN(t,typeof e!="symbol"?e+"":e,s);class HN{constructor(e){Or(this,"name","elrond"),Or(this,"client"),Or(this,"httpProviders"),Or(this,"events"),Or(this,"namespace"),Or(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=dr(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new jt(new Qt(r,we("disableProviderPing")))}}var KN=Object.defineProperty,VN=(t,e,s)=>e in t?KN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,xr=(t,e,s)=>VN(t,typeof e!="symbol"?e+"":e,s);class GN{constructor(e){xr(this,"name","multiversx"),xr(this,"client"),xr(this,"httpProviders"),xr(this,"events"),xr(this,"namespace"),xr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=dr(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new jt(new Qt(r,we("disableProviderPing")))}}var JN=Object.defineProperty,YN=(t,e,s)=>e in t?JN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,kr=(t,e,s)=>YN(t,typeof e!="symbol"?e+"":e,s);class ZN{constructor(e){kr(this,"name","near"),kr(this,"client"),kr(this,"httpProviders"),kr(this,"events"),kr(this,"namespace"),kr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){if(this.chainId=e,!this.httpProviders[e]){const r=s||kt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace);return typeof r>"u"?void 0:new jt(new Qt(r,we("disableProviderPing")))}}var XN=Object.defineProperty,QN=(t,e,s)=>e in t?XN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,$r=(t,e,s)=>QN(t,typeof e!="symbol"?e+"":e,s);class eA{constructor(e){$r(this,"name","tezos"),$r(this,"client"),$r(this,"httpProviders"),$r(this,"events"),$r(this,"namespace"),$r(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){if(this.chainId=e,!this.httpProviders[e]){const r=s||kt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{e[s]=this.createHttpProvider(s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace);return typeof r>"u"?void 0:new jt(new Qt(r))}}var tA=Object.defineProperty,sA=(t,e,s)=>e in t?tA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Rr=(t,e,s)=>sA(t,typeof e!="symbol"?e+"":e,s);class rA{constructor(e){Rr(this,"name",Dr),Rr(this,"client"),Rr(this,"httpProviders"),Rr(this,"events"),Rr(this,"namespace"),Rr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){var e,s;const r={};return(s=(e=this.namespace)==null?void 0:e.accounts)==null||s.forEach(i=>{const n=Hr(i);r[`${n.namespace}:${n.reference}`]=this.createHttpProvider(i)}),r}getHttpProvider(e){const s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new jt(new Qt(r,we("disableProviderPing")))}}var iA=Object.defineProperty,nA=Object.defineProperties,oA=Object.getOwnPropertyDescriptors,Ku=Object.getOwnPropertySymbols,aA=Object.prototype.hasOwnProperty,cA=Object.prototype.propertyIsEnumerable,Ga=(t,e,s)=>e in t?iA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Tn=(t,e)=>{for(var s in e||(e={}))aA.call(e,s)&&Ga(t,s,e[s]);if(Ku)for(var s of Ku(e))cA.call(e,s)&&Ga(t,s,e[s]);return t},sa=(t,e)=>nA(t,oA(e)),Bt=(t,e,s)=>Ga(t,typeof e!="symbol"?e+"":e,s);class yc{constructor(e){Bt(this,"client"),Bt(this,"namespaces"),Bt(this,"optionalNamespaces"),Bt(this,"sessionProperties"),Bt(this,"scopedProperties"),Bt(this,"events",new ec),Bt(this,"rpcProviders",{}),Bt(this,"session"),Bt(this,"providerOpts"),Bt(this,"logger"),Bt(this,"uri"),Bt(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Za(en({level:(e==null?void 0:e.logger)||Ru})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const s=new yc(e);return await s.initialize(),s}async request(e,s,r){const[i,n]=this.validateChain(s);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Tn({},e),chainId:`${i}:${n}`,topic:this.session.topic,expiry:r})}sendAsync(e,s,r,i){const n=new Date().getTime();this.request(e,r,i).then(o=>s(null,Yn(n,o))).catch(o=>s(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:$e("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,s){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:r,response:i}=await this.client.authenticate(e,s);r&&(this.uri=r,this.events.emit("display_uri",r));const n=await i();if(this.session=n.session,this.session){const o=Fu(this.session.namespaces);this.namespaces=Pn(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}removeListener(e,s){this.events.removeListener(e,s)}off(e,s){this.events.off(e,s)}get isWalletConnect(){return!0}async pair(e){const{uri:s,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});s&&(this.uri=s,this.events.emit("display_uri",s));const i=await r();this.session=i;const n=Fu(i.namespaces);return this.namespaces=Pn(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,s){try{if(!this.session)return;const[r,i]=this.validateChain(e),n=this.getProvider(r);n.name===Dr?n.setDefaultChain(`${r}:${i}`,s):n.setDefaultChain(i,s)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const s=this.client.pairing.getAll();if(Bs(s)){for(const r of s)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${s.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,s;if(this.client=this.providerOpts.client||await LC.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Ru,relayUrl:this.providerOpts.relayUrl||BC,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error("Failed to get session",r),new Error(`The provided session: ${(s=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:s.topic} doesn't exist in the Sign client`)}else{const r=this.client.session.getAll();this.session=r[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(s=>Fr(s)))];ta("client",this.client),ta("events",this.events),ta("disableProviderPing",this.disableProviderPing),e.forEach(s=>{if(!this.session)return;const r=EN(s,this.session),i=np(r),n=Pn(this.namespaces,this.optionalNamespaces),o=sa(Tn({},n[s]),{accounts:r,chains:i});switch(s){case"eip155":this.rpcProviders[s]=new ON({namespace:o});break;case"algorand":this.rpcProviders[s]=new MN({namespace:o});break;case"solana":this.rpcProviders[s]=new $N({namespace:o});break;case"cosmos":this.rpcProviders[s]=new DN({namespace:o});break;case"polkadot":this.rpcProviders[s]=new NN({namespace:o});break;case"cip34":this.rpcProviders[s]=new FN({namespace:o});break;case"elrond":this.rpcProviders[s]=new HN({namespace:o});break;case"multiversx":this.rpcProviders[s]=new GN({namespace:o});break;case"near":this.rpcProviders[s]=new ZN({namespace:o});break;case"tezos":this.rpcProviders[s]=new eA({namespace:o});break;default:this.rpcProviders[Dr]?this.rpcProviders[Dr].updateNamespace(o):this.rpcProviders[Dr]=new rA({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var s;const{topic:r}=e;r===((s=this.session)==null?void 0:s.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var s;const{params:r,topic:i}=e;if(i!==((s=this.session)==null?void 0:s.topic))return;const{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&Bs(o)&&this.events.emit("accountsChanged",o.map(qu))}else if(n.name==="chainChanged"){const o=r.chainId,a=r.event.data,c=Fr(o),l=ea(o)!==ea(a)?`${c}:${ea(a)}`:o;this.onChainChanged(l)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:s})=>{var r,i;if(e!==((r=this.session)==null?void 0:r.topic))return;const{namespaces:n}=s,o=(i=this.client)==null?void 0:i.session.get(e);this.session=sa(Tn({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:s})}),this.client.on("session_delete",async e=>{var s;e.topic===((s=this.session)==null?void 0:s.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",sa(Tn({},$e("USER_DISCONNECTED")),{data:e.topic})))}),this.on(qt.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Dr]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var s;this.getProvider(e).updateNamespace((s=this.session)==null?void 0:s.namespaces[e])})}setNamespaces(e){const{namespaces:s={},optionalNamespaces:r={},sessionProperties:i,scopedProperties:n}=e;this.optionalNamespaces=Pn(s,r),this.sessionProperties=i,this.scopedProperties=n}validateChain(e){const[s,r]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[s,r];if(s&&!Object.keys(this.namespaces||{}).map(o=>Fr(o)).includes(s))throw new Error(`Namespace '${s}' is not configured. Please call connect() first with namespace config.`);if(s&&r)return[s,r];const i=Fr(Object.keys(this.namespaces)[0]),n=this.rpcProviders[i].getDefaultChain();return[i,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,s=!1){if(!this.namespaces)return;const[r,i]=this.validateChain(e);if(!i)return;this.updateNamespaceChain(r,i),this.events.emit("chainChanged",i);const n=this.getProvider(r).getDefaultChain();s||this.getProvider(r).setDefaultChain(i),this.emitAccountsChangedOnChainChange({namespace:r,previousChainId:n,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:s,newChainId:r}){var i,n;try{if(s===r)return;const o=(n=(i=this.session)==null?void 0:i.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(qu);if(!Bs(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,s){if(!this.namespaces)return;const r=this.namespaces[e]?e:`${e}:${s}`,i={chains:[],methods:[],events:[],defaultChain:s};this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=s):this.namespaces[r]=i}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,s){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.setItem(`${Sn}/${e}${i}`,s)}async getFromStore(e){var s;const r=((s=this.session)==null?void 0:s.topic)||"";return await this.client.core.storage.getItem(`${Sn}/${e}${r}`)}async deleteFromStore(e){var s;const r=((s=this.session)==null?void 0:s.topic)||"";await this.client.core.storage.removeItem(`${Sn}/${e}${r}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const s=await this.client.core.storage.getKeys();for(const r of s)r.startsWith(Sn)&&await this.client.core.storage.removeItem(r)}catch(s){this.logger.warn("Failed to cleanup storage",s)}}}function On(t,e){return W.getConnectorId(t)===e}function lA(t){const e=Array.from(b.state.chains.keys());let s=[];return t?(s.push([t,b.state.chains.get(t)]),On(t,V.CONNECTOR_ID.WALLET_CONNECT)?e.forEach(r=>{r!==t&&On(r,V.CONNECTOR_ID.WALLET_CONNECT)&&s.push([r,b.state.chains.get(r)])}):On(t,V.CONNECTOR_ID.AUTH)&&e.forEach(r=>{r!==t&&On(r,V.CONNECTOR_ID.AUTH)&&s.push([r,b.state.chains.get(r)])})):s=Array.from(b.state.chains.entries()),s}const xs={EIP155:"eip155",CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED"},Gn={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900",2741:"fc2427d1-5af9-4a9c-8da5-6f94627cd900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200"},ConnectorImageIds:{[V.CONNECTOR_ID.COINBASE]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[V.CONNECTOR_ID.COINBASE_SDK]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[V.CONNECTOR_ID.SAFE]:"461db637-8616-43ce-035a-d89b8a1d5800",[V.CONNECTOR_ID.LEDGER]:"54a1aa77-d202-4f8d-0fb2-5d2bb6db0300",[V.CONNECTOR_ID.WALLET_CONNECT]:"ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",[V.CONNECTOR_ID.INJECTED]:"07ba87ed-43aa-4adf-4540-9e6a2b9cae00"},ConnectorNamesMap:{[V.CONNECTOR_ID.INJECTED]:"Browser Wallet",[V.CONNECTOR_ID.WALLET_CONNECT]:"WalletConnect",[V.CONNECTOR_ID.COINBASE]:"Coinbase",[V.CONNECTOR_ID.COINBASE_SDK]:"Coinbase",[V.CONNECTOR_ID.LEDGER]:"Ledger",[V.CONNECTOR_ID.SAFE]:"Safe"}},bc={getCaipTokens(t){if(!t)return;const e={};return Object.entries(t).forEach(([s,r])=>{e[`${xs.EIP155}:${s}`]=r}),e},isLowerCaseMatch(t,e){return(t==null?void 0:t.toLowerCase())===(e==null?void 0:e.toLowerCase())}};new AbortController;const Ur={UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"INVALID_APP_CONFIGURATION"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{shortMessage:"Network Not Found",longMessage:"Network not found - please make sure it is included in 'networks' array in createAppKit function"},INVALID_APP_CONFIGURATION:{shortMessage:"Invalid App Configuration",longMessage:()=>`Origin ${uA()?window.origin:"unknown"} not found on Allowlist - update configuration on cloud.reown.com`},IFRAME_LOAD_FAILED:{shortMessage:"Network Error - Could not load embedded wallet",longMessage:()=>"There was an issue loading the embedded wallet. Please try again later."},IFRAME_REQUEST_TIMEOUT:{shortMessage:"Embedded Wallet Request Timed Out",longMessage:()=>"There was an issue doing the request to the embedded wallet. Please try again later."},UNVERIFIED_DOMAIN:{shortMessage:"Invalid App Configuration",longMessage:()=>"There was an issue loading the embedded wallet. Please verify that your domain is allowed at cloud.reown.com"},JWT_TOKEN_NOT_VALID:{shortMessage:"Session Expired",longMessage:"Invalid session found on UniversalProvider - please check your time settings and connect again"},INVALID_PROJECT_ID:{shortMessage:"Invalid App Configuration",longMessage:"Invalid Project ID - update configuration"},PROJECT_ID_NOT_CONFIGURED:{shortMessage:"Project ID Not Configured",longMessage:"Project ID Not Configured - update configuration on cloud.reown.com"}}};function uA(){return typeof window<"u"}const hA={createLogger(t,e="error"){const s=en({level:e}),{logger:r}=Xu({opts:s});return r.error=(...i)=>{for(const n of i)if(n instanceof Error){t(n,...i);return}t(void 0,...i)},r}},dA="rpc.walletconnect.org";function Vu(t,e){const s=new URL("https://rpc.walletconnect.org/v1/");return s.searchParams.set("chainId",t),s.searchParams.set("projectId",e),s.toString()}const ra=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],Lr={extendRpcUrlWithProjectId(t,e){let s=!1;try{s=new URL(t).host===dA}catch{s=!1}if(s){const r=new URL(t);return r.searchParams.has("projectId")||r.searchParams.set("projectId",e),r.toString()}return t},isCaipNetwork(t){return"chainNamespace"in t&&"caipNetworkId"in t},getChainNamespace(t){return this.isCaipNetwork(t)?t.chainNamespace:V.CHAIN.EVM},getCaipNetworkId(t){return this.isCaipNetwork(t)?t.caipNetworkId:`${V.CHAIN.EVM}:${t.id}`},getDefaultRpcUrl(t,e,s){var i,n,o;const r=(o=(n=(i=t.rpcUrls)==null?void 0:i.default)==null?void 0:n.http)==null?void 0:o[0];return ra.includes(e)?Vu(e,s):r||""},extendCaipNetwork(t,{customNetworkImageUrls:e,projectId:s,customRpcUrls:r}){var d,f,g,m,p;const i=this.getChainNamespace(t),n=this.getCaipNetworkId(t),o=(d=t.rpcUrls.default.http)==null?void 0:d[0],a=this.getDefaultRpcUrl(t,n,s),c=((m=(g=(f=t==null?void 0:t.rpcUrls)==null?void 0:f.chainDefault)==null?void 0:g.http)==null?void 0:m[0])||o,l=((p=r==null?void 0:r[n])==null?void 0:p.map(w=>w.url))||[],u=[...l,a],h=[...l];return c&&!h.includes(c)&&h.push(c),{...t,chainNamespace:i,caipNetworkId:n,assets:{imageId:Gn.NetworkImageIds[t.id],imageUrl:e==null?void 0:e[t.id]},rpcUrls:{...t.rpcUrls,default:{http:u},chainDefault:{http:h}}}},extendCaipNetworks(t,{customNetworkImageUrls:e,projectId:s,customRpcUrls:r}){return t.map(i=>Lr.extendCaipNetwork(i,{customNetworkImageUrls:e,customRpcUrls:r,projectId:s}))},getViemTransport(t,e,s){var i,n,o;const r=[];return s==null||s.forEach(a=>{r.push(pn(a.url,a.config))}),ra.includes(t.caipNetworkId)&&r.push(pn(Vu(t.caipNetworkId,e),{fetchOptions:{headers:{"Content-Type":"text/plain"}}})),(o=(n=(i=t==null?void 0:t.rpcUrls)==null?void 0:i.default)==null?void 0:n.http)==null||o.forEach(a=>{r.push(pn(a))}),Nc(r)},extendWagmiTransports(t,e,s){if(ra.includes(t.caipNetworkId)){const r=this.getDefaultRpcUrl(t,t.caipNetworkId,e);return Nc([s,pn(r)])}return s},getUnsupportedNetwork(t){return{id:t.split(":")[1],caipNetworkId:t,name:V.UNSUPPORTED_NETWORK_NAME,chainNamespace:t.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(t){var c;const e=H.getActiveCaipNetworkId(),s=b.getAllRequestedCaipNetworks(),r=Array.from(((c=b.state.chains)==null?void 0:c.keys())||[]),i=e==null?void 0:e.split(":")[0],n=i?r.includes(i):!1,o=s==null?void 0:s.find(l=>l.caipNetworkId===e);return n&&!o&&e?this.getUnsupportedNetwork(e):o||t||(s==null?void 0:s[0])}},Jn={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0},wt=xe({providers:{...Jn},providerIds:{...Jn}}),ke={state:wt,subscribeKey(t,e){return ot(wt,t,e)},subscribe(t){return nt(wt,()=>{t(wt)})},subscribeProviders(t){return nt(wt.providers,()=>t(wt.providers))},setProvider(t,e){e&&(wt.providers[t]=rr(e))},getProvider(t){return wt.providers[t]},setProviderId(t,e){e&&(wt.providerIds[t]=e)},getProviderId(t){if(t)return wt.providerIds[t]},reset(){wt.providers={...Jn},wt.providerIds={...Jn}},resetChain(t){wt.providers[t]=void 0,wt.providerIds[t]=void 0}},pA={VIEW_DIRECTION:{Next:"next",Prev:"prev"},DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"],ANIMATION_DURATIONS:{HeaderText:120,ModalHeight:150,ViewTransition:150}},Ja={filterOutDuplicatesByRDNS(t){const e=B.state.enableEIP6963?W.state.connectors:[],s=H.getRecentWallets(),r=e.map(a=>{var c;return(c=a.info)==null?void 0:c.rdns}).filter(Boolean),i=s.map(a=>a.rdns).filter(Boolean),n=r.concat(i);if(n.includes("io.metamask.mobile")&&te.isMobile()){const a=n.indexOf("io.metamask.mobile");n[a]="io.metamask"}return t.filter(a=>!n.includes(String(a==null?void 0:a.rdns)))},filterOutDuplicatesByIds(t){const e=W.state.connectors.filter(a=>a.type==="ANNOUNCED"||a.type==="INJECTED"),s=H.getRecentWallets(),r=e.map(a=>a.explorerId),i=s.map(a=>a.id),n=r.concat(i);return t.filter(a=>!n.includes(a==null?void 0:a.id))},filterOutDuplicateWallets(t){const e=this.filterOutDuplicatesByRDNS(t);return this.filterOutDuplicatesByIds(e)},markWalletsAsInstalled(t){const{connectors:e}=W.state,{featuredWalletIds:s}=B.state,r=e.filter(o=>o.type==="ANNOUNCED").reduce((o,a)=>{var c;return(c=a.info)!=null&&c.rdns&&(o[a.info.rdns]=!0),o},{});return t.map(o=>({...o,installed:!!o.rdns&&!!r[o.rdns??""]})).sort((o,a)=>{const c=Number(a.installed)-Number(o.installed);if(c!==0)return c;if(s!=null&&s.length){const l=s.indexOf(o.id),u=s.indexOf(a.id);if(l!==-1&&u!==-1)return l-u;if(l!==-1)return-1;if(u!==-1)return 1}return 0})},getConnectOrderMethod(t,e){var c;const s=(t==null?void 0:t.connectMethodsOrder)||((c=B.state.features)==null?void 0:c.connectMethodsOrder),r=e||W.state.connectors;if(s)return s;const{injected:i,announced:n}=Bn.getConnectorsByType(r,J.state.recommended,J.state.featured),o=i.filter(Bn.showConnector),a=n.filter(Bn.showConnector);return o.length||a.length?["wallet","email","social"]:pA.DEFAULT_CONNECT_METHOD_ORDER},isExcluded(t){const e=!!t.rdns&&J.state.excludedWallets.some(r=>r.rdns===t.rdns),s=!!t.name&&J.state.excludedWallets.some(r=>bc.isLowerCaseMatch(r.name,t.name));return e||s}},Bn={getConnectorsByType(t,e,s){const{customWallets:r}=B.state,i=H.getRecentWallets(),n=Ja.filterOutDuplicateWallets(e),o=Ja.filterOutDuplicateWallets(s),a=t.filter(h=>h.type==="MULTI_CHAIN"),c=t.filter(h=>h.type==="ANNOUNCED"),l=t.filter(h=>h.type==="INJECTED"),u=t.filter(h=>h.type==="EXTERNAL");return{custom:r,recent:i,external:u,multiChain:a,announced:c,injected:l,recommended:n,featured:o}},showConnector(t){var i;const e=(i=t.info)==null?void 0:i.rdns,s=!!e&&J.state.excludedWallets.some(n=>!!n.rdns&&n.rdns===e),r=!!t.name&&J.state.excludedWallets.some(n=>bc.isLowerCaseMatch(n.name,t.name));return!(t.type==="INJECTED"&&(t.name==="Browser Wallet"&&(!te.isMobile()||te.isMobile()&&!e&&!ee.checkInstalled())||s||r)||(t.type==="ANNOUNCED"||t.type==="EXTERNAL")&&(s||r))},getIsConnectedWithWC(){return Array.from(b.state.chains.values()).some(s=>W.getConnectorId(s.namespace)===V.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:t,featured:e,custom:s,recent:r,announced:i,injected:n,multiChain:o,external:a,overriddenConnectors:c=(l=>(l=B.state.features)==null?void 0:l.connectorTypeOrder)()??[]}){const u=Bn.getIsConnectedWithWC(),f=[{type:"walletConnect",isEnabled:B.state.enableWalletConnect&&!u},{type:"recent",isEnabled:r.length>0},{type:"injected",isEnabled:[...n,...i,...o].length>0},{type:"featured",isEnabled:e.length>0},{type:"custom",isEnabled:s&&s.length>0},{type:"external",isEnabled:a.length>0},{type:"recommended",isEnabled:t.length>0}].filter(w=>w.isEnabled),g=new Set(f.map(w=>w.type)),m=c.filter(w=>g.has(w)).map(w=>({type:w,isEnabled:!0})),p=f.filter(({type:w})=>!m.some(({type:I})=>I===w));return Array.from(new Set([...m,...p].map(({type:w})=>w)))}};let Wi,js,qs;function mS(t,e){Wi=document.createElement("style"),js=document.createElement("style"),qs=document.createElement("style"),Wi.textContent=Kr(t).core.cssText,js.textContent=Kr(t).dark.cssText,qs.textContent=Kr(t).light.cssText,document.head.appendChild(Wi),document.head.appendChild(js),document.head.appendChild(qs),ap(e)}function ap(t){js&&qs&&(t==="light"?(js.removeAttribute("media"),qs.media="enabled"):(qs.removeAttribute("media"),js.media="enabled"))}function fA(t){Wi&&js&&qs&&(Wi.textContent=Kr(t).core.cssText,js.textContent=Kr(t).dark.cssText,qs.textContent=Kr(t).light.cssText)}function Kr(t){return{core:Wr`
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --w3m-modal-width: 360px;
        --w3m-color-mix-strength: ${zt(t!=null&&t["--w3m-color-mix-strength"]?`${t["--w3m-color-mix-strength"]}%`:"0%")};
        --w3m-font-family: ${zt((t==null?void 0:t["--w3m-font-family"])||"Inter, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;")};
        --w3m-font-size-master: ${zt((t==null?void 0:t["--w3m-font-size-master"])||"10px")};
        --w3m-border-radius-master: ${zt((t==null?void 0:t["--w3m-border-radius-master"])||"4px")};
        --w3m-z-index: ${zt((t==null?void 0:t["--w3m-z-index"])||999)};

        --wui-font-family: var(--w3m-font-family);

        --wui-font-size-mini: calc(var(--w3m-font-size-master) * 0.8);
        --wui-font-size-micro: var(--w3m-font-size-master);
        --wui-font-size-tiny: calc(var(--w3m-font-size-master) * 1.2);
        --wui-font-size-small: calc(var(--w3m-font-size-master) * 1.4);
        --wui-font-size-paragraph: calc(var(--w3m-font-size-master) * 1.6);
        --wui-font-size-medium: calc(var(--w3m-font-size-master) * 1.8);
        --wui-font-size-large: calc(var(--w3m-font-size-master) * 2);
        --wui-font-size-title-6: calc(var(--w3m-font-size-master) * 2.2);
        --wui-font-size-medium-title: calc(var(--w3m-font-size-master) * 2.4);
        --wui-font-size-2xl: calc(var(--w3m-font-size-master) * 4);

        --wui-border-radius-5xs: var(--w3m-border-radius-master);
        --wui-border-radius-4xs: calc(var(--w3m-border-radius-master) * 1.5);
        --wui-border-radius-3xs: calc(var(--w3m-border-radius-master) * 2);
        --wui-border-radius-xxs: calc(var(--w3m-border-radius-master) * 3);
        --wui-border-radius-xs: calc(var(--w3m-border-radius-master) * 4);
        --wui-border-radius-s: calc(var(--w3m-border-radius-master) * 5);
        --wui-border-radius-m: calc(var(--w3m-border-radius-master) * 7);
        --wui-border-radius-l: calc(var(--w3m-border-radius-master) * 9);
        --wui-border-radius-3xl: calc(var(--w3m-border-radius-master) * 20);

        --wui-font-weight-light: 400;
        --wui-font-weight-regular: 500;
        --wui-font-weight-medium: 600;
        --wui-font-weight-bold: 700;

        --wui-letter-spacing-2xl: -1.6px;
        --wui-letter-spacing-medium-title: -0.96px;
        --wui-letter-spacing-title-6: -0.88px;
        --wui-letter-spacing-large: -0.8px;
        --wui-letter-spacing-medium: -0.72px;
        --wui-letter-spacing-paragraph: -0.64px;
        --wui-letter-spacing-small: -0.56px;
        --wui-letter-spacing-tiny: -0.48px;
        --wui-letter-spacing-micro: -0.2px;
        --wui-letter-spacing-mini: -0.16px;

        --wui-spacing-0: 0px;
        --wui-spacing-4xs: 2px;
        --wui-spacing-3xs: 4px;
        --wui-spacing-xxs: 6px;
        --wui-spacing-2xs: 7px;
        --wui-spacing-xs: 8px;
        --wui-spacing-1xs: 10px;
        --wui-spacing-s: 12px;
        --wui-spacing-m: 14px;
        --wui-spacing-l: 16px;
        --wui-spacing-2l: 18px;
        --wui-spacing-xl: 20px;
        --wui-spacing-xxl: 24px;
        --wui-spacing-2xl: 32px;
        --wui-spacing-3xl: 40px;
        --wui-spacing-4xl: 90px;
        --wui-spacing-5xl: 95px;

        --wui-icon-box-size-xxs: 14px;
        --wui-icon-box-size-xs: 20px;
        --wui-icon-box-size-sm: 24px;
        --wui-icon-box-size-md: 32px;
        --wui-icon-box-size-mdl: 36px;
        --wui-icon-box-size-lg: 40px;
        --wui-icon-box-size-2lg: 48px;
        --wui-icon-box-size-xl: 64px;

        --wui-icon-size-inherit: inherit;
        --wui-icon-size-xxs: 10px;
        --wui-icon-size-xs: 12px;
        --wui-icon-size-sm: 14px;
        --wui-icon-size-md: 16px;
        --wui-icon-size-mdl: 18px;
        --wui-icon-size-lg: 20px;
        --wui-icon-size-xl: 24px;
        --wui-icon-size-xxl: 28px;

        --wui-wallet-image-size-inherit: inherit;
        --wui-wallet-image-size-sm: 40px;
        --wui-wallet-image-size-md: 56px;
        --wui-wallet-image-size-lg: 80px;

        --wui-visual-size-size-inherit: inherit;
        --wui-visual-size-sm: 40px;
        --wui-visual-size-md: 55px;
        --wui-visual-size-lg: 80px;

        --wui-box-size-md: 100px;
        --wui-box-size-lg: 120px;

        --wui-ease-out-power-2: cubic-bezier(0, 0, 0.22, 1);
        --wui-ease-out-power-1: cubic-bezier(0, 0, 0.55, 1);

        --wui-ease-in-power-3: cubic-bezier(0.66, 0, 1, 1);
        --wui-ease-in-power-2: cubic-bezier(0.45, 0, 1, 1);
        --wui-ease-in-power-1: cubic-bezier(0.3, 0, 1, 1);

        --wui-ease-inout-power-1: cubic-bezier(0.45, 0, 0.55, 1);

        --wui-duration-lg: 200ms;
        --wui-duration-md: 125ms;
        --wui-duration-sm: 75ms;

        --wui-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --wui-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --wui-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --wui-width-network-sm: 36px;
        --wui-width-network-md: 48px;
        --wui-width-network-lg: 86px;

        --wui-height-network-sm: 40px;
        --wui-height-network-md: 54px;
        --wui-height-network-lg: 96px;

        --wui-icon-size-network-xs: 12px;
        --wui-icon-size-network-sm: 16px;
        --wui-icon-size-network-md: 24px;
        --wui-icon-size-network-lg: 42px;

        --wui-color-inherit: inherit;

        --wui-color-inverse-100: #fff;
        --wui-color-inverse-000: #000;

        --wui-cover: rgba(20, 20, 20, 0.8);

        --wui-color-modal-bg: var(--wui-color-modal-bg-base);

        --wui-color-accent-100: var(--wui-color-accent-base-100);
        --wui-color-accent-090: var(--wui-color-accent-base-090);
        --wui-color-accent-080: var(--wui-color-accent-base-080);

        --wui-color-success-100: var(--wui-color-success-base-100);
        --wui-color-success-125: var(--wui-color-success-base-125);

        --wui-color-warning-100: var(--wui-color-warning-base-100);

        --wui-color-error-100: var(--wui-color-error-base-100);
        --wui-color-error-125: var(--wui-color-error-base-125);

        --wui-color-blue-100: var(--wui-color-blue-base-100);
        --wui-color-blue-90: var(--wui-color-blue-base-90);

        --wui-icon-box-bg-error-100: var(--wui-icon-box-bg-error-base-100);
        --wui-icon-box-bg-blue-100: var(--wui-icon-box-bg-blue-base-100);
        --wui-icon-box-bg-success-100: var(--wui-icon-box-bg-success-base-100);
        --wui-icon-box-bg-inverse-100: var(--wui-icon-box-bg-inverse-base-100);

        --wui-all-wallets-bg-100: var(--wui-all-wallets-bg-100);

        --wui-avatar-border: var(--wui-avatar-border-base);

        --wui-thumbnail-border: var(--wui-thumbnail-border-base);

        --wui-wallet-button-bg: var(--wui-wallet-button-bg-base);

        --wui-box-shadow-blue: var(--wui-color-accent-glass-020);
      }

      @supports (background: color-mix(in srgb, white 50%, black)) {
        :root {
          --wui-color-modal-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-modal-bg-base)
          );

          --wui-box-shadow-blue: color-mix(in srgb, var(--wui-color-accent-100) 20%, transparent);

          --wui-color-accent-100: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 100%,
            transparent
          );
          --wui-color-accent-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-glass-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-020: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 20%,
            transparent
          );
          --wui-color-accent-glass-015: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 15%,
            transparent
          );
          --wui-color-accent-glass-010: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 10%,
            transparent
          );
          --wui-color-accent-glass-005: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 5%,
            transparent
          );
          --wui-color-accent-002: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 2%,
            transparent
          );

          --wui-color-fg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-100)
          );
          --wui-color-fg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-125)
          );
          --wui-color-fg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-150)
          );
          --wui-color-fg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-175)
          );
          --wui-color-fg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-200)
          );
          --wui-color-fg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-225)
          );
          --wui-color-fg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-250)
          );
          --wui-color-fg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-275)
          );
          --wui-color-fg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-300)
          );
          --wui-color-fg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-325)
          );
          --wui-color-fg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-350)
          );

          --wui-color-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-100)
          );
          --wui-color-bg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-125)
          );
          --wui-color-bg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-150)
          );
          --wui-color-bg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-175)
          );
          --wui-color-bg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-200)
          );
          --wui-color-bg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-225)
          );
          --wui-color-bg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-250)
          );
          --wui-color-bg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-275)
          );
          --wui-color-bg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-300)
          );
          --wui-color-bg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-325)
          );
          --wui-color-bg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-350)
          );

          --wui-color-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-100)
          );
          --wui-color-success-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-125)
          );

          --wui-color-warning-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-warning-base-100)
          );

          --wui-color-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-100)
          );
          --wui-color-blue-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-100)
          );
          --wui-color-blue-90: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-90)
          );
          --wui-color-error-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-125)
          );

          --wui-icon-box-bg-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-error-base-100)
          );
          --wui-icon-box-bg-accent-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-blue-base-100)
          );
          --wui-icon-box-bg-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-success-base-100)
          );
          --wui-icon-box-bg-inverse-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-inverse-base-100)
          );

          --wui-all-wallets-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-all-wallets-bg-100)
          );

          --wui-avatar-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-avatar-border-base)
          );

          --wui-thumbnail-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-thumbnail-border-base)
          );

          --wui-wallet-button-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-wallet-button-bg-base)
          );
        }
      }
    `,light:Wr`
      :root {
        --w3m-color-mix: ${zt((t==null?void 0:t["--w3m-color-mix"])||"#fff")};
        --w3m-accent: ${zt($s(t,"dark")["--w3m-accent"])};
        --w3m-default: #fff;

        --wui-color-modal-bg-base: ${zt($s(t,"dark")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(230, 100%, 67%, 1);
        --wui-color-blueberry-090: hsla(231, 76%, 61%, 1);
        --wui-color-blueberry-080: hsla(230, 59%, 55%, 1);
        --wui-color-blueberry-050: hsla(231, 100%, 70%, 0.1);

        --wui-color-fg-100: #e4e7e7;
        --wui-color-fg-125: #d0d5d5;
        --wui-color-fg-150: #a8b1b1;
        --wui-color-fg-175: #a8b0b0;
        --wui-color-fg-200: #949e9e;
        --wui-color-fg-225: #868f8f;
        --wui-color-fg-250: #788080;
        --wui-color-fg-275: #788181;
        --wui-color-fg-300: #6e7777;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #363636;

        --wui-color-bg-100: #141414;
        --wui-color-bg-125: #191a1a;
        --wui-color-bg-150: #1e1f1f;
        --wui-color-bg-175: #222525;
        --wui-color-bg-200: #272a2a;
        --wui-color-bg-225: #2c3030;
        --wui-color-bg-250: #313535;
        --wui-color-bg-275: #363b3b;
        --wui-color-bg-300: #3b4040;
        --wui-color-bg-325: #252525;
        --wui-color-bg-350: #ffffff;

        --wui-color-success-base-100: #26d962;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f25a67;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 217, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 217, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 217, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 217, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 217, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 217, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 217, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 217, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 217, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 217, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(242, 90, 103, 0.01);
        --wui-color-error-glass-002: rgba(242, 90, 103, 0.02);
        --wui-color-error-glass-005: rgba(242, 90, 103, 0.05);
        --wui-color-error-glass-010: rgba(242, 90, 103, 0.1);
        --wui-color-error-glass-015: rgba(242, 90, 103, 0.15);
        --wui-color-error-glass-020: rgba(242, 90, 103, 0.2);
        --wui-color-error-glass-025: rgba(242, 90, 103, 0.25);
        --wui-color-error-glass-030: rgba(242, 90, 103, 0.3);
        --wui-color-error-glass-060: rgba(242, 90, 103, 0.6);
        --wui-color-error-glass-080: rgba(242, 90, 103, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-color-gray-glass-001: rgba(255, 255, 255, 0.01);
        --wui-color-gray-glass-002: rgba(255, 255, 255, 0.02);
        --wui-color-gray-glass-005: rgba(255, 255, 255, 0.05);
        --wui-color-gray-glass-010: rgba(255, 255, 255, 0.1);
        --wui-color-gray-glass-015: rgba(255, 255, 255, 0.15);
        --wui-color-gray-glass-020: rgba(255, 255, 255, 0.2);
        --wui-color-gray-glass-025: rgba(255, 255, 255, 0.25);
        --wui-color-gray-glass-030: rgba(255, 255, 255, 0.3);
        --wui-color-gray-glass-060: rgba(255, 255, 255, 0.6);
        --wui-color-gray-glass-080: rgba(255, 255, 255, 0.8);
        --wui-color-gray-glass-090: rgba(255, 255, 255, 0.9);

        --wui-color-dark-glass-100: rgba(42, 42, 42, 1);

        --wui-icon-box-bg-error-base-100: #3c2426;
        --wui-icon-box-bg-blue-base-100: #20303f;
        --wui-icon-box-bg-success-base-100: #1f3a28;
        --wui-icon-box-bg-inverse-base-100: #243240;

        --wui-all-wallets-bg-100: #222b35;

        --wui-avatar-border-base: #252525;

        --wui-thumbnail-border-base: #252525;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --w3m-card-embedded-shadow-color: rgb(17 17 18 / 25%);
      }
    `,dark:Wr`
      :root {
        --w3m-color-mix: ${zt((t==null?void 0:t["--w3m-color-mix"])||"#000")};
        --w3m-accent: ${zt($s(t,"light")["--w3m-accent"])};
        --w3m-default: #000;

        --wui-color-modal-bg-base: ${zt($s(t,"light")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(231, 100%, 70%, 1);
        --wui-color-blueberry-090: hsla(231, 97%, 72%, 1);
        --wui-color-blueberry-080: hsla(231, 92%, 74%, 1);

        --wui-color-fg-100: #141414;
        --wui-color-fg-125: #2d3131;
        --wui-color-fg-150: #474d4d;
        --wui-color-fg-175: #636d6d;
        --wui-color-fg-200: #798686;
        --wui-color-fg-225: #828f8f;
        --wui-color-fg-250: #8b9797;
        --wui-color-fg-275: #95a0a0;
        --wui-color-fg-300: #9ea9a9;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #d0d0d0;

        --wui-color-bg-100: #ffffff;
        --wui-color-bg-125: #f5fafa;
        --wui-color-bg-150: #f3f8f8;
        --wui-color-bg-175: #eef4f4;
        --wui-color-bg-200: #eaf1f1;
        --wui-color-bg-225: #e5eded;
        --wui-color-bg-250: #e1e9e9;
        --wui-color-bg-275: #dce7e7;
        --wui-color-bg-300: #d8e3e3;
        --wui-color-bg-325: #f3f3f3;
        --wui-color-bg-350: #202020;

        --wui-color-success-base-100: #26b562;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f05142;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 181, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 181, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 181, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 181, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 181, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 181, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 181, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 181, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 181, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 181, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(240, 81, 66, 0.01);
        --wui-color-error-glass-002: rgba(240, 81, 66, 0.02);
        --wui-color-error-glass-005: rgba(240, 81, 66, 0.05);
        --wui-color-error-glass-010: rgba(240, 81, 66, 0.1);
        --wui-color-error-glass-015: rgba(240, 81, 66, 0.15);
        --wui-color-error-glass-020: rgba(240, 81, 66, 0.2);
        --wui-color-error-glass-025: rgba(240, 81, 66, 0.25);
        --wui-color-error-glass-030: rgba(240, 81, 66, 0.3);
        --wui-color-error-glass-060: rgba(240, 81, 66, 0.6);
        --wui-color-error-glass-080: rgba(240, 81, 66, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-icon-box-bg-error-base-100: #f4dfdd;
        --wui-icon-box-bg-blue-base-100: #d9ecfb;
        --wui-icon-box-bg-success-base-100: #daf0e4;
        --wui-icon-box-bg-inverse-base-100: #dcecfc;

        --wui-all-wallets-bg-100: #e8f1fa;

        --wui-avatar-border-base: #f3f4f4;

        --wui-thumbnail-border-base: #eaefef;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --wui-color-gray-glass-001: rgba(0, 0, 0, 0.01);
        --wui-color-gray-glass-002: rgba(0, 0, 0, 0.02);
        --wui-color-gray-glass-005: rgba(0, 0, 0, 0.05);
        --wui-color-gray-glass-010: rgba(0, 0, 0, 0.1);
        --wui-color-gray-glass-015: rgba(0, 0, 0, 0.15);
        --wui-color-gray-glass-020: rgba(0, 0, 0, 0.2);
        --wui-color-gray-glass-025: rgba(0, 0, 0, 0.25);
        --wui-color-gray-glass-030: rgba(0, 0, 0, 0.3);
        --wui-color-gray-glass-060: rgba(0, 0, 0, 0.6);
        --wui-color-gray-glass-080: rgba(0, 0, 0, 0.8);
        --wui-color-gray-glass-090: rgba(0, 0, 0, 0.9);

        --wui-color-dark-glass-100: rgba(233, 233, 233, 1);

        --w3m-card-embedded-shadow-color: rgb(224 225 233 / 25%);
      }
    `}}const wS=Wr`
  *,
  *::after,
  *::before,
  :host {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-style: normal;
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    font-family: var(--wui-font-family);
    backface-visibility: hidden;
  }
`,yS=Wr`
  button,
  a {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    transition:
      color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      background-color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1),
      box-shadow var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: background-color, color, border, box-shadow, border-radius;
    outline: none;
    border: none;
    column-gap: var(--wui-spacing-3xs);
    background-color: transparent;
    text-decoration: none;
  }

  wui-flex {
    transition: border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: border-radius;
  }

  button:disabled > wui-wallet-image,
  button:disabled > wui-all-wallets-image,
  button:disabled > wui-network-image,
  button:disabled > wui-image,
  button:disabled > wui-transaction-visual,
  button:disabled > wui-logo {
    filter: grayscale(1);
  }

  @media (hover: hover) and (pointer: fine) {
    button:hover:enabled {
      background-color: var(--wui-color-gray-glass-005);
    }

    button:active:enabled {
      background-color: var(--wui-color-gray-glass-010);
    }
  }

  button:disabled > wui-icon-box {
    opacity: 0.5;
  }

  input {
    border: none;
    outline: none;
    appearance: none;
  }
`,bS=Wr`
  .wui-color-inherit {
    color: var(--wui-color-inherit);
  }

  .wui-color-accent-100 {
    color: var(--wui-color-accent-100);
  }

  .wui-color-error-100 {
    color: var(--wui-color-error-100);
  }

  .wui-color-blue-100 {
    color: var(--wui-color-blue-100);
  }

  .wui-color-blue-90 {
    color: var(--wui-color-blue-90);
  }

  .wui-color-error-125 {
    color: var(--wui-color-error-125);
  }

  .wui-color-success-100 {
    color: var(--wui-color-success-100);
  }

  .wui-color-success-125 {
    color: var(--wui-color-success-125);
  }

  .wui-color-inverse-100 {
    color: var(--wui-color-inverse-100);
  }

  .wui-color-inverse-000 {
    color: var(--wui-color-inverse-000);
  }

  .wui-color-fg-100 {
    color: var(--wui-color-fg-100);
  }

  .wui-color-fg-200 {
    color: var(--wui-color-fg-200);
  }

  .wui-color-fg-300 {
    color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    color: var(--wui-color-fg-350);
  }

  .wui-bg-color-inherit {
    background-color: var(--wui-color-inherit);
  }

  .wui-bg-color-blue-100 {
    background-color: var(--wui-color-accent-100);
  }

  .wui-bg-color-error-100 {
    background-color: var(--wui-color-error-100);
  }

  .wui-bg-color-error-125 {
    background-color: var(--wui-color-error-125);
  }

  .wui-bg-color-success-100 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-success-125 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-inverse-100 {
    background-color: var(--wui-color-inverse-100);
  }

  .wui-bg-color-inverse-000 {
    background-color: var(--wui-color-inverse-000);
  }

  .wui-bg-color-fg-100 {
    background-color: var(--wui-color-fg-100);
  }

  .wui-bg-color-fg-200 {
    background-color: var(--wui-color-fg-200);
  }

  .wui-bg-color-fg-300 {
    background-color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    background-color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    background-color: var(--wui-color-fg-350);
  }
`,Ri={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603,DEFAULT_ALLOWED_ANCESTORS:["http://localhost:*","https://*.pages.dev","https://*.vercel.app","https://*.ngrok-free.app","https://secure-mobile.walletconnect.com","https://secure-mobile.walletconnect.org"]};function hn(t){return{formatters:void 0,fees:void 0,serializers:void 0,...t}}const Gu=hn({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"}),Ju=hn({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"});hn({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"});hn({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}});hn({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});const gA={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},Mn={getMethodsByChainNamespace(t){return gA[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return{...t};const s={...t},r=new Set;if(e.methods&&Object.keys(e.methods).forEach(i=>r.add(i)),e.chains&&Object.keys(e.chains).forEach(i=>r.add(i)),e.events&&Object.keys(e.events).forEach(i=>r.add(i)),e.rpcMap&&Object.keys(e.rpcMap).forEach(i=>{const[n]=i.split(":");n&&r.add(n)}),r.forEach(i=>{s[i]||(s[i]=this.createDefaultNamespace(i))}),e.methods&&Object.entries(e.methods).forEach(([i,n])=>{s[i]&&(s[i].methods=n)}),e.chains&&Object.entries(e.chains).forEach(([i,n])=>{s[i]&&(s[i].chains=n)}),e.events&&Object.entries(e.events).forEach(([i,n])=>{s[i]&&(s[i].events=n)}),e.rpcMap){const i=new Set;Object.entries(e.rpcMap).forEach(([n,o])=>{const[a,c]=n.split(":");!a||!c||!s[a]||(s[a].rpcMap||(s[a].rpcMap={}),i.has(a)||(s[a].rpcMap={},i.add(a)),s[a].rpcMap[c]=o)})}return s},createNamespaces(t,e){const s=t.reduce((r,i)=>{const{id:n,chainNamespace:o,rpcUrls:a}=i,c=a.default.http[0];r[o]||(r[o]=this.createDefaultNamespace(o));const l=`${o}:${n}`,u=r[o];switch(u.chains.push(l),l){case Gu.caipNetworkId:u.chains.push(Gu.deprecatedCaipNetworkId);break;case Ju.caipNetworkId:u.chains.push(Ju.deprecatedCaipNetworkId);break}return u!=null&&u.rpcMap&&c&&(u.rpcMap[n]=c),r},{});return this.applyNamespaceOverrides(s,e)},resolveReownName:async t=>{var r;const e=await Li.resolveName(t);return((r=(Object.values(e==null?void 0:e.addresses)||[])[0])==null?void 0:r.address)||!1},getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{const s=e.chains||[],r=e.accounts.map(i=>{const[n,o]=i.split(":");return`${n}:${o}`});return Array.from(new Set([...s,...r]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null},isOriginAllowed(t,e,s){for(const r of[...e,...s])if(r.includes("*")){const n=`^${r.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&").replace(/\\\*/gu,".*")}$`;if(new RegExp(n,"u").test(t))return!0}else try{if(new URL(r).origin===t)return!0}catch{if(r===t)return!0}return!1}};class cp{constructor({provider:e,namespace:s}){this.id=V.CONNECTOR_ID.WALLET_CONNECT,this.name=Gn.ConnectorNamesMap[V.CONNECTOR_ID.WALLET_CONNECT],this.type="WALLET_CONNECT",this.imageId=Gn.ConnectorImageIds[V.CONNECTOR_ID.WALLET_CONNECT],this.getCaipNetworks=b.getCaipNetworks.bind(b),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=s}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){const s=this.getCaipNetworks(),r=B.state.universalProviderConfigOverride,i=Mn.createNamespaces(s,r);await this.provider.connect({optionalNamespaces:i})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(s=>s.caipNetworkId);return zi.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:mA})}}const mA=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];class wA{constructor(e){this.availableConnectors=[],this.eventListeners=new Map,this.getCaipNetworks=s=>b.getCaipNetworks(s),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get networks(){return this.getCaipNetworks(this.namespace)}setAuthProvider(e){this.addConnector({id:V.CONNECTOR_ID.AUTH,type:"AUTH",name:V.CONNECTOR_NAMES.AUTH,provider:e,imageId:Gn.ConnectorImageIds[V.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}addConnector(...e){const s=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(r=>s.has(r.id)?!1:(s.add(r.id),!0)),this.emit("connectors",this.availableConnectors)}setStatus(e,s){K.setStatus(e,s)}on(e,s){var r;this.eventListeners.has(e)||this.eventListeners.set(e,new Set),(r=this.eventListeners.get(e))==null||r.add(s)}off(e,s){const r=this.eventListeners.get(e);r&&r.delete(s)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,s){const r=this.eventListeners.get(e);r&&r.forEach(i=>i(s))}async connectWalletConnect(e){return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}async switchNetwork(e){var n;const{caipNetwork:s,providerType:r}=e;if(!e.provider)return;const i="provider"in e.provider?e.provider.provider:e.provider;if(r==="WALLET_CONNECT"){i.setDefaultChain(s.caipNetworkId);return}if(i&&r==="AUTH"){const o=i,a=(n=K.state.preferredAccountTypes)==null?void 0:n[s.chainNamespace];await o.switchNetwork(s.caipNetworkId);const c=await o.getUser({chainId:s.caipNetworkId,preferredAccountType:a});this.emit("switchNetwork",c)}}getWalletConnectConnector(){const e=this.connectors.find(s=>s instanceof cp);if(!e)throw new Error("WalletConnectConnector not found");return e}}class yA extends wA{setUniversalProvider(e){this.addConnector(new cp({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace}))}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect()}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}}async getAccounts({namespace:e}){var i,n,o,a;const s=this.provider,r=((a=(o=(n=(i=s==null?void 0:s.session)==null?void 0:i.namespaces)==null?void 0:n[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>{const[,,l]=c.split(":");return l}).filter((c,l,u)=>u.indexOf(c)===l))||[];return Promise.resolve({accounts:r.map(c=>te.createAccount(e,c,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){var n,o,a,c,l;if(!(e.caipNetwork&&_e.BALANCE_SUPPORTED_CHAINS.includes((n=e.caipNetwork)==null?void 0:n.chainNamespace))||(o=e.caipNetwork)!=null&&o.testnet)return{balance:"0.00",symbol:((a=e.caipNetwork)==null?void 0:a.nativeCurrency.symbol)||""};if(K.state.balanceLoading&&e.chainId===((c=b.state.activeCaipNetwork)==null?void 0:c.id))return{balance:K.state.balance||"0.00",symbol:K.state.balanceSymbol||""};const i=(await K.fetchTokenBalance()).find(u=>{var h,d;return u.chainId===`${(h=e.caipNetwork)==null?void 0:h.chainNamespace}:${e.chainId}`&&u.symbol===((d=e.caipNetwork)==null?void 0:d.nativeCurrency.symbol)});return{balance:(i==null?void 0:i.quantity.numeric)||"0.00",symbol:(i==null?void 0:i.symbol)||((l=e.caipNetwork)==null?void 0:l.nativeCurrency.symbol)||""}}async signMessage(e){var o,a,c;const{provider:s,message:r,address:i}=e;if(!s)throw new Error("UniversalAdapter:signMessage - provider is undefined");let n="";return((o=b.state.activeCaipNetwork)==null?void 0:o.chainNamespace)===V.CHAIN.SOLANA?n=(await s.request({method:"solana_signMessage",params:{message:eh.encode(new TextEncoder().encode(r)),pubkey:i}},(a=b.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)).signature:n=await s.request({method:"personal_sign",params:[r,i]},(c=b.state.activeCaipNetwork)==null?void 0:c.caipNetworkId),{signature:n}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){var i,n,o,a,c,l;const{caipNetwork:s}=e,r=this.getWalletConnectConnector();if(s.chainNamespace===V.CHAIN.EVM)try{await((i=r.provider)==null?void 0:i.request({method:"wallet_switchEthereumChain",params:[{chainId:Cc(s.id)}]}))}catch(u){if(u.code===Ri.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||u.code===Ri.ERROR_INVALID_CHAIN_ID||u.code===Ri.ERROR_CODE_DEFAULT||((o=(n=u==null?void 0:u.data)==null?void 0:n.originalError)==null?void 0:o.code)===Ri.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await((l=r.provider)==null?void 0:l.request({method:"wallet_addEthereumChain",params:[{chainId:Cc(s.id),rpcUrls:[(a=s==null?void 0:s.rpcUrls.chainDefault)==null?void 0:a.http],chainName:s.name,nativeCurrency:s.nativeCurrency,blockExplorerUrls:[(c=s.blockExplorers)==null?void 0:c.default.url]}]}))}catch{throw new Error("Chain is not supported")}}r.provider.setDefaultChain(s.caipNetworkId)}getWalletConnectProvider(){const e=this.connectors.find(r=>r.type==="WALLET_CONNECT");return e==null?void 0:e.provider}}const bA=["email","socials","swaps","onramp","activity","reownBranding"],xn={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return!!t.isEnabled&&e.includes("email")},processFallback:t=>t===void 0?_e.DEFAULT_REMOTE_FEATURES.email:!!t},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e.filter(s=>s!=="email"):!1},processFallback:t=>t===void 0?_e.DEFAULT_REMOTE_FEATURES.socials:typeof t=="boolean"?t?_e.DEFAULT_REMOTE_FEATURES.socials:!1:t},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?_e.DEFAULT_REMOTE_FEATURES.swaps:typeof t=="boolean"?t?_e.DEFAULT_REMOTE_FEATURES.swaps:!1:t},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?_e.DEFAULT_REMOTE_FEATURES.onramp:typeof t=="boolean"?t?_e.DEFAULT_REMOTE_FEATURES.onramp:!1:t},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?_e.DEFAULT_REMOTE_FEATURES.activity:!!t},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?_e.DEFAULT_REMOTE_FEATURES.reownBranding:!!t}},vA={localSettingsOverridden:new Set,getApiConfig(t,e){return e==null?void 0:e.find(s=>s.id===t)},addWarning(t,e){if(t!==void 0){const s=xn[e],r=s.isLegacy?`"features.${s.localFeatureName}" (now "${e}")`:`"features.${e}"`;this.localSettingsOverridden.add(r)}},processFeature(t,e,s,r,i){const n=xn[t],o=e[n.localFeatureName];if(i&&!n.isAvailableOnBasic)return!1;if(r){const a=this.getApiConfig(n.apiFeatureName,s);return(a==null?void 0:a.config)===null?this.processFallbackFeature(t,o):a!=null&&a.config?(o!==void 0&&this.addWarning(o,t),this.processApiFeature(t,a)):!1}return this.processFallbackFeature(t,o)},processApiFeature(t,e){return xn[t].processApi(e)},processFallbackFeature(t,e){return xn[t].processFallback(e)},async fetchRemoteFeatures(t){const e=t.basic??!1,s=t.features||{};this.localSettingsOverridden.clear();let r=null,i=!1;try{r=await J.fetchProjectConfig(),i=r!=null}catch(o){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",o)}const n=i&&!e?_e.DEFAULT_REMOTE_FEATURES:_e.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(const o of bA){const a=this.processFeature(o,s,r,i,e);Object.assign(n,{[o]:a})}}catch(o){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",o),_e.DEFAULT_REMOTE_FEATURES}if(i&&this.localSettingsOverridden.size>0){const o=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;Vs.open({shortMessage:"Local configuration ignored",longMessage:`[Reown Config Notice] ${o}`},"warning")}return n}};class EA{constructor(e){this.chainNamespaces=[],this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(s,r)=>{var i,n,o,a;if(s){const c=(n=(i=b.getNetworkData(s))==null?void 0:i.requestedCaipNetworks)==null?void 0:n.find(h=>h.id===r);if(c)return c;const l=(o=b.getNetworkData(s))==null?void 0:o.caipNetwork;return l||((a=b.getRequestedCaipNetworks(s).filter(h=>h.chainNamespace===s))==null?void 0:a[0])}return b.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const s=this.getCaipNetwork();if(s)return s.id},this.getCaipNetworks=s=>b.getCaipNetworks(s),this.getActiveChainNamespace=()=>b.state.activeChain,this.setRequestedCaipNetworks=(s,r)=>{b.setRequestedCaipNetworks(s,r)},this.getApprovedCaipNetworkIds=()=>b.getAllApprovedCaipNetworkIds(),this.getCaipAddress=s=>b.state.activeChain===s||!s?b.state.activeCaipAddress:b.getAccountProp("caipAddress",s),this.setClientId=s=>{Q.setClientId(s)},this.getProvider=s=>ke.getProvider(s),this.getProviderType=s=>ke.getProviderId(s),this.getPreferredAccountType=s=>{var r;return(r=K.state.preferredAccountTypes)==null?void 0:r[s]},this.setCaipAddress=(s,r)=>{K.setCaipAddress(s,r),s&&B.state.enableEmbedded&&this.close()},this.setBalance=(s,r,i)=>{K.setBalance(s,r,i)},this.setProfileName=(s,r)=>{K.setProfileName(s,r)},this.setProfileImage=(s,r)=>{K.setProfileImage(s,r)},this.setUser=(s,r)=>{K.setUser(s,r)},this.resetAccount=s=>{K.resetAccount(s)},this.setCaipNetwork=s=>{b.setActiveCaipNetwork(s)},this.setCaipNetworkOfNamespace=(s,r)=>{b.setChainNetworkData(r,{caipNetwork:s})},this.setAllAccounts=(s,r)=>{K.setAllAccounts(s,r),B.setHasMultipleAddresses((s==null?void 0:s.length)>1)},this.setStatus=(s,r)=>{K.setStatus(s,r),W.isConnected()?H.setConnectionStatus("connected"):H.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=s=>b.getAccountProp("address",s),this.setConnectors=s=>{const r=[...W.state.allConnectors,...s];W.setConnectors(r)},this.setConnections=(s,r)=>{ee.setConnections(s,r)},this.fetchIdentity=s=>Q.fetchIdentity(s),this.getReownName=s=>Li.getNamesForAddress(s),this.getConnectors=()=>W.getConnectors(),this.getConnectorImage=s=>rh.getConnectorImage(s),this.setConnectedWalletInfo=(s,r)=>{const i=ke.getProviderId(r),n=s?{...s,type:i}:void 0;K.setConnectedWalletInfo(n,r)},this.getIsConnectedState=()=>!!b.state.activeCaipAddress,this.addAddressLabel=(s,r,i)=>{K.addAddressLabel(s,r,i)},this.removeAddressLabel=(s,r)=>{K.removeAddressLabel(s,r)},this.getAddress=s=>b.state.activeChain===s||!s?K.state.address:b.getAccountProp("address",s),this.setApprovedCaipNetworksData=s=>b.setApprovedCaipNetworksData(s),this.resetNetwork=s=>{b.resetNetwork(s)},this.addConnector=s=>{W.addConnector(s)},this.resetWcConnection=()=>{ee.resetWcConnection()},this.setAddressExplorerUrl=(s,r)=>{K.setAddressExplorerUrl(s,r)},this.setSmartAccountDeployed=(s,r)=>{K.setSmartAccountDeployed(s,r)},this.setSmartAccountEnabledNetworks=(s,r)=>{b.setSmartAccountEnabledNetworks(s,r)},this.setPreferredAccountType=(s,r)=>{K.setPreferredAccountType(s,r)},this.setEIP6963Enabled=s=>{B.setEIP6963Enabled(s)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.readyPromise=this.initialize(e)}getChainNamespacesSet(e,s){const r=e==null?void 0:e.map(n=>n.namespace).filter(n=>!!n);if(r!=null&&r.length)return[...new Set(r)];const i=s==null?void 0:s.map(n=>n.chainNamespace);return[...new Set(i)]}async initialize(e){var s,r,i;this.initializeProjectSettings(e),this.initControllers(e),await this.initChainAdapters(),this.sendInitializeEvent(e),await this.syncExistingConnection(),this.remoteFeatures=await vA.fetchRemoteFeatures(e),B.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&la.setOnrampProviders(this.remoteFeatures.onramp),((s=B.state.remoteFeatures)!=null&&s.email||Array.isArray((r=B.state.remoteFeatures)==null?void 0:r.socials)&&((i=B.state.remoteFeatures)==null?void 0:i.socials.length)>0)&&await this.checkAllowedOrigins()}async checkAllowedOrigins(){const e=await J.fetchAllowedOrigins();if(e&&te.isClient()){const s=window.location.origin;Mn.isOriginAllowed(s,e,Ri.DEFAULT_ALLOWED_ANCESTORS)||Vs.open(Ur.ALERT_ERRORS.INVALID_APP_CONFIGURATION,"error")}else Vs.open(Ur.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error")}sendInitializeEvent(e){var r;const{...s}=e;delete s.adapters,delete s.universalProvider,Re.sendEvent({type:"track",event:"INITIALIZE",properties:{...s,networks:e.networks.map(i=>i.id),siweConfig:{options:((r=e.siweConfig)==null?void 0:r.options)||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initializeThemeController(e){e.themeMode&&St.setThemeMode(e.themeMode),e.themeVariables&&St.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient||!this.networkControllerClient)throw new Error("ConnectionControllerClient and NetworkControllerClient must be set");b.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient});const s=this.getDefaultNetwork();s&&b.setActiveCaipNetwork(s)}initializeConnectionController(e){ee.setWcBasic(e.basic??!1)}initializeConnectorController(){W.initialize(this.chainNamespaces)}initializeProjectSettings(e){B.setProjectId(e.projectId),B.setSdkVersion(e.sdkVersion)}initializeOptionsController(e){var o;B.setDebug(e.debug!==!1),B.setEnableWalletConnect(e.enableWalletConnect!==!1),B.setEnableWalletGuide(e.enableWalletGuide!==!1),B.setEnableWallets(e.enableWallets!==!1),B.setEIP6963Enabled(e.enableEIP6963!==!1),B.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),B.setEnableAuthLogger(e.enableAuthLogger!==!1),B.setCustomRpcUrls(e.customRpcUrls),B.setEnableEmbedded(e.enableEmbedded),B.setAllWallets(e.allWallets),B.setIncludeWalletIds(e.includeWalletIds),B.setExcludeWalletIds(e.excludeWalletIds),B.setFeaturedWalletIds(e.featuredWalletIds),B.setTokens(e.tokens),B.setTermsConditionsUrl(e.termsConditionsUrl),B.setPrivacyPolicyUrl(e.privacyPolicyUrl),B.setCustomWallets(e.customWallets),B.setFeatures(e.features),B.setAllowUnsupportedChain(e.allowUnsupportedChain),B.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),B.setPreferUniversalLinks(e.experimental_preferUniversalLinks),B.setDefaultAccountTypes(e.defaultAccountTypes);const s=H.getPreferredAccountTypes()||{},r={...B.state.defaultAccountTypes,...s};K.setPreferredAccountTypes(r);const i=this.getDefaultMetaData();if(!e.metadata&&i&&(e.metadata=i),B.setMetadata(e.metadata),B.setDisableAppend(e.disableAppend),B.setEnableEmbedded(e.enableEmbedded),B.setSIWX(e.siwx),!e.projectId){Vs.open(Ur.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(((o=e.adapters)==null?void 0:o.find(a=>a.namespace===V.CHAIN.EVM))&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");B.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){var e,s,r,i;return te.isClient()?{name:((s=(e=document.getElementsByTagName("title"))==null?void 0:e[0])==null?void 0:s.textContent)||"",description:((r=document.querySelector('meta[property="og:description"]'))==null?void 0:r.content)||"",url:window.location.origin,icons:[((i=document.querySelector('link[rel~="icon"]'))==null?void 0:i.href)||""]}:null}setUnsupportedNetwork(e){const s=this.getActiveChainNamespace();if(s){const r=Lr.getUnsupportedNetwork(`${s}:${e}`);b.setActiveCaipNetwork(r)}}getDefaultNetwork(){return Lr.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,s){return Lr.extendCaipNetwork(e,{customNetworkImageUrls:s.chainImages,projectId:s.projectId})}extendCaipNetworks(e){return Lr.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const s=e.networks.find(i=>{var n;return i.id===((n=e.defaultNetwork)==null?void 0:n.id)});return s?Lr.extendCaipNetwork(s,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}async disconnectNamespace(e){try{const s=this.getAdapter(e),r=ke.getProvider(e),i=ke.getProviderId(e),{caipAddress:n}=b.getAccountData(e)||{};this.setLoading(!0,e),n&&(s!=null&&s.disconnect)&&await s.disconnect({provider:r,providerType:i}),H.removeConnectedNamespace(e),ke.resetChain(e),this.setUser(void 0,e),this.setStatus("disconnected",e),this.setConnectedWalletInfo(void 0,e),W.removeConnectorId(e),b.resetAccount(e),b.resetNetwork(e),this.setLoading(!1,e)}catch(s){throw this.setLoading(!1,e),new Error(`Failed to disconnect chain ${e}: ${s.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{var n;const e=b.state.activeChain,s=this.getAdapter(e),r=(n=this.getCaipNetwork(e))==null?void 0:n.id;if(!s)throw new Error("Adapter not found");const i=await s.connectWalletConnect(r);this.close(),this.setClientId((i==null?void 0:i.clientId)||null),H.setConnectedNamespaces([...b.state.chains.keys()]),this.chainNamespaces.forEach(o=>{W.setConnectorId(xs.CONNECTOR_TYPE_WALLET_CONNECT,o)}),await this.syncWalletConnectAccount()},connectExternal:async({id:e,info:s,type:r,provider:i,chain:n,caipNetwork:o,socialUri:a})=>{var m,p,w,y,I,T;const c=b.state.activeChain,l=n||c,u=this.getAdapter(l);if(n&&n!==c&&!o){const $=this.getCaipNetworks().find(P=>P.chainNamespace===n);$&&this.setCaipNetwork($)}if(!u)throw new Error("Adapter not found");const h=this.getCaipNetwork(l),d=await u.connect({id:e,info:s,type:r,provider:i,socialUri:a,chainId:(o==null?void 0:o.id)||(h==null?void 0:h.id),rpcUrl:((w=(p=(m=o==null?void 0:o.rpcUrls)==null?void 0:m.default)==null?void 0:p.http)==null?void 0:w[0])||((T=(I=(y=h==null?void 0:h.rpcUrls)==null?void 0:y.default)==null?void 0:I.http)==null?void 0:T[0])});if(!d)return;H.addConnectedNamespace(l),this.syncProvider({...d,chainNamespace:l});const f=K.state.allAccounts,{accounts:g}=(f==null?void 0:f.length)>0?{accounts:[...f]}:await u.getAccounts({namespace:l,id:e});this.setAllAccounts(g,l),this.setStatus("connected",l),this.syncConnectedWalletInfo(l)},reconnectExternal:async({id:e,info:s,type:r,provider:i})=>{var a;const n=b.state.activeChain,o=this.getAdapter(n);o!=null&&o.reconnect&&(await(o==null?void 0:o.reconnect({id:e,info:s,type:r,provider:i,chainId:(a=this.getCaipNetwork())==null?void 0:a.id})),H.addConnectedNamespace(n),this.syncConnectedWalletInfo(n))},disconnect:async e=>{const s=lA(e);try{const r=await Promise.allSettled(s.map(async([n])=>this.disconnectNamespace(n)));ye.resetSend(),ee.resetWcConnection(),await zi.clearSessions(),W.setFilterByNamespace(void 0);const i=r.filter(n=>n.status==="rejected");if(i.length>0)throw new Error(i.map(n=>n.reason.message).join(", "));H.deleteConnectedSocialProvider(),Re.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:e||"all"}})}catch(r){throw new Error(`Failed to disconnect chains: ${r.message}`)}},checkInstalled:e=>e?e.some(s=>{var r;return!!((r=window.ethereum)!=null&&r[String(s)])}):!!window.ethereum,signMessage:async e=>{const s=this.getAdapter(b.state.activeChain),r=await(s==null?void 0:s.signMessage({message:e,address:K.state.address,provider:ke.getProvider(b.state.activeChain)}));return(r==null?void 0:r.signature)||""},sendTransaction:async e=>{const s=e.chainNamespace;if(_e.SEND_SUPPORTED_NAMESPACES.includes(s)){const r=this.getAdapter(b.state.activeChain),i=ke.getProvider(s),n=await(r==null?void 0:r.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:i}));return(n==null?void 0:n.hash)||""}return""},estimateGas:async e=>{if(e.chainNamespace===V.CHAIN.EVM){const s=this.getAdapter(b.state.activeChain),r=ke.getProvider(b.state.activeChain),i=this.getCaipNetwork();if(!i)throw new Error("CaipNetwork is undefined");const n=await(s==null?void 0:s.estimateGas({...e,provider:r,caipNetwork:i}));return(n==null?void 0:n.gas)||0n}return 0n},getEnsAvatar:async()=>{var e;return await this.syncIdentity({address:K.state.address,chainId:Number((e=this.getCaipNetwork())==null?void 0:e.id),chainNamespace:b.state.activeChain}),K.state.profileImage||!1},getEnsAddress:async e=>await Mn.resolveReownName(e),writeContract:async e=>{const s=this.getAdapter(b.state.activeChain),r=this.getCaipNetwork(),i=this.getCaipAddress(),n=ke.getProvider(b.state.activeChain);if(!r||!i)throw new Error("CaipNetwork or CaipAddress is undefined");const o=await(s==null?void 0:s.writeContract({...e,caipNetwork:r,provider:n,caipAddress:i}));return o==null?void 0:o.hash},parseUnits:(e,s)=>{const r=this.getAdapter(b.state.activeChain);return(r==null?void 0:r.parseUnits({value:e,decimals:s}))??0n},formatUnits:(e,s)=>{const r=this.getAdapter(b.state.activeChain);return(r==null?void 0:r.formatUnits({value:e,decimals:s}))??"0"},getCapabilities:async e=>{const s=this.getAdapter(b.state.activeChain);return await(s==null?void 0:s.getCapabilities(e))},grantPermissions:async e=>{const s=this.getAdapter(b.state.activeChain);return await(s==null?void 0:s.grantPermissions(e))},revokePermissions:async e=>{const s=this.getAdapter(b.state.activeChain);return s!=null&&s.revokePermissions?await s.revokePermissions(e):"0x"},walletGetAssets:async e=>{const s=this.getAdapter(b.state.activeChain);return await(s==null?void 0:s.walletGetAssets(e))??{}},updateBalance:e=>{const s=this.getCaipNetwork(e);!s||!K.state.address||this.updateNativeBalance(K.state.address,s==null?void 0:s.id,e)}},this.networkControllerClient={switchCaipNetwork:async e=>await this.switchCaipNetwork(e),getApprovedCaipNetworksData:async()=>this.getApprovedCaipNetworksData()},ee.setClient(this.connectionControllerClient)}getApprovedCaipNetworksData(){var s,r,i,n,o;if(ke.getProviderId(b.state.activeChain)===xs.CONNECTOR_TYPE_WALLET_CONNECT){const a=(r=(s=this.universalProvider)==null?void 0:s.session)==null?void 0:r.namespaces;return{supportsAllNetworks:((o=(n=(i=this.universalProvider)==null?void 0:i.session)==null?void 0:n.peer)==null?void 0:o.metadata.name)==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(a)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){if(!e)return;const s=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const i=ke.getProvider(s),n=ke.getProviderId(s);if(e.chainNamespace===b.state.activeChain){const o=this.getAdapter(s);await(o==null?void 0:o.switchNetwork({caipNetwork:e,provider:i,providerType:n}))}else if(this.setCaipNetwork(e),n===xs.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{const o=this.getAddressByChainNamespace(s);o&&this.syncAccount({address:o,chainId:e.id,chainNamespace:s})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(s=>{const r=s.chains||[],i=s.accounts.map(n=>{const{chainId:o,chainNamespace:a}=Ns.parseCaipAddress(n);return`${a}:${o}`});return Array.from(new Set([...r,...i]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((s,r)=>{var n;const i=e==null?void 0:e.find(o=>o.namespace===r);return i?(i.construct({namespace:r,projectId:(n=this.options)==null?void 0:n.projectId,networks:this.getCaipNetworks()}),s[r]=i):s[r]=new yA({namespace:r,networks:this.getCaipNetworks()}),s},{})}async initChainAdapter(e){var s;this.onConnectors(e),this.listenAdapter(e),await((s=this.chainAdapters)==null?void 0:s[e].syncConnectors(this.options,this)),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)}))}onConnectors(e){const s=this.getAdapter(e);s==null||s.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const s=this.getAdapter(e);if(!s)return;const r=H.getConnectionStatus();r==="connected"?this.setStatus("connecting",e):r==="disconnected"?(H.clearAddressCache(),this.setStatus(r,e)):this.setStatus(r,e),s.on("switchNetwork",({address:i,chainId:n})=>{const o=this.getCaipNetworks().find(l=>l.id===n||l.caipNetworkId===n),a=b.state.activeChain===e,c=b.getAccountProp("address",e);if(o){const l=a&&i?i:c;l&&this.syncAccount({address:l,chainId:o.id,chainNamespace:e})}else this.setUnsupportedNetwork(n)}),s.on("disconnect",this.disconnect.bind(this,e)),s.on("connections",i=>{this.setConnections(i,e)}),s.on("pendingTransactions",()=>{const i=K.state.address,n=b.state.activeCaipNetwork;!i||!(n!=null&&n.id)||this.updateNativeBalance(i,n.id,n.chainNamespace)}),s.on("accountChanged",({address:i,chainId:n})=>{var a,c;const o=b.state.activeChain===e;o&&n?this.syncAccount({address:i,chainId:n,chainNamespace:e}):o&&((a=b.state.activeCaipNetwork)!=null&&a.id)?this.syncAccount({address:i,chainId:(c=b.state.activeCaipNetwork)==null?void 0:c.id,chainNamespace:e}):this.syncAccountInfo(i,n,e),this.syncAllAccounts(e)})}async createUniversalProviderForAdapter(e){var s,r,i;await this.getUniversalProvider(),this.universalProvider&&((i=(r=(s=this.chainAdapters)==null?void 0:s[e])==null?void 0:r.setUniversalProvider)==null||i.call(r,this.universalProvider))}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async syncNamespaceConnection(e){try{e===V.CHAIN.EVM&&te.isSafeApp()&&W.setConnectorId(V.CONNECTOR_ID.SAFE,e);const s=W.getConnectorId(e);switch(this.setStatus("connecting",e),s){case V.CONNECTOR_ID.WALLET_CONNECT:await this.syncWalletConnectAccount();break;case V.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(s){console.warn("AppKit couldn't sync existing connection",s),this.setStatus("disconnected",e)}}async syncAdapterConnection(e){var a,c,l;const s=this.getAdapter(e),r=W.getConnectorId(e),i=this.getCaipNetwork(e),o=W.getConnectors(e).find(u=>u.id===r);try{if(!s||!o)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!(i!=null&&i.id))throw new Error("CaipNetwork not found");const u=await(s==null?void 0:s.syncConnection({namespace:e,id:o.id,chainId:i.id,rpcUrl:(l=(c=(a=i==null?void 0:i.rpcUrls)==null?void 0:a.default)==null?void 0:c.http)==null?void 0:l[0]}));if(u){const h=await(s==null?void 0:s.getAccounts({namespace:e,id:o.id}));h&&h.accounts.length>0?this.setAllAccounts(h.accounts,e):this.setAllAccounts([te.createAccount(e,u.address,"eoa")],e),this.syncProvider({...u,chainNamespace:e}),await this.syncAccount({...u,chainNamespace:e}),this.setStatus("connected",e)}else this.setStatus("disconnected",e)}catch{this.setStatus("disconnected",e)}}async syncWalletConnectAccount(){const e=this.chainNamespaces.map(async s=>{var a,c,l,u,h;const r=this.getAdapter(s),i=((u=(l=(c=(a=this.universalProvider)==null?void 0:a.session)==null?void 0:c.namespaces)==null?void 0:l[s])==null?void 0:u.accounts)||[],n=(h=b.state.activeCaipNetwork)==null?void 0:h.id,o=i.find(d=>{const{chainId:f}=Ns.parseCaipAddress(d);return f===(n==null?void 0:n.toString())})||i[0];if(o){const d=Ns.validateCaipAddress(o),{chainId:f,address:g}=Ns.parseCaipAddress(d);if(ke.setProviderId(s,xs.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&b.state.activeCaipNetwork&&(r==null?void 0:r.namespace)!==V.CHAIN.EVM){const m=r==null?void 0:r.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:b.state.activeCaipNetwork});ke.setProvider(s,m)}else ke.setProvider(s,this.universalProvider);W.setConnectorId(V.CONNECTOR_ID.WALLET_CONNECT,s),H.addConnectedNamespace(s),this.syncWalletConnectAccounts(s),await this.syncAccount({address:g,chainId:f,chainNamespace:s})}else this.setStatus("disconnected",s);this.syncConnectedWalletInfo(s),await b.setApprovedCaipNetworksData(s)});await Promise.all(e)}syncWalletConnectAccounts(e){var r,i,n,o,a;const s=(a=(o=(n=(i=(r=this.universalProvider)==null?void 0:r.session)==null?void 0:i.namespaces)==null?void 0:n[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>{const{address:l}=Ns.parseCaipAddress(c);return l}).filter((c,l,u)=>u.indexOf(c)===l);s&&this.setAllAccounts(s.map(c=>te.createAccount(e,c,e==="bip122"?"payment":"eoa")),e)}syncProvider({type:e,provider:s,id:r,chainNamespace:i}){ke.setProviderId(i,e),ke.setProvider(i,s),W.setConnectorId(r,i)}async syncAllAccounts(e){const s=W.getConnectorId(e);if(!s)return;const r=this.getAdapter(e),i=await(r==null?void 0:r.getAccounts({namespace:e,id:s}));i&&i.accounts.length>0&&this.setAllAccounts(i.accounts,e)}async syncAccount(e){var h,d;const s=e.chainNamespace===b.state.activeChain,r=b.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:i,chainId:n,chainNamespace:o}=e,{chainId:a}=H.getActiveNetworkProps(),c=n||a,l=((h=b.state.activeCaipNetwork)==null?void 0:h.name)===V.UNSUPPORTED_NETWORK_NAME,u=b.getNetworkProp("supportsAllNetworks",o);if(this.setStatus("connected",o),!(l&&!u)&&c){let f=this.getCaipNetworks().find(p=>p.id.toString()===c.toString()),g=this.getCaipNetworks().find(p=>p.chainNamespace===o);if(!u&&!f&&!g){const p=this.getApprovedCaipNetworkIds()||[],w=p.find(I=>{var T;return((T=Ns.parseCaipNetworkId(I))==null?void 0:T.chainId)===c.toString()}),y=p.find(I=>{var T;return((T=Ns.parseCaipNetworkId(I))==null?void 0:T.chainNamespace)===o});f=this.getCaipNetworks().find(I=>I.caipNetworkId===w),g=this.getCaipNetworks().find(I=>I.caipNetworkId===y||"deprecatedCaipNetworkId"in I&&I.deprecatedCaipNetworkId===y)}const m=f||g;(m==null?void 0:m.chainNamespace)===b.state.activeChain?B.state.enableNetworkSwitch&&!B.state.allowUnsupportedChain&&((d=b.state.activeCaipNetwork)==null?void 0:d.name)===V.UNSUPPORTED_NETWORK_NAME?b.showUnsupportedChainUI():this.setCaipNetwork(m):s||r&&this.setCaipNetworkOfNamespace(r,o),this.syncConnectedWalletInfo(o),bc.isLowerCaseMatch(i,K.state.address)||this.syncAccountInfo(i,m==null?void 0:m.id,o),s?await this.syncBalance({address:i,chainId:m==null?void 0:m.id,chainNamespace:o}):await this.syncBalance({address:i,chainId:r==null?void 0:r.id,chainNamespace:o})}}async syncAccountInfo(e,s,r){const i=this.getCaipAddress(r),n=s||(i==null?void 0:i.split(":")[1]);if(!n)return;const o=`${r}:${n}:${e}`;this.setCaipAddress(o,r),await this.syncIdentity({address:e,chainId:n,chainNamespace:r})}async syncReownName(e,s){try{const r=await this.getReownName(e);if(r[0]){const i=r[0];this.setProfileName(i.name,s)}else this.setProfileName(null,s)}catch{this.setProfileName(null,s)}}syncConnectedWalletInfo(e){var i;const s=W.getConnectorId(e),r=ke.getProviderId(e);if(r===xs.CONNECTOR_TYPE_ANNOUNCED||r===xs.CONNECTOR_TYPE_INJECTED){if(s){const n=this.getConnectors().find(o=>o.id===s);if(n){const{info:o,name:a,imageUrl:c}=n,l=c||this.getConnectorImage(n);this.setConnectedWalletInfo({name:a,icon:l,...o},e)}}}else if(r===xs.CONNECTOR_TYPE_WALLET_CONNECT){const n=ke.getProvider(e);n!=null&&n.session&&this.setConnectedWalletInfo({...n.session.peer.metadata,name:n.session.peer.metadata.name,icon:(i=n.session.peer.metadata.icons)==null?void 0:i[0]},e)}else if(s&&s===V.CONNECTOR_ID.COINBASE){const n=this.getConnectors().find(o=>o.id===V.CONNECTOR_ID.COINBASE);this.setConnectedWalletInfo({name:"Coinbase Wallet",icon:this.getConnectorImage(n)},e)}}async syncBalance(e){!th.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(r=>{var i;return r.id.toString()===((i=e.chainId)==null?void 0:i.toString())})||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(e,s,r){const i=this.getAdapter(r),n=b.getCaipNetworkByNamespace(r,s);if(i){const o=await i.getBalance({address:e,chainId:s,caipNetwork:n,tokens:this.options.tokens});return this.setBalance(o.balance,o.symbol,r),o}}async initializeUniversalAdapter(){var r,i,n,o,a,c,l,u,h,d;const e=hA.createLogger((f,...g)=>{f&&this.handleAlertError(f),console.error(...g)}),s={projectId:(r=this.options)==null?void 0:r.projectId,metadata:{name:(i=this.options)!=null&&i.metadata?(n=this.options)==null?void 0:n.metadata.name:"",description:(o=this.options)!=null&&o.metadata?(a=this.options)==null?void 0:a.metadata.description:"",url:(c=this.options)!=null&&c.metadata?(l=this.options)==null?void 0:l.metadata.url:"",icons:(u=this.options)!=null&&u.metadata?(h=this.options)==null?void 0:h.metadata.icons:[""]},logger:e};B.setManualWCControl(!!((d=this.options)!=null&&d.manualWCControl)),this.universalProvider=this.options.universalProvider??await yc.init(s),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&(this.universalProvider.on("display_uri",e=>{ee.setUri(e)}),this.universalProvider.on("connect",ee.finalizeWcConnection),this.universalProvider.on("disconnect",()=>{this.chainNamespaces.forEach(e=>{this.resetAccount(e)}),ee.resetWcConnection()}),this.universalProvider.on("chainChanged",e=>{const s=this.getCaipNetworks().find(i=>i.id==e),r=this.getCaipNetwork();if(!s){this.setUnsupportedNetwork(e);return}(r==null?void 0:r.id)!==(s==null?void 0:s.id)&&this.setCaipNetwork(s)}),this.universalProvider.on("session_event",e=>{if(Mn.isSessionEventData(e)){const{name:s,data:r}=e.params.event;s==="accountsChanged"&&Array.isArray(r)&&te.isCaipAddress(r[0])&&this.syncAccount(Ns.parseCaipAddress(r[0]))}}))}createUniversalProvider(){var e;return!this.universalProviderInitPromise&&te.isClient()&&((e=this.options)!=null&&e.projectId)&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){Re.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}handleAlertError(e){const s=Object.entries(Ur.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[r,i]=s??[],{message:n,alertErrorKey:o}=i??{};if(r&&n&&!this.reportedAlertErrors[r]){const a=Ur.ALERT_ERRORS[o];a&&(Vs.open(a,"error"),this.reportedAlertErrors[r]=!0)}}getAdapter(e){var s;if(e)return(s=this.chainAdapters)==null?void 0:s[e]}createAdapter(e){var i;if(!e)return;const s=e.namespace;if(!s)return;this.createClients();const r=e;r.namespace=s,r.construct({namespace:s,projectId:(i=this.options)==null?void 0:i.projectId,networks:this.getCaipNetworks()}),this.chainNamespaces.includes(s)||this.chainNamespaces.push(s),this.chainAdapters&&(this.chainAdapters[s]=r)}async open(e){if(await this.injectModalUi(),e!=null&&e.uri&&ee.setUri(e.uri),e!=null&&e.arguments)switch(e==null?void 0:e.view){case"Swap":return Ve.open({...e,data:{swap:e.arguments}})}return Ve.open(e)}async close(){await this.injectModalUi(),Ve.close()}setLoading(e,s){Ve.setLoading(e,s)}async disconnect(e){await ee.disconnect(e)}getSIWX(){return B.state.siwx}getError(){return""}getChainId(){var e;return(e=b.state.activeCaipNetwork)==null?void 0:e.id}async switchNetwork(e){const s=this.getCaipNetworks().find(r=>r.id===e.id);if(!s){Vs.open(Ur.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await b.switchActiveNetwork(s)}getWalletProvider(){return b.state.activeChain?ke.state.providers[b.state.activeChain]:null}getWalletProviderType(){return ke.getProviderId(b.state.activeChain)}subscribeProviders(e){return ke.subscribeProviders(e)}getThemeMode(){return St.state.themeMode}getThemeVariables(){return St.state.themeVariables}setThemeMode(e){St.setThemeMode(e),ap(St.state.themeMode)}setTermsConditionsUrl(e){B.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){B.setPrivacyPolicyUrl(e)}setThemeVariables(e){St.setThemeVariables(e),fA(St.state.themeVariables)}subscribeTheme(e){return St.subscribe(e)}getWalletInfo(){return K.state.connectedWalletInfo}getAccount(e){var o;const s=W.getAuthConnector(e),r=b.getAccountData(e),i=b.state.activeChain,n=H.getConnectedConnectorId(e||i);if(r)return{allAccounts:r.allAccounts,caipAddress:r.caipAddress,address:te.getPlainAddress(r.caipAddress),isConnected:!!r.caipAddress,status:r.status,embeddedWalletInfo:s&&n===V.CONNECTOR_ID.AUTH?{user:r.user?{...r.user,username:H.getConnectedSocialUsername()}:void 0,authProvider:r.socialProvider||"email",accountType:(o=r.preferredAccountTypes)==null?void 0:o[e||i],isSmartAccountDeployed:!!r.smartAccountDeployed}:void 0}}subscribeAccount(e,s){const r=()=>{const i=this.getAccount(s);i&&e(i)};s?b.subscribeChainProp("accountState",r,s):b.subscribe(r),W.subscribe(r)}subscribeNetwork(e){return b.subscribe(({activeCaipNetwork:s})=>{e({caipNetwork:s,chainId:s==null?void 0:s.id,caipNetworkId:s==null?void 0:s.caipNetworkId})})}subscribeWalletInfo(e){return K.subscribeKey("connectedWalletInfo",e)}subscribeShouldUpdateToAddress(e){K.subscribeKey("shouldUpdateToAddress",e)}subscribeCaipNetworkChange(e){b.subscribeKey("activeCaipNetwork",e)}getState(){return Us.state}subscribeState(e){return Us.subscribe(e)}showErrorMessage(e){Zt.showError(e)}showSuccessMessage(e){Zt.showSuccess(e)}getEvent(){return{...Re.state}}subscribeEvents(e){return Re.subscribe(e)}replace(e){ne.replace(e)}redirect(e){ne.push(e)}popTransactionStack(e){ne.popTransactionStack(e)}isOpen(){return Ve.state.open}isTransactionStackEmpty(){return ne.state.transactionStack.length===0}static getInstance(){return this.instance}updateFeatures(e){B.setFeatures(e)}updateRemoteFeatures(e){B.setRemoteFeatures(e)}updateOptions(e){const r={...B.state||{},...e};B.setOptions(r)}setConnectMethodsOrder(e){B.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){B.setWalletFeaturesOrder(e)}setCollapseWallets(e){B.setCollapseWallets(e)}setSocialsOrder(e){B.setSocialsOrder(e)}getConnectMethodsOrder(){return Ja.getConnectOrderMethod(B.state.features,W.getConnectors())}addNetwork(e,s){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);const r=this.extendCaipNetwork(s,this.options);this.getCaipNetworks().find(i=>i.id===r.id)||b.addNetwork(r)}removeNetwork(e,s){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(i=>i.id===s)&&b.removeNetwork(e,s)}}let Yu=!1;class lp extends EA{async open(e){W.isConnected()||await super.open(e)}async close(){await super.close(),this.options.manualWCControl&&ee.finalizeWcConnection()}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!Yu&&te.isClient()){if(await na(()=>import("./basic-Uba6gPM7.js"),__vite__mapDeps([3,2,1,4,5,6,7])),await na(()=>import("./w3m-modal-CzytgwBZ.js"),__vite__mapDeps([8,2,1,4,5])),!document.querySelector("w3m-modal")){const s=document.createElement("w3m-modal");!B.state.disableAppend&&!B.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",s)}Yu=!0}}}const IA="1.7.8";function CA(t){return new lp({...t,basic:!0,sdkVersion:`html-core-${IA}`})}const vS=Object.freeze(Object.defineProperty({__proto__:null,AppKit:lp,createAppKit:CA},Symbol.toStringTag,{value:"Module"}));export{Vs as A,V as B,b as C,Bn as D,Re as E,ee as F,H as G,lg as H,_e as I,vS as J,Ve as M,B as O,ne as R,zi as S,St as T,Ja as W,Dc as a,Qf as b,MA as c,BA as d,Zn as e,FA as f,qA as g,wS as h,bS as i,yS as j,Rt as k,nt as l,rh as m,Yt as n,pA as o,xe as p,W as q,jA as r,ot as s,oh as t,K as u,Zt as v,ug as w,J as x,mS as y,te as z};
